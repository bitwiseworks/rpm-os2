#! /bin/sh
# Generated from local.at by GNU Autoconf 2.69.
#
# Copyright (C) 2009-2012 Free Software Foundation, Inc.
#
# This test suite is free software; the Free Software Foundation gives
# unlimited permission to copy, distribute and modify it.
## -------------------- ##
## M4sh Initialization. ##
## -------------------- ##

# Be more Bourne compatible
DUALCASE=1; export DUALCASE # for MKS sh
if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then :
  emulate sh
  NULLCMD=:
  # Pre-4.2 versions of Zsh do word splitting on ${1+"$@"}, which
  # is contrary to our usage.  Disable this feature.
  alias -g '${1+"$@"}'='"$@"'
  setopt NO_GLOB_SUBST
else
  case `(set -o) 2>/dev/null` in #(
  *posix*) :
    set -o posix ;; #(
  *) :
     ;;
esac
fi


as_nl='
'
export as_nl
# Printing a long string crashes Solaris 7 /usr/bin/printf.
as_echo='\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\'
as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo
as_echo=$as_echo$as_echo$as_echo$as_echo$as_echo$as_echo
# Prefer a ksh shell builtin over an external printf program on Solaris,
# but without wasting forks for bash or zsh.
if test -z "$BASH_VERSION$ZSH_VERSION" \
    && (test "X`print -r -- $as_echo`" = "X$as_echo") 2>/dev/null; then
  as_echo='print -r --'
  as_echo_n='print -rn --'
elif (test "X`printf %s $as_echo`" = "X$as_echo") 2>/dev/null; then
  as_echo='printf %s\n'
  as_echo_n='printf %s'
else
  if test "X`(/usr/ucb/echo -n -n $as_echo) 2>/dev/null`" = "X-n $as_echo"; then
    as_echo_body='eval /usr/ucb/echo -n "$1$as_nl"'
    as_echo_n='/usr/ucb/echo -n'
  else
    as_echo_body='eval expr "X$1" : "X\\(.*\\)"'
    as_echo_n_body='eval
      arg=$1;
      case $arg in #(
      *"$as_nl"*)
	expr "X$arg" : "X\\(.*\\)$as_nl";
	arg=`expr "X$arg" : ".*$as_nl\\(.*\\)"`;;
      esac;
      expr "X$arg" : "X\\(.*\\)" | tr -d "$as_nl"
    '
    export as_echo_n_body
    as_echo_n='sh -c $as_echo_n_body as_echo'
  fi
  export as_echo_body
  as_echo='sh -c $as_echo_body as_echo'
fi

# The user is always right.
if test "${PATH_SEPARATOR+set}" != set; then
  PATH_SEPARATOR=:
  (PATH='/bin;/bin'; FPATH=$PATH; sh -c :) >/dev/null 2>&1 && {
    (PATH='/bin:/bin'; FPATH=$PATH; sh -c :) >/dev/null 2>&1 ||
      PATH_SEPARATOR=';'
  }
fi


# IFS
# We need space, tab and new line, in precisely that order.  Quoting is
# there to prevent editors from complaining about space-tab.
# (If _AS_PATH_WALK were called with IFS unset, it would disable word
# splitting by setting IFS to empty value.)
IFS=" ""	$as_nl"

# Find who we are.  Look in the path if we contain no directory separator.
as_myself=
case $0 in #((
  *[\\/]* ) as_myself=$0 ;;
  *) as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
for as_dir in $PATH
do
  IFS=$as_save_IFS
  test -z "$as_dir" && as_dir=.
    test -r "$as_dir/$0" && as_myself=$as_dir/$0 && break
  done
IFS=$as_save_IFS

     ;;
esac
# We did not find ourselves, most probably we were run as `sh COMMAND'
# in which case we are not to be found in the path.
if test "x$as_myself" = x; then
  as_myself=$0
fi
if test ! -f "$as_myself"; then
  $as_echo "$as_myself: error: cannot find myself; rerun with an absolute file name" >&2
  exit 1
fi

# Unset variables that we do not need and which cause bugs (e.g. in
# pre-3.0 UWIN ksh).  But do not cause bugs in bash 2.01; the "|| exit 1"
# suppresses any "Segmentation fault" message there.  '((' could
# trigger a bug in pdksh 5.2.14.
for as_var in BASH_ENV ENV MAIL MAILPATH
do eval test x\${$as_var+set} = xset \
  && ( (unset $as_var) || exit 1) >/dev/null 2>&1 && unset $as_var || :
done
PS1='$ '
PS2='> '
PS4='+ '

# NLS nuisances.
LC_ALL=C
export LC_ALL
LANGUAGE=C
export LANGUAGE

# CDPATH.
(unset CDPATH) >/dev/null 2>&1 && unset CDPATH

if test "x$CONFIG_SHELL" = x; then
  as_bourne_compatible="if test -n \"\${ZSH_VERSION+set}\" && (emulate sh) >/dev/null 2>&1; then :
  emulate sh
  NULLCMD=:
  # Pre-4.2 versions of Zsh do word splitting on \${1+\"\$@\"}, which
  # is contrary to our usage.  Disable this feature.
  alias -g '\${1+\"\$@\"}'='\"\$@\"'
  setopt NO_GLOB_SUBST
else
  case \`(set -o) 2>/dev/null\` in #(
  *posix*) :
    set -o posix ;; #(
  *) :
     ;;
esac
fi
"
  as_required="as_fn_return () { (exit \$1); }
as_fn_success () { as_fn_return 0; }
as_fn_failure () { as_fn_return 1; }
as_fn_ret_success () { return 0; }
as_fn_ret_failure () { return 1; }

exitcode=0
as_fn_success || { exitcode=1; echo as_fn_success failed.; }
as_fn_failure && { exitcode=1; echo as_fn_failure succeeded.; }
as_fn_ret_success || { exitcode=1; echo as_fn_ret_success failed.; }
as_fn_ret_failure && { exitcode=1; echo as_fn_ret_failure succeeded.; }
if ( set x; as_fn_ret_success y && test x = \"\$1\" ); then :

else
  exitcode=1; echo positional parameters were not saved.
fi
test x\$exitcode = x0 || exit 1
test -x / || exit 1"
  as_suggested="  as_lineno_1=";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested" as_lineno_1a=\$LINENO
  as_lineno_2=";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested" as_lineno_2a=\$LINENO
  eval 'test \"x\$as_lineno_1'\$as_run'\" != \"x\$as_lineno_2'\$as_run'\" &&
  test \"x\`expr \$as_lineno_1'\$as_run' + 1\`\" = \"x\$as_lineno_2'\$as_run'\"' || exit 1
test \$(( 1 + 1 )) = 2 || exit 1"
  if (eval "$as_required") 2>/dev/null; then :
  as_have_required=yes
else
  as_have_required=no
fi
  if test x$as_have_required = xyes && (eval "$as_suggested") 2>/dev/null; then :

else
  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
as_found=false
for as_dir in /bin$PATH_SEPARATOR/usr/bin$PATH_SEPARATOR$PATH
do
  IFS=$as_save_IFS
  test -z "$as_dir" && as_dir=.
  as_found=:
  case $as_dir in #(
	 /*)
	   for as_base in sh bash ksh sh5; do
	     # Try only shells that exist, to save several forks.
	     as_shell=$as_dir/$as_base
	     if { test -f "$as_shell" || test -f "$as_shell.exe"; } &&
		    { $as_echo "$as_bourne_compatible""$as_required" | as_run=a "$as_shell"; } 2>/dev/null; then :
  CONFIG_SHELL=$as_shell as_have_required=yes
		   if { $as_echo "$as_bourne_compatible""$as_suggested" | as_run=a "$as_shell"; } 2>/dev/null; then :
  break 2
fi
fi
	   done;;
       esac
  as_found=false
done
$as_found || { if { test -f "$SHELL" || test -f "$SHELL.exe"; } &&
	      { $as_echo "$as_bourne_compatible""$as_required" | as_run=a "$SHELL"; } 2>/dev/null; then :
  CONFIG_SHELL=$SHELL as_have_required=yes
fi; }
IFS=$as_save_IFS


      if test "x$CONFIG_SHELL" != x; then :
  export CONFIG_SHELL
             # We cannot yet assume a decent shell, so we have to provide a
# neutralization value for shells without unset; and this also
# works around shells that cannot unset nonexistent variables.
# Preserve -v and -x to the replacement shell.
BASH_ENV=/dev/null
ENV=/dev/null
(unset BASH_ENV) >/dev/null 2>&1 && unset BASH_ENV ENV
case $- in # ((((
  *v*x* | *x*v* ) as_opts=-vx ;;
  *v* ) as_opts=-v ;;
  *x* ) as_opts=-x ;;
  * ) as_opts= ;;
esac
exec $CONFIG_SHELL $as_opts "$as_myself" ${1+"$@"}
# Admittedly, this is quite paranoid, since all the known shells bail
# out after a failed `exec'.
$as_echo "$0: could not re-execute with $CONFIG_SHELL" >&2
exit 255
fi

    if test x$as_have_required = xno; then :
  $as_echo "$0: This script requires a shell more modern than all"
  $as_echo "$0: the shells that I found on your system."
  if test x${ZSH_VERSION+set} = xset ; then
    $as_echo "$0: In particular, zsh $ZSH_VERSION has bugs and should"
    $as_echo "$0: be upgraded to zsh 4.3.4 or later."
  else
    $as_echo "$0: Please tell bug-autoconf@gnu.org about your system,
$0: including any error possibly output before this
$0: message. Then install a modern shell, or manually run
$0: the script under such a shell if you do have one."
  fi
  exit 1
fi
fi
fi
SHELL=${CONFIG_SHELL-/bin/sh}
export SHELL
# Unset more variables known to interfere with behavior of common tools.
CLICOLOR_FORCE= GREP_OPTIONS=
unset CLICOLOR_FORCE GREP_OPTIONS

## --------------------- ##
## M4sh Shell Functions. ##
## --------------------- ##
# as_fn_unset VAR
# ---------------
# Portably unset VAR.
as_fn_unset ()
{
  { eval $1=; unset $1;}
}
as_unset=as_fn_unset

# as_fn_set_status STATUS
# -----------------------
# Set $? to STATUS, without forking.
as_fn_set_status ()
{
  return $1
} # as_fn_set_status

# as_fn_exit STATUS
# -----------------
# Exit the shell with STATUS, even in a "trap 0" or "set -e" context.
as_fn_exit ()
{
  set +e
  as_fn_set_status $1
  exit $1
} # as_fn_exit

# as_fn_mkdir_p
# -------------
# Create "$as_dir" as a directory, including parents if necessary.
as_fn_mkdir_p ()
{

  case $as_dir in #(
  -*) as_dir=./$as_dir;;
  esac
  test -d "$as_dir" || eval $as_mkdir_p || {
    as_dirs=
    while :; do
      case $as_dir in #(
      *\'*) as_qdir=`$as_echo "$as_dir" | sed "s/'/'\\\\\\\\''/g"`;; #'(
      *) as_qdir=$as_dir;;
      esac
      as_dirs="'$as_qdir' $as_dirs"
      as_dir=`$as_dirname -- "$as_dir" ||
$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
	 X"$as_dir" : 'X\(//\)[^/]' \| \
	 X"$as_dir" : 'X\(//\)$' \| \
	 X"$as_dir" : 'X\(/\)' \| . 2>/dev/null ||
$as_echo X"$as_dir" |
    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{
	    s//\1/
	    q
	  }
	  /^X\(\/\/\)[^/].*/{
	    s//\1/
	    q
	  }
	  /^X\(\/\/\)$/{
	    s//\1/
	    q
	  }
	  /^X\(\/\).*/{
	    s//\1/
	    q
	  }
	  s/.*/./; q'`
      test -d "$as_dir" && break
    done
    test -z "$as_dirs" || eval "mkdir $as_dirs"
  } || test -d "$as_dir" || as_fn_error $? "cannot create directory $as_dir"


} # as_fn_mkdir_p

# as_fn_executable_p FILE
# -----------------------
# Test if FILE is an executable regular file.
as_fn_executable_p ()
{
  test -f "$1" && test -x "$1"
} # as_fn_executable_p
# as_fn_append VAR VALUE
# ----------------------
# Append the text in VALUE to the end of the definition contained in VAR. Take
# advantage of any shell optimizations that allow amortized linear growth over
# repeated appends, instead of the typical quadratic growth present in naive
# implementations.
if (eval "as_var=1; as_var+=2; test x\$as_var = x12") 2>/dev/null; then :
  eval 'as_fn_append ()
  {
    eval $1+=\$2
  }'
else
  as_fn_append ()
  {
    eval $1=\$$1\$2
  }
fi # as_fn_append

# as_fn_arith ARG...
# ------------------
# Perform arithmetic evaluation on the ARGs, and store the result in the
# global $as_val. Take advantage of shells that can avoid forks. The arguments
# must be portable across $(()) and expr.
if (eval "test \$(( 1 + 1 )) = 2") 2>/dev/null; then :
  eval 'as_fn_arith ()
  {
    as_val=$(( $* ))
  }'
else
  as_fn_arith ()
  {
    as_val=`expr "$@" || test $? -eq 1`
  }
fi # as_fn_arith


# as_fn_error STATUS ERROR [LINENO LOG_FD]
# ----------------------------------------
# Output "`basename $0`: error: ERROR" to stderr. If LINENO and LOG_FD are
# provided, also output the error to LOG_FD, referencing LINENO. Then exit the
# script with STATUS, using 1 if that was 0.
as_fn_error ()
{
  as_status=$1; test $as_status -eq 0 && as_status=1
  if test "$4"; then
    as_lineno=${as_lineno-"$3"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
    $as_echo "$as_me:${as_lineno-$LINENO}: error: $2" >&$4
  fi
  $as_echo "$as_me: error: $2" >&2
  as_fn_exit $as_status
} # as_fn_error

if expr a : '\(a\)' >/dev/null 2>&1 &&
   test "X`expr 00001 : '.*\(...\)'`" = X001; then
  as_expr=expr
else
  as_expr=false
fi

if (basename -- /) >/dev/null 2>&1 && test "X`basename -- / 2>&1`" = "X/"; then
  as_basename=basename
else
  as_basename=false
fi

as_me=`$as_basename -- "$0" ||
$as_expr X/"$0" : '.*/\([^/][^/]*\)/*$' \| \
	 X"$0" : 'X\(//\)$' \| \
	 X"$0" : 'X\(/\)' \| . 2>/dev/null ||
$as_echo X/"$0" |
    sed '/^.*\/\([^/][^/]*\)\/*$/{
	    s//\1/
	    q
	  }
	  /^X\/\(\/\/\)$/{
	    s//\1/
	    q
	  }
	  /^X\/\(\/\).*/{
	    s//\1/
	    q
	  }
	  s/.*/./; q'`

if (as_dir=`dirname -- /` && test "X$as_dir" = X/) >/dev/null 2>&1; then
  as_dirname=dirname
else
  as_dirname=false
fi

# Avoid depending upon Character Ranges.
as_cr_letters='abcdefghijklmnopqrstuvwxyz'
as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
as_cr_Letters=$as_cr_letters$as_cr_LETTERS
as_cr_digits='0123456789'
as_cr_alnum=$as_cr_Letters$as_cr_digits


  as_lineno_1=$LINENO as_lineno_1a=$LINENO
  as_lineno_2=$LINENO as_lineno_2a=$LINENO
  eval 'test "x$as_lineno_1'$as_run'" != "x$as_lineno_2'$as_run'" &&
  test "x`expr $as_lineno_1'$as_run' + 1`" = "x$as_lineno_2'$as_run'"' || {
  # Blame Lee E. McMahon (1931-1989) for sed's syntax.  :-)
  sed -n '
    p
    /[$]LINENO/=
  ' <$as_myself |
    sed '
      s/[$]LINENO.*/&-/
      t lineno
      b
      :lineno
      N
      :loop
      s/[$]LINENO\([^'$as_cr_alnum'_].*\n\)\(.*\)/\2\1\2/
      t loop
      s/-\n.*//
    ' >$as_me.lineno &&
  chmod +x "$as_me.lineno" ||
    { $as_echo "$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&2; as_fn_exit 1; }

  # If we had to re-execute with $CONFIG_SHELL, we're ensured to have
  # already done that, so ensure we don't try to do so again and fall
  # in an infinite loop.  This has already happened in practice.
  _as_can_reexec=no; export _as_can_reexec
  # Don't try to exec as it changes $[0], causing all sort of problems
  # (the dirname of $[0] is not the place where we might find the
  # original and so on.  Autoconf is especially sensitive to this).
  . "./$as_me.lineno"
  # Exit status is that of the last command.
  exit
}

ECHO_C= ECHO_N= ECHO_T=
case `echo -n x` in #(((((
-n*)
  case `echo 'xy\c'` in
  *c*) ECHO_T='	';;	# ECHO_T is single tab character.
  xy)  ECHO_C='\c';;
  *)   echo `echo ksh88 bug on AIX 6.1` > /dev/null
       ECHO_T='	';;
  esac;;
*)
  ECHO_N='-n';;
esac

rm -f conf$$ conf$$.exe conf$$.file
if test -d conf$$.dir; then
  rm -f conf$$.dir/conf$$.file
else
  rm -f conf$$.dir
  mkdir conf$$.dir 2>/dev/null
fi
if (echo >conf$$.file) 2>/dev/null; then
  if ln -s conf$$.file conf$$ 2>/dev/null; then
    as_ln_s='ln -s'
    # ... but there are two gotchas:
    # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
    # 2) DJGPP < 2.04 has no symlinks; `ln -s' creates a wrapper executable.
    # In both cases, we have to default to `cp -pR'.
    ln -s conf$$.file conf$$.dir 2>/dev/null && test ! -f conf$$.exe ||
      as_ln_s='cp -pR'
  elif ln conf$$.file conf$$ 2>/dev/null; then
    as_ln_s=ln
  else
    as_ln_s='cp -pR'
  fi
else
  as_ln_s='cp -pR'
fi
rm -f conf$$ conf$$.exe conf$$.dir/conf$$.file conf$$.file
rmdir conf$$.dir 2>/dev/null

if mkdir -p . 2>/dev/null; then
  as_mkdir_p='mkdir -p "$as_dir"'
else
  test -d ./-p && rmdir ./-p
  as_mkdir_p=false
fi

as_test_x='test -x'
as_executable_p=as_fn_executable_p

# Sed expression to map a string onto a valid CPP name.
as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"

# Sed expression to map a string onto a valid variable name.
as_tr_sh="eval sed 'y%*+%pp%;s%[^_$as_cr_alnum]%_%g'"





SHELL=${CONFIG_SHELL-/bin/sh}

# How were we run?
at_cli_args="$@"


# Not all shells have the 'times' builtin; the subshell is needed to make
# sure we discard the 'times: not found' message from the shell.
at_times_p=false
(times) >/dev/null 2>&1 && at_times_p=:

# CLI Arguments to pass to the debugging scripts.
at_debug_args=
# -e sets to true
at_errexit_p=false
# Shall we be verbose?  ':' means no, empty means yes.
at_verbose=:
at_quiet=
# Running several jobs in parallel, 0 means as many as test groups.
at_jobs=1
at_traceon=:
at_trace_echo=:
at_check_filter_trace=:

# Shall we keep the debug scripts?  Must be `:' when the suite is
# run by a debug script, so that the script doesn't remove itself.
at_debug_p=false
# Display help message?
at_help_p=false
# Display the version message?
at_version_p=false
# List test groups?
at_list_p=false
# --clean
at_clean=false
# Test groups to run
at_groups=
# Whether to rerun failed tests.
at_recheck=
# Whether a write failure occurred
at_write_fail=0

# The directory we run the suite in.  Default to . if no -C option.
at_dir=`pwd`
# An absolute reference to this testsuite script.
case $as_myself in
  [\\/]* | ?:[\\/]* ) at_myself=$as_myself ;;
  * ) at_myself=$at_dir/$as_myself ;;
esac
# Whether -C is in effect.
at_change_dir=false

# Whether to enable colored test results.
at_color=auto
# List of the tested programs.
at_tested='rpm
rpmbuild
rpmquery'
# As many question marks as there are digits in the last test group number.
# Used to normalize the test group numbers so that `ls' lists them in
# numerical order.
at_format='???'
# Description of all the test groups.
at_help_all="1;rpmgeneral.at:22;rpm --version;basic;
2;rpmgeneral.at:31;rpmbuild --version;basic;
3;rpmgeneral.at:39;rpm library version;basic;
4;rpmgeneral.at:55;rpm --showrc;basic;
5;rpmgeneral.at:65;rpm --querytags;basic;
6;rpmgeneral.at:317;rpm2cpio;basic;
7;rpmgeneral.at:334;rpm2archive;basic;
8;rpmvercmp.at:14;rpmvercmp(1.0, 1.0) = 0;vercmp;
9;rpmvercmp.at:15;rpmvercmp(1.0, 2.0) = -1;vercmp;
10;rpmvercmp.at:16;rpmvercmp(2.0, 1.0) = 1;vercmp;
11;rpmvercmp.at:18;rpmvercmp(2.0.1, 2.0.1) = 0;vercmp;
12;rpmvercmp.at:19;rpmvercmp(2.0, 2.0.1) = -1;vercmp;
13;rpmvercmp.at:20;rpmvercmp(2.0.1, 2.0) = 1;vercmp;
14;rpmvercmp.at:22;rpmvercmp(2.0.1a, 2.0.1a) = 0;vercmp;
15;rpmvercmp.at:23;rpmvercmp(2.0.1a, 2.0.1) = 1;vercmp;
16;rpmvercmp.at:24;rpmvercmp(2.0.1, 2.0.1a) = -1;vercmp;
17;rpmvercmp.at:26;rpmvercmp(5.5p1, 5.5p1) = 0;vercmp;
18;rpmvercmp.at:27;rpmvercmp(5.5p1, 5.5p2) = -1;vercmp;
19;rpmvercmp.at:28;rpmvercmp(5.5p2, 5.5p1) = 1;vercmp;
20;rpmvercmp.at:30;rpmvercmp(5.5p10, 5.5p10) = 0;vercmp;
21;rpmvercmp.at:31;rpmvercmp(5.5p1, 5.5p10) = -1;vercmp;
22;rpmvercmp.at:32;rpmvercmp(5.5p10, 5.5p1) = 1;vercmp;
23;rpmvercmp.at:34;rpmvercmp(10xyz, 10.1xyz) = -1;vercmp;
24;rpmvercmp.at:35;rpmvercmp(10.1xyz, 10xyz) = 1;vercmp;
25;rpmvercmp.at:37;rpmvercmp(xyz10, xyz10) = 0;vercmp;
26;rpmvercmp.at:38;rpmvercmp(xyz10, xyz10.1) = -1;vercmp;
27;rpmvercmp.at:39;rpmvercmp(xyz10.1, xyz10) = 1;vercmp;
28;rpmvercmp.at:41;rpmvercmp(xyz.4, xyz.4) = 0;vercmp;
29;rpmvercmp.at:42;rpmvercmp(xyz.4, 8) = -1;vercmp;
30;rpmvercmp.at:43;rpmvercmp(8, xyz.4) = 1;vercmp;
31;rpmvercmp.at:44;rpmvercmp(xyz.4, 2) = -1;vercmp;
32;rpmvercmp.at:45;rpmvercmp(2, xyz.4) = 1;vercmp;
33;rpmvercmp.at:47;rpmvercmp(5.5p2, 5.6p1) = -1;vercmp;
34;rpmvercmp.at:48;rpmvercmp(5.6p1, 5.5p2) = 1;vercmp;
35;rpmvercmp.at:50;rpmvercmp(5.6p1, 6.5p1) = -1;vercmp;
36;rpmvercmp.at:51;rpmvercmp(6.5p1, 5.6p1) = 1;vercmp;
37;rpmvercmp.at:53;rpmvercmp(6.0.rc1, 6.0) = 1;vercmp;
38;rpmvercmp.at:54;rpmvercmp(6.0, 6.0.rc1) = -1;vercmp;
39;rpmvercmp.at:56;rpmvercmp(10b2, 10a1) = 1;vercmp;
40;rpmvercmp.at:57;rpmvercmp(10a2, 10b2) = -1;vercmp;
41;rpmvercmp.at:59;rpmvercmp(1.0aa, 1.0aa) = 0;vercmp;
42;rpmvercmp.at:60;rpmvercmp(1.0a, 1.0aa) = -1;vercmp;
43;rpmvercmp.at:61;rpmvercmp(1.0aa, 1.0a) = 1;vercmp;
44;rpmvercmp.at:63;rpmvercmp(10.0001, 10.0001) = 0;vercmp;
45;rpmvercmp.at:64;rpmvercmp(10.0001, 10.1) = 0;vercmp;
46;rpmvercmp.at:65;rpmvercmp(10.1, 10.0001) = 0;vercmp;
47;rpmvercmp.at:66;rpmvercmp(10.0001, 10.0039) = -1;vercmp;
48;rpmvercmp.at:67;rpmvercmp(10.0039, 10.0001) = 1;vercmp;
49;rpmvercmp.at:69;rpmvercmp(4.999.9, 5.0) = -1;vercmp;
50;rpmvercmp.at:70;rpmvercmp(5.0, 4.999.9) = 1;vercmp;
51;rpmvercmp.at:72;rpmvercmp(20101121, 20101121) = 0;vercmp;
52;rpmvercmp.at:73;rpmvercmp(20101121, 20101122) = -1;vercmp;
53;rpmvercmp.at:74;rpmvercmp(20101122, 20101121) = 1;vercmp;
54;rpmvercmp.at:76;rpmvercmp(2_0, 2_0) = 0;vercmp;
55;rpmvercmp.at:77;rpmvercmp(2.0, 2_0) = 0;vercmp;
56;rpmvercmp.at:78;rpmvercmp(2_0, 2.0) = 0;vercmp;
57;rpmvercmp.at:81;rpmvercmp(a, a) = 0;vercmp;
58;rpmvercmp.at:82;rpmvercmp(a+, a+) = 0;vercmp;
59;rpmvercmp.at:83;rpmvercmp(a+, a_) = 0;vercmp;
60;rpmvercmp.at:84;rpmvercmp(a_, a+) = 0;vercmp;
61;rpmvercmp.at:85;rpmvercmp(+a, +a) = 0;vercmp;
62;rpmvercmp.at:86;rpmvercmp(+a, _a) = 0;vercmp;
63;rpmvercmp.at:87;rpmvercmp(_a, +a) = 0;vercmp;
64;rpmvercmp.at:88;rpmvercmp(+_, +_) = 0;vercmp;
65;rpmvercmp.at:89;rpmvercmp(_+, +_) = 0;vercmp;
66;rpmvercmp.at:90;rpmvercmp(_+, _+) = 0;vercmp;
67;rpmvercmp.at:91;rpmvercmp(+, _) = 0;vercmp;
68;rpmvercmp.at:92;rpmvercmp(_, +) = 0;vercmp;
69;rpmvercmp.at:95;rpmvercmp(1.0~rc1, 1.0~rc1) = 0;vercmp;
70;rpmvercmp.at:96;rpmvercmp(1.0~rc1, 1.0) = -1;vercmp;
71;rpmvercmp.at:97;rpmvercmp(1.0, 1.0~rc1) = 1;vercmp;
72;rpmvercmp.at:98;rpmvercmp(1.0~rc1, 1.0~rc2) = -1;vercmp;
73;rpmvercmp.at:99;rpmvercmp(1.0~rc2, 1.0~rc1) = 1;vercmp;
74;rpmvercmp.at:100;rpmvercmp(1.0~rc1~git123, 1.0~rc1~git123) = 0;vercmp;
75;rpmvercmp.at:101;rpmvercmp(1.0~rc1~git123, 1.0~rc1) = -1;vercmp;
76;rpmvercmp.at:102;rpmvercmp(1.0~rc1, 1.0~rc1~git123) = 1;vercmp;
77;rpmvercmp.at:105;rpmvercmp(1.0^, 1.0^) = 0;vercmp;
78;rpmvercmp.at:106;rpmvercmp(1.0^, 1.0) = 1;vercmp;
79;rpmvercmp.at:107;rpmvercmp(1.0, 1.0^) = -1;vercmp;
80;rpmvercmp.at:108;rpmvercmp(1.0^git1, 1.0^git1) = 0;vercmp;
81;rpmvercmp.at:109;rpmvercmp(1.0^git1, 1.0) = 1;vercmp;
82;rpmvercmp.at:110;rpmvercmp(1.0, 1.0^git1) = -1;vercmp;
83;rpmvercmp.at:111;rpmvercmp(1.0^git1, 1.0^git2) = -1;vercmp;
84;rpmvercmp.at:112;rpmvercmp(1.0^git2, 1.0^git1) = 1;vercmp;
85;rpmvercmp.at:113;rpmvercmp(1.0^git1, 1.01) = -1;vercmp;
86;rpmvercmp.at:114;rpmvercmp(1.01, 1.0^git1) = 1;vercmp;
87;rpmvercmp.at:115;rpmvercmp(1.0^20160101, 1.0^20160101) = 0;vercmp;
88;rpmvercmp.at:116;rpmvercmp(1.0^20160101, 1.0.1) = -1;vercmp;
89;rpmvercmp.at:117;rpmvercmp(1.0.1, 1.0^20160101) = 1;vercmp;
90;rpmvercmp.at:118;rpmvercmp(1.0^20160101^git1, 1.0^20160101^git1) = 0;vercmp;
91;rpmvercmp.at:119;rpmvercmp(1.0^20160102, 1.0^20160101^git1) = 1;vercmp;
92;rpmvercmp.at:120;rpmvercmp(1.0^20160101^git1, 1.0^20160102) = -1;vercmp;
93;rpmvercmp.at:123;rpmvercmp(1.0~rc1^git1, 1.0~rc1^git1) = 0;vercmp;
94;rpmvercmp.at:124;rpmvercmp(1.0~rc1^git1, 1.0~rc1) = 1;vercmp;
95;rpmvercmp.at:125;rpmvercmp(1.0~rc1, 1.0~rc1^git1) = -1;vercmp;
96;rpmvercmp.at:126;rpmvercmp(1.0^git1~pre, 1.0^git1~pre) = 0;vercmp;
97;rpmvercmp.at:127;rpmvercmp(1.0^git1, 1.0^git1~pre) = 1;vercmp;
98;rpmvercmp.at:128;rpmvercmp(1.0^git1~pre, 1.0^git1) = -1;vercmp;
99;rpmmacro.at:6;simple rpm --eval;macros;
100;rpmmacro.at:20;invalid rpm --eval;macros;
101;rpmmacro.at:32;invalid rpm --define;macros;
102;rpmmacro.at:45;rpm --undefine;macros;
103;rpmmacro.at:60;simple true conditional rpm --eval;macros;
104;rpmmacro.at:70;simple false conditional rpm --eval;macros;
105;rpmmacro.at:80;nested macro in name;macros;
106;rpmmacro.at:90;parametrized macro 1;macros;
107;rpmmacro.at:127;parametrized macro 2;macros;
108;rpmmacro.at:140;parametrized macro 3;macros;
109;rpmmacro.at:152;parametrized macro 4;macros;
110;rpmmacro.at:167;parametrized macro 5;macros;
111;rpmmacro.at:201;parametrized macro 6;macros;
112;rpmmacro.at:213;uncompress macro 1;macros;
113;rpmmacro.at:225;uncompress macro 2;macros;
114;rpmmacro.at:238;basename macro;macros;
115;rpmmacro.at:249;shrink macro;macros;
116;rpmmacro.at:260;suffix macro;macros;
117;rpmmacro.at:271;url2path macro;macros;
118;rpmmacro.at:282;macrobody macro;macros;
119;rpmmacro.at:299;builtin macro arguments;macros;
120;rpmmacro.at:338;macro arguments;macros;
121;rpmmacro.at:360;expr macro 1;macros;
122;rpmmacro.at:402;expr macro 2;macros;
123;rpmmacro.at:436;ternary expressions;macros;
124;rpmmacro.at:466;short circuiting;macros;
125;rpmmacro.at:482;shell expansion;macros;
126;rpmmacro.at:493;expression expansion 1;macros;
127;rpmmacro.at:519;expression expansion 2;macros;
128;rpmmacro.at:543;expression version comparison;macros;
129;rpmmacro.at:561;simple lua --eval;macros lua;
130;rpmmacro.at:571;lua macro arguments;macros lua;
131;rpmmacro.at:584;lua macros table;macros lua;
132;rpmmacro.at:616;lua macros recursion;macros lua;
133;rpmmacro.at:628;lua rpm extensions 1;macros lua;
134;rpmmacro.at:638;lua rpm extensions 2;macros lua;
135;rpmmacro.at:648;lua rpm isdefined;macros lua;
136;rpmmacro.at:663;lua posix extensions;macros lua;
137;rpmmacro.at:674;lua script exit behavior;macros lua;
138;rpmmacro.at:686;lua script redirect2null;macros lua;
139;rpmmacro.at:698;lua library path;macros lua;
140;rpmmacro.at:713;lua rpm version objects;macros lua;
141;rpmmacro.at:730;lua rpm io stream;macros lua;
142;rpmmacro.at:746;%define + %undefine in nested levels 1;macros define undefine;
143;rpmmacro.at:761;%define + %undefine in nested levels 2;macros define;
144;rpmmacro.at:777;%define + %undefine in nested levels 3;macros define;
145;rpmmacro.at:795;%define + %undefine in nested levels 4;macros define global;
146;rpmmacro.at:817;%define in conditional macro;macros;
147;rpmmacro.at:835;%verbose macro;macros verbose;
148;rpmmacro.at:850;%exists macro;macros;
149;rpmmacro.at:866;macro with a line starting by \"{\";macros;
150;rpmmacro.at:878;macro with %if-%endif;macros;
151;rpmmacro.at:890;macro file errors;macros;
152;rpmmacro.at:914;macro comments;macros;
153;rpmmacro.at:933;macro comments 2;macros;
154;rpmmacro.at:948;macro file empty lines;macros;
155;rpmmacro.at:965;macro traceback;macros;
156;rpmmacro.at:988;no space left on stdout;macros;
157;rpmpython.at:6;module import;python;
158;rpmpython.at:12;macro manipulation;python;
159;rpmpython.at:35;basic rpmio;python;
160;rpmpython.at:70;spec parse 1;python;
161;rpmpython.at:85;spec parse 2;python;
162;rpmpython.at:90;basic header manipulation;python;
163;rpmpython.at:114;non-utf8 data in header;python;
164;rpmpython.at:133;invalid header data;python;
165;rpmpython.at:152;labelCompare;python;
166;rpmpython.at:192;vfyflags API;python;
167;rpmpython.at:203;vfylevel API;python;
168;rpmpython.at:214;reading a package file;python;
169;rpmpython.at:222;reading a signed package file 1;python;
170;rpmpython.at:237;reading a signed package file 2;python;
171;rpmpython.at:255;add package to transaction;python;
172;rpmpython.at:267;add erasure to transaction;python;
173;rpmpython.at:289;add bogus package to transaction 1;python;
174;rpmpython.at:303;add bogus package to transaction 2;python;
175;rpmpython.at:324;transaction element userdata;python;
176;rpmpython.at:338;transaction callback 1;python;
177;rpmpython.at:375;database iterators;python rpmdb;
178;rpmpython.at:473;database cookies;python rpmdb;
179;rpmpython.at:541;dependency sets 1;python;
180;rpmpython.at:558;dependency sets 2;python;
181;rpmpython.at:568;dependency sets 3;python;
182;rpmpython.at:588;file info sets 1;python;
183;rpmpython.at:605;string pool 1;python;
184;rpmpython.at:620;string pool 2;python;
185;rpmpython.at:638;archive 1;python;
186;rpmpython.at:658;header unload;python;
187;rpmpython.at:675;version objects 1;python;
188;rpmpython.at:706;version objects 2;python;
189;rpmdepmatch.at:4;provide - require pairs;python;
190;rpmquery.at:22;rpm --qf -p *.i386.rpm;query;
191;rpmquery.at:37;rpm --qf -p *.src.rpm;query;
192;rpmquery.at:52;rpm -ql -p *.src.rpm;query;
193;rpmquery.at:68;rpm -ql multiple *.rpm;query;
194;rpmquery.at:87;rpmspec -q;query;
195;rpmquery.at:100;rpm -ql -p *.i386.rpm;query;
196;rpmquery.at:118;rpm -qp <manifest>;query;
197;rpmquery.at:140;rpm -q --scripts -p *.i386.rpm;query;
198;rpmquery.at:162;rpm -q on installed package;rpmdb install query;
199;rpmquery.at:205;integer array query;query;
200;rpmquery.at:222;formatted filesbypkg query;query;
201;rpmquery.at:239;hex formatted integer array extension query;query;
202;rpmquery.at:256;base64 extension query;query;
203;rpmquery.at:270;pgpsig extension query;query signature;
204;rpmquery.at:285;integer array perms format query;query;
205;rpmquery.at:302;string array query;query;
206;rpmquery.at:316;empty string array query;query;
207;rpmquery.at:330;empty string array extension array format;query;
208;rpmquery.at:344;empty string array extension query;query;
209;rpmquery.at:358;different sizes arrays query 1;query;
210;rpmquery.at:375;different sizes arrays query 2;query;
211;rpmquery.at:390;different sizes arrays query 3;query;
212;rpmquery.at:405;different sizes arrays query 4;query;
213;rpmquery.at:422;non-existent string tag;query;
214;rpmquery.at:436;non-existent integer tag query;query;
215;rpmquery.at:450;conditional queryformat;query;
216;rpmquery.at:464;invalid tag query;query;
217;rpmquery.at:479;invalid data for format query;query;
218;rpmquery.at:493;invalid format width query;query;
219;rpmquery.at:507;xml format;query;
220;rpmquery.at:807;query file attribute filtering;query;
221;rpmquery.at:862;formatting name humansi, humaniec;query, humansi, humaniec;
222;rpmquery.at:885;incomplete escape sequence for format query;query;
223;rpmquery.at:900;query format iteration;query;
224;rpmspec.at:12;rpmspec --query Requires;rpmspec query;
225;rpmspec.at:37;rpmspec --query Requires(,);rpmspec query;
226;rpmspec.at:52;rpmspec --query Requires(;);rpmspec query;
227;rpmspec.at:67;rpmspec --query Requires(junk);rpmspec query;
228;rpmspec.at:82;rpmspec --query Requires(pre,junk);rpmspec query;
229;rpmspec.at:97;rpmspec --query Requires(junk,pre);rpmspec query;
230;rpmspec.at:112;rpmspec --query Requires(,pre);rpmspec query;
231;rpmspec.at:127;rpmspec --query Requires(pre,);rpmspec query;
232;rpmspec.at:142;rpmspec --query Requires(pre,,postun);rpmspec query;
233;rpmspec.at:157;rpmspec --query Requires(pre,,junk);rpmspec query;
234;rpmspec.at:172;rpmspec --query Requires(;pre);rpmspec query;
235;rpmspec.at:187;rpmspec --query Requires(pre;);rpmspec query;
236;rpmspec.at:202;rpmspec --query Requires(pre;postun);rpmspec query;
237;rpmspec.at:217;rpmspec --query Requires(pre;junk);rpmspec query;
238;rpmspec.at:232;rpmspec --parse;rpmspec;
239;rpmspec.at:273;rpmspec --srpm provides;rpmspec;
240;rpmvfylevel.at:3;rpmkeys -K <unsigned 1> verifylevel;rpmkeys digest;
241;rpmvfylevel.at:75;rpmkeys -K <unsigned 2> verifylevel;rpmkeys digest;
242;rpmvfylevel.at:147;rpmkeys -K <signed 1> verifylevel;rpmkeys digest;
243;rpmvfylevel.at:219;rpmkeys -K <signed 2> verifylevel;rpmkeys digest;
244;rpmvfylevel.at:292;rpmkeys -K <signed 3> verifylevel;rpmkeys digest;
245;rpmsigdig.at:7;rpmkeys -Kv <unsigned> 1;rpmkeys digest;
246;rpmsigdig.at:27;rpmkeys -Kv <reconstructed> 1;rpmkeys digest;
247;rpmsigdig.at:55;rpmkeys -Kv <corrupted unsigned> 1;rpmkeys digest;
248;rpmsigdig.at:78;rpmkeys -Kv <corrupted unsigned> 2;rpmkeys digest;
249;rpmsigdig.at:101;rpmkeys -Kv <corrupted unsigned> 3;rpmkeys digest;
250;rpmsigdig.at:125;rpmkeys -Kv <corrupted unsigned> 4;rpmkeys digest;
251;rpmsigdig.at:144;rpmkeys -Kv <unsigned> 2;rpmkeys digest;
252;rpmsigdig.at:181;rpmkeys --import rsa;rpmkeys import;
253;rpmsigdig.at:245;rpmkeys -K <signed> 1;rpmkeys digest signature;
254;rpmsigdig.at:263;rpmkeys -Kv <signed> 1;rpmkeys digest signature;
255;rpmsigdig.at:308;rpmkeys -Kv <corrupted signed> 1;rpmkeys digest signature;
256;rpmsigdig.at:342;rpmkeys -Kv <corrupted signed> 2;rpmkeys digest signature;
257;rpmsigdig.at:377;rpmkeys -Kv <corrupted signed> 3;rpmkeys digest signature;
258;rpmsigdig.at:414;rpmsign --addsign;rpmsign signature;
259;rpmsigdig.at:518;rpmsign --delsign;rpmsign signature;
260;rpmio.at:21;SIGPIPE from install scriptlet;signals;
261;rpmio.at:50;rpmlog error handling;log;
262;rpmverify.at:7;dependency problems;verify;
263;rpmverify.at:30;files with no problems;verify;
264;rpmverify.at:45;files with no problems in verbose mode;verify;
265;rpmverify.at:63;directory replaced with a directory symlink;verify;
266;rpmverify.at:92;directory replaced with an invalid directory symlink;verify;
267;rpmverify.at:122;verify from db, with problems present;verify;
268;rpmverify.at:143;verify from package, with problems present;verify;
269;rpmverify.at:163;verify file attribute filtering;query;
270;rpmverify.at:223;verifyscript failure;verify;
271;rpmverify.at:238;verifyscript success;verify;
272;rpmverify.at:255;shared file timestamp behavior;verify;
273;rpmverify.at:281;minimize writes (files);upgrade verify min_writes;
274;rpmverify.at:406;minimize writes (hardlinks);upgrade verify min_writes;
275;rpmverify.at:428;minimize writes (symlinks);upgrade verify min_writes;
276;rpmverify.at:546;minimize writes (SUID files);upgrade verify min_writes;
277;rpmverify.at:580;verify empty/no capabilities 1;verify;
278;rpmverify.at:599;verify empty/no capabilities 2;verify;
279;rpmdb.at:23;rpm --initdb;rpmdb;
280;rpmdb.at:35;rpm -qa;rpmdb query;
281;rpmdb.at:46;rpm -qa;rpmdb query;
282;rpmdb.at:60;rpm -q foo;rpmdb query;
283;rpmdb.at:79;rpm -q foo-;rpmdb query;
284;rpmdb.at:96;rpmdb header numbering;rpmdb;
285;rpmdb.at:116;rpm -q --querybynumber;rpmdb query;
286;rpmdb.at:149;rpm -i *.noarch.rpm;rpmdb install;
287;rpmdb.at:164;rpm -U --replacepkgs 1;rpmdb install;
288;rpmdb.at:185;rpm -U --replacepkgs 2;rpmdb install;
289;rpmdb.at:205;rpm --reinstall 1;rpmdb install;
290;rpmdb.at:227;rpm -i --relocate=.. *.i386.rpm;rpmdb install;
291;rpmdb.at:245;rpm -i --relocate=.. *.ppc64.rpm;rpmdb install;
292;rpmdb.at:260;rpmdb --rebuilddb;rpmdb;
293;rpmdb.at:284;rpmdb --rebuilddb and verify empty database;rpmdb;
294;rpmdb.at:298;rpm -U and verify status;install rpmdb query;
295;rpmdb.at:319;rpm -U with _install_lang and verify status;install rpmdb query;
296;rpmdb.at:343;rpm -U and verify files on disk;install rpmdb;
297;rpmdb.at:362;rpm -e and verify files removed;install rpmdb;
298;rpmi.at:21;rpm -U <manifest>;install;
299;rpmi.at:35;rpm -U <manifest notfound 1>;install;
300;rpmi.at:50;rpm -U <manifest notfound 2>;install;
301;rpmi.at:65;rpm -U <notfound>;install;
302;rpmi.at:79;rpm -U <unsigned 1>;install;
303;rpmi.at:92;rpm -U <unsigned 2>;install;
304;rpmi.at:107;rpm -U <corrupted unsigned 1>;install;
305;rpmi.at:153;rpm -U <corrupted unsigned 2>;install;
306;rpmi.at:196;rpm -U <signed nokey 1>;install;
307;rpmi.at:210;rpm -U <signed nokey 2>;install;
308;rpmi.at:226;rpm -U <signed 1>;install;
309;rpmi.at:240;rpm -U <signed 2>;install;
310;rpmi.at:255;rpm -U <corrupted signed 1>;install;
311;rpmi.at:275;rpm -U <corrupted signed 2>;install;
312;rpmi.at:297;rpm -U <corrupted signed 3>;install;
313;rpmi.at:357;rpm -U *.src.rpm;install;
314;rpmi.at:373;rpm -i *.src.rpm;install;
315;rpmi.at:390;rpm -i <nonexistent file>;install;
316;rpmi.at:403;rpm -i --nomanifest <garbage text file>;install;
317;rpmi.at:422;rpm -i <garbage text file;install;
318;rpmi.at:443;rpm upgrade/downgrade;;
319;rpmi.at:557;rpm -U obsoleted packages;install obsolete;
320;rpmi.at:605;rpm -U with invalid --relocate;install relocate;
321;rpmi.at:621;rpm -U --badreloc with invalid --relocate;install relocate;
322;rpmi.at:636;rpm -i with/without --excludedocs;install excludedocs;
323;rpmi.at:669;rpm -i --excludeartifacts;install;
324;rpmi.at:687;rpm -U <suicidal>;install;
325;rpmi.at:728;rpm -i hardlinks;build install;
326;rpmorder.at:3;basic install/erase order 1;install erase order;
327;rpmorder.at:48;basic install/erase order 2;install erase order;
328;rpmorder.at:93;basic install/erase order 3;install erase order;
329;rpmbuild.at:23;rpmbuild -ba *.spec;build;
330;rpmbuild.at:36;rpmbuild -ba autosetup;build;
331;rpmbuild.at:51;rpmbuild --rebuild;build;
332;rpmbuild.at:64;rpmbuild --short-circuit -bl;build;
333;rpmbuild.at:79;rpmbuild -tb <tar with bad spec>;build;
334;rpmbuild.at:93;rpmbuild -ts <spec>;build;
335;rpmbuild.at:109;rpmbuild package with weird filenames;build;
336;rpmbuild.at:141;rpmbuild package with illegal filenames;build;
337;rpmbuild.at:156;rpmbuild -tb;build;
338;rpmbuild.at:169;rpmbuild scriptlet -f;build;
339;rpmbuild.at:218;rpmbuild %attr and %defattr;build;
340;rpmbuild.at:256;rpmbuild unpackaged files;build;
341;rpmbuild.at:275;rpmbuild unpackaged directories;build;
342;rpmbuild.at:294;rpmbuild glob;build;
343;rpmbuild.at:327;rpmbuild prefixpostfix;build;
344;rpmbuild.at:362;Weak and reverse requires;build;
345;rpmbuild.at:391;Build requires;build;
346;rpmbuild.at:408;Dependency generation 1;build;
347;rpmbuild.at:450;Dependency generation 2;build;
348;rpmbuild.at:465;Dependency generation 3;build;
349;rpmbuild.at:487;Dependency generation 4;build;
350;rpmbuild.at:503;Dependency generation 5;build;
351;rpmbuild.at:520;elf dependencies;build;
352;rpmbuild.at:583;rpmspec query 1;build;
353;rpmbuild.at:603;rpmbuild archive sanity;build;
354;rpmbuild.at:621;rpmbuild debuginfo minisymtab;build debuginfo;
355;rpmbuild.at:659;rpmbuild debuginfo minisymtab strip -g;build debuginfo;
356;rpmbuild.at:699;rpmbuild debuginfo dwz;build debuginfo dwz;
357;rpmbuild.at:786;rpmbuild no debuginfo;build debuginfo;
358;rpmbuild.at:820;rpmbuild debuginfo dwz unique debug names;build debuginfo dwz;
359;rpmbuild.at:907;rpmbuild implicit suid binary;build debuginfo dwz suid;
360;rpmbuild.at:939;rpmbuild debuginfo gdb index included;build debuginfo gdb;
361;rpmbuild.at:966;rpmbuild debuginfo no gdb index included;build debuginfo gdb;
362;rpmbuild.at:992;rpmbuild debuginfo -g3 .debug_macro;build debuginfo gdb;
363;rpmbuild.at:1023;rpmbuild debuginfo unique debug src dir;build debuginfo;
364;rpmbuild.at:1060;rpmbuild debuginfo no unique debug src dir;build debuginfo;
365;rpmbuild.at:1094;rpmbuild debugsource;build debuginfo debugsource;
366;rpmbuild.at:1126;rpmbuild debugsource debugsourcefiles.list path;build debuginfo debugsource;
367;rpmbuild.at:1151;rpmbuild debuginfo subpackages single;build debuginfo debugsubpackage;
368;rpmbuild.at:1190;rpmbuild debuginfo subpackages multiple;build debuginfo debugsubpackage;
369;rpmbuild.at:1271;rpmbuild debuginfo subpackages multiple unique;build debuginfo debugsubpackage;
370;rpmbuild.at:1352;rpmbuild debuginfo subpackages multiple unique debugsource;build debuginfo debugsubpackage debugsource;
371;rpmbuild.at:1436;rpmbuild debuginfo subpackages multiple excluded;build debuginfo debugsubpackage debugsource;
372;rpmbuild.at:1497;rpmbuild debuginfo subpackages multiple excluded;build debuginfo debugsubpackage debugsource;
373;rpmbuild.at:1565;dynamic build requires rpmbuild -bs;build;
374;rpmbuild.at:1584;rpmbuild -br;build;
375;rpmbuild.at:1604;rpmbuild -ba;build;
376;rpmbuild.at:1625;rpmbuild -br --nodeps;build;
377;rpmbuild.at:1648;rpmbuild -ba missing source;build;
378;rpmbuild.at:1663;rpmbuild minimal spec;build;
379;rpmbuild.at:1676;rpmbuild missing doc;build;
380;rpmbuild.at:1696;spec conditionals;if else elif build;
381;rpmbuildid.at:23;rpmbuild buildid none;build debuginfo buildid;
382;rpmbuildid.at:54;rpmbuild buildid alldebug;build debuginfo buildid;
383;rpmbuildid.at:143;rpmbuild buildid alldebug unique debug names;build debuginfo buildid;
384;rpmbuildid.at:231;rpmbuild buildid separate;build debuginfo buildid;
385;rpmbuildid.at:319;rpmbuild buildid separate unique debug names;build debuginfo buildid;
386;rpmbuildid.at:406;rpmbuild buildid compat;build debuginfo buildid;
387;rpmbuildid.at:507;rpmbuild buildid compat unique debug names;build debuginfo buildid;
388;rpmbuildid.at:608;rpmbuild buildid duplicate alldebug;build debuginfo buildid;
389;rpmbuildid.at:673;rpmbuild buildid hardlink alldebug;build debuginfo buildid;
390;rpmbuildid.at:735;rpmbuild buildid duplicate separate;build debuginfo buildid;
391;rpmbuildid.at:797;rpmbuild buildid hardlink separate;build debuginfo buildid;
392;rpmbuildid.at:856;rpmbuild buildid duplicate compat;build debuginfo buildid;
393;rpmbuildid.at:930;rpmbuild buildid hardlink compat;build debuginfo buildid;
394;rpmbuildid.at:1000;rpmbuild buildid recompute;build debuginfo buildid;
395;rpmbuildid.at:1111;rpmbuild buildid unique r1 r2;build debuginfo buildid;
396;rpmbuildid.at:1156;rpmbuild buildid non-unique r1 r2;build debuginfo buildid;
397;rpmbuildid.at:1205;rpmbuild buildid attrs;build debuginfo buildid;
398;rpmbuildid.at:1236;rpmbuild buildid config attrs;build debuginfo buildid;
399;rpmscript.at:5;basic script failures 1;script;
400;rpmscript.at:125;basic scripts and arguments;verify;
401;rpmscript.at:160;basic trigger scripts and arguments;trigger script;
402;rpmscript.at:216;basic file trigger scripts;file trigger script;
403;rpmscript.at:317;basic file triggers 2;filetrigger script;
404;rpmdeps.at:6;unversioned requires;install depends;
405;rpmdeps.at:45;unsatisfied versioned require;install;
406;rpmdeps.at:79;satisfied versioned require;install;
407;rpmdeps.at:103;versioned conflicts;install;
408;rpmdeps.at:142;install and verify self-conflicting package;install;
409;rpmdeps.at:162;explicit file conflicts;install;
410;rpmdeps.at:199;erase to break dependencies;install;
411;rpmdeps.at:225;erase to break colored file dependency;install;
412;rpmdeps.at:252;erase on wrong-colored file dependency;install;
413;rpmdeps.at:278;unsatisfied WITH requires;install, boolean;
414;rpmdeps.at:324;satisfied WITH requires;install, boolean;
415;rpmdeps.at:372;unsatisfied WITHOUT requires;install, boolean;
416;rpmdeps.at:413;satisfied WITHOUT requires;install, boolean;
417;rpmdeps.at:451;AND requires;install, boolean;
418;rpmdeps.at:514;OR requires;install, boolean;
419;rpmdeps.at:573;IF requires;install, boolean;
420;rpmdeps.at:611;IF-ELSE requires;install, boolean;
421;rpmdeps.at:661;nested AND-OR requires;install, boolean;
422;rpmdeps.at:700;nested AND-IF requires;install, boolean;
423;rpmdeps.at:738;install to break installed rich dependency;install, boolean;
424;rpmdeps.at:786;erase to break installed rich dependency;install, boolean;
425;rpmconflict.at:6;packages with file conflicts;install;
426;rpmconflict.at:41;shareable files;install;
427;rpmconflict.at:77;non-conflicting identical basenames;install;
428;rpmconflict.at:93;conflicting identical basenames;install;
429;rpmconflict.at:111;multilib elf conflict, prefer 64bit 1;install;
430;rpmconflict.at:132;multilib elf conflict, prefer 64bit 2;install;
431;rpmconflict.at:158;multilib elf conflict, prefer 64bit 3;install;
432;rpmconflict.at:184;multilib elf conflict, prefer 32bit 1;install;
433;rpmconflict.at:205;multilib elf conflict, prefer 32bit 2;install;
434;rpmconflict.at:231;multilib elf conflict, prefer 32bit 3;install;
435;rpmconflict.at:257;multilib elf vs non-elf file conflict 1;install;
436;rpmconflict.at:277;multilib elf vs non-elf file conflict 2;install;
437;rpmconflict.at:301;multilib elf vs non-elf file conflict 3;install;
438;rpmconflict.at:326;replacing directory with symlink;install;
439;rpmconflict.at:348;replacing symlink with directory;install;
440;rpmconflict.at:371;real file with shared ghost;install;
441;rpmreplace.at:4;upgrade to/from regular file;install;
442;rpmreplace.at:38;upgrade regular file to/from link;install;
443;rpmreplace.at:95;upgrade broken link to broken link;install;
444;rpmreplace.at:126;upgrade file link to file link;install;
445;rpmreplace.at:157;upgrade directory link to directory link;install;
446;rpmreplace.at:188;upgrade regular file to directory;install;
447;rpmreplace.at:217;upgrade broken link to directory;install;
448;rpmreplace.at:246;upgrade file link to directory;install;
449;rpmreplace.at:275;upgrade directory link to directory;install;
450;rpmreplace.at:304;upgrade empty directory to empty directory;install;
451;rpmreplace.at:330;upgrade empty directory to regular file;install;
452;rpmreplace.at:357;upgrade locally symlinked directory;install;
453;rpmreplace.at:391;upgrade invalid locally symlinked directory;install;
454;rpmreplace.at:421;upgrade empty directory to broken link;install;
455;rpmreplace.at:465;upgrade empty directory to file link;install;
456;rpmreplace.at:511;upgrade empty directory to file link with pretrans;install;
457;rpmconfig.at:5;config file install/upgrade/erase;install;
458;rpmconfig.at:141;config(noreplace) file install/upgrade/erase;install;
459;rpmconfig.at:196;upgrade changing config;install;
460;rpmconfig.at:273;upgrade changing config(noreplace);install;
461;rpmconfig.at:325;upgrade changing config(noreplace);install;
462;rpmconfig.at:399;upgrade shared config;install;
463;rpmconfig.at:459;upgrade changing shared config;install;
464;rpmconfig.at:548;upgrade shared config(noreplace);install;
465;rpmconfig.at:617;ghost config;install;
466;rpmconfig2.at:5;config symlinks;install;
467;rpmconfig2.at:145;changing config symlinks;install;
468;rpmconfig2.at:220;upgrade unchanged config(noreplace) links;install;
469;rpmconfig2.at:271;upgrade changing config(noreplace) links;install;
470;rpmconfig2.at:348;upgrade unchanged shared config links;install;
471;rpmconfig2.at:410;upgrade changing shared config links;install;
472;rpmconfig2.at:500;upgrade changing shared config(noreplace) links;install;
473;rpmconfig3.at:5;upgrade config to/from non-config;install;
474;rpmconfig3.at:92;upgrade config to/from config link;install;
475;rpmconfig3.at:153;upgrade modified config link to config;install;
476;rpmconfig3.at:190;upgrade config to directory;install;
"
# List of the all the test groups.
at_groups_all=`$as_echo "$at_help_all" | sed 's/;.*//'`

# at_fn_validate_ranges NAME...
# -----------------------------
# Validate and normalize the test group number contained in each variable
# NAME. Leading zeroes are treated as decimal.
at_fn_validate_ranges ()
{
  for at_grp
  do
    eval at_value=\$$at_grp
    if test $at_value -lt 1 || test $at_value -gt 476; then
      $as_echo "invalid test group: $at_value" >&2
      exit 1
    fi
    case $at_value in
      0*) # We want to treat leading 0 as decimal, like expr and test, but
	  # AS_VAR_ARITH treats it as octal if it uses $(( )).
	  # With XSI shells, ${at_value#${at_value%%[1-9]*}} avoids the
	  # expr fork, but it is not worth the effort to determine if the
	  # shell supports XSI when the user can just avoid leading 0.
	  eval $at_grp='`expr $at_value + 0`' ;;
    esac
  done
}

at_prev=
for at_option
do
  # If the previous option needs an argument, assign it.
  if test -n "$at_prev"; then
    at_option=$at_prev=$at_option
    at_prev=
  fi

  case $at_option in
  *=?*) at_optarg=`expr "X$at_option" : '[^=]*=\(.*\)'` ;;
  *)    at_optarg= ;;
  esac

  # Accept the important Cygnus configure options, so we can diagnose typos.

  case $at_option in
    --help | -h )
	at_help_p=:
	;;

    --list | -l )
	at_list_p=:
	;;

    --version | -V )
	at_version_p=:
	;;

    --clean | -c )
	at_clean=:
	;;

    --color )
	at_color=always
	;;
    --color=* )
	case $at_optarg in
	no | never | none) at_color=never ;;
	auto | tty | if-tty) at_color=auto ;;
	always | yes | force) at_color=always ;;
	*) at_optname=`echo " $at_option" | sed 's/^ //; s/=.*//'`
	   as_fn_error $? "unrecognized argument to $at_optname: $at_optarg" ;;
	esac
	;;

    --debug | -d )
	at_debug_p=:
	;;

    --errexit | -e )
	at_debug_p=:
	at_errexit_p=:
	;;

    --verbose | -v )
	at_verbose=; at_quiet=:
	;;

    --trace | -x )
	at_traceon='set -x'
	at_trace_echo=echo
	at_check_filter_trace=at_fn_filter_trace
	;;

    [0-9] | [0-9][0-9] | [0-9][0-9][0-9] | [0-9][0-9][0-9][0-9])
	at_fn_validate_ranges at_option
	as_fn_append at_groups "$at_option$as_nl"
	;;

    # Ranges
    [0-9]- | [0-9][0-9]- | [0-9][0-9][0-9]- | [0-9][0-9][0-9][0-9]-)
	at_range_start=`echo $at_option |tr -d X-`
	at_fn_validate_ranges at_range_start
	at_range=`$as_echo "$at_groups_all" | \
	  sed -ne '/^'$at_range_start'$/,$p'`
	as_fn_append at_groups "$at_range$as_nl"
	;;

    -[0-9] | -[0-9][0-9] | -[0-9][0-9][0-9] | -[0-9][0-9][0-9][0-9])
	at_range_end=`echo $at_option |tr -d X-`
	at_fn_validate_ranges at_range_end
	at_range=`$as_echo "$at_groups_all" | \
	  sed -ne '1,/^'$at_range_end'$/p'`
	as_fn_append at_groups "$at_range$as_nl"
	;;

    [0-9]-[0-9] | [0-9]-[0-9][0-9] | [0-9]-[0-9][0-9][0-9] | \
    [0-9]-[0-9][0-9][0-9][0-9] | [0-9][0-9]-[0-9][0-9] | \
    [0-9][0-9]-[0-9][0-9][0-9] | [0-9][0-9]-[0-9][0-9][0-9][0-9] | \
    [0-9][0-9][0-9]-[0-9][0-9][0-9] | \
    [0-9][0-9][0-9]-[0-9][0-9][0-9][0-9] | \
    [0-9][0-9][0-9][0-9]-[0-9][0-9][0-9][0-9] )
	at_range_start=`expr $at_option : '\(.*\)-'`
	at_range_end=`expr $at_option : '.*-\(.*\)'`
	if test $at_range_start -gt $at_range_end; then
	  at_tmp=$at_range_end
	  at_range_end=$at_range_start
	  at_range_start=$at_tmp
	fi
	at_fn_validate_ranges at_range_start at_range_end
	at_range=`$as_echo "$at_groups_all" | \
	  sed -ne '/^'$at_range_start'$/,/^'$at_range_end'$/p'`
	as_fn_append at_groups "$at_range$as_nl"
	;;

    # Directory selection.
    --directory | -C )
	at_prev=--directory
	;;
    --directory=* )
	at_change_dir=:
	at_dir=$at_optarg
	if test x- = "x$at_dir" ; then
	  at_dir=./-
	fi
	;;

    # Parallel execution.
    --jobs | -j )
	at_jobs=0
	;;
    --jobs=* | -j[0-9]* )
	if test -n "$at_optarg"; then
	  at_jobs=$at_optarg
	else
	  at_jobs=`expr X$at_option : 'X-j\(.*\)'`
	fi
	case $at_jobs in *[!0-9]*)
	  at_optname=`echo " $at_option" | sed 's/^ //; s/[0-9=].*//'`
	  as_fn_error $? "non-numeric argument to $at_optname: $at_jobs" ;;
	esac
	;;

    # Keywords.
    --keywords | -k )
	at_prev=--keywords
	;;
    --keywords=* )
	at_groups_selected=$at_help_all
	at_save_IFS=$IFS
	IFS=,
	set X $at_optarg
	shift
	IFS=$at_save_IFS
	for at_keyword
	do
	  at_invert=
	  case $at_keyword in
	  '!'*)
	    at_invert="-v"
	    at_keyword=`expr "X$at_keyword" : 'X!\(.*\)'`
	    ;;
	  esac
	  # It is on purpose that we match the test group titles too.
	  at_groups_selected=`$as_echo "$at_groups_selected" |
	      grep -i $at_invert "^[1-9][^;]*;.*[; ]$at_keyword[ ;]"`
	done
	# Smash the keywords.
	at_groups_selected=`$as_echo "$at_groups_selected" | sed 's/;.*//'`
	as_fn_append at_groups "$at_groups_selected$as_nl"
	;;
    --recheck)
	at_recheck=:
	;;

    *=*)
	at_envvar=`expr "x$at_option" : 'x\([^=]*\)='`
	# Reject names that are not valid shell variable names.
	case $at_envvar in
	  '' | [0-9]* | *[!_$as_cr_alnum]* )
	    as_fn_error $? "invalid variable name: \`$at_envvar'" ;;
	esac
	at_value=`$as_echo "$at_optarg" | sed "s/'/'\\\\\\\\''/g"`
	# Export now, but save eval for later and for debug scripts.
	export $at_envvar
	as_fn_append at_debug_args " $at_envvar='$at_value'"
	;;

     *) $as_echo "$as_me: invalid option: $at_option" >&2
	$as_echo "Try \`$0 --help' for more information." >&2
	exit 1
	;;
  esac
done

# Verify our last option didn't require an argument
if test -n "$at_prev"; then :
  as_fn_error $? "\`$at_prev' requires an argument"
fi

# The file containing the suite.
at_suite_log=$at_dir/$as_me.log

# Selected test groups.
if test -z "$at_groups$at_recheck"; then
  at_groups=$at_groups_all
else
  if test -n "$at_recheck" && test -r "$at_suite_log"; then
    at_oldfails=`sed -n '
      /^Failed tests:$/,/^Skipped tests:$/{
	s/^[ ]*\([1-9][0-9]*\):.*/\1/p
      }
      /^Unexpected passes:$/,/^## Detailed failed tests/{
	s/^[ ]*\([1-9][0-9]*\):.*/\1/p
      }
      /^## Detailed failed tests/q
      ' "$at_suite_log"`
    as_fn_append at_groups "$at_oldfails$as_nl"
  fi
  # Sort the tests, removing duplicates.
  at_groups=`$as_echo "$at_groups" | sort -nu | sed '/^$/d'`
fi

if test x"$at_color" = xalways \
   || { test x"$at_color" = xauto && test -t 1; }; then
  at_red=`printf '\033[0;31m'`
  at_grn=`printf '\033[0;32m'`
  at_lgn=`printf '\033[1;32m'`
  at_blu=`printf '\033[1;34m'`
  at_std=`printf '\033[m'`
else
  at_red= at_grn= at_lgn= at_blu= at_std=
fi

# Help message.
if $at_help_p; then
  cat <<_ATEOF || at_write_fail=1
Usage: $0 [OPTION]... [VARIABLE=VALUE]... [TESTS]

Run all the tests, or the selected TESTS, given by numeric ranges, and
save a detailed log file.  Upon failure, create debugging scripts.

Do not change environment variables directly.  Instead, set them via
command line arguments.  Set \`AUTOTEST_PATH' to select the executables
to exercise.  Each relative directory is expanded as build and source
directories relative to the top level of this distribution.
E.g., from within the build directory /tmp/foo-1.0, invoking this:

  $ $0 AUTOTEST_PATH=bin

is equivalent to the following, assuming the source directory is /src/foo-1.0:

  PATH=/tmp/foo-1.0/bin:/src/foo-1.0/bin:\$PATH $0
_ATEOF
cat <<_ATEOF || at_write_fail=1

Operation modes:
  -h, --help     print the help message, then exit
  -V, --version  print version number, then exit
  -c, --clean    remove all the files this test suite might create and exit
  -l, --list     describes all the tests, or the selected TESTS
_ATEOF
cat <<_ATEOF || at_write_fail=1

Execution tuning:
  -C, --directory=DIR
                 change to directory DIR before starting
      --color[=never|auto|always]
                 disable colored test results, or enable even without terminal
  -j, --jobs[=N]
                 Allow N jobs at once; infinite jobs with no arg (default 1)
  -k, --keywords=KEYWORDS
                 select the tests matching all the comma-separated KEYWORDS
                 multiple \`-k' accumulate; prefixed \`!' negates a KEYWORD
      --recheck  select all tests that failed or passed unexpectedly last time
  -e, --errexit  abort as soon as a test fails; implies --debug
  -v, --verbose  force more detailed output
                 default for debugging scripts
  -d, --debug    inhibit clean up and top-level logging
                 default for debugging scripts
  -x, --trace    enable tests shell tracing
_ATEOF
cat <<_ATEOF || at_write_fail=1

Report bugs to <rpm-maint@lists.rpm.org>.
_ATEOF
  exit $at_write_fail
fi

# List of tests.
if $at_list_p; then
  cat <<_ATEOF || at_write_fail=1
rpm 4.17.0 test suite test groups:

 NUM: FILE-NAME:LINE     TEST-GROUP-NAME
      KEYWORDS

_ATEOF
  # Pass an empty line as separator between selected groups and help.
  $as_echo "$at_groups$as_nl$as_nl$at_help_all" |
    awk 'NF == 1 && FS != ";" {
	   selected[$ 1] = 1
	   next
	 }
	 /^$/ { FS = ";" }
	 NF > 0 {
	   if (selected[$ 1]) {
	     printf " %3d: %-18s %s\n", $ 1, $ 2, $ 3
	     if ($ 4) {
	       lmax = 79
	       indent = "     "
	       line = indent
	       len = length (line)
	       n = split ($ 4, a, " ")
	       for (i = 1; i <= n; i++) {
		 l = length (a[i]) + 1
		 if (i > 1 && len + l > lmax) {
		   print line
		   line = indent " " a[i]
		   len = length (line)
		 } else {
		   line = line " " a[i]
		   len += l
		 }
	       }
	       if (n)
		 print line
	     }
	   }
	 }' || at_write_fail=1
  exit $at_write_fail
fi
if $at_version_p; then
  $as_echo "$as_me (rpm 4.17.0)" &&
  cat <<\_ATEOF || at_write_fail=1

Copyright (C) 2012 Free Software Foundation, Inc.
This test suite is free software; the Free Software Foundation gives
unlimited permission to copy, distribute and modify it.
_ATEOF
  exit $at_write_fail
fi

# Should we print banners?  Yes if more than one test is run.
case $at_groups in #(
  *$as_nl* )
      at_print_banners=: ;; #(
  * ) at_print_banners=false ;;
esac
# Text for banner N, set to a single space once printed.
# Banner 1. rpmgeneral.at:19
# Category starts at test group 1.
at_banner_text_1="Basic tests"
# Banner 2. rpmvercmp.at:12
# Category starts at test group 8.
at_banner_text_2="RPM version comparison"
# Banner 3. rpmmacro.at:3
# Category starts at test group 99.
at_banner_text_3="RPM macros"
# Banner 4. rpmpython.at:4
# Category starts at test group 157.
at_banner_text_4="Python bindings"
# Banner 5. rpmdepmatch.at:2
# Category starts at test group 189.
at_banner_text_5="RPM dependency matching"
# Banner 6. rpmquery.at:19
# Category starts at test group 190.
at_banner_text_6="RPM queries"
# Banner 7. rpmspec.at:10
# Category starts at test group 224.
at_banner_text_7="RPM Spec Tool"
# Banner 8. rpmvfylevel.at:1
# Category starts at test group 240.
at_banner_text_8="RPM signature/digest verifylevel"
# Banner 9. rpmsigdig.at:3
# Category starts at test group 245.
at_banner_text_9="RPM signatures and digests"
# Banner 10. rpmio.at:3
# Category starts at test group 260.
at_banner_text_10="I/O"
# Banner 11. rpmverify.at:3
# Category starts at test group 262.
at_banner_text_11="RPM verification"
# Banner 12. rpmdb.at:19
# Category starts at test group 279.
at_banner_text_12="RPM database access"
# Banner 13. rpmi.at:19
# Category starts at test group 298.
at_banner_text_13="RPM install tests"
# Banner 14. rpmorder.at:1
# Category starts at test group 326.
at_banner_text_14="RPM install/erase ordering"
# Banner 15. rpmbuild.at:19
# Category starts at test group 329.
at_banner_text_15="RPM build"
# Banner 16. rpmbuildid.at:19
# Category starts at test group 381.
at_banner_text_16="RPM buildid tests"
# Banner 17. rpmscript.at:3
# Category starts at test group 399.
at_banner_text_17="RPM scriptlets"
# Banner 18. rpmdeps.at:3
# Category starts at test group 404.
at_banner_text_18="RPM dependencies"
# Banner 19. rpmconflict.at:3
# Category starts at test group 425.
at_banner_text_19="RPM implicit file conflicts"
# Banner 20. rpmreplace.at:2
# Category starts at test group 441.
at_banner_text_20="RPM file replacement"
# Banner 21. rpmconfig.at:3
# Category starts at test group 457.
at_banner_text_21="RPM config file behavior"
# Banner 22. rpmconfig2.at:3
# Category starts at test group 466.
at_banner_text_22="RPM config symlink behavior"
# Banner 23. rpmconfig3.at:3
# Category starts at test group 473.
at_banner_text_23="RPM config filetype changes"

# Take any -C into account.
if $at_change_dir ; then
  test x != "x$at_dir" && cd "$at_dir" \
    || as_fn_error $? "unable to change directory"
  at_dir=`pwd`
fi

# Load the config files for any default variable assignments.
for at_file in atconfig atlocal
do
  test -r $at_file || continue
  . ./$at_file || as_fn_error $? "invalid content: $at_file"
done

# Autoconf <=2.59b set at_top_builddir instead of at_top_build_prefix:
: "${at_top_build_prefix=$at_top_builddir}"

# Perform any assignments requested during argument parsing.
eval "$at_debug_args"

# atconfig delivers names relative to the directory the test suite is
# in, but the groups themselves are run in testsuite-dir/group-dir.
if test -n "$at_top_srcdir"; then
  builddir=../..
  for at_dir_var in srcdir top_srcdir top_build_prefix
  do
    eval at_val=\$at_$at_dir_var
    case $at_val in
      [\\/$]* | ?:[\\/]* ) at_prefix= ;;
      *) at_prefix=../../ ;;
    esac
    eval "$at_dir_var=\$at_prefix\$at_val"
  done
fi

## -------------------- ##
## Directory structure. ##
## -------------------- ##

# This is the set of directories and files used by this script
# (non-literals are capitalized):
#
# TESTSUITE         - the testsuite
# TESTSUITE.log     - summarizes the complete testsuite run
# TESTSUITE.dir/    - created during a run, remains after -d or failed test
# + at-groups/      - during a run: status of all groups in run
# | + NNN/          - during a run: meta-data about test group NNN
# | | + check-line  - location (source file and line) of current AT_CHECK
# | | + status      - exit status of current AT_CHECK
# | | + stdout      - stdout of current AT_CHECK
# | | + stder1      - stderr, including trace
# | | + stderr      - stderr, with trace filtered out
# | | + test-source - portion of testsuite that defines group
# | | + times       - timestamps for computing duration
# | | + pass        - created if group passed
# | | + xpass       - created if group xpassed
# | | + fail        - created if group failed
# | | + xfail       - created if group xfailed
# | | + skip        - created if group skipped
# + at-stop         - during a run: end the run if this file exists
# + at-source-lines - during a run: cache of TESTSUITE line numbers for extraction
# + 0..NNN/         - created for each group NNN, remains after -d or failed test
# | + TESTSUITE.log - summarizes the group results
# | + ...           - files created during the group

# The directory the whole suite works in.
# Should be absolute to let the user `cd' at will.
at_suite_dir=$at_dir/$as_me.dir
# The file containing the suite ($at_dir might have changed since earlier).
at_suite_log=$at_dir/$as_me.log
# The directory containing helper files per test group.
at_helper_dir=$at_suite_dir/at-groups
# Stop file: if it exists, do not start new jobs.
at_stop_file=$at_suite_dir/at-stop
# The fifo used for the job dispatcher.
at_job_fifo=$at_suite_dir/at-job-fifo

if $at_clean; then
  test -d "$at_suite_dir" &&
    find "$at_suite_dir" -type d ! -perm -700 -exec chmod u+rwx \{\} \;
  rm -f -r "$at_suite_dir" "$at_suite_log"
  exit $?
fi

# Don't take risks: use only absolute directories in PATH.
#
# For stand-alone test suites (ie. atconfig was not found),
# AUTOTEST_PATH is relative to `.'.
#
# For embedded test suites, AUTOTEST_PATH is relative to the top level
# of the package.  Then expand it into build/src parts, since users
# may create executables in both places.
AUTOTEST_PATH=`$as_echo "$AUTOTEST_PATH" | sed "s|:|$PATH_SEPARATOR|g"`
at_path=
as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
for as_dir in $AUTOTEST_PATH $PATH
do
  IFS=$as_save_IFS
  test -z "$as_dir" && as_dir=.
    test -n "$at_path" && as_fn_append at_path $PATH_SEPARATOR
case $as_dir in
  [\\/]* | ?:[\\/]* )
    as_fn_append at_path "$as_dir"
    ;;
  * )
    if test -z "$at_top_build_prefix"; then
      # Stand-alone test suite.
      as_fn_append at_path "$as_dir"
    else
      # Embedded test suite.
      as_fn_append at_path "$at_top_build_prefix$as_dir$PATH_SEPARATOR"
      as_fn_append at_path "$at_top_srcdir/$as_dir"
    fi
    ;;
esac
  done
IFS=$as_save_IFS


# Now build and simplify PATH.
#
# There might be directories that don't exist, but don't redirect
# builtins' (eg., cd) stderr directly: Ultrix's sh hates that.
at_new_path=
as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
for as_dir in $at_path
do
  IFS=$as_save_IFS
  test -z "$as_dir" && as_dir=.
    test -d "$as_dir" || continue
case $as_dir in
  [\\/]* | ?:[\\/]* ) ;;
  * ) as_dir=`(cd "$as_dir" && pwd) 2>/dev/null` ;;
esac
case $PATH_SEPARATOR$at_new_path$PATH_SEPARATOR in
  *$PATH_SEPARATOR$as_dir$PATH_SEPARATOR*) ;;
  $PATH_SEPARATOR$PATH_SEPARATOR) at_new_path=$as_dir ;;
  *) as_fn_append at_new_path "$PATH_SEPARATOR$as_dir" ;;
esac
  done
IFS=$as_save_IFS

PATH=$at_new_path
export PATH

# Setting up the FDs.



# 5 is the log file.  Not to be overwritten if `-d'.
if $at_debug_p; then
  at_suite_log=/dev/null
else
  : >"$at_suite_log"
fi
exec 5>>"$at_suite_log"

# Banners and logs.
$as_echo "## ---------------------- ##
## rpm 4.17.0 test suite. ##
## ---------------------- ##"
{
  $as_echo "## ---------------------- ##
## rpm 4.17.0 test suite. ##
## ---------------------- ##"
  echo

  $as_echo "$as_me: command line was:"
  $as_echo "  \$ $0 $at_cli_args"
  echo

  # If ChangeLog exists, list a few lines in case it might help determining
  # the exact version.
  if test -n "$at_top_srcdir" && test -f "$at_top_srcdir/ChangeLog"; then
    $as_echo "## ---------- ##
## ChangeLog. ##
## ---------- ##"
    echo
    sed 's/^/| /;10q' "$at_top_srcdir/ChangeLog"
    echo
  fi

  {
cat <<_ASUNAME
## --------- ##
## Platform. ##
## --------- ##

hostname = `(hostname || uname -n) 2>/dev/null | sed 1q`
uname -m = `(uname -m) 2>/dev/null || echo unknown`
uname -r = `(uname -r) 2>/dev/null || echo unknown`
uname -s = `(uname -s) 2>/dev/null || echo unknown`
uname -v = `(uname -v) 2>/dev/null || echo unknown`

/usr/bin/uname -p = `(/usr/bin/uname -p) 2>/dev/null || echo unknown`
/bin/uname -X     = `(/bin/uname -X) 2>/dev/null     || echo unknown`

/bin/arch              = `(/bin/arch) 2>/dev/null              || echo unknown`
/usr/bin/arch -k       = `(/usr/bin/arch -k) 2>/dev/null       || echo unknown`
/usr/convex/getsysinfo = `(/usr/convex/getsysinfo) 2>/dev/null || echo unknown`
/usr/bin/hostinfo      = `(/usr/bin/hostinfo) 2>/dev/null      || echo unknown`
/bin/machine           = `(/bin/machine) 2>/dev/null           || echo unknown`
/usr/bin/oslevel       = `(/usr/bin/oslevel) 2>/dev/null       || echo unknown`
/bin/universe          = `(/bin/universe) 2>/dev/null          || echo unknown`

_ASUNAME

as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
for as_dir in $PATH
do
  IFS=$as_save_IFS
  test -z "$as_dir" && as_dir=.
    $as_echo "PATH: $as_dir"
  done
IFS=$as_save_IFS

}
  echo

  # Contents of the config files.
  for at_file in atconfig atlocal
  do
    test -r $at_file || continue
    $as_echo "$as_me: $at_file:"
    sed 's/^/| /' $at_file
    echo
  done
} >&5


## ------------------------- ##
## Autotest shell functions. ##
## ------------------------- ##

# at_fn_banner NUMBER
# -------------------
# Output banner NUMBER, provided the testsuite is running multiple groups and
# this particular banner has not yet been printed.
at_fn_banner ()
{
  $at_print_banners || return 0
  eval at_banner_text=\$at_banner_text_$1
  test "x$at_banner_text" = "x " && return 0
  eval "at_banner_text_$1=\" \""
  if test -z "$at_banner_text"; then
    $at_first || echo
  else
    $as_echo "$as_nl$at_banner_text$as_nl"
  fi
} # at_fn_banner

# at_fn_check_prepare_notrace REASON LINE
# ---------------------------------------
# Perform AT_CHECK preparations for the command at LINE for an untraceable
# command; REASON is the reason for disabling tracing.
at_fn_check_prepare_notrace ()
{
  $at_trace_echo "Not enabling shell tracing (command contains $1)"
  $as_echo "$2" >"$at_check_line_file"
  at_check_trace=: at_check_filter=:
  : >"$at_stdout"; : >"$at_stderr"
}

# at_fn_check_prepare_trace LINE
# ------------------------------
# Perform AT_CHECK preparations for the command at LINE for a traceable
# command.
at_fn_check_prepare_trace ()
{
  $as_echo "$1" >"$at_check_line_file"
  at_check_trace=$at_traceon at_check_filter=$at_check_filter_trace
  : >"$at_stdout"; : >"$at_stderr"
}

# at_fn_check_prepare_dynamic COMMAND LINE
# ----------------------------------------
# Decide if COMMAND at LINE is traceable at runtime, and call the appropriate
# preparation function.
at_fn_check_prepare_dynamic ()
{
  case $1 in
    *$as_nl*)
      at_fn_check_prepare_notrace 'an embedded newline' "$2" ;;
    *)
      at_fn_check_prepare_trace "$2" ;;
  esac
}

# at_fn_filter_trace
# ------------------
# Remove the lines in the file "$at_stderr" generated by "set -x" and print
# them to stderr.
at_fn_filter_trace ()
{
  mv "$at_stderr" "$at_stder1"
  grep '^ *+' "$at_stder1" >&2
  grep -v '^ *+' "$at_stder1" >"$at_stderr"
}

# at_fn_log_failure FILE-LIST
# ---------------------------
# Copy the files in the list on stdout with a "> " prefix, and exit the shell
# with a failure exit code.
at_fn_log_failure ()
{
  for file
    do $as_echo "$file:"; sed 's/^/> /' "$file"; done
  echo 1 > "$at_status_file"
  exit 1
}

# at_fn_check_skip EXIT-CODE LINE
# -------------------------------
# Check whether EXIT-CODE is a special exit code (77 or 99), and if so exit
# the test group subshell with that same exit code. Use LINE in any report
# about test failure.
at_fn_check_skip ()
{
  case $1 in
    99) echo 99 > "$at_status_file"; at_failed=:
	$as_echo "$2: hard failure"; exit 99;;
    77) echo 77 > "$at_status_file"; exit 77;;
  esac
}

# at_fn_check_status EXPECTED EXIT-CODE LINE
# ------------------------------------------
# Check whether EXIT-CODE is the EXPECTED exit code, and if so do nothing.
# Otherwise, if it is 77 or 99, exit the test group subshell with that same
# exit code; if it is anything else print an error message referring to LINE,
# and fail the test.
at_fn_check_status ()
{
  case $2 in
    $1 ) ;;
    77) echo 77 > "$at_status_file"; exit 77;;
    99) echo 99 > "$at_status_file"; at_failed=:
	$as_echo "$3: hard failure"; exit 99;;
    *) $as_echo "$3: exit code was $2, expected $1"
      at_failed=:;;
  esac
}

# at_fn_diff_devnull FILE
# -----------------------
# Emit a diff between /dev/null and FILE. Uses "test -s" to avoid useless diff
# invocations.
at_fn_diff_devnull ()
{
  test -s "$1" || return 0
  $at_diff "$at_devnull" "$1"
}

# at_fn_test NUMBER
# -----------------
# Parse out test NUMBER from the tail of this file.
at_fn_test ()
{
  eval at_sed=\$at_sed$1
  sed "$at_sed" "$at_myself" > "$at_test_source"
}

# at_fn_create_debugging_script
# -----------------------------
# Create the debugging script $at_group_dir/run which will reproduce the
# current test group.
at_fn_create_debugging_script ()
{
  {
    echo "#! /bin/sh" &&
    echo 'test "${ZSH_VERSION+set}" = set && alias -g '\''${1+"$@"}'\''='\''"$@"'\''' &&
    $as_echo "cd '$at_dir'" &&
    $as_echo "exec \${CONFIG_SHELL-$SHELL} \"$at_myself\" -v -d $at_debug_args $at_group \${1+\"\$@\"}" &&
    echo 'exit 1'
  } >"$at_group_dir/run" &&
  chmod +x "$at_group_dir/run"
}

## -------------------------------- ##
## End of autotest shell functions. ##
## -------------------------------- ##
{
  $as_echo "## ---------------- ##
## Tested programs. ##
## ---------------- ##"
  echo
} >&5

# Report what programs are being tested.
for at_program in : $at_tested
do
  test "$at_program" = : && continue
  case $at_program in
    [\\/]* | ?:[\\/]* ) $at_program_=$at_program ;;
    * )
    as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
for as_dir in $PATH
do
  IFS=$as_save_IFS
  test -z "$as_dir" && as_dir=.
    test -f "$as_dir/$at_program" && break
  done
IFS=$as_save_IFS

    at_program_=$as_dir/$at_program ;;
  esac
  if test -f "$at_program_"; then
    {
      $as_echo "$at_srcdir/local.at:51: $at_program_ --version"
      "$at_program_" --version </dev/null
      echo
    } >&5 2>&1
  else
    as_fn_error $? "cannot find $at_program" "$LINENO" 5
  fi
done

{
  $as_echo "## ------------------ ##
## Running the tests. ##
## ------------------ ##"
} >&5

at_start_date=`date`
at_start_time=`date +%s 2>/dev/null`
$as_echo "$as_me: starting at: $at_start_date" >&5

# Create the master directory if it doesn't already exist.
as_dir="$at_suite_dir"; as_fn_mkdir_p ||
  as_fn_error $? "cannot create \`$at_suite_dir'" "$LINENO" 5

# Can we diff with `/dev/null'?  DU 5.0 refuses.
if diff /dev/null /dev/null >/dev/null 2>&1; then
  at_devnull=/dev/null
else
  at_devnull=$at_suite_dir/devnull
  >"$at_devnull"
fi

# Use `diff -u' when possible.
if at_diff=`diff -u "$at_devnull" "$at_devnull" 2>&1` && test -z "$at_diff"
then
  at_diff='diff -u'
else
  at_diff=diff
fi

# Get the last needed group.
for at_group in : $at_groups; do :; done

# Extract the start and end lines of each test group at the tail
# of this file
awk '
BEGIN { FS="" }
/^#AT_START_/ {
  start = NR
}
/^#AT_STOP_/ {
  test = substr ($ 0, 10)
  print "at_sed" test "=\"1," start "d;" (NR-1) "q\""
  if (test == "'"$at_group"'") exit
}' "$at_myself" > "$at_suite_dir/at-source-lines" &&
. "$at_suite_dir/at-source-lines" ||
  as_fn_error $? "cannot create test line number cache" "$LINENO" 5
rm -f "$at_suite_dir/at-source-lines"

# Set number of jobs for `-j'; avoid more jobs than test groups.
set X $at_groups; shift; at_max_jobs=$#
if test $at_max_jobs -eq 0; then
  at_jobs=1
fi
if test $at_jobs -ne 1 &&
   { test $at_jobs -eq 0 || test $at_jobs -gt $at_max_jobs; }; then
  at_jobs=$at_max_jobs
fi

# If parallel mode, don't output banners, don't split summary lines.
if test $at_jobs -ne 1; then
  at_print_banners=false
  at_quiet=:
fi

# Set up helper dirs.
rm -rf "$at_helper_dir" &&
mkdir "$at_helper_dir" &&
cd "$at_helper_dir" &&
{ test -z "$at_groups" || mkdir $at_groups; } ||
as_fn_error $? "testsuite directory setup failed" "$LINENO" 5

# Functions for running a test group.  We leave the actual
# test group execution outside of a shell function in order
# to avoid hitting zsh 4.x exit status bugs.

# at_fn_group_prepare
# -------------------
# Prepare for running a test group.
at_fn_group_prepare ()
{
  # The directory for additional per-group helper files.
  at_job_dir=$at_helper_dir/$at_group
  # The file containing the location of the last AT_CHECK.
  at_check_line_file=$at_job_dir/check-line
  # The file containing the exit status of the last command.
  at_status_file=$at_job_dir/status
  # The files containing the output of the tested commands.
  at_stdout=$at_job_dir/stdout
  at_stder1=$at_job_dir/stder1
  at_stderr=$at_job_dir/stderr
  # The file containing the code for a test group.
  at_test_source=$at_job_dir/test-source
  # The file containing dates.
  at_times_file=$at_job_dir/times

  # Be sure to come back to the top test directory.
  cd "$at_suite_dir"

  # Clearly separate the test groups when verbose.
  $at_first || $at_verbose echo

  at_group_normalized=$at_group

  eval 'while :; do
    case $at_group_normalized in #(
    '"$at_format"'*) break;;
    esac
    at_group_normalized=0$at_group_normalized
  done'


  # Create a fresh directory for the next test group, and enter.
  # If one already exists, the user may have invoked ./run from
  # within that directory; we remove the contents, but not the
  # directory itself, so that we aren't pulling the rug out from
  # under the shell's notion of the current directory.
  at_group_dir=$at_suite_dir/$at_group_normalized
  at_group_log=$at_group_dir/$as_me.log
  if test -d "$at_group_dir"; then
  find "$at_group_dir" -type d ! -perm -700 -exec chmod u+rwx {} \;
  rm -fr "$at_group_dir"/* "$at_group_dir"/.[!.] "$at_group_dir"/.??*
fi ||
    { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: test directory for $at_group_normalized could not be cleaned" >&5
$as_echo "$as_me: WARNING: test directory for $at_group_normalized could not be cleaned" >&2;}
  # Be tolerant if the above `rm' was not able to remove the directory.
  as_dir="$at_group_dir"; as_fn_mkdir_p

  echo 0 > "$at_status_file"

  # In verbose mode, append to the log file *and* show on
  # the standard output; in quiet mode only write to the log.
  if test -z "$at_verbose"; then
    at_tee_pipe='tee -a "$at_group_log"'
  else
    at_tee_pipe='cat >> "$at_group_log"'
  fi
}

# at_fn_group_banner ORDINAL LINE DESC PAD [BANNER]
# -------------------------------------------------
# Declare the test group ORDINAL, located at LINE with group description DESC,
# and residing under BANNER. Use PAD to align the status column.
at_fn_group_banner ()
{
  at_setup_line="$2"
  test -n "$5" && at_fn_banner $5
  at_desc="$3"
  case $1 in
    [0-9])      at_desc_line="  $1: ";;
    [0-9][0-9]) at_desc_line=" $1: " ;;
    *)          at_desc_line="$1: "  ;;
  esac
  as_fn_append at_desc_line "$3$4"
  $at_quiet $as_echo_n "$at_desc_line"
  echo "#                             -*- compilation -*-" >> "$at_group_log"
}

# at_fn_group_postprocess
# -----------------------
# Perform cleanup after running a test group.
at_fn_group_postprocess ()
{
  # Be sure to come back to the suite directory, in particular
  # since below we might `rm' the group directory we are in currently.
  cd "$at_suite_dir"

  if test ! -f "$at_check_line_file"; then
    sed "s/^ */$as_me: WARNING: /" <<_ATEOF
      A failure happened in a test group before any test could be
      run. This means that test suite is improperly designed.  Please
      report this failure to <rpm-maint@lists.rpm.org>.
_ATEOF
    $as_echo "$at_setup_line" >"$at_check_line_file"
    at_status=99
  fi
  $at_verbose $as_echo_n "$at_group. $at_setup_line: "
  $as_echo_n "$at_group. $at_setup_line: " >> "$at_group_log"
  case $at_xfail:$at_status in
    yes:0)
	at_msg="UNEXPECTED PASS"
	at_res=xpass
	at_errexit=$at_errexit_p
	at_color=$at_red
	;;
    no:0)
	at_msg="ok"
	at_res=pass
	at_errexit=false
	at_color=$at_grn
	;;
    *:77)
	at_msg='skipped ('`cat "$at_check_line_file"`')'
	at_res=skip
	at_errexit=false
	at_color=$at_blu
	;;
    no:* | *:99)
	at_msg='FAILED ('`cat "$at_check_line_file"`')'
	at_res=fail
	at_errexit=$at_errexit_p
	at_color=$at_red
	;;
    yes:*)
	at_msg='expected failure ('`cat "$at_check_line_file"`')'
	at_res=xfail
	at_errexit=false
	at_color=$at_lgn
	;;
  esac
  echo "$at_res" > "$at_job_dir/$at_res"
  # In parallel mode, output the summary line only afterwards.
  if test $at_jobs -ne 1 && test -n "$at_verbose"; then
    $as_echo "$at_desc_line $at_color$at_msg$at_std"
  else
    # Make sure there is a separator even with long titles.
    $as_echo " $at_color$at_msg$at_std"
  fi
  at_log_msg="$at_group. $at_desc ($at_setup_line): $at_msg"
  case $at_status in
    0|77)
      # $at_times_file is only available if the group succeeded.
      # We're not including the group log, so the success message
      # is written in the global log separately.  But we also
      # write to the group log in case they're using -d.
      if test -f "$at_times_file"; then
	at_log_msg="$at_log_msg     ("`sed 1d "$at_times_file"`')'
	rm -f "$at_times_file"
      fi
      $as_echo "$at_log_msg" >> "$at_group_log"
      $as_echo "$at_log_msg" >&5

      # Cleanup the group directory, unless the user wants the files
      # or the success was unexpected.
      if $at_debug_p || test $at_res = xpass; then
	at_fn_create_debugging_script
	if test $at_res = xpass && $at_errexit; then
	  echo stop > "$at_stop_file"
	fi
      else
	if test -d "$at_group_dir"; then
	  find "$at_group_dir" -type d ! -perm -700 -exec chmod u+rwx \{\} \;
	  rm -fr "$at_group_dir"
	fi
	rm -f "$at_test_source"
      fi
      ;;
    *)
      # Upon failure, include the log into the testsuite's global
      # log.  The failure message is written in the group log.  It
      # is later included in the global log.
      $as_echo "$at_log_msg" >> "$at_group_log"

      # Upon failure, keep the group directory for autopsy, and create
      # the debugging script.  With -e, do not start any further tests.
      at_fn_create_debugging_script
      if $at_errexit; then
	echo stop > "$at_stop_file"
      fi
      ;;
  esac
}


## ------------ ##
## Driver loop. ##
## ------------ ##


if (set -m && set +m && set +b) >/dev/null 2>&1; then
  set +b
  at_job_control_on='set -m' at_job_control_off='set +m' at_job_group=-
else
  at_job_control_on=: at_job_control_off=: at_job_group=
fi

for at_signal in 1 2 15; do
  trap 'set +x; set +e
	$at_job_control_off
	at_signal='"$at_signal"'
	echo stop > "$at_stop_file"
	trap "" $at_signal
	at_pgids=
	for at_pgid in `jobs -p 2>/dev/null`; do
	  at_pgids="$at_pgids $at_job_group$at_pgid"
	done
	test -z "$at_pgids" || kill -$at_signal $at_pgids 2>/dev/null
	wait
	if test "$at_jobs" -eq 1 || test -z "$at_verbose"; then
	  echo >&2
	fi
	at_signame=`kill -l $at_signal 2>&1 || echo $at_signal`
	set x $at_signame
	test 0 -gt 2 && at_signame=$at_signal
	{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: caught signal $at_signame, bailing out" >&5
$as_echo "$as_me: WARNING: caught signal $at_signame, bailing out" >&2;}
	as_fn_arith 128 + $at_signal && exit_status=$as_val
	as_fn_exit $exit_status' $at_signal
done

rm -f "$at_stop_file"
at_first=:

if test $at_jobs -ne 1 &&
     rm -f "$at_job_fifo" &&
     test -n "$at_job_group" &&
     ( mkfifo "$at_job_fifo" && trap 'exit 1' PIPE STOP TSTP ) 2>/dev/null
then
  # FIFO job dispatcher.

  trap 'at_pids=
	for at_pid in `jobs -p`; do
	  at_pids="$at_pids $at_job_group$at_pid"
	done
	if test -n "$at_pids"; then
	  at_sig=TSTP
	  test "${TMOUT+set}" = set && at_sig=STOP
	  kill -$at_sig $at_pids 2>/dev/null
	fi
	kill -STOP $$
	test -z "$at_pids" || kill -CONT $at_pids 2>/dev/null' TSTP

  echo
  # Turn jobs into a list of numbers, starting from 1.
  at_joblist=`$as_echo "$at_groups" | sed -n 1,${at_jobs}p`

  set X $at_joblist
  shift
  for at_group in $at_groups; do
    $at_job_control_on 2>/dev/null
    (
      # Start one test group.
      $at_job_control_off
      if $at_first; then
	exec 7>"$at_job_fifo"
      else
	exec 6<&-
      fi
      trap 'set +x; set +e
	    trap "" PIPE
	    echo stop > "$at_stop_file"
	    echo >&7
	    as_fn_exit 141' PIPE
      at_fn_group_prepare
      if cd "$at_group_dir" &&
	 at_fn_test $at_group &&
	 . "$at_test_source"
      then :; else
	{ $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: unable to parse test group: $at_group" >&5
$as_echo "$as_me: WARNING: unable to parse test group: $at_group" >&2;}
	at_failed=:
      fi
      at_fn_group_postprocess
      echo >&7
    ) &
    $at_job_control_off
    if $at_first; then
      at_first=false
      exec 6<"$at_job_fifo" 7>"$at_job_fifo"
    fi
    shift # Consume one token.
    if test $# -gt 0; then :; else
      read at_token <&6 || break
      set x $*
    fi
    test -f "$at_stop_file" && break
  done
  exec 7>&-
  # Read back the remaining ($at_jobs - 1) tokens.
  set X $at_joblist
  shift
  if test $# -gt 0; then
    shift
    for at_job
    do
      read at_token
    done <&6
  fi
  exec 6<&-
  wait
else
  # Run serially, avoid forks and other potential surprises.
  for at_group in $at_groups; do
    at_fn_group_prepare
    if cd "$at_group_dir" &&
       at_fn_test $at_group &&
       . "$at_test_source"; then :; else
      { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: unable to parse test group: $at_group" >&5
$as_echo "$as_me: WARNING: unable to parse test group: $at_group" >&2;}
      at_failed=:
    fi
    at_fn_group_postprocess
    test -f "$at_stop_file" && break
    at_first=false
  done
fi

# Wrap up the test suite with summary statistics.
cd "$at_helper_dir"

# Use ?..???? when the list must remain sorted, the faster * otherwise.
at_pass_list=`for f in */pass; do echo $f; done | sed '/\*/d; s,/pass,,'`
at_skip_list=`for f in */skip; do echo $f; done | sed '/\*/d; s,/skip,,'`
at_xfail_list=`for f in */xfail; do echo $f; done | sed '/\*/d; s,/xfail,,'`
at_xpass_list=`for f in ?/xpass ??/xpass ???/xpass ????/xpass; do
		 echo $f; done | sed '/?/d; s,/xpass,,'`
at_fail_list=`for f in ?/fail ??/fail ???/fail ????/fail; do
		echo $f; done | sed '/?/d; s,/fail,,'`

set X $at_pass_list $at_xpass_list $at_xfail_list $at_fail_list $at_skip_list
shift; at_group_count=$#
set X $at_xpass_list; shift; at_xpass_count=$#; at_xpass_list=$*
set X $at_xfail_list; shift; at_xfail_count=$#
set X $at_fail_list; shift; at_fail_count=$#; at_fail_list=$*
set X $at_skip_list; shift; at_skip_count=$#

as_fn_arith $at_group_count - $at_skip_count && at_run_count=$as_val
as_fn_arith $at_xpass_count + $at_fail_count && at_unexpected_count=$as_val
as_fn_arith $at_xfail_count + $at_fail_count && at_total_fail_count=$as_val

# Back to the top directory.
cd "$at_dir"
rm -rf "$at_helper_dir"

# Compute the duration of the suite.
at_stop_date=`date`
at_stop_time=`date +%s 2>/dev/null`
$as_echo "$as_me: ending at: $at_stop_date" >&5
case $at_start_time,$at_stop_time in
  [0-9]*,[0-9]*)
    as_fn_arith $at_stop_time - $at_start_time && at_duration_s=$as_val
    as_fn_arith $at_duration_s / 60 && at_duration_m=$as_val
    as_fn_arith $at_duration_m / 60 && at_duration_h=$as_val
    as_fn_arith $at_duration_s % 60 && at_duration_s=$as_val
    as_fn_arith $at_duration_m % 60 && at_duration_m=$as_val
    at_duration="${at_duration_h}h ${at_duration_m}m ${at_duration_s}s"
    $as_echo "$as_me: test suite duration: $at_duration" >&5
    ;;
esac

echo
$as_echo "## ------------- ##
## Test results. ##
## ------------- ##"
echo
{
  echo
  $as_echo "## ------------- ##
## Test results. ##
## ------------- ##"
  echo
} >&5

if test $at_run_count = 1; then
  at_result="1 test"
  at_were=was
else
  at_result="$at_run_count tests"
  at_were=were
fi
if $at_errexit_p && test $at_unexpected_count != 0; then
  if test $at_xpass_count = 1; then
    at_result="$at_result $at_were run, one passed"
  else
    at_result="$at_result $at_were run, one failed"
  fi
  at_result="$at_result unexpectedly and inhibited subsequent tests."
  at_color=$at_red
else
  # Don't you just love exponential explosion of the number of cases?
  at_color=$at_red
  case $at_xpass_count:$at_fail_count:$at_xfail_count in
    # So far, so good.
    0:0:0) at_result="$at_result $at_were successful." at_color=$at_grn ;;
    0:0:*) at_result="$at_result behaved as expected." at_color=$at_lgn ;;

    # Some unexpected failures
    0:*:0) at_result="$at_result $at_were run,
$at_fail_count failed unexpectedly." ;;

    # Some failures, both expected and unexpected
    0:*:1) at_result="$at_result $at_were run,
$at_total_fail_count failed ($at_xfail_count expected failure)." ;;
    0:*:*) at_result="$at_result $at_were run,
$at_total_fail_count failed ($at_xfail_count expected failures)." ;;

    # No unexpected failures, but some xpasses
    *:0:*) at_result="$at_result $at_were run,
$at_xpass_count passed unexpectedly." ;;

    # No expected failures, but failures and xpasses
    *:1:0) at_result="$at_result $at_were run,
$at_unexpected_count did not behave as expected ($at_fail_count unexpected failure)." ;;
    *:*:0) at_result="$at_result $at_were run,
$at_unexpected_count did not behave as expected ($at_fail_count unexpected failures)." ;;

    # All of them.
    *:*:1) at_result="$at_result $at_were run,
$at_xpass_count passed unexpectedly,
$at_total_fail_count failed ($at_xfail_count expected failure)." ;;
    *:*:*) at_result="$at_result $at_were run,
$at_xpass_count passed unexpectedly,
$at_total_fail_count failed ($at_xfail_count expected failures)." ;;
  esac

  if test $at_skip_count = 0 && test $at_run_count -gt 1; then
    at_result="All $at_result"
  fi
fi

# Now put skips in the mix.
case $at_skip_count in
  0) ;;
  1) at_result="$at_result
1 test was skipped." ;;
  *) at_result="$at_result
$at_skip_count tests were skipped." ;;
esac

if test $at_unexpected_count = 0; then
  echo "$at_color$at_result$at_std"
  echo "$at_result" >&5
else
  echo "${at_color}ERROR: $at_result$at_std" >&2
  echo "ERROR: $at_result" >&5
  {
    echo
    $as_echo "## ------------------------ ##
## Summary of the failures. ##
## ------------------------ ##"

    # Summary of failed and skipped tests.
    if test $at_fail_count != 0; then
      echo "Failed tests:"
      $SHELL "$at_myself" $at_fail_list --list
      echo
    fi
    if test $at_skip_count != 0; then
      echo "Skipped tests:"
      $SHELL "$at_myself" $at_skip_list --list
      echo
    fi
    if test $at_xpass_count != 0; then
      echo "Unexpected passes:"
      $SHELL "$at_myself" $at_xpass_list --list
      echo
    fi
    if test $at_fail_count != 0; then
      $as_echo "## ---------------------- ##
## Detailed failed tests. ##
## ---------------------- ##"
      echo
      for at_group in $at_fail_list
      do
	at_group_normalized=$at_group

  eval 'while :; do
    case $at_group_normalized in #(
    '"$at_format"'*) break;;
    esac
    at_group_normalized=0$at_group_normalized
  done'

	cat "$at_suite_dir/$at_group_normalized/$as_me.log"
	echo
      done
      echo
    fi
    if test -n "$at_top_srcdir"; then
      sed 'h;s/./-/g;s/^.../## /;s/...$/ ##/;p;x;p;x' <<_ASBOX
## ${at_top_build_prefix}config.log ##
_ASBOX
      sed 's/^/| /' ${at_top_build_prefix}config.log
      echo
    fi
  } >&5

  sed 'h;s/./-/g;s/^.../## /;s/...$/ ##/;p;x;p;x' <<_ASBOX
## $as_me.log was created. ##
_ASBOX

  echo
  if $at_debug_p; then
    at_msg='per-test log files'
  else
    at_msg="\`${at_testdir+${at_testdir}/}$as_me.log'"
  fi
  $as_echo "Please send $at_msg and all information you think might help:

   To: <rpm-maint@lists.rpm.org>
   Subject: [rpm 4.17.0] $as_me: $at_fail_list${at_fail_list:+ failed${at_xpass_list:+, }}$at_xpass_list${at_xpass_list:+ passed unexpectedly}

You may investigate any problem if you feel able to do so, in which
case the test suite provides a good starting point.  Its output may
be found below \`${at_testdir+${at_testdir}/}$as_me.dir'.
"
  exit 1
fi

exit 0

## ------------- ##
## Actual tests. ##
## ------------- ##
#AT_START_1
at_fn_group_banner 1 'rpmgeneral.at:22' \
  "rpm --version" "                                  " 1
at_xfail=no
(
  $as_echo "1. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmgeneral.at:24: runroot rpm --version"
at_fn_check_prepare_trace "rpmgeneral.at:24"
( $at_check_trace; runroot rpm --version
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "RPM version 4.17.0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmgeneral.at:24"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_1
#AT_START_2
at_fn_group_banner 2 'rpmgeneral.at:31' \
  "rpmbuild --version" "                             " 1
at_xfail=no
(
  $as_echo "2. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmgeneral.at:33: runroot rpmbuild --version"
at_fn_check_prepare_trace "rpmgeneral.at:33"
( $at_check_trace; runroot rpmbuild --version
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "RPM version 4.17.0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmgeneral.at:33"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_2
#AT_START_3
at_fn_group_banner 3 'rpmgeneral.at:39' \
  "rpm library version" "                            " 1
at_xfail=no
(
  $as_echo "3. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmgeneral.at:41" >"$at_check_line_file"
(test -f "${RPMTEST}/${RPMLIBDIR}/librpm.a") \
  && at_fn_check_skip 77 "$at_srcdir/rpmgeneral.at:41"
{ set +x
$as_echo "$at_srcdir/rpmgeneral.at:42:
cd \${RPMTEST}/\${RPMLIBDIR}
ls lib*.so.*.*
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmgeneral.at:42"
( $at_check_trace;
cd ${RPMTEST}/${RPMLIBDIR}
ls lib*.so.*.*

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "librpm.so.9.2.0
librpmbuild.so.9.2.0
librpmio.so.9.2.0
librpmsign.so.9.2.0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmgeneral.at:42"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_3
#AT_START_4
at_fn_group_banner 4 'rpmgeneral.at:55' \
  "rpm --showrc" "                                   " 1
at_xfail=no
(
  $as_echo "4. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmgeneral.at:57: runroot rpm --showrc"
at_fn_check_prepare_trace "rpmgeneral.at:57"
( $at_check_trace; runroot rpm --showrc
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo stdout:; cat "$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/rpmgeneral.at:57"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_4
#AT_START_5
at_fn_group_banner 5 'rpmgeneral.at:65' \
  "rpm --querytags" "                                " 1
at_xfail=no
(
  $as_echo "5. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmgeneral.at:67: runroot rpm --querytags"
at_fn_check_prepare_trace "rpmgeneral.at:67"
( $at_check_trace; runroot rpm --querytags
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "ARCH
ARCHIVESIZE
BASENAMES
BUGURL
BUILDARCHS
BUILDHOST
BUILDTIME
C
CHANGELOGNAME
CHANGELOGTEXT
CHANGELOGTIME
CLASSDICT
CONFLICTFLAGS
CONFLICTNAME
CONFLICTNEVRS
CONFLICTS
CONFLICTVERSION
COOKIE
DBINSTANCE
DEPENDSDICT
DESCRIPTION
DIRINDEXES
DIRNAMES
DISTRIBUTION
DISTTAG
DISTURL
DSAHEADER
E
ENCODING
ENHANCEFLAGS
ENHANCENAME
ENHANCENEVRS
ENHANCES
ENHANCEVERSION
EPOCH
EPOCHNUM
EVR
EXCLUDEARCH
EXCLUDEOS
EXCLUSIVEARCH
EXCLUSIVEOS
FILECAPS
FILECLASS
FILECOLORS
FILECONTEXTS
FILEDEPENDSN
FILEDEPENDSX
FILEDEVICES
FILEDIGESTALGO
FILEDIGESTS
FILEFLAGS
FILEGROUPNAME
FILEINODES
FILELANGS
FILELINKTOS
FILEMD5S
FILEMODES
FILEMTIMES
FILENAMES
FILENLINKS
FILEPROVIDE
FILERDEVS
FILEREQUIRE
FILESIGNATURELENGTH
FILESIGNATURES
FILESIZES
FILESTATES
FILETRIGGERCONDS
FILETRIGGERFLAGS
FILETRIGGERINDEX
FILETRIGGERNAME
FILETRIGGERPRIORITIES
FILETRIGGERSCRIPTFLAGS
FILETRIGGERSCRIPTPROG
FILETRIGGERSCRIPTS
FILETRIGGERTYPE
FILETRIGGERVERSION
FILEUSERNAME
FILEVERIFYFLAGS
FSCONTEXTS
GIF
GROUP
HDRID
HEADERCOLOR
HEADERI18NTABLE
HEADERIMAGE
HEADERIMMUTABLE
HEADERREGIONS
HEADERSIGNATURES
ICON
INSTALLCOLOR
INSTALLTID
INSTALLTIME
INSTFILENAMES
INSTPREFIXES
LICENSE
LONGARCHIVESIZE
LONGFILESIZES
LONGSIGSIZE
LONGSIZE
MODULARITYLABEL
N
NAME
NEVR
NEVRA
NOPATCH
NOSOURCE
NVR
NVRA
O
OBSOLETEFLAGS
OBSOLETENAME
OBSOLETENEVRS
OBSOLETES
OBSOLETEVERSION
OLDENHANCES
OLDENHANCESFLAGS
OLDENHANCESNAME
OLDENHANCESVERSION
OLDFILENAMES
OLDSUGGESTS
OLDSUGGESTSFLAGS
OLDSUGGESTSNAME
OLDSUGGESTSVERSION
OPTFLAGS
ORDERFLAGS
ORDERNAME
ORDERVERSION
ORIGBASENAMES
ORIGDIRINDEXES
ORIGDIRNAMES
ORIGFILENAMES
OS
P
PACKAGER
PATCH
PATCHESFLAGS
PATCHESNAME
PATCHESVERSION
PAYLOADCOMPRESSOR
PAYLOADDIGEST
PAYLOADDIGESTALGO
PAYLOADDIGESTALT
PAYLOADFLAGS
PAYLOADFORMAT
PKGID
PLATFORM
POLICIES
POLICYFLAGS
POLICYNAMES
POLICYTYPES
POLICYTYPESINDEXES
POSTIN
POSTINFLAGS
POSTINPROG
POSTTRANS
POSTTRANSFLAGS
POSTTRANSPROG
POSTUN
POSTUNFLAGS
POSTUNPROG
PREFIXES
PREIN
PREINFLAGS
PREINPROG
PRETRANS
PRETRANSFLAGS
PRETRANSPROG
PREUN
PREUNFLAGS
PREUNPROG
PROVIDEFLAGS
PROVIDENAME
PROVIDENEVRS
PROVIDES
PROVIDEVERSION
PUBKEYS
R
RECOMMENDFLAGS
RECOMMENDNAME
RECOMMENDNEVRS
RECOMMENDS
RECOMMENDVERSION
RECONTEXTS
RELEASE
REMOVETID
REQUIREFLAGS
REQUIRENAME
REQUIRENEVRS
REQUIRES
REQUIREVERSION
RPMVERSION
RSAHEADER
SHA1HEADER
SHA256HEADER
SIGGPG
SIGMD5
SIGPGP
SIGSIZE
SIZE
SOURCE
SOURCEPACKAGE
SOURCEPKGID
SOURCERPM
SUGGESTFLAGS
SUGGESTNAME
SUGGESTNEVRS
SUGGESTS
SUGGESTVERSION
SUMMARY
SUPPLEMENTFLAGS
SUPPLEMENTNAME
SUPPLEMENTNEVRS
SUPPLEMENTS
SUPPLEMENTVERSION
TRANSFILETRIGGERCONDS
TRANSFILETRIGGERFLAGS
TRANSFILETRIGGERINDEX
TRANSFILETRIGGERNAME
TRANSFILETRIGGERPRIORITIES
TRANSFILETRIGGERSCRIPTFLAGS
TRANSFILETRIGGERSCRIPTPROG
TRANSFILETRIGGERSCRIPTS
TRANSFILETRIGGERTYPE
TRANSFILETRIGGERVERSION
TRIGGERCONDS
TRIGGERFLAGS
TRIGGERINDEX
TRIGGERNAME
TRIGGERSCRIPTFLAGS
TRIGGERSCRIPTPROG
TRIGGERSCRIPTS
TRIGGERTYPE
TRIGGERVERSION
URL
V
VCS
VENDOR
VERBOSE
VERIFYSCRIPT
VERIFYSCRIPTFLAGS
VERIFYSCRIPTPROG
VERITYSIGNATUREALGO
VERITYSIGNATURES
VERSION
XPM
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmgeneral.at:67"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_5
#AT_START_6
at_fn_group_banner 6 'rpmgeneral.at:317' \
  "rpm2cpio" "                                       " 1
at_xfail=no
(
  $as_echo "6. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmgeneral.at:319:
runroot_other rpm2cpio data/RPMS/hello-2.0-1.x86_64.rpm | cpio -t --quiet
runroot_other rpm2cpio data/SRPMS/hello-1.0-1.src.rpm | cpio -t --quiet
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmgeneral.at:319"
( $at_check_trace;
runroot_other rpm2cpio data/RPMS/hello-2.0-1.x86_64.rpm | cpio -t --quiet
runroot_other rpm2cpio data/SRPMS/hello-1.0-1.src.rpm | cpio -t --quiet

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "./usr/bin/hello
./usr/share/doc/hello-2.0
./usr/share/doc/hello-2.0/COPYING
./usr/share/doc/hello-2.0/FAQ
./usr/share/doc/hello-2.0/README
hello-1.0.tar.gz
hello.spec
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmgeneral.at:319"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_6
#AT_START_7
at_fn_group_banner 7 'rpmgeneral.at:334' \
  "rpm2archive" "                                    " 1
at_xfail=no
(
  $as_echo "7. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmgeneral.at:336:
runroot_other rpm2archive - < \"\${RPMTEST}\"/data/RPMS/hello-2.0-1.x86_64.rpm | tar tzf -
runroot_other rpm2archive - < \"\${RPMTEST}\"/data/SRPMS/hello-1.0-1.src.rpm | tar tzf -
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmgeneral.at:336"
( $at_check_trace;
runroot_other rpm2archive - < "${RPMTEST}"/data/RPMS/hello-2.0-1.x86_64.rpm | tar tzf -
runroot_other rpm2archive - < "${RPMTEST}"/data/SRPMS/hello-1.0-1.src.rpm | tar tzf -

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "./usr/bin/hello
./usr/share/doc/hello-2.0/
./usr/share/doc/hello-2.0/COPYING
./usr/share/doc/hello-2.0/FAQ
./usr/share/doc/hello-2.0/README
./hello-1.0.tar.gz
./hello.spec
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmgeneral.at:336"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_7
#AT_START_8
at_fn_group_banner 8 'rpmvercmp.at:14' \
  "rpmvercmp(1.0, 1.0) = 0" "                        " 2
at_xfail=no
(
  $as_echo "8. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:14:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0\", \"1.0\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:14"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0", "1.0"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:14"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_8
#AT_START_9
at_fn_group_banner 9 'rpmvercmp.at:15' \
  "rpmvercmp(1.0, 2.0) = -1" "                       " 2
at_xfail=no
(
  $as_echo "9. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:15:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0\", \"2.0\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:15"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0", "2.0"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:15"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_9
#AT_START_10
at_fn_group_banner 10 'rpmvercmp.at:16' \
  "rpmvercmp(2.0, 1.0) = 1" "                        " 2
at_xfail=no
(
  $as_echo "10. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:16:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"2.0\", \"1.0\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:16"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("2.0", "1.0"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:16"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_10
#AT_START_11
at_fn_group_banner 11 'rpmvercmp.at:18' \
  "rpmvercmp(2.0.1, 2.0.1) = 0" "                    " 2
at_xfail=no
(
  $as_echo "11. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:18:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"2.0.1\", \"2.0.1\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:18"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("2.0.1", "2.0.1"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:18"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_11
#AT_START_12
at_fn_group_banner 12 'rpmvercmp.at:19' \
  "rpmvercmp(2.0, 2.0.1) = -1" "                     " 2
at_xfail=no
(
  $as_echo "12. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:19:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"2.0\", \"2.0.1\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:19"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("2.0", "2.0.1"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:19"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_12
#AT_START_13
at_fn_group_banner 13 'rpmvercmp.at:20' \
  "rpmvercmp(2.0.1, 2.0) = 1" "                      " 2
at_xfail=no
(
  $as_echo "13. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:20:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"2.0.1\", \"2.0\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:20"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("2.0.1", "2.0"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:20"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_13
#AT_START_14
at_fn_group_banner 14 'rpmvercmp.at:22' \
  "rpmvercmp(2.0.1a, 2.0.1a) = 0" "                  " 2
at_xfail=no
(
  $as_echo "14. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:22:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"2.0.1a\", \"2.0.1a\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:22"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("2.0.1a", "2.0.1a"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:22"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_14
#AT_START_15
at_fn_group_banner 15 'rpmvercmp.at:23' \
  "rpmvercmp(2.0.1a, 2.0.1) = 1" "                   " 2
at_xfail=no
(
  $as_echo "15. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:23:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"2.0.1a\", \"2.0.1\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:23"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("2.0.1a", "2.0.1"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:23"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_15
#AT_START_16
at_fn_group_banner 16 'rpmvercmp.at:24' \
  "rpmvercmp(2.0.1, 2.0.1a) = -1" "                  " 2
at_xfail=no
(
  $as_echo "16. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:24:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"2.0.1\", \"2.0.1a\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:24"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("2.0.1", "2.0.1a"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:24"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_16
#AT_START_17
at_fn_group_banner 17 'rpmvercmp.at:26' \
  "rpmvercmp(5.5p1, 5.5p1) = 0" "                    " 2
at_xfail=no
(
  $as_echo "17. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:26:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"5.5p1\", \"5.5p1\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:26"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("5.5p1", "5.5p1"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:26"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_17
#AT_START_18
at_fn_group_banner 18 'rpmvercmp.at:27' \
  "rpmvercmp(5.5p1, 5.5p2) = -1" "                   " 2
at_xfail=no
(
  $as_echo "18. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:27:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"5.5p1\", \"5.5p2\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:27"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("5.5p1", "5.5p2"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:27"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_18
#AT_START_19
at_fn_group_banner 19 'rpmvercmp.at:28' \
  "rpmvercmp(5.5p2, 5.5p1) = 1" "                    " 2
at_xfail=no
(
  $as_echo "19. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:28:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"5.5p2\", \"5.5p1\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:28"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("5.5p2", "5.5p1"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:28"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_19
#AT_START_20
at_fn_group_banner 20 'rpmvercmp.at:30' \
  "rpmvercmp(5.5p10, 5.5p10) = 0" "                  " 2
at_xfail=no
(
  $as_echo "20. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:30:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"5.5p10\", \"5.5p10\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:30"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("5.5p10", "5.5p10"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:30"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_20
#AT_START_21
at_fn_group_banner 21 'rpmvercmp.at:31' \
  "rpmvercmp(5.5p1, 5.5p10) = -1" "                  " 2
at_xfail=no
(
  $as_echo "21. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:31:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"5.5p1\", \"5.5p10\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:31"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("5.5p1", "5.5p10"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:31"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_21
#AT_START_22
at_fn_group_banner 22 'rpmvercmp.at:32' \
  "rpmvercmp(5.5p10, 5.5p1) = 1" "                   " 2
at_xfail=no
(
  $as_echo "22. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:32:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"5.5p10\", \"5.5p1\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:32"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("5.5p10", "5.5p1"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:32"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_22
#AT_START_23
at_fn_group_banner 23 'rpmvercmp.at:34' \
  "rpmvercmp(10xyz, 10.1xyz) = -1" "                 " 2
at_xfail=no
(
  $as_echo "23. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:34:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"10xyz\", \"10.1xyz\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:34"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("10xyz", "10.1xyz"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:34"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_23
#AT_START_24
at_fn_group_banner 24 'rpmvercmp.at:35' \
  "rpmvercmp(10.1xyz, 10xyz) = 1" "                  " 2
at_xfail=no
(
  $as_echo "24. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:35:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"10.1xyz\", \"10xyz\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:35"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("10.1xyz", "10xyz"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:35"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_24
#AT_START_25
at_fn_group_banner 25 'rpmvercmp.at:37' \
  "rpmvercmp(xyz10, xyz10) = 0" "                    " 2
at_xfail=no
(
  $as_echo "25. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:37:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"xyz10\", \"xyz10\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:37"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("xyz10", "xyz10"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:37"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_25
#AT_START_26
at_fn_group_banner 26 'rpmvercmp.at:38' \
  "rpmvercmp(xyz10, xyz10.1) = -1" "                 " 2
at_xfail=no
(
  $as_echo "26. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:38:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"xyz10\", \"xyz10.1\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:38"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("xyz10", "xyz10.1"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:38"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_26
#AT_START_27
at_fn_group_banner 27 'rpmvercmp.at:39' \
  "rpmvercmp(xyz10.1, xyz10) = 1" "                  " 2
at_xfail=no
(
  $as_echo "27. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:39:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"xyz10.1\", \"xyz10\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:39"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("xyz10.1", "xyz10"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:39"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_27
#AT_START_28
at_fn_group_banner 28 'rpmvercmp.at:41' \
  "rpmvercmp(xyz.4, xyz.4) = 0" "                    " 2
at_xfail=no
(
  $as_echo "28. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:41:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"xyz.4\", \"xyz.4\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:41"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("xyz.4", "xyz.4"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:41"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_28
#AT_START_29
at_fn_group_banner 29 'rpmvercmp.at:42' \
  "rpmvercmp(xyz.4, 8) = -1" "                       " 2
at_xfail=no
(
  $as_echo "29. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:42:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"xyz.4\", \"8\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:42"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("xyz.4", "8"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:42"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_29
#AT_START_30
at_fn_group_banner 30 'rpmvercmp.at:43' \
  "rpmvercmp(8, xyz.4) = 1" "                        " 2
at_xfail=no
(
  $as_echo "30. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:43:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"8\", \"xyz.4\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:43"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("8", "xyz.4"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:43"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_30
#AT_START_31
at_fn_group_banner 31 'rpmvercmp.at:44' \
  "rpmvercmp(xyz.4, 2) = -1" "                       " 2
at_xfail=no
(
  $as_echo "31. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:44:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"xyz.4\", \"2\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:44"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("xyz.4", "2"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:44"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_31
#AT_START_32
at_fn_group_banner 32 'rpmvercmp.at:45' \
  "rpmvercmp(2, xyz.4) = 1" "                        " 2
at_xfail=no
(
  $as_echo "32. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:45:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"2\", \"xyz.4\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:45"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("2", "xyz.4"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:45"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_32
#AT_START_33
at_fn_group_banner 33 'rpmvercmp.at:47' \
  "rpmvercmp(5.5p2, 5.6p1) = -1" "                   " 2
at_xfail=no
(
  $as_echo "33. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:47:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"5.5p2\", \"5.6p1\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:47"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("5.5p2", "5.6p1"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:47"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_33
#AT_START_34
at_fn_group_banner 34 'rpmvercmp.at:48' \
  "rpmvercmp(5.6p1, 5.5p2) = 1" "                    " 2
at_xfail=no
(
  $as_echo "34. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:48:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"5.6p1\", \"5.5p2\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:48"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("5.6p1", "5.5p2"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:48"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_34
#AT_START_35
at_fn_group_banner 35 'rpmvercmp.at:50' \
  "rpmvercmp(5.6p1, 6.5p1) = -1" "                   " 2
at_xfail=no
(
  $as_echo "35. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:50:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"5.6p1\", \"6.5p1\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:50"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("5.6p1", "6.5p1"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:50"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_35
#AT_START_36
at_fn_group_banner 36 'rpmvercmp.at:51' \
  "rpmvercmp(6.5p1, 5.6p1) = 1" "                    " 2
at_xfail=no
(
  $as_echo "36. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:51:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"6.5p1\", \"5.6p1\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:51"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("6.5p1", "5.6p1"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:51"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_36
#AT_START_37
at_fn_group_banner 37 'rpmvercmp.at:53' \
  "rpmvercmp(6.0.rc1, 6.0) = 1" "                    " 2
at_xfail=no
(
  $as_echo "37. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:53:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"6.0.rc1\", \"6.0\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:53"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("6.0.rc1", "6.0"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:53"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_37
#AT_START_38
at_fn_group_banner 38 'rpmvercmp.at:54' \
  "rpmvercmp(6.0, 6.0.rc1) = -1" "                   " 2
at_xfail=no
(
  $as_echo "38. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:54:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"6.0\", \"6.0.rc1\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:54"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("6.0", "6.0.rc1"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:54"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_38
#AT_START_39
at_fn_group_banner 39 'rpmvercmp.at:56' \
  "rpmvercmp(10b2, 10a1) = 1" "                      " 2
at_xfail=no
(
  $as_echo "39. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:56:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"10b2\", \"10a1\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:56"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("10b2", "10a1"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:56"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_39
#AT_START_40
at_fn_group_banner 40 'rpmvercmp.at:57' \
  "rpmvercmp(10a2, 10b2) = -1" "                     " 2
at_xfail=no
(
  $as_echo "40. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:57:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"10a2\", \"10b2\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:57"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("10a2", "10b2"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:57"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_40
#AT_START_41
at_fn_group_banner 41 'rpmvercmp.at:59' \
  "rpmvercmp(1.0aa, 1.0aa) = 0" "                    " 2
at_xfail=no
(
  $as_echo "41. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:59:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0aa\", \"1.0aa\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:59"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0aa", "1.0aa"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:59"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_41
#AT_START_42
at_fn_group_banner 42 'rpmvercmp.at:60' \
  "rpmvercmp(1.0a, 1.0aa) = -1" "                    " 2
at_xfail=no
(
  $as_echo "42. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:60:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0a\", \"1.0aa\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:60"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0a", "1.0aa"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:60"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_42
#AT_START_43
at_fn_group_banner 43 'rpmvercmp.at:61' \
  "rpmvercmp(1.0aa, 1.0a) = 1" "                     " 2
at_xfail=no
(
  $as_echo "43. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:61:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0aa\", \"1.0a\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:61"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0aa", "1.0a"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:61"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_43
#AT_START_44
at_fn_group_banner 44 'rpmvercmp.at:63' \
  "rpmvercmp(10.0001, 10.0001) = 0" "                " 2
at_xfail=no
(
  $as_echo "44. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:63:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"10.0001\", \"10.0001\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:63"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("10.0001", "10.0001"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:63"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_44
#AT_START_45
at_fn_group_banner 45 'rpmvercmp.at:64' \
  "rpmvercmp(10.0001, 10.1) = 0" "                   " 2
at_xfail=no
(
  $as_echo "45. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:64:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"10.0001\", \"10.1\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:64"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("10.0001", "10.1"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:64"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_45
#AT_START_46
at_fn_group_banner 46 'rpmvercmp.at:65' \
  "rpmvercmp(10.1, 10.0001) = 0" "                   " 2
at_xfail=no
(
  $as_echo "46. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:65:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"10.1\", \"10.0001\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:65"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("10.1", "10.0001"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:65"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_46
#AT_START_47
at_fn_group_banner 47 'rpmvercmp.at:66' \
  "rpmvercmp(10.0001, 10.0039) = -1" "               " 2
at_xfail=no
(
  $as_echo "47. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:66:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"10.0001\", \"10.0039\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:66"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("10.0001", "10.0039"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:66"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_47
#AT_START_48
at_fn_group_banner 48 'rpmvercmp.at:67' \
  "rpmvercmp(10.0039, 10.0001) = 1" "                " 2
at_xfail=no
(
  $as_echo "48. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:67:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"10.0039\", \"10.0001\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:67"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("10.0039", "10.0001"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:67"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_48
#AT_START_49
at_fn_group_banner 49 'rpmvercmp.at:69' \
  "rpmvercmp(4.999.9, 5.0) = -1" "                   " 2
at_xfail=no
(
  $as_echo "49. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:69:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"4.999.9\", \"5.0\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:69"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("4.999.9", "5.0"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:69"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_49
#AT_START_50
at_fn_group_banner 50 'rpmvercmp.at:70' \
  "rpmvercmp(5.0, 4.999.9) = 1" "                    " 2
at_xfail=no
(
  $as_echo "50. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:70:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"5.0\", \"4.999.9\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:70"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("5.0", "4.999.9"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:70"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_50
#AT_START_51
at_fn_group_banner 51 'rpmvercmp.at:72' \
  "rpmvercmp(20101121, 20101121) = 0" "              " 2
at_xfail=no
(
  $as_echo "51. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:72:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"20101121\", \"20101121\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:72"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("20101121", "20101121"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:72"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_51
#AT_START_52
at_fn_group_banner 52 'rpmvercmp.at:73' \
  "rpmvercmp(20101121, 20101122) = -1" "             " 2
at_xfail=no
(
  $as_echo "52. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:73:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"20101121\", \"20101122\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:73"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("20101121", "20101122"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:73"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_52
#AT_START_53
at_fn_group_banner 53 'rpmvercmp.at:74' \
  "rpmvercmp(20101122, 20101121) = 1" "              " 2
at_xfail=no
(
  $as_echo "53. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:74:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"20101122\", \"20101121\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:74"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("20101122", "20101121"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:74"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_53
#AT_START_54
at_fn_group_banner 54 'rpmvercmp.at:76' \
  "rpmvercmp(2_0, 2_0) = 0" "                        " 2
at_xfail=no
(
  $as_echo "54. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:76:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"2_0\", \"2_0\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:76"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("2_0", "2_0"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:76"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_54
#AT_START_55
at_fn_group_banner 55 'rpmvercmp.at:77' \
  "rpmvercmp(2.0, 2_0) = 0" "                        " 2
at_xfail=no
(
  $as_echo "55. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:77:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"2.0\", \"2_0\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:77"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("2.0", "2_0"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:77"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_55
#AT_START_56
at_fn_group_banner 56 'rpmvercmp.at:78' \
  "rpmvercmp(2_0, 2.0) = 0" "                        " 2
at_xfail=no
(
  $as_echo "56. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:78:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"2_0\", \"2.0\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:78"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("2_0", "2.0"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:78"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_56
#AT_START_57
at_fn_group_banner 57 'rpmvercmp.at:81' \
  "rpmvercmp(a, a) = 0" "                            " 2
at_xfail=no
(
  $as_echo "57. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:81:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"a\", \"a\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:81"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("a", "a"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:81"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_57
#AT_START_58
at_fn_group_banner 58 'rpmvercmp.at:82' \
  "rpmvercmp(a+, a+) = 0" "                          " 2
at_xfail=no
(
  $as_echo "58. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:82:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"a+\", \"a+\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:82"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("a+", "a+"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:82"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_58
#AT_START_59
at_fn_group_banner 59 'rpmvercmp.at:83' \
  "rpmvercmp(a+, a_) = 0" "                          " 2
at_xfail=no
(
  $as_echo "59. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:83:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"a+\", \"a_\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:83"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("a+", "a_"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:83"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_59
#AT_START_60
at_fn_group_banner 60 'rpmvercmp.at:84' \
  "rpmvercmp(a_, a+) = 0" "                          " 2
at_xfail=no
(
  $as_echo "60. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:84:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"a_\", \"a+\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:84"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("a_", "a+"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:84"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_60
#AT_START_61
at_fn_group_banner 61 'rpmvercmp.at:85' \
  "rpmvercmp(+a, +a) = 0" "                          " 2
at_xfail=no
(
  $as_echo "61. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:85:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"+a\", \"+a\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:85"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("+a", "+a"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:85"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_61
#AT_START_62
at_fn_group_banner 62 'rpmvercmp.at:86' \
  "rpmvercmp(+a, _a) = 0" "                          " 2
at_xfail=no
(
  $as_echo "62. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:86:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"+a\", \"_a\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:86"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("+a", "_a"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:86"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_62
#AT_START_63
at_fn_group_banner 63 'rpmvercmp.at:87' \
  "rpmvercmp(_a, +a) = 0" "                          " 2
at_xfail=no
(
  $as_echo "63. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:87:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"_a\", \"+a\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:87"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("_a", "+a"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:87"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_63
#AT_START_64
at_fn_group_banner 64 'rpmvercmp.at:88' \
  "rpmvercmp(+_, +_) = 0" "                          " 2
at_xfail=no
(
  $as_echo "64. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:88:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"+_\", \"+_\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:88"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("+_", "+_"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:88"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_64
#AT_START_65
at_fn_group_banner 65 'rpmvercmp.at:89' \
  "rpmvercmp(_+, +_) = 0" "                          " 2
at_xfail=no
(
  $as_echo "65. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:89:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"_+\", \"+_\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:89"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("_+", "+_"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:89"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_65
#AT_START_66
at_fn_group_banner 66 'rpmvercmp.at:90' \
  "rpmvercmp(_+, _+) = 0" "                          " 2
at_xfail=no
(
  $as_echo "66. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:90:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"_+\", \"_+\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:90"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("_+", "_+"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:90"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_66
#AT_START_67
at_fn_group_banner 67 'rpmvercmp.at:91' \
  "rpmvercmp(+, _) = 0" "                            " 2
at_xfail=no
(
  $as_echo "67. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:91:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"+\", \"_\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:91"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("+", "_"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:91"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_67
#AT_START_68
at_fn_group_banner 68 'rpmvercmp.at:92' \
  "rpmvercmp(_, +) = 0" "                            " 2
at_xfail=no
(
  $as_echo "68. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:92:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"_\", \"+\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:92"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("_", "+"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:92"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_68
#AT_START_69
at_fn_group_banner 69 'rpmvercmp.at:95' \
  "rpmvercmp(1.0~rc1, 1.0~rc1) = 0" "                " 2
at_xfail=no
(
  $as_echo "69. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:95:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0~rc1\", \"1.0~rc1\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:95"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0~rc1", "1.0~rc1"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:95"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_69
#AT_START_70
at_fn_group_banner 70 'rpmvercmp.at:96' \
  "rpmvercmp(1.0~rc1, 1.0) = -1" "                   " 2
at_xfail=no
(
  $as_echo "70. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:96:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0~rc1\", \"1.0\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:96"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0~rc1", "1.0"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:96"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_70
#AT_START_71
at_fn_group_banner 71 'rpmvercmp.at:97' \
  "rpmvercmp(1.0, 1.0~rc1) = 1" "                    " 2
at_xfail=no
(
  $as_echo "71. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:97:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0\", \"1.0~rc1\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:97"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0", "1.0~rc1"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:97"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_71
#AT_START_72
at_fn_group_banner 72 'rpmvercmp.at:98' \
  "rpmvercmp(1.0~rc1, 1.0~rc2) = -1" "               " 2
at_xfail=no
(
  $as_echo "72. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:98:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0~rc1\", \"1.0~rc2\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:98"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0~rc1", "1.0~rc2"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:98"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_72
#AT_START_73
at_fn_group_banner 73 'rpmvercmp.at:99' \
  "rpmvercmp(1.0~rc2, 1.0~rc1) = 1" "                " 2
at_xfail=no
(
  $as_echo "73. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:99:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0~rc2\", \"1.0~rc1\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:99"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0~rc2", "1.0~rc1"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:99"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_73
#AT_START_74
at_fn_group_banner 74 'rpmvercmp.at:100' \
  "rpmvercmp(1.0~rc1~git123, 1.0~rc1~git123) = 0" "  " 2
at_xfail=no
(
  $as_echo "74. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:100:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0~rc1~git123\", \"1.0~rc1~git123\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:100"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0~rc1~git123", "1.0~rc1~git123"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:100"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_74
#AT_START_75
at_fn_group_banner 75 'rpmvercmp.at:101' \
  "rpmvercmp(1.0~rc1~git123, 1.0~rc1) = -1" "        " 2
at_xfail=no
(
  $as_echo "75. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:101:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0~rc1~git123\", \"1.0~rc1\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:101"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0~rc1~git123", "1.0~rc1"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:101"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_75
#AT_START_76
at_fn_group_banner 76 'rpmvercmp.at:102' \
  "rpmvercmp(1.0~rc1, 1.0~rc1~git123) = 1" "         " 2
at_xfail=no
(
  $as_echo "76. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:102:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0~rc1\", \"1.0~rc1~git123\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:102"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0~rc1", "1.0~rc1~git123"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:102"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_76
#AT_START_77
at_fn_group_banner 77 'rpmvercmp.at:105' \
  "rpmvercmp(1.0^, 1.0^) = 0" "                      " 2
at_xfail=no
(
  $as_echo "77. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:105:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0^\", \"1.0^\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:105"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0^", "1.0^"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:105"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_77
#AT_START_78
at_fn_group_banner 78 'rpmvercmp.at:106' \
  "rpmvercmp(1.0^, 1.0) = 1" "                       " 2
at_xfail=no
(
  $as_echo "78. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:106:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0^\", \"1.0\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:106"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0^", "1.0"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:106"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_78
#AT_START_79
at_fn_group_banner 79 'rpmvercmp.at:107' \
  "rpmvercmp(1.0, 1.0^) = -1" "                      " 2
at_xfail=no
(
  $as_echo "79. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:107:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0\", \"1.0^\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:107"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0", "1.0^"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:107"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_79
#AT_START_80
at_fn_group_banner 80 'rpmvercmp.at:108' \
  "rpmvercmp(1.0^git1, 1.0^git1) = 0" "              " 2
at_xfail=no
(
  $as_echo "80. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:108:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0^git1\", \"1.0^git1\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:108"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0^git1", "1.0^git1"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:108"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_80
#AT_START_81
at_fn_group_banner 81 'rpmvercmp.at:109' \
  "rpmvercmp(1.0^git1, 1.0) = 1" "                   " 2
at_xfail=no
(
  $as_echo "81. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:109:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0^git1\", \"1.0\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:109"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0^git1", "1.0"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:109"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_81
#AT_START_82
at_fn_group_banner 82 'rpmvercmp.at:110' \
  "rpmvercmp(1.0, 1.0^git1) = -1" "                  " 2
at_xfail=no
(
  $as_echo "82. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:110:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0\", \"1.0^git1\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:110"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0", "1.0^git1"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:110"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_82
#AT_START_83
at_fn_group_banner 83 'rpmvercmp.at:111' \
  "rpmvercmp(1.0^git1, 1.0^git2) = -1" "             " 2
at_xfail=no
(
  $as_echo "83. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:111:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0^git1\", \"1.0^git2\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:111"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0^git1", "1.0^git2"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:111"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_83
#AT_START_84
at_fn_group_banner 84 'rpmvercmp.at:112' \
  "rpmvercmp(1.0^git2, 1.0^git1) = 1" "              " 2
at_xfail=no
(
  $as_echo "84. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:112:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0^git2\", \"1.0^git1\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:112"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0^git2", "1.0^git1"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:112"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_84
#AT_START_85
at_fn_group_banner 85 'rpmvercmp.at:113' \
  "rpmvercmp(1.0^git1, 1.01) = -1" "                 " 2
at_xfail=no
(
  $as_echo "85. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:113:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0^git1\", \"1.01\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:113"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0^git1", "1.01"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:113"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_85
#AT_START_86
at_fn_group_banner 86 'rpmvercmp.at:114' \
  "rpmvercmp(1.01, 1.0^git1) = 1" "                  " 2
at_xfail=no
(
  $as_echo "86. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:114:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.01\", \"1.0^git1\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:114"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.01", "1.0^git1"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:114"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_86
#AT_START_87
at_fn_group_banner 87 'rpmvercmp.at:115' \
  "rpmvercmp(1.0^20160101, 1.0^20160101) = 0" "      " 2
at_xfail=no
(
  $as_echo "87. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:115:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0^20160101\", \"1.0^20160101\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:115"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0^20160101", "1.0^20160101"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:115"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_87
#AT_START_88
at_fn_group_banner 88 'rpmvercmp.at:116' \
  "rpmvercmp(1.0^20160101, 1.0.1) = -1" "            " 2
at_xfail=no
(
  $as_echo "88. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:116:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0^20160101\", \"1.0.1\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:116"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0^20160101", "1.0.1"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:116"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_88
#AT_START_89
at_fn_group_banner 89 'rpmvercmp.at:117' \
  "rpmvercmp(1.0.1, 1.0^20160101) = 1" "             " 2
at_xfail=no
(
  $as_echo "89. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:117:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0.1\", \"1.0^20160101\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:117"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0.1", "1.0^20160101"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:117"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_89
#AT_START_90
at_fn_group_banner 90 'rpmvercmp.at:118' \
  "rpmvercmp(1.0^20160101^git1, 1.0^20160101^git1) = 0" "" 2
at_xfail=no
(
  $as_echo "90. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:118:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0^20160101^git1\", \"1.0^20160101^git1\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:118"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0^20160101^git1", "1.0^20160101^git1"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:118"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_90
#AT_START_91
at_fn_group_banner 91 'rpmvercmp.at:119' \
  "rpmvercmp(1.0^20160102, 1.0^20160101^git1) = 1" " " 2
at_xfail=no
(
  $as_echo "91. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:119:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0^20160102\", \"1.0^20160101^git1\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:119"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0^20160102", "1.0^20160101^git1"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:119"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_91
#AT_START_92
at_fn_group_banner 92 'rpmvercmp.at:120' \
  "rpmvercmp(1.0^20160101^git1, 1.0^20160102) = -1" "" 2
at_xfail=no
(
  $as_echo "92. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:120:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0^20160101^git1\", \"1.0^20160102\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:120"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0^20160101^git1", "1.0^20160102"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:120"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_92
#AT_START_93
at_fn_group_banner 93 'rpmvercmp.at:123' \
  "rpmvercmp(1.0~rc1^git1, 1.0~rc1^git1) = 0" "      " 2
at_xfail=no
(
  $as_echo "93. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:123:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0~rc1^git1\", \"1.0~rc1^git1\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:123"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0~rc1^git1", "1.0~rc1^git1"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:123"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_93
#AT_START_94
at_fn_group_banner 94 'rpmvercmp.at:124' \
  "rpmvercmp(1.0~rc1^git1, 1.0~rc1) = 1" "           " 2
at_xfail=no
(
  $as_echo "94. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:124:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0~rc1^git1\", \"1.0~rc1\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:124"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0~rc1^git1", "1.0~rc1"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:124"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_94
#AT_START_95
at_fn_group_banner 95 'rpmvercmp.at:125' \
  "rpmvercmp(1.0~rc1, 1.0~rc1^git1) = -1" "          " 2
at_xfail=no
(
  $as_echo "95. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:125:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0~rc1\", \"1.0~rc1^git1\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:125"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0~rc1", "1.0~rc1^git1"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:125"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_95
#AT_START_96
at_fn_group_banner 96 'rpmvercmp.at:126' \
  "rpmvercmp(1.0^git1~pre, 1.0^git1~pre) = 0" "      " 2
at_xfail=no
(
  $as_echo "96. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:126:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0^git1~pre\", \"1.0^git1~pre\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:126"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0^git1~pre", "1.0^git1~pre"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:126"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_96
#AT_START_97
at_fn_group_banner 97 'rpmvercmp.at:127' \
  "rpmvercmp(1.0^git1, 1.0^git1~pre) = 1" "          " 2
at_xfail=no
(
  $as_echo "97. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:127:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0^git1\", \"1.0^git1~pre\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:127"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0^git1", "1.0^git1~pre"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:127"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_97
#AT_START_98
at_fn_group_banner 98 'rpmvercmp.at:128' \
  "rpmvercmp(1.0^git1~pre, 1.0^git1) = -1" "         " 2
at_xfail=no
(
  $as_echo "98. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvercmp.at:128:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0^git1~pre\", \"1.0^git1\"))}'"
at_fn_check_prepare_notrace 'an embedded newline' "rpmvercmp.at:128"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0^git1~pre", "1.0^git1"))}'
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvercmp.at:128"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_98
#AT_START_99
at_fn_group_banner 99 'rpmmacro.at:6' \
  "simple rpm --eval" "                              " 3
at_xfail=no
(
  $as_echo "99. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:8:
runroot rpm --define \"this that\" --eval '%{this}' --eval '%not_defined' --eval '%{not_defined}' --eval '%{}'
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:8"
( $at_check_trace;
runroot rpm --define "this that" --eval '%{this}' --eval '%not_defined' --eval '%{not_defined}' --eval '%{}'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "that
%not_defined
%{not_defined}
%{}
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:8"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_99
#AT_START_100
at_fn_group_banner 100 'rpmmacro.at:20' \
  "invalid rpm --eval" "                             " 3
at_xfail=no
(
  $as_echo "100. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:22:
runroot rpm --eval '%define _ that'
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:22"
( $at_check_trace;
runroot rpm --eval '%define _ that'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Macro %_ has illegal name (%define)
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmmacro.at:22"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_100
#AT_START_101
at_fn_group_banner 101 'rpmmacro.at:32' \
  "invalid rpm --define" "                           " 3
at_xfail=no
(
  $as_echo "101. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:34:
runroot rpm --define \"_ that\"
runroot rpm --define \"undefine that\"
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:34"
( $at_check_trace;
runroot rpm --define "_ that"
runroot rpm --define "undefine that"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Macro %_ has illegal name (%define)
error: Macro %undefine is a built-in (%define)
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmmacro.at:34"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_101
#AT_START_102
at_fn_group_banner 102 'rpmmacro.at:45' \
  "rpm --undefine" "                                 " 3
at_xfail=no
(
  $as_echo "102. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:47:
runroot rpm --define \"this that\" --eval '1. %{this}' --undefine 'this' --eval '2. %{this'}
runroot rpm --eval '1. %{this}' --define \"this that\" --eval '2. %{this}' --undefine 'this' --eval '3. %{this'}
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:47"
( $at_check_trace;
runroot rpm --define "this that" --eval '1. %{this}' --undefine 'this' --eval '2. %{this'}
runroot rpm --eval '1. %{this}' --define "this that" --eval '2. %{this}' --undefine 'this' --eval '3. %{this'}

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1. that
2. %{this}
1. %{this}
2. that
3. %{this}
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:47"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_102
#AT_START_103
at_fn_group_banner 103 'rpmmacro.at:60' \
  "simple true conditional rpm --eval" "             " 3
at_xfail=no
(
  $as_echo "103. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:62:
runroot rpm --define \"this that\" --eval '%{?this}'
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:62"
( $at_check_trace;
runroot rpm --define "this that" --eval '%{?this}'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "that
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:62"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_103
#AT_START_104
at_fn_group_banner 104 'rpmmacro.at:70' \
  "simple false conditional rpm --eval" "            " 3
at_xfail=no
(
  $as_echo "104. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:72:
runroot rpm --define \"this that\" --eval '%{?that}'
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:72"
( $at_check_trace;
runroot rpm --define "this that" --eval '%{?that}'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:72"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_104
#AT_START_105
at_fn_group_banner 105 'rpmmacro.at:80' \
  "nested macro in name" "                           " 3
at_xfail=no
(
  $as_echo "105. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:82:
runroot rpm --define \"this that\" --define \"that_that foo\" --eval '%{expand:%{%{this}_that}}'
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:82"
( $at_check_trace;
runroot rpm --define "this that" --define "that_that foo" --eval '%{expand:%{%{this}_that}}'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:82"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_105
#AT_START_106
at_fn_group_banner 106 'rpmmacro.at:90' \
  "parametrized macro 1" "                           " 3
at_xfail=no
(
  $as_echo "106. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:92:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cat << EOF > \${RPMTEST}/mtest
%bar() bar
%foo()\\\\
%bar\\\\
foo 1\\\\
%{bar}\\\\
foo 2\\\\
%bar x\\\\
foo 3\\\\
%{bar x}\\\\
foo 4\\\\
%bar \\\\
foo 5
EOF

runroot rpm --eval '%{load:mtest}%{foo}'
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmmacro.at:92"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cat << EOF > ${RPMTEST}/mtest
%bar() bar
%foo()\\
%bar\\
foo 1\\
%{bar}\\
foo 2\\
%bar x\\
foo 3\\
%{bar x}\\
foo 4\\
%bar \\
foo 5
EOF

runroot rpm --eval '%{load:mtest}%{foo}'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "
bar
foo 1
bar
foo 2
bar
foo 3
bar
foo 4
bar
foo 5
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:92"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_106
#AT_START_107
at_fn_group_banner 107 'rpmmacro.at:127' \
  "parametrized macro 2" "                           " 3
at_xfail=no
(
  $as_echo "107. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:129:
runroot rpm \\
    --define '%bar() \"Bar %#: %{?1} %{?2}\"' \\
    --define '%foo() \"Foo %#: %{?1} %{?2}\" %bar a' \\
    --eval '%foo 1 2'
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:129"
( $at_check_trace;
runroot rpm \
    --define '%bar() "Bar %#: %{?1} %{?2}"' \
    --define '%foo() "Foo %#: %{?1} %{?2}" %bar a' \
    --eval '%foo 1 2'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "\"Foo 2: 1 2\" \"Bar 1: a \"
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:129"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_107
#AT_START_108
at_fn_group_banner 108 'rpmmacro.at:140' \
  "parametrized macro 3" "                           " 3
at_xfail=no
(
  $as_echo "108. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:142:
runroot rpm \\
    --define '%foo() 1:%1 2:%2' \\
    --eval '%foo %nil bar'
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:142"
( $at_check_trace;
runroot rpm \
    --define '%foo() 1:%1 2:%2' \
    --eval '%foo %nil bar'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1:bar 2:%2
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:142"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_108
#AT_START_109
at_fn_group_banner 109 'rpmmacro.at:152' \
  "parametrized macro 4" "                           " 3
at_xfail=no
(
  $as_echo "109. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:154:
runroot rpm \\
    --define '%bar yyy' \\
    --define '%foo() %1' \\
    --eval '%foo %bar' \\
    --eval '%foo %%bar'
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:154"
( $at_check_trace;
runroot rpm \
    --define '%bar yyy' \
    --define '%foo() %1' \
    --eval '%foo %bar' \
    --eval '%foo %%bar'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "yyy
%bar
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:154"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_109
#AT_START_110
at_fn_group_banner 110 'rpmmacro.at:167' \
  "parametrized macro 5" "                           " 3
at_xfail=no
(
  $as_echo "110. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:169:
runroot rpm \\
    --define '%foo() %#:%{?1:\"%1\"}%{?2: \"%2\"}' \\
    --define 'bar zzz' \\
    --eval '%foo 1' \\
    --eval '%foo   2  ' \\
    --eval '%foo 1 2' \\
    --eval '%foo %{nil}' \\
    --eval '%foo %{nil} xx' \\
    --eval '%foo %{bar} xx' \\
    --eval '%foo %{quote:   2 3  5} %{quote:%{nil}}' \\
    --eval '%foo x%{quote:y}z 123' \\
    --eval '%foo x%{quote:%{nil}}z' \\
    --eval '%foo 1 \\
bar' \\
    --eval '%foo 1 \\' \\
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:169"
( $at_check_trace;
runroot rpm \
    --define '%foo() %#:%{?1:"%1"}%{?2: "%2"}' \
    --define 'bar zzz' \
    --eval '%foo 1' \
    --eval '%foo   2  ' \
    --eval '%foo 1 2' \
    --eval '%foo %{nil}' \
    --eval '%foo %{nil} xx' \
    --eval '%foo %{bar} xx' \
    --eval '%foo %{quote:   2 3  5} %{quote:%{nil}}' \
    --eval '%foo x%{quote:y}z 123' \
    --eval '%foo x%{quote:%{nil}}z' \
    --eval '%foo 1 \
bar' \
    --eval '%foo 1 \' \

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1:\"1\"
1:\"2\"
2:\"1\" \"2\"
0:
1:\"xx\"
2:\"zzz\" \"xx\"
2:\"   2 3  5\" \"\"
2:\"xyz\" \"123\"
1:\"xz\"
2:\"1\" \"\\\"bar
2:\"1\" \"\\\"
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:169"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_110
#AT_START_111
at_fn_group_banner 111 'rpmmacro.at:201' \
  "parametrized macro 6" "                           " 3
at_xfail=no
(
  $as_echo "111. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:203:
runroot rpm \\
    --define '%foo(-) %{*}' \\
    --eval '%foo 5 a -z -b2'
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:203"
( $at_check_trace;
runroot rpm \
    --define '%foo(-) %{*}' \
    --eval '%foo 5 a -z -b2'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "5 a -z -b2
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:203"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_111
#AT_START_112
at_fn_group_banner 112 'rpmmacro.at:213' \
  "uncompress macro 1" "                             " 3
at_xfail=no
(
  $as_echo "112. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:215:
runroot rpm \\
    --define \"__gzip /my/bin/gzip\" \\
    --eval \"%{uncompress:/data/SOURCES/hello-2.0.tar.gz}\"
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:215"
( $at_check_trace;
runroot rpm \
    --define "__gzip /my/bin/gzip" \
    --eval "%{uncompress:/data/SOURCES/hello-2.0.tar.gz}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "/my/bin/gzip -dc /data/SOURCES/hello-2.0.tar.gz
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:215"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_112
#AT_START_113
at_fn_group_banner 113 'rpmmacro.at:225' \
  "uncompress macro 2" "                             " 3
at_xfail=no
(
  $as_echo "113. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:227:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

echo xxxxxxxxxxxxxxxxxxxxxxxxx > \${RPMTEST}/tmp/\"some%%ath\"
runroot rpm \\
    --eval \"%{uncompress:/tmp/some%%%%ath}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmmacro.at:227"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

echo xxxxxxxxxxxxxxxxxxxxxxxxx > ${RPMTEST}/tmp/"some%%ath"
runroot rpm \
    --eval "%{uncompress:/tmp/some%%%%ath}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "/usr/bin/cat /tmp/some%%ath
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:227"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_113
#AT_START_114
at_fn_group_banner 114 'rpmmacro.at:238' \
  "basename macro" "                                 " 3
at_xfail=no
(
  $as_echo "114. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:240:
runroot rpm \\
    --eval \"%{basename:/data/SOURCES/hello-2.0.tar.gz}\"
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:240"
( $at_check_trace;
runroot rpm \
    --eval "%{basename:/data/SOURCES/hello-2.0.tar.gz}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "hello-2.0.tar.gz
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:240"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_114
#AT_START_115
at_fn_group_banner 115 'rpmmacro.at:249' \
  "shrink macro" "                                   " 3
at_xfail=no
(
  $as_echo "115. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:251:
runroot rpm \\
    --eval \"%{shrink:  h e  l   lo  }\"
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:251"
( $at_check_trace;
runroot rpm \
    --eval "%{shrink:  h e  l   lo  }"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "h e l lo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:251"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_115
#AT_START_116
at_fn_group_banner 116 'rpmmacro.at:260' \
  "suffix macro" "                                   " 3
at_xfail=no
(
  $as_echo "116. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:262:
runroot rpm \\
    --eval \"%{suffix:/data/SOURCES/hello-2.0.tar.gz}\"
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:262"
( $at_check_trace;
runroot rpm \
    --eval "%{suffix:/data/SOURCES/hello-2.0.tar.gz}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "gz
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:262"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_116
#AT_START_117
at_fn_group_banner 117 'rpmmacro.at:271' \
  "url2path macro" "                                 " 3
at_xfail=no
(
  $as_echo "117. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:273:
runroot rpm \\
    --eval \"%{url2path:http://hello.org/releases/hello-2.0.tar.gz}\"
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:273"
( $at_check_trace;
runroot rpm \
    --eval "%{url2path:http://hello.org/releases/hello-2.0.tar.gz}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "/releases/hello-2.0.tar.gz
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:273"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_117
#AT_START_118
at_fn_group_banner 118 'rpmmacro.at:282' \
  "macrobody macro" "                                " 3
at_xfail=no
(
  $as_echo "118. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:284:
runroot rpm \\
    --define \"somedir %{_exec_prefix}/%{_lib}\" \\
    --eval \"%{macrobody:somedir}\"
runroot rpm \\
    --define \"something somedir\" \\
    --define \"somedir %{_exec_prefix}/%{_lib}\" \\
    --eval \"%{macrobody:%{something}}\"
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:284"
( $at_check_trace;
runroot rpm \
    --define "somedir %{_exec_prefix}/%{_lib}" \
    --eval "%{macrobody:somedir}"
runroot rpm \
    --define "something somedir" \
    --define "somedir %{_exec_prefix}/%{_lib}" \
    --eval "%{macrobody:%{something}}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "%{_exec_prefix}/%{_lib}
%{_exec_prefix}/%{_lib}
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:284"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_118
#AT_START_119
at_fn_group_banner 119 'rpmmacro.at:299' \
  "builtin macro arguments" "                        " 3
at_xfail=no
(
  $as_echo "119. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:301:
runroot rpm --eval \"%{dirname}\"
runroot rpm --eval \"%{dirname:}\"
runroot rpm --eval \"%{dirname:dir}\"
runroot rpm --eval \"%{dirname dir}\"
runroot rpm --eval \"%dirname\"
runroot rpm --eval \"%dirname dir\"
runroot rpm --define '%xxx /hello/%%%%/world' --eval '%{dirname:%xxx}'
runroot rpm --eval \"%{uncompress}\"
runroot rpm --eval \"%{uncompress:}\"
runroot rpm --eval \"%{getncpus:}\"
runroot rpm --eval \"%{getncpus:5}\"
runroot rpm --eval \"%{define:}\"
runroot rpm --eval \"%{define:foo}\"
runroot rpm --eval \"%{define:foo bar}%{foo}\"
runroot rpm --eval \"%{dump:foo}\"
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:301"
( $at_check_trace;
runroot rpm --eval "%{dirname}"
runroot rpm --eval "%{dirname:}"
runroot rpm --eval "%{dirname:dir}"
runroot rpm --eval "%{dirname dir}"
runroot rpm --eval "%dirname"
runroot rpm --eval "%dirname dir"
runroot rpm --define '%xxx /hello/%%%%/world' --eval '%{dirname:%xxx}'
runroot rpm --eval "%{uncompress}"
runroot rpm --eval "%{uncompress:}"
runroot rpm --eval "%{getncpus:}"
runroot rpm --eval "%{getncpus:5}"
runroot rpm --eval "%{define:}"
runroot rpm --eval "%{define:foo}"
runroot rpm --eval "%{define:foo bar}%{foo}"
runroot rpm --eval "%{dump:foo}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: %dirname: argument expected
error: %dirname: argument expected
error: %uncompress: argument expected
error: %getncpus: unexpected argument
error: %getncpus: unexpected argument
error: Macro % has illegal name (%define)
error: Macro %foo has empty body
error: %dump: unexpected argument
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "
dir
dir
dir
/hello/%%

bar
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmmacro.at:301"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_119
#AT_START_120
at_fn_group_banner 120 'rpmmacro.at:338' \
  "macro arguments" "                                " 3
at_xfail=no
(
  $as_echo "120. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:340:
runroot rpm \\
    --define 'zzz xxx' \\
    --eval '%{defined zzz}' \\
    --eval '%{defined:zzz}' \\
    --eval '%defined zzz' \\
    --eval '%{defined aaa}' \\
    --eval '%{defined:aaa}' \\
    --eval '%defined aaa'
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:340"
( $at_check_trace;
runroot rpm \
    --define 'zzz xxx' \
    --eval '%{defined zzz}' \
    --eval '%{defined:zzz}' \
    --eval '%defined zzz' \
    --eval '%{defined aaa}' \
    --eval '%{defined:aaa}' \
    --eval '%defined aaa'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
1
1
0
0
0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:340"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_120
#AT_START_121
at_fn_group_banner 121 'rpmmacro.at:360' \
  "expr macro 1" "                                   " 3
at_xfail=no
(
  $as_echo "121. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:362:
runroot rpm \\
    --define \"aaa 5\" \\
    --define \"bbb 0\" \\
    --eval '%{expr:4*1024}' \\
    --eval '%{expr:5 < 1}' \\
    --eval '%{expr:(4 + 5) * 2 == 18}' \\
    --eval '%{expr:%{aaa} || %{bbb}}' \\
    --eval '%{expr:%{aaa} && %{bbb}}' \\
    --eval '%{expr:! \"\"}' \\
    --eval '%{expr:! \"foo\"}' \\
    --eval '%{expr: 0 || 3}' \\
    --eval '%{expr: 2 || 3}' \\
    --eval '%{expr: \"\" || \"foo\"}' \\
    --eval '%{expr: \"bar\" || \"foo\"}' \\
    --eval '%{expr: 0 && 3}' \\
    --eval '%{expr: 2 && 3}' \\
    --eval '%{expr: \"\" && \"foo\"}' \\
    --eval '%{expr: \"bar\" && \"foo\"}'
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:362"
( $at_check_trace;
runroot rpm \
    --define "aaa 5" \
    --define "bbb 0" \
    --eval '%{expr:4*1024}' \
    --eval '%{expr:5 < 1}' \
    --eval '%{expr:(4 + 5) * 2 == 18}' \
    --eval '%{expr:%{aaa} || %{bbb}}' \
    --eval '%{expr:%{aaa} && %{bbb}}' \
    --eval '%{expr:! ""}' \
    --eval '%{expr:! "foo"}' \
    --eval '%{expr: 0 || 3}' \
    --eval '%{expr: 2 || 3}' \
    --eval '%{expr: "" || "foo"}' \
    --eval '%{expr: "bar" || "foo"}' \
    --eval '%{expr: 0 && 3}' \
    --eval '%{expr: 2 && 3}' \
    --eval '%{expr: "" && "foo"}' \
    --eval '%{expr: "bar" && "foo"}'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "4096
0
1
5
0
1
0
3
2
foo
bar
0
3

foo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:362"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_121
#AT_START_122
at_fn_group_banner 122 'rpmmacro.at:402' \
  "expr macro 2" "                                   " 3
at_xfail=no
(
  $as_echo "122. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:404:
runroot rpm --eval '%{expr:\"a\"*1}'
runroot rpm --eval '%{expr:(5+1)*4)}'
runroot rpm --eval '%{expr:\"a\"=!\"b\"}'
runroot rpm --eval '%{expr:4+}'
runroot rpm --eval '%{expr:bare}'
runroot rpm --eval '%{expr:1/0}'
runroot rpm --eval '%{expr:0 < 1 ? 2 : 1*\"a\"}'
runroot rpm --eval '%{expr:0 < 1 ? 1*\"a\" : 2}'
runroot rpm --eval '%{expr:0 < 1 ? 2 : \"a\"}'
runroot rpm --eval '%{expr:0 < 1 ? \"a\" : 2}'
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:404"
( $at_check_trace;
runroot rpm --eval '%{expr:"a"*1}'
runroot rpm --eval '%{expr:(5+1)*4)}'
runroot rpm --eval '%{expr:"a"=!"b"}'
runroot rpm --eval '%{expr:4+}'
runroot rpm --eval '%{expr:bare}'
runroot rpm --eval '%{expr:1/0}'
runroot rpm --eval '%{expr:0 < 1 ? 2 : 1*"a"}'
runroot rpm --eval '%{expr:0 < 1 ? 1*"a" : 2}'
runroot rpm --eval '%{expr:0 < 1 ? 2 : "a"}'
runroot rpm --eval '%{expr:0 < 1 ? "a" : 2}'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: types must match: \"a\"*1
error: syntax error in expression: (5+1)*4)
error:                                    ^
error: syntax error while parsing ==: \"a\"=!\"b\"
error:                                    ^
error: unexpected end of expression: 4+
error:                                ^
error: bare words are no longer supported, please use \"...\": bare
error:                                                       ^
error: division by zero: 1/0
error:                    ^
error: types must match: 0 < 1 ? 2 : 1*\"a\"
error: types must match: 0 < 1 ? 1*\"a\" : 2
error: types must match: 0 < 1 ? 2 : \"a\"
error: types must match: 0 < 1 ? \"a\" : 2
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmmacro.at:404"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_122
#AT_START_123
at_fn_group_banner 123 'rpmmacro.at:436' \
  "ternary expressions" "                            " 3
at_xfail=no
(
  $as_echo "123. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:438:
runroot rpm \\
    --eval '%{expr: 0 ? 2 : 3}' \\
    --eval '%{expr: 1 ? 2 : 3}' \\
    --eval '%{expr: 0 ? 0 ? 3 : 4 : 0 ? 6 : 7}' \\
    --eval '%{expr: 0 ? 0 ? 3 : 4 : 5 ? 6 : 7}' \\
    --eval '%{expr: 0 ? 2 ? 3 : 4 : 0 ? 6 : 7}' \\
    --eval '%{expr: 0 ? 2 ? 3 : 4 : 5 ? 6 : 7}' \\
    --eval '%{expr: 1 ? 0 ? 3 : 4 : 0 ? 6 : 7}' \\
    --eval '%{expr: 1 ? 0 ? 3 : 4 : 5 ? 6 : 7}' \\
    --eval '%{expr: 1 ? 2 ? 3 : 4 : 0 ? 6 : 7}' \\
    --eval '%{expr: 1 ? 2 ? 3 : 4 : 5 ? 6 : 7}' \\
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:438"
( $at_check_trace;
runroot rpm \
    --eval '%{expr: 0 ? 2 : 3}' \
    --eval '%{expr: 1 ? 2 : 3}' \
    --eval '%{expr: 0 ? 0 ? 3 : 4 : 0 ? 6 : 7}' \
    --eval '%{expr: 0 ? 0 ? 3 : 4 : 5 ? 6 : 7}' \
    --eval '%{expr: 0 ? 2 ? 3 : 4 : 0 ? 6 : 7}' \
    --eval '%{expr: 0 ? 2 ? 3 : 4 : 5 ? 6 : 7}' \
    --eval '%{expr: 1 ? 0 ? 3 : 4 : 0 ? 6 : 7}' \
    --eval '%{expr: 1 ? 0 ? 3 : 4 : 5 ? 6 : 7}' \
    --eval '%{expr: 1 ? 2 ? 3 : 4 : 0 ? 6 : 7}' \
    --eval '%{expr: 1 ? 2 ? 3 : 4 : 5 ? 6 : 7}' \

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3
2
7
6
7
6
4
4
3
3
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:438"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_123
#AT_START_124
at_fn_group_banner 124 'rpmmacro.at:466' \
  "short circuiting" "                               " 3
at_xfail=no
(
  $as_echo "124. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:468:
runroot rpm \\
    --eval '%{expr: 0 && 1 / 0}' \\
    --eval '%{expr: 1 || 1 / 0}' \\
    --eval '%{expr: 1 ? 2 : 1 / 0}' \\
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:468"
( $at_check_trace;
runroot rpm \
    --eval '%{expr: 0 && 1 / 0}' \
    --eval '%{expr: 1 || 1 / 0}' \
    --eval '%{expr: 1 ? 2 : 1 / 0}' \

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
1
2
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:468"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_124
#AT_START_125
at_fn_group_banner 125 'rpmmacro.at:482' \
  "shell expansion" "                                " 3
at_xfail=no
(
  $as_echo "125. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:484:
runroot rpm \\
    --eval \"%(echo foo)\"
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:484"
( $at_check_trace;
runroot rpm \
    --eval "%(echo foo)"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:484"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_125
#AT_START_126
at_fn_group_banner 126 'rpmmacro.at:493' \
  "expression expansion 1" "                         " 3
at_xfail=no
(
  $as_echo "126. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:495:
runroot rpm \\
    --define \"aaa 5\" \\
    --define \"bbb 0\" \\
    --eval '%[4*1024]' \\
    --eval '%[5 < 1]' \\
    --eval '%[%aaa]' \\
    --eval '%[%{aaa}]' \\
    --eval '%[\"%{aaa}\"]' \\
    --eval '%[%{?ccc}]' \\
    --eval '%[v\"1:2.3-4\"]' \\
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:495"
( $at_check_trace;
runroot rpm \
    --define "aaa 5" \
    --define "bbb 0" \
    --eval '%[4*1024]' \
    --eval '%[5 < 1]' \
    --eval '%[%aaa]' \
    --eval '%[%{aaa}]' \
    --eval '%["%{aaa}"]' \
    --eval '%[%{?ccc}]' \
    --eval '%[v"1:2.3-4"]' \

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "4096
0
5
5
5
0
1:2.3-4
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:495"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_126
#AT_START_127
at_fn_group_banner 127 'rpmmacro.at:519' \
  "expression expansion 2" "                         " 3
at_xfail=no
(
  $as_echo "127. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:521:
runroot rpm --define \"aaa hello\" --eval '%[%aaa]'
runroot rpm --eval '%[%{foo]'
runroot rpm --eval '%[v\"\"]'
runroot rpm --eval '%[v\"1\" + v\"2\"]'
runroot rpm --eval '%[v\"1\" / v\"2\"]'
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:521"
( $at_check_trace;
runroot rpm --define "aaa hello" --eval '%[%aaa]'
runroot rpm --eval '%[%{foo]'
runroot rpm --eval '%[v""]'
runroot rpm --eval '%[v"1" + v"2"]'
runroot rpm --eval '%[v"1" / v"2"]'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: macro expansion returned a bare word, please use \"...\": %aaa
error:                                                         ^
error: expanded string: hello
error: Unterminated {: {foo
error: invalid version: v\"\"
error:                    ^
error: + and - not supported for versions: v\"1\" + v\"2\"
error:                                          ^
error: * and / not supported for versions: v\"1\" / v\"2\"
error:                                          ^
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmmacro.at:521"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_127
#AT_START_128
at_fn_group_banner 128 'rpmmacro.at:543' \
  "expression version comparison" "                  " 3
at_xfail=no
(
  $as_echo "128. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:545:
runroot rpm \\
    --eval '%[v\"1.0\" == v\"1.0\"]' \\
    --eval '%[v\"1.0~rc\" < v\"1.0\"]' \\
    --eval '%[v\"1.0~rc\" > v\"1.0\"]' \\
    --eval '%[v\"1.0-rc\" > v\"1.0\"]' \\
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:545"
( $at_check_trace;
runroot rpm \
    --eval '%[v"1.0" == v"1.0"]' \
    --eval '%[v"1.0~rc" < v"1.0"]' \
    --eval '%[v"1.0~rc" > v"1.0"]' \
    --eval '%[v"1.0-rc" > v"1.0"]' \

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
1
0
1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:545"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_128
#AT_START_129
at_fn_group_banner 129 'rpmmacro.at:561' \
  "simple lua --eval" "                              " 3
at_xfail=no
(
  $as_echo "129. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:563:
runroot rpm --eval '%{lua:print(5*5)}'
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:563"
( $at_check_trace;
runroot rpm --eval '%{lua:print(5*5)}'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "25
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:563"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_129
#AT_START_130
at_fn_group_banner 130 'rpmmacro.at:571' \
  "lua macro arguments" "                            " 3
at_xfail=no
(
  $as_echo "130. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:573:
runroot rpm \\
	--define \"foo(a:) %{lua:print(opt.a, arg[1])}\" \\
	--define \"bar() %{lua:print(rpm.expand('%foo -a'..arg[2]..' '..arg[1]))}\" \\
	--eval '%bar 5 3'
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:573"
( $at_check_trace;
runroot rpm \
	--define "foo(a:) %{lua:print(opt.a, arg[1])}" \
	--define "bar() %{lua:print(rpm.expand('%foo -a'..arg[2]..' '..arg[1]))}" \
	--eval '%bar 5 3'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3	5
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:573"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_130
#AT_START_131
at_fn_group_banner 131 'rpmmacro.at:584' \
  "lua macros table" "                               " 3
at_xfail=no
(
  $as_echo "131. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:586:
runroot rpm \\
	--define \"qtst() %{lua:for i=1, #arg do print(' '..i..':'..arg[i]) end}\"\\
	--eval \"%{lua:print(macros.with('zap'), macros.without('zap'))}\" \\
	--eval \"%{lua:print(macros.aaa)}\" \\
	--eval \"%{lua:macros.aaa='bbb'; macros['yyy']='zzz'}\" \\
	--eval \"%{lua:print(macros['aaa'], macros.yyy)}\" \\
	--eval \"%{lua:macros.aaa=nil\"} \\
	--eval \"%{lua:print(macros.aaa)}\" \\
	--eval \"%{lua:print(macros.qtst('a c'))}\" \\
	--eval \"%{lua:print(macros.qtst({'a', '', 'c'}))}\" \\
	--eval \"%{lua:print(macros.qtst('%{?aaa} %{yyy}'))}\" \\
	--eval \"%{lua:print(macros.qtst({'%{?aaa}', '%{yyy}'}))}\" \\
	--eval \"%{lua:macros.define({'this', 'that'}); print(macros.this)}\"
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:586"
( $at_check_trace;
runroot rpm \
	--define "qtst() %{lua:for i=1, #arg do print(' '..i..':'..arg[i]) end}"\
	--eval "%{lua:print(macros.with('zap'), macros.without('zap'))}" \
	--eval "%{lua:print(macros.aaa)}" \
	--eval "%{lua:macros.aaa='bbb'; macros['yyy']='zzz'}" \
	--eval "%{lua:print(macros['aaa'], macros.yyy)}" \
	--eval "%{lua:macros.aaa=nil"} \
	--eval "%{lua:print(macros.aaa)}" \
	--eval "%{lua:print(macros.qtst('a c'))}" \
	--eval "%{lua:print(macros.qtst({'a', '', 'c'}))}" \
	--eval "%{lua:print(macros.qtst('%{?aaa} %{yyy}'))}" \
	--eval "%{lua:print(macros.qtst({'%{?aaa}', '%{yyy}'}))}" \
	--eval "%{lua:macros.define({'this', 'that'}); print(macros.this)}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0	1
nil

bbb	zzz

nil
 1:a 2:c
 1:a 2: 3:c
 1:zzz
 1:%{?aaa} 2:%{yyy}
that
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:586"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_131
#AT_START_132
at_fn_group_banner 132 'rpmmacro.at:616' \
  "lua macros recursion" "                           " 3
at_xfail=no
(
  $as_echo "132. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:618:
runroot rpm \\
	--define \"%recurse() %{lua:io.write(' '..#arg); if #arg < 16 then table.insert(arg, #arg); macros.recurse(arg) end;}\" \\
	--eval \"%recurse\"
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:618"
( $at_check_trace;
runroot rpm \
	--define "%recurse() %{lua:io.write(' '..#arg); if #arg < 16 then table.insert(arg, #arg); macros.recurse(arg) end;}" \
	--eval "%recurse"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo " 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:618"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_132
#AT_START_133
at_fn_group_banner 133 'rpmmacro.at:628' \
  "lua rpm extensions 1" "                           " 3
at_xfail=no
(
  $as_echo "133. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:630:
runroot rpm --eval '%{lua: rpm.define(\"foo bar\") print(rpm.expand(\"%{foo}\"))}'
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:630"
( $at_check_trace;
runroot rpm --eval '%{lua: rpm.define("foo bar") print(rpm.expand("%{foo}"))}'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "bar
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:630"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_133
#AT_START_134
at_fn_group_banner 134 'rpmmacro.at:638' \
  "lua rpm extensions 2" "                           " 3
at_xfail=no
(
  $as_echo "134. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:640:
runroot rpm --eval '%{lua: print(rpm.vercmp(\"1.0\", \"2.0\"))}'
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:640"
( $at_check_trace;
runroot rpm --eval '%{lua: print(rpm.vercmp("1.0", "2.0"))}'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:640"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_134
#AT_START_135
at_fn_group_banner 135 'rpmmacro.at:648' \
  "lua rpm isdefined" "                              " 3
at_xfail=no
(
  $as_echo "135. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:650:
runroot rpm \\
	--eval '%{lua: print(rpm.isdefined(\"with\"))}' \\
	--eval '%{lua: print(rpm.isdefined(\"nil\"))}' \\
	--eval '%{lua: print(rpm.isdefined(\"ponies\"))}'
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:650"
( $at_check_trace;
runroot rpm \
	--eval '%{lua: print(rpm.isdefined("with"))}' \
	--eval '%{lua: print(rpm.isdefined("nil"))}' \
	--eval '%{lua: print(rpm.isdefined("ponies"))}'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "true	true
true	false
false	false
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:650"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_135
#AT_START_136
at_fn_group_banner 136 'rpmmacro.at:663' \
  "lua posix extensions" "                           " 3
at_xfail=no
(
  $as_echo "136. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:665:
runroot rpm \\
  --eval '%{lua: posix.putenv(\"LUATEST=ok\") print(posix.getenv(\"LUATEST\"))}'
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:665"
( $at_check_trace;
runroot rpm \
  --eval '%{lua: posix.putenv("LUATEST=ok") print(posix.getenv("LUATEST"))}'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "ok
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:665"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_136
#AT_START_137
at_fn_group_banner 137 'rpmmacro.at:674' \
  "lua script exit behavior" "                       " 3
at_xfail=no
(
  $as_echo "137. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:676:
runroot rpm \\
  --eval '%{lua: os.exit()}))}'
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:676"
( $at_check_trace;
runroot rpm \
  --eval '%{lua: os.exit()}))}'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: lua script failed: [string \"<lua>\"]:1: exit not permitted in this context
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmmacro.at:676"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_137
#AT_START_138
at_fn_group_banner 138 'rpmmacro.at:686' \
  "lua script redirect2null" "                       " 3
at_xfail=no
(
  $as_echo "138. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:688:
runroot rpm \\
  --eval '%{lua: posix.redirect2null()}))}'
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:688"
( $at_check_trace;
runroot rpm \
  --eval '%{lua: posix.redirect2null()}))}'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: lua script failed: [string \"<lua>\"]:1: redirect2null not permitted in this context
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmmacro.at:688"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_138
#AT_START_139
at_fn_group_banner 139 'rpmmacro.at:698' \
  "lua library path" "                               " 3
at_xfail=no
(
  $as_echo "139. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:700:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

f=\$(run rpm --eval \"%{_rpmconfigdir}/lua/foo.lua\")
echo \"bar = 'graak'\" > \${f}
runroot rpm \\
  --eval '%{lua:require \"foo\"; print(bar)}'
rm -f \${f}
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmmacro.at:700"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

f=$(run rpm --eval "%{_rpmconfigdir}/lua/foo.lua")
echo "bar = 'graak'" > ${f}
runroot rpm \
  --eval '%{lua:require "foo"; print(bar)}'
rm -f ${f}

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "graak
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:700"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_139
#AT_START_140
at_fn_group_banner 140 'rpmmacro.at:713' \
  "lua rpm version objects" "                        " 3
at_xfail=no
(
  $as_echo "140. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:715:
runroot rpm \\
  --eval '%{lua: v1 = rpm.ver(\"1:4.16-5\"); print(v1, v1.e, v1.v, v1.r)}' \\
  --eval '%{lua: v1 = rpm.ver(\"4.16-1\"); print(v1, v1.e, v1.v, v1.r)}' \\
  --eval '%{lua: v1 = rpm.ver(\"4.16\"); print(v1, v1.e, v1.v, v1.r)}' \\
  --eval '%{lua: v1 = rpm.ver(\"1:4.16-5\"); v2 = rpm.ver(\"4.4-1\"); print(v1 < v2, v1 == v2, v1 > v2, v1 == v1)}'
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:715"
( $at_check_trace;
runroot rpm \
  --eval '%{lua: v1 = rpm.ver("1:4.16-5"); print(v1, v1.e, v1.v, v1.r)}' \
  --eval '%{lua: v1 = rpm.ver("4.16-1"); print(v1, v1.e, v1.v, v1.r)}' \
  --eval '%{lua: v1 = rpm.ver("4.16"); print(v1, v1.e, v1.v, v1.r)}' \
  --eval '%{lua: v1 = rpm.ver("1:4.16-5"); v2 = rpm.ver("4.4-1"); print(v1 < v2, v1 == v2, v1 > v2, v1 == v1)}'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1:4.16-5	1	4.16	5
4.16-1	nil	4.16	1
4.16	nil	4.16	nil
false	false	true	true
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:715"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_140
#AT_START_141
at_fn_group_banner 141 'rpmmacro.at:730' \
  "lua rpm io stream" "                              " 3
at_xfail=no
(
  $as_echo "141. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:732:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
  --eval '%{lua: local f = rpm.open(\"zzz\", \"w+\"); f:write(\"gggg\"); print(f:seek(\"cur\")); f:close()}' \\
  --eval '%{lua: local f = rpm.open(\"zzz\"); print(f:read()); f:close()}' \\
  --eval '%{lua: local f = rpm.open(\"/data/SOURCES/hello-2.0.tar.gz\"); f:reopen(\"r.gzip\"); f:seek(\"cur\", 6); print(f:read(3)); f:close()}'
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmmacro.at:732"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
  --eval '%{lua: local f = rpm.open("zzz", "w+"); f:write("gggg"); print(f:seek("cur")); f:close()}' \
  --eval '%{lua: local f = rpm.open("zzz"); print(f:read()); f:close()}' \
  --eval '%{lua: local f = rpm.open("/data/SOURCES/hello-2.0.tar.gz"); f:reopen("r.gzip"); f:seek("cur", 6); print(f:read(3)); f:close()}'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "4
gggg
2.0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:732"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_141
#AT_START_142
at_fn_group_banner 142 'rpmmacro.at:746' \
  "%define + %undefine in nested levels 1" "         " 3
at_xfail=no
(
  $as_echo "142. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:748:
# basic %define in nested scoping level
runroot rpm \\
    --define '%foo() %{expand:%define xxx 1} %{echo:%xxx} %{expand:%undefine xxx} %{echo:%xxx}' \\
    --eval .'%foo'.
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:748"
( $at_check_trace;
# basic %define in nested scoping level
runroot rpm \
    --define '%foo() %{expand:%define xxx 1} %{echo:%xxx} %{expand:%undefine xxx} %{echo:%xxx}' \
    --eval .'%foo'.

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
%xxx
.   .
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:748"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_142
#AT_START_143
at_fn_group_banner 143 'rpmmacro.at:761' \
  "%define + %undefine in nested levels 2" "         " 3
at_xfail=no
(
  $as_echo "143. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:763:
# %define macro once in a nested scope
runroot rpm \\
    --define '%foo() %{expand:%define xxx 1} %{echo:%xxx}' \\
    --eval .'%foo'. \\
    --eval '%xxx'
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:763"
( $at_check_trace;
# %define macro once in a nested scope
runroot rpm \
    --define '%foo() %{expand:%define xxx 1} %{echo:%xxx}' \
    --eval .'%foo'. \
    --eval '%xxx'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
. .
%xxx
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:763"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_143
#AT_START_144
at_fn_group_banner 144 'rpmmacro.at:777' \
  "%define + %undefine in nested levels 3" "         " 3
at_xfail=no
      test $RPM_XFAIL -ne 0 && at_xfail=yes
(
  $as_echo "144. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:779:

# %define macro twice in a nested scope
runroot rpm \\
    --define '%foo() %{expand:%define xxx 1} %{echo:%xxx} %{expand: %define xxx 2} %{echo:%xxx}' \\
    --eval .'%foo'. \\
    --eval '%xxx'
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:779"
( $at_check_trace;

# %define macro twice in a nested scope
runroot rpm \
    --define '%foo() %{expand:%define xxx 1} %{echo:%xxx} %{expand: %define xxx 2} %{echo:%xxx}' \
    --eval .'%foo'. \
    --eval '%xxx'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
2
.    .
%xxx
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:779"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_144
#AT_START_145
at_fn_group_banner 145 'rpmmacro.at:795' \
  "%define + %undefine in nested levels 4" "         " 3
at_xfail=no
      test $RPM_XFAIL -ne 0 && at_xfail=yes
(
  $as_echo "145. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:797:

# %define in a nested level covered by %global
runroot rpm \\
    --define '%foo() %{expand:%define xxx 1} %{echo:%xxx} %{expand: %global xxx 2} %{echo:%xxx}' \\
    --eval .'%foo'. \\
    --eval '%xxx' \\
    --eval .'%undefine xxx'. \\
    --eval '%xxx'
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:797"
( $at_check_trace;

# %define in a nested level covered by %global
runroot rpm \
    --define '%foo() %{expand:%define xxx 1} %{echo:%xxx} %{expand: %global xxx 2} %{echo:%xxx}' \
    --eval .'%foo'. \
    --eval '%xxx' \
    --eval .'%undefine xxx'. \
    --eval '%xxx'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
2
.    .
2
..
%xxx
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:797"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_145
#AT_START_146
at_fn_group_banner 146 'rpmmacro.at:817' \
  "%define in conditional macro" "                   " 3
at_xfail=no
(
  $as_echo "146. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:819:
runroot rpm \\
    --define 'dofoo() true'\\
    --eval '.%{!?foo: %define foo bar}.'\\
    --eval '%foo' \\
    --eval '%dofoo'\\
    --eval '%foo'
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:819"
( $at_check_trace;
runroot rpm \
    --define 'dofoo() true'\
    --eval '.%{!?foo: %define foo bar}.'\
    --eval '%foo' \
    --eval '%dofoo'\
    --eval '%foo'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo ". .
bar
true
bar
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:819"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_146
#AT_START_147
at_fn_group_banner 147 'rpmmacro.at:835' \
  "%verbose macro" "                                 " 3
at_xfail=no
(
  $as_echo "147. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:837:
runroot rpm --eval '%{verbose}'
runroot rpm -v --eval '%{verbose}'
runroot rpm --eval '%{verbose:zzz}'
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:837"
( $at_check_trace;
runroot rpm --eval '%{verbose}'
runroot rpm -v --eval '%{verbose}'
runroot rpm --eval '%{verbose:zzz}'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: %verbose: unexpected argument
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmmacro.at:837"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_147
#AT_START_148
at_fn_group_banner 148 'rpmmacro.at:850' \
  "%exists macro" "                                  " 3
at_xfail=no
(
  $as_echo "148. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:852:
runroot rpm \\
	--eval \"%{exists:/data}\" \\
	--eval \"%{exists:/zzz}\" \\
	--eval \"%{exists}\"
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:852"
( $at_check_trace;
runroot rpm \
	--eval "%{exists:/data}" \
	--eval "%{exists:/zzz}" \
	--eval "%{exists}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: %exists: argument expected
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmmacro.at:852"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_148
#AT_START_149
at_fn_group_banner 149 'rpmmacro.at:866' \
  "macro with a line starting by \"{\"" "              " 3
at_xfail=no
(
  $as_echo "149. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:868:
runroot rpm --macros \"/data/macros.testfile\" \\
	--eval \"%first\" --eval \"%second\""
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:868"
( $at_check_trace;
runroot rpm --macros "/data/macros.testfile" \
	--eval "%first" --eval "%second"
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "macro_1

macro_2
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:868"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_149
#AT_START_150
at_fn_group_banner 150 'rpmmacro.at:878' \
  "macro with %if-%endif" "                          " 3
at_xfail=no
(
  $as_echo "150. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:880:
runroot rpmspec -q --qf \"%{summary}\\n%{description}\\n\" /data/SPECS/iftest.spec
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:880"
( $at_check_trace;
runroot rpmspec -q --qf "%{summary}\n%{description}\n" /data/SPECS/iftest.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "macro 1
ccc0
ccc1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:880"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_150
#AT_START_151
at_fn_group_banner 151 'rpmmacro.at:890' \
  "macro file errors" "                              " 3
at_xfail=no
(
  $as_echo "151. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:892:
cat << EOF > macros.bad
%_i foo

%multi \\\\
line\\\\
thing

%foo bar
%bad-name 123
EOF

run rpm --macros \"macros.bad\" --eval \"%foo\"
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:892"
( $at_check_trace;
cat << EOF > macros.bad
%_i foo

%multi \\
line\\
thing

%foo bar
%bad-name 123
EOF

run rpm --macros "macros.bad" --eval "%foo"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: macros.bad: line 1: Macro %_i has illegal name (%define)
warning: macros.bad: line 8: Macro %bad needs whitespace before body
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "bar
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:892"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_151
#AT_START_152
at_fn_group_banner 152 'rpmmacro.at:914' \
  "macro comments" "                                 " 3
at_xfail=no
(
  $as_echo "152. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:916:
runroot rpm \\
	--macros /data/macros.testfile \\
	--eval \"%{comment1}\" \\
	--eval \"%{comment2}\"
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:916"
( $at_check_trace;
runroot rpm \
	--macros /data/macros.testfile \
	--eval "%{comment1}" \
	--eval "%{comment2}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "
read
me

see
this
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:916"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_152
#AT_START_153
at_fn_group_banner 153 'rpmmacro.at:933' \
  "macro comments 2" "                               " 3
at_xfail=no
(
  $as_echo "153. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:935:
runroot rpm \\
	--macros /data/macros.testfile \\
	--eval \"%{comment3}\"
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:935"
( $at_check_trace;
runroot rpm \
	--macros /data/macros.testfile \
	--eval "%{comment3}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "
read
' change this meaning
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:935"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_153
#AT_START_154
at_fn_group_banner 154 'rpmmacro.at:948' \
  "macro file empty lines" "                         " 3
at_xfail=no
(
  $as_echo "154. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:950:
runroot rpm \\
	--macros /data/macros.testfile \\
	--eval \"%{empty0}\"
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:950"
( $at_check_trace;
runroot rpm \
	--macros /data/macros.testfile \
	--eval "%{empty0}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "
some

thing

" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmmacro.at:950"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_154
#AT_START_155
at_fn_group_banner 155 'rpmmacro.at:965' \
  "macro traceback" "                                " 3
at_xfail=no
(
  $as_echo "155. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:967:
for o in \"-v\" \"\"; do
    runroot rpm \$o \\
	--define \"err %{error:bad}\" \\
	--define \"bar %err\" \\
	--define \"foo %bar zz\" \\
	--eval \"xxx%{foo}yyy\"
done
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:967"
( $at_check_trace;
for o in "-v" ""; do
    runroot rpm $o \
	--define "err %{error:bad}" \
	--define "bar %err" \
	--define "foo %bar zz" \
	--eval "xxx%{foo}yyy"
done

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: bad
  3<        (%error)
  2<      (%err)
  1<    (%bar)
  0<  (%foo)
xxx
error: bad
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmmacro.at:967"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_155
#AT_START_156
at_fn_group_banner 156 'rpmmacro.at:988' \
  "no space left on stdout" "                        " 3
at_xfail=no
(
  $as_echo "156. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmmacro.at:990:
runroot rpm --eval 1 >/dev/full
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmmacro.at:990"
( $at_check_trace;
runroot rpm --eval 1 >/dev/full

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "Error writing to stdout: No space left on device
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmmacro.at:990"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_156
#AT_START_157
at_fn_group_banner 157 'rpmpython.at:6' \
  "module import" "                                  " 4
at_xfail=no
(
  $as_echo "157. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmpython.at:6" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:6"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:6:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

myprint(rpm.__version__)

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:6"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

myprint(rpm.__version__)

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "4.17.0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:6"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_157
#AT_START_158
at_fn_group_banner 158 'rpmpython.at:12' \
  "macro manipulation" "                             " 4
at_xfail=no
(
  $as_echo "158. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmpython.at:12" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:12"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:12:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

def prexp(m):
    myprint(rpm.expandMacro('%%{?%s}' % m))

mname = '__no_such_macro_yet'
prexp(mname)
rpm.addMacro(mname, '/bin/sh')
prexp(mname)
rpm.addMacro(mname, '/bin/false')
prexp(mname)
rpm.delMacro(mname)
prexp(mname)
rpm.delMacro(mname)
prexp(mname)

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:12"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

def prexp(m):
    myprint(rpm.expandMacro('%%{?%s}' % m))

mname = '__no_such_macro_yet'
prexp(mname)
rpm.addMacro(mname, '/bin/sh')
prexp(mname)
rpm.addMacro(mname, '/bin/false')
prexp(mname)
rpm.delMacro(mname)
prexp(mname)
rpm.delMacro(mname)
prexp(mname)

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "
/bin/sh
/bin/false
/bin/sh

" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:12"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_158
#AT_START_159
at_fn_group_banner 159 'rpmpython.at:35' \
  "basic rpmio" "                                    " 4
at_xfail=no
(
  $as_echo "159. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmpython.at:35" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:35"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:35:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

msg = b'Killroy was here\\n'
data = msg * 10
# TODO: test other compression types too if built in
for iot in [ 'fpio', 'fdio', 'ufdio', 'gzdio' ]:
    fn = 'pyio.%s' % iot
    fd = rpm.fd(fn, 'w', iot)
    pos = fd.tell()
    if pos != -2 and pos != 0:
        myprint('bad start pos %d' % fd.tell())
    if fd.write(data) != len(data):
        myprint('%s write fail' % iot)
    if fn != fd.name:
        myprint('bad file name %s' % fd.name)
    fd.flush()
    pos = fd.tell()
    if pos != -2 and pos != len(data):
        myprint('bad end pos %d' % fd.tell())
    fd = rpm.fd(fn, 'r', iot)
    rdata = fd.read()
    if rdata != data:
        myprint('%s read fail (got %d bytes)\\n%s' % (iot, len(rdata), rdata))
    # compressed io types can't seek
    if iot == 'ufdio':
        fd.seek(0)
    else:
        fd = rpm.fd(fn, 'r', iot)
    if fn != fd.name:
        myprint('bad file name %s' % fd.name)
    rdata = fd.read(len(msg))
    if rdata != msg:
        myprint('%s sized read fail (got %d bytes)\\n%s' % (iot, len(rdata), rdata))

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:35"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

msg = b'Killroy was here\n'
data = msg * 10
# TODO: test other compression types too if built in
for iot in [ 'fpio', 'fdio', 'ufdio', 'gzdio' ]:
    fn = 'pyio.%s' % iot
    fd = rpm.fd(fn, 'w', iot)
    pos = fd.tell()
    if pos != -2 and pos != 0:
        myprint('bad start pos %d' % fd.tell())
    if fd.write(data) != len(data):
        myprint('%s write fail' % iot)
    if fn != fd.name:
        myprint('bad file name %s' % fd.name)
    fd.flush()
    pos = fd.tell()
    if pos != -2 and pos != len(data):
        myprint('bad end pos %d' % fd.tell())
    fd = rpm.fd(fn, 'r', iot)
    rdata = fd.read()
    if rdata != data:
        myprint('%s read fail (got %d bytes)\n%s' % (iot, len(rdata), rdata))
    # compressed io types can't seek
    if iot == 'ufdio':
        fd.seek(0)
    else:
        fd = rpm.fd(fn, 'r', iot)
    if fn != fd.name:
        myprint('bad file name %s' % fd.name)
    rdata = fd.read(len(msg))
    if rdata != msg:
        myprint('%s sized read fail (got %d bytes)\n%s' % (iot, len(rdata), rdata))

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:35"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_159
#AT_START_160
at_fn_group_banner 160 'rpmpython.at:70' \
  "spec parse 1" "                                   " 4
at_xfail=no
(
  $as_echo "160. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmpython.at:70" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:70"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:70:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

# TODO: add a better test spec with sub-packages etc
spec = rpm.spec('\${RPMDATA}/SPECS/hello.spec')
for (name, num, flags) in spec.sources:
    myprint('src %s %d %d' % (name, num, flags))
for pkg in spec.packages:
    myprint(pkg.header.format('%{nvr}'))
myprint(spec.sourceHeader.format('%{nvr}'))

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:70"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

# TODO: add a better test spec with sub-packages etc
spec = rpm.spec('${RPMDATA}/SPECS/hello.spec')
for (name, num, flags) in spec.sources:
    myprint('src %s %d %d' % (name, num, flags))
for pkg in spec.packages:
    myprint(pkg.header.format('%{nvr}'))
myprint(spec.sourceHeader.format('%{nvr}'))

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "src hello-1.0-modernize.patch 0 2
src hello-1.0.tar.gz 0 1
hello-1.0-1
hello-1.0-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:70"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_160
#AT_START_161
at_fn_group_banner 161 'rpmpython.at:85' \
  "spec parse 2" "                                   " 4
at_xfail=no
(
  $as_echo "161. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmpython.at:85" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:85"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:85:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

spec = rpm.spec('\${RPMDATA}/SPECS/mini.spec')
rpm.reloadConfig()

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:85"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

spec = rpm.spec('${RPMDATA}/SPECS/mini.spec')
rpm.reloadConfig()

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:85"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_161
#AT_START_162
at_fn_group_banner 162 'rpmpython.at:90' \
  "basic header manipulation" "                      " 4
at_xfail=no
(
  $as_echo "162. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmpython.at:90" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:90"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:90:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

h = rpm.hdr()
h['name'] = 'testpkg'
h['version'] = '1.0'
h['release'] = '1'
h['epoch'] = 5
h['arch'] = 'noarch'
myprint(h['nevra'])
del h['epoch']
myprint(h['nevra'])
for a in ['name', 'bugurl', '__foo__', ]:
    try:
        x = getattr(h, a)
        myprint(x)
    except AttributeError as exc:
        myprint(exc)

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:90"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

h = rpm.hdr()
h['name'] = 'testpkg'
h['version'] = '1.0'
h['release'] = '1'
h['epoch'] = 5
h['arch'] = 'noarch'
myprint(h['nevra'])
del h['epoch']
myprint(h['nevra'])
for a in ['name', 'bugurl', '__foo__', ]:
    try:
        x = getattr(h, a)
        myprint(x)
    except AttributeError as exc:
        myprint(exc)

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "testpkg-5:1.0-1.noarch
testpkg-1.0-1.noarch
testpkg
None
'rpm.hdr' object has no attribute '__foo__'
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:90"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_162
#AT_START_163
at_fn_group_banner 163 'rpmpython.at:114' \
  "non-utf8 data in header" "                        " 4
at_xfail=no
(
  $as_echo "163. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmpython.at:114" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:114"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:114:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

str = u'lml'
enc = 'iso-8859-1'
b = str.encode(enc)
h = rpm.hdr()
h['group'] = b
d = h['group']
try:
    # python 3
    t = bytes(d, 'utf-8', 'surrogateescape')
except TypeError:
    # python 2
    t = bytes(d)
res = t.decode(enc)
myprint(str == res)

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:114"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

str = u'lml'
enc = 'iso-8859-1'
b = str.encode(enc)
h = rpm.hdr()
h['group'] = b
d = h['group']
try:
    # python 3
    t = bytes(d, 'utf-8', 'surrogateescape')
except TypeError:
    # python 2
    t = bytes(d)
res = t.decode(enc)
myprint(str == res)

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "True
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:114"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_163
#AT_START_164
at_fn_group_banner 164 'rpmpython.at:133' \
  "invalid header data" "                            " 4
at_xfail=no
(
  $as_echo "164. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmpython.at:133" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:133"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:133:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

h1 = rpm.hdr()
h1['basenames'] = ['bing', 'bang', 'bong']
h1['dirnames'] = ['/opt/', '/flopt/']
h1['dirindexes'] = [ 1, 0, 3 ]
h2 = rpm.hdr()
h2['basenames'] = ['bing', 'bang', 'bong']
h2['dirnames'] = ['/opt/', '/flopt/']
h2['dirindexes'] = [ 0, 0, 1 ]
for h in [h1, h2]:
    try:
        myprint(','.join(h['filenames']))
    except rpm.error as exc:
        myprint(exc)

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:133"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

h1 = rpm.hdr()
h1['basenames'] = ['bing', 'bang', 'bong']
h1['dirnames'] = ['/opt/', '/flopt/']
h1['dirindexes'] = [ 1, 0, 3 ]
h2 = rpm.hdr()
h2['basenames'] = ['bing', 'bang', 'bong']
h2['dirnames'] = ['/opt/', '/flopt/']
h2['dirindexes'] = [ 0, 0, 1 ]
for h in [h1, h2]:
    try:
        myprint(','.join(h['filenames']))
    except rpm.error as exc:
        myprint(exc)

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "invalid header data
/opt/bing,/opt/bang,/flopt/bong
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:133"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_164
#AT_START_165
at_fn_group_banner 165 'rpmpython.at:152' \
  "labelCompare" "                                   " 4
at_xfail=no
(
  $as_echo "165. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmpython.at:152" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:152"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:152:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

v = '1.0'
r = '1'
e = 3
h = rpm.hdr()
h['name'] = 'testpkg'
h['version'] = v
h['release'] = r
h['epoch'] = e
myprint(rpm.labelCompare((str(h['epoch']), h['version'], h['release']),
			 (str(e), v, r)))
myprint(rpm.labelCompare((None, '1.0', '1'),
			 (None, '1.1', '2')))
myprint(rpm.labelCompare((None, '1.0', '1'),
			 (None, '1.1', '1')))
myprint(rpm.labelCompare((None, '1.1', '1'),
			 (None, '1.0', '1')))
myprint(rpm.labelCompare((None, '1.1', '1'),
			 (None, '1.0', '2')))
myprint(rpm.labelCompare(('1', '1.0', '1'),
			 ('0', '1.0', '1')))
myprint(rpm.labelCompare(('0', '1.0', '1'),
			 ('1', '1.0', '1')))
myprint(rpm.labelCompare(('0', '1.0', '1'),
			 (None, '1.0', '1')))
myprint(rpm.labelCompare(\"1.0-1\", \"2.0-1\"))
myprint(rpm.labelCompare(\"2:1.0-1\", \"2.0-1\"))

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:152"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

v = '1.0'
r = '1'
e = 3
h = rpm.hdr()
h['name'] = 'testpkg'
h['version'] = v
h['release'] = r
h['epoch'] = e
myprint(rpm.labelCompare((str(h['epoch']), h['version'], h['release']),
			 (str(e), v, r)))
myprint(rpm.labelCompare((None, '1.0', '1'),
			 (None, '1.1', '2')))
myprint(rpm.labelCompare((None, '1.0', '1'),
			 (None, '1.1', '1')))
myprint(rpm.labelCompare((None, '1.1', '1'),
			 (None, '1.0', '1')))
myprint(rpm.labelCompare((None, '1.1', '1'),
			 (None, '1.0', '2')))
myprint(rpm.labelCompare(('1', '1.0', '1'),
			 ('0', '1.0', '1')))
myprint(rpm.labelCompare(('0', '1.0', '1'),
			 ('1', '1.0', '1')))
myprint(rpm.labelCompare(('0', '1.0', '1'),
			 (None, '1.0', '1')))
myprint(rpm.labelCompare("1.0-1", "2.0-1"))
myprint(rpm.labelCompare("2:1.0-1", "2.0-1"))

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0
-1
-1
1
1
1
-1
0
-1
1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:152"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_165
#AT_START_166
at_fn_group_banner 166 'rpmpython.at:192' \
  "vfyflags API" "                                   " 4
at_xfail=no
(
  $as_echo "166. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmpython.at:192" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:192"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:192:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

ts = rpm.ts()
dlv = ts.getVfyFlags()
tlv = dlv | rpm.RPMVSF_NOSHA1HEADER
olv = ts.setVfyFlags(tlv)
nlv = ts.getVfyFlags()
myprint('%s %s %s' % (hex(dlv), hex(olv), hex(nlv)))

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:192"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

ts = rpm.ts()
dlv = ts.getVfyFlags()
tlv = dlv | rpm.RPMVSF_NOSHA1HEADER
olv = ts.setVfyFlags(tlv)
nlv = ts.getVfyFlags()
myprint('%s %s %s' % (hex(dlv), hex(olv), hex(nlv)))

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0x0 0x0 0x100
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:192"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_166
#AT_START_167
at_fn_group_banner 167 'rpmpython.at:203' \
  "vfylevel API" "                                   " 4
at_xfail=no
(
  $as_echo "167. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmpython.at:203" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:203"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:203:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

ts = rpm.ts()
dlv = ts.getVfyLevel()
olv = ts.setVfyLevel(rpm.RPMSIG_SIGNATURE_TYPE|rpm.RPMSIG_DIGEST_TYPE)
nlv = ts.getVfyLevel()
myprint('%s %s %s' % (hex(dlv), hex(olv), hex(nlv)))

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:203"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

ts = rpm.ts()
dlv = ts.getVfyLevel()
olv = ts.setVfyLevel(rpm.RPMSIG_SIGNATURE_TYPE|rpm.RPMSIG_DIGEST_TYPE)
nlv = ts.getVfyLevel()
myprint('%s %s %s' % (hex(dlv), hex(olv), hex(nlv)))

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0x1 0x1 0x3
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:203"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_167
#AT_START_168
at_fn_group_banner 168 'rpmpython.at:214' \
  "reading a package file" "                         " 4
at_xfail=no
(
  $as_echo "168. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmpython.at:214" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:214"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:214:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

ts = rpm.ts()
h = ts.hdrFromFdno('\${RPMDATA}/RPMS/hello-1.0-1.ppc64.rpm')
myprint(h['arch'])

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:214"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

ts = rpm.ts()
h = ts.hdrFromFdno('${RPMDATA}/RPMS/hello-1.0-1.ppc64.rpm')
myprint(h['arch'])

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "ppc64
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:214"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_168
#AT_START_169
at_fn_group_banner 169 'rpmpython.at:222' \
  "reading a signed package file 1" "                " 4
at_xfail=no
(
  $as_echo "169. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmpython.at:222" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:222"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:222:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

ts = rpm.ts()
# avoid rpmlog spew with absolute path to package
sink = open('/dev/null', 'w')
rpm.setLogFile(sink)
try:
    h = ts.hdrFromFdno('\${RPMDATA}/RPMS/hello-2.0-1.x86_64-signed.rpm')
    myprint(h['arch'])
except rpm.error as e:
    myprint(e)

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:222"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

ts = rpm.ts()
# avoid rpmlog spew with absolute path to package
sink = open('/dev/null', 'w')
rpm.setLogFile(sink)
try:
    h = ts.hdrFromFdno('${RPMDATA}/RPMS/hello-2.0-1.x86_64-signed.rpm')
    myprint(h['arch'])
except rpm.error as e:
    myprint(e)

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "public key not available
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:222"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_169
#AT_START_170
at_fn_group_banner 170 'rpmpython.at:237' \
  "reading a signed package file 2" "                " 4
at_xfail=no
(
  $as_echo "170. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmpython.at:237" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:237"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:237:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)


keydata = open('\${RPMDATA}/keys/rpm.org-rsa-2048-test.pub', 'rb').read()
pubkey = rpm.pubkey(keydata)
keyring = rpm.keyring()
keyring.addKey(pubkey)

ts = rpm.ts()
ts.setKeyring(keyring)
try:
    h = ts.hdrFromFdno('\${RPMDATA}/RPMS/hello-2.0-1.x86_64-signed.rpm')
    myprint(h['arch'])
except rpm.error as e:
    myprint(e)

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:237"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)


keydata = open('${RPMDATA}/keys/rpm.org-rsa-2048-test.pub', 'rb').read()
pubkey = rpm.pubkey(keydata)
keyring = rpm.keyring()
keyring.addKey(pubkey)

ts = rpm.ts()
ts.setKeyring(keyring)
try:
    h = ts.hdrFromFdno('${RPMDATA}/RPMS/hello-2.0-1.x86_64-signed.rpm')
    myprint(h['arch'])
except rpm.error as e:
    myprint(e)

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "x86_64
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:237"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_170
#AT_START_171
at_fn_group_banner 171 'rpmpython.at:255' \
  "add package to transaction" "                     " 4
at_xfail=no
(
  $as_echo "171. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmpython.at:255" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:255"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:255:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

ts = rpm.ts()
ts.addInstall('\${RPMDATA}/RPMS/foo-1.0-1.noarch.rpm', 'u')
for e in ts:
    myprint(e.NEVRA())
ts.clear()
for e in ts:
    myprint(e.NEVRA())

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:255"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

ts = rpm.ts()
ts.addInstall('${RPMDATA}/RPMS/foo-1.0-1.noarch.rpm', 'u')
for e in ts:
    myprint(e.NEVRA())
ts.clear()
for e in ts:
    myprint(e.NEVRA())

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo-1.0-1.noarch
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:255"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_171
#AT_START_172
at_fn_group_banner 172 'rpmpython.at:267' \
  "add erasure to transaction" "                     " 4
at_xfail=no
(
  $as_echo "172. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmpython.at:267" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:267"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:267:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

ts = rpm.ts()
for i in ['foo', 1234]:
    myprint('addErase %s' % i)
    try:
        ts.addErase(i)
    except rpm.error as err:
        myprint(err)
myprint('addErase mi')
mi = ts.dbMatch('name', 'foo')
try:
    ts.addErase(mi)
except rpm.error as err:
    myprint(err)

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:267"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

ts = rpm.ts()
for i in ['foo', 1234]:
    myprint('addErase %s' % i)
    try:
        ts.addErase(i)
    except rpm.error as err:
        myprint(err)
myprint('addErase mi')
mi = ts.dbMatch('name', 'foo')
try:
    ts.addErase(mi)
except rpm.error as err:
    myprint(err)

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "addErase foo
package not installed
addErase 1234
package not installed
addErase mi
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:267"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_172
#AT_START_173
at_fn_group_banner 173 'rpmpython.at:289' \
  "add bogus package to transaction 1" "             " 4
at_xfail=no
(
  $as_echo "173. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmpython.at:289" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:289"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:289:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

ts = rpm.ts()
h = rpm.hdr()
h['name'] = \"foo\"
try:
    ts.addInstall(h, 'foo', 'i')
except rpm.error as err:
    myprint(err)
for e in ts:
    myprint(e.NEVRA())

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:289"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

ts = rpm.ts()
h = rpm.hdr()
h['name'] = "foo"
try:
    ts.addInstall(h, 'foo', 'i')
except rpm.error as err:
    myprint(err)
for e in ts:
    myprint(e.NEVRA())

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "adding install to transaction failed
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:289"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_173
#AT_START_174
at_fn_group_banner 174 'rpmpython.at:303' \
  "add bogus package to transaction 2" "             " 4
at_xfail=no
(
  $as_echo "174. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmpython.at:303" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:303"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:303:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

ts = rpm.ts()
h = rpm.hdr()
h['name'] = 'foo'
h['version'] = '1.0'
h['release'] = '1'
h['os'] = 'linux'
h['arch'] = 'noarch'
h['basenames'] = ['bing', 'bang', 'bong']
h['dirnames'] = ['/opt' '/flopt']
h['dirindexes'] = [ 1, 2, 3 ]
try:
    ts.addInstall(h, 'foo', 'u')
except rpm.error as err:
    myprint(err)
for e in ts:
    myprint(e.NEVRA())

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:303"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

ts = rpm.ts()
h = rpm.hdr()
h['name'] = 'foo'
h['version'] = '1.0'
h['release'] = '1'
h['os'] = 'linux'
h['arch'] = 'noarch'
h['basenames'] = ['bing', 'bang', 'bong']
h['dirnames'] = ['/opt' '/flopt']
h['dirindexes'] = [ 1, 2, 3 ]
try:
    ts.addInstall(h, 'foo', 'u')
except rpm.error as err:
    myprint(err)
for e in ts:
    myprint(e.NEVRA())

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "adding upgrade to transaction failed
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:303"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_174
#AT_START_175
at_fn_group_banner 175 'rpmpython.at:324' \
  "transaction element userdata" "                   " 4
at_xfail=no
(
  $as_echo "175. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmpython.at:324" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:324"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:324:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

mydata = { 'foo': 'bar', 'capstest': 'lock' }
ts = rpm.ts()
ts.addInstall('\${RPMDATA}/RPMS/foo-1.0-1.noarch.rpm', 'u')
ts.addInstall('\${RPMDATA}/RPMS/capstest-1.0-1.noarch.rpm', 'u')
for e in ts:
    e.SetUserdata(mydata[e.N()])
for e in ts:
    myprint(e.Userdata())

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:324"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

mydata = { 'foo': 'bar', 'capstest': 'lock' }
ts = rpm.ts()
ts.addInstall('${RPMDATA}/RPMS/foo-1.0-1.noarch.rpm', 'u')
ts.addInstall('${RPMDATA}/RPMS/capstest-1.0-1.noarch.rpm', 'u')
for e in ts:
    e.SetUserdata(mydata[e.N()])
for e in ts:
    myprint(e.Userdata())

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "bar
lock
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:324"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_175
#AT_START_176
at_fn_group_banner 176 'rpmpython.at:338' \
  "transaction callback 1" "                         " 4
at_xfail=no
(
  $as_echo "176. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmpython.at:338" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:338"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:338:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

def ocb(what, amount, total, key, data):
    print(what, amount, total, type(key), data)
    return -1

def ncb(arg, what, amount, total, data):
    print(type(arg), what, amount, total, data)
    return -1

cbd = \"mine\"
ts = rpm.ts()
ts.addInstall('\${RPMDATA}/RPMS/foo-1.0-1.noarch.rpm', 'mykey', 'u')
ts.setFlags(rpm.RPMTRANS_FLAG_TEST)
print(\"- old -\")
ts.run(callback=ocb, data=cbd)
ts.cbStyle = 1
print(\"- new -\")
ts.run(callback=ncb, data=cbd)

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:338"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

def ocb(what, amount, total, key, data):
    print(what, amount, total, type(key), data)
    return -1

def ncb(arg, what, amount, total, data):
    print(type(arg), what, amount, total, data)
    return -1

cbd = "mine"
ts = rpm.ts()
ts.addInstall('${RPMDATA}/RPMS/foo-1.0-1.noarch.rpm', 'mykey', 'u')
ts.setFlags(rpm.RPMTRANS_FLAG_TEST)
print("- old -")
ts.run(callback=ocb, data=cbd)
ts.cbStyle = 1
print("- new -")
ts.run(callback=ncb, data=cbd)

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "- old -
2097152 0 1 <class 'NoneType'> mine
1048576 0 1 <class 'str'> mine
4 0 0 <class 'str'> mine
4194304 1 1 <class 'NoneType'> mine
32 6 1 <class 'NoneType'> mine
16 0 1 <class 'NoneType'> mine
64 6 1 <class 'NoneType'> mine
- new -
<class 'NoneType'> 2097152 0 1 mine
<class 'rpm.te'> 1048576 0 1 mine
<class 'rpm.te'> 4 0 0 mine
<class 'NoneType'> 4194304 1 1 mine
<class 'NoneType'> 32 6 1 mine
<class 'NoneType'> 16 0 1 mine
<class 'NoneType'> 64 6 1 mine
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:338"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_176
#AT_START_177
at_fn_group_banner 177 'rpmpython.at:375' \
  "database iterators" "                             " 4
at_xfail=no
(
  $as_echo "177. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

{ set +x
$as_echo "$at_srcdir/rpmpython.at:378:
runroot rpm -i \\
  --justdb --nodeps --ignorearch --ignoreos \\
  /data/RPMS/foo-1.0-1.noarch.rpm \\
  /data/RPMS/hello-2.0-1.i686.rpm
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmpython.at:378"
( $at_check_trace;
runroot rpm -i \
  --justdb --nodeps --ignorearch --ignoreos \
  /data/RPMS/foo-1.0-1.noarch.rpm \
  /data/RPMS/hello-2.0-1.i686.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:378"
$at_failed && at_fn_log_failure
$at_traceon; }



$as_echo "rpmpython.at:388" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:388"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:388:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

ts = rpm.ts()
ix = 0
mi = ts.dbMatch()
mi.pattern('name', rpm.RPMMIRE_STRCMP, 'hello')
for h in mi:
    ix = h['dbinstance']
    break
del mi
for h in ts.dbMatch('packages', ix):
    myprint(h['nevra'])

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:388"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

ts = rpm.ts()
ix = 0
mi = ts.dbMatch()
mi.pattern('name', rpm.RPMMIRE_STRCMP, 'hello')
for h in mi:
    ix = h['dbinstance']
    break
del mi
for h in ts.dbMatch('packages', ix):
    myprint(h['nevra'])

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "hello-2.0-1.i686
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:388"
$at_failed && at_fn_log_failure
$at_traceon; }




$as_echo "rpmpython.at:404" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:404"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:404:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

ts = rpm.ts()
mi = ts.dbMatch()
mi.pattern('name', rpm.RPMMIRE_DEFAULT, 'f*')
for h in mi:
    myprint(h['nevra'])

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:404"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

ts = rpm.ts()
mi = ts.dbMatch()
mi.pattern('name', rpm.RPMMIRE_DEFAULT, 'f*')
for h in mi:
    myprint(h['nevra'])

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo-1.0-1.noarch
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:404"
$at_failed && at_fn_log_failure
$at_traceon; }




$as_echo "rpmpython.at:415" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:415"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:415:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

ts = rpm.ts()
for h in ts.dbMatch('name'):
    myprint(h['nevra'])

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:415"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

ts = rpm.ts()
for h in ts.dbMatch('name'):
    myprint(h['nevra'])

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo-1.0-1.noarch
hello-2.0-1.i686
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:415"
$at_failed && at_fn_log_failure
$at_traceon; }




$as_echo "rpmpython.at:425" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:425"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:425:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

ts = rpm.ts()
for h in ts.dbMatch('obsoletes'):
    myprint(h['nevra'])

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:425"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

ts = rpm.ts()
for h in ts.dbMatch('obsoletes'):
    myprint(h['nevra'])

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo-1.0-1.noarch
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:425"
$at_failed && at_fn_log_failure
$at_traceon; }




$as_echo "rpmpython.at:434" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:434"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:434:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

ts = rpm.ts()
for h in ts.dbMatch('provides', 'hi'):
    myprint(h['nevra'])

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:434"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

ts = rpm.ts()
for h in ts.dbMatch('provides', 'hi'):
    myprint(h['nevra'])

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo-1.0-1.noarch
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:434"
$at_failed && at_fn_log_failure
$at_traceon; }




$as_echo "rpmpython.at:443" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:443"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:443:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

ts = rpm.ts()
for h in ts.dbMatch('basenames', '/usr/share/doc/hello-2.0/FAQ'):
    myprint(h['nevra'])

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:443"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

ts = rpm.ts()
for h in ts.dbMatch('basenames', '/usr/share/doc/hello-2.0/FAQ'):
    myprint(h['nevra'])

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "hello-2.0-1.i686
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:443"
$at_failed && at_fn_log_failure
$at_traceon; }



$as_echo "rpmpython.at:451" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:451"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:451:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

ts = rpm.ts()
for di in sorted(ts.dbIndex('obsoletes')):
    myprint(di)

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:451"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

ts = rpm.ts()
for di in sorted(ts.dbIndex('obsoletes')):
    myprint(di)

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "howdy
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:451"
$at_failed && at_fn_log_failure
$at_traceon; }




$as_echo "rpmpython.at:460" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:460"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:460:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

ts = rpm.ts()
for di in sorted(ts.dbIndex('provides')):
    myprint(di)

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:460"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

ts = rpm.ts()
for di in sorted(ts.dbIndex('provides')):
    myprint(di)

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
hello
hello(x86-32)
hi
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:460"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_177
#AT_START_178
at_fn_group_banner 178 'rpmpython.at:473' \
  "database cookies" "                               " 4
at_xfail=no
(
  $as_echo "178. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

{ set +x
$as_echo "$at_srcdir/rpmpython.at:476:
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmpython.at:476"
( $at_check_trace;

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:476"
$at_failed && at_fn_log_failure
$at_traceon; }



$as_echo "rpmpython.at:482" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:482"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:482:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

ts = rpm.ts()
ts.openDB()
c1 = ts.dbCookie()
ts.closeDB()
ts.openDB()
c2 = ts.dbCookie()
myprint(c1 == c2 != None)
open(\"dbcookie\", \"w+\").write(c1)

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:482"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

ts = rpm.ts()
ts.openDB()
c1 = ts.dbCookie()
ts.closeDB()
ts.openDB()
c2 = ts.dbCookie()
myprint(c1 == c2 != None)
open("dbcookie", "w+").write(c1)

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "True
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:482"
$at_failed && at_fn_log_failure
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/rpmpython.at:496:
runroot rpm -i \\
  --justdb --nodeps --ignorearch --ignoreos \\
  /data/RPMS/foo-1.0-1.noarch.rpm \\
  /data/RPMS/hello-2.0-1.i686.rpm \\
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmpython.at:496"
( $at_check_trace;
runroot rpm -i \
  --justdb --nodeps --ignorearch --ignoreos \
  /data/RPMS/foo-1.0-1.noarch.rpm \
  /data/RPMS/hello-2.0-1.i686.rpm \

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:496"
$at_failed && at_fn_log_failure
$at_traceon; }



$as_echo "rpmpython.at:506" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:506"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:506:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

ts = rpm.ts()
ts.openDB()
c1 = ts.dbCookie()
c2 = open(\"dbcookie\", \"r\").read()
myprint(c1 != c2)
open(\"dbcookie\", \"w+\").write(c1)

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:506"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

ts = rpm.ts()
ts.openDB()
c1 = ts.dbCookie()
c2 = open("dbcookie", "r").read()
myprint(c1 != c2)
open("dbcookie", "w+").write(c1)

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "True
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:506"
$at_failed && at_fn_log_failure
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/rpmpython.at:518:
runroot rpm -i \\
  --justdb --nodeps --ignorearch --ignoreos \\
  --define \"_transaction_color 3\" \\
  --define \"_prefer_color 2\" \\
  /data/RPMS/hello-2.0-1.x86_64.rpm
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmpython.at:518"
( $at_check_trace;
runroot rpm -i \
  --justdb --nodeps --ignorearch --ignoreos \
  --define "_transaction_color 3" \
  --define "_prefer_color 2" \
  /data/RPMS/hello-2.0-1.x86_64.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:518"
$at_failed && at_fn_log_failure
$at_traceon; }



$as_echo "rpmpython.at:529" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:529"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:529:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

ts = rpm.ts()
ts.openDB()
c1 = ts.dbCookie()
c2 = open(\"dbcookie\", \"r\").read()
myprint(c1 != c2)

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:529"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

ts = rpm.ts()
ts.openDB()
c1 = ts.dbCookie()
c2 = open("dbcookie", "r").read()
myprint(c1 != c2)

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "True
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:529"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_178
#AT_START_179
at_fn_group_banner 179 'rpmpython.at:541' \
  "dependency sets 1" "                              " 4
at_xfail=no
(
  $as_echo "179. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmpython.at:541" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:541"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:541:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

ts = rpm.ts()
h = ts.hdrFromFdno('\${RPMDATA}/RPMS/hello-1.0-1.ppc64.rpm')
for dep in rpm.ds(h, 'requires'):
    myprint(dep.DNEVR())

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:541"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

ts = rpm.ts()
h = ts.hdrFromFdno('${RPMDATA}/RPMS/hello-1.0-1.ppc64.rpm')
for dep in rpm.ds(h, 'requires'):
    myprint(dep.DNEVR())

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "R /bin/sh
R /bin/sh
R /bin/sh
R /bin/sh
R libc.so.6
R libc.so.6(GLIBC_2.0)
R rpmlib(CompressedFileNames) <= 3.0.4-1
R rpmlib(PayloadFilesHavePrefix) <= 4.0-1
R rtld(GNU_HASH)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:541"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_179
#AT_START_180
at_fn_group_banner 180 'rpmpython.at:558' \
  "dependency sets 2" "                              " 4
at_xfail=no
(
  $as_echo "180. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmpython.at:558" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:558"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:558:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

ts = rpm.ts()
h = ts.hdrFromFdno('\${RPMDATA}/RPMS/hello-2.0-1.i686.rpm')
ds = rpm.ds(h, 'provides')
myprint('%d %d' % (ds.Instance(), ds.Count()))

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:558"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

ts = rpm.ts()
h = ts.hdrFromFdno('${RPMDATA}/RPMS/hello-2.0-1.i686.rpm')
ds = rpm.ds(h, 'provides')
myprint('%d %d' % (ds.Instance(), ds.Count()))

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "0 2
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:558"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_180
#AT_START_181
at_fn_group_banner 181 'rpmpython.at:568' \
  "dependency sets 3" "                              " 4
at_xfail=no
(
  $as_echo "181. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmpython.at:568" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:568"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:568:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

deps = []
deps.append(rpm.ds(('foo', rpm.RPMSENSE_EQUAL, '2.0'), rpm.RPMTAG_REQUIRENAME))
deps.append(rpm.ds(('bar', rpm.RPMSENSE_EQUAL, '2.0'), rpm.RPMTAG_RECOMMENDNAME))
deps.append(rpm.ds(('bar', rpm.RPMSENSE_EQUAL|rpm.RPMSENSE_MISSINGOK, '2.0'), rpm.RPMTAG_REQUIRENAME))
deps.append(rpm.ds(('(foo if bar)',), rpm.RPMTAG_REQUIRENAME))
deps.append(rpm.ds(('(foo if bar)',), rpm.RPMTAG_SUGGESTNAME))
deps.append(rpm.ds(('(foo if bar)',), rpm.RPMTAG_SUPPLEMENTNAME))
for d in deps:
    myprint(\"%s %s %s %s\" % (d.DNEVR(), d.IsWeak(), d.IsRich(), d.IsReverse()))

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:568"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

deps = []
deps.append(rpm.ds(('foo', rpm.RPMSENSE_EQUAL, '2.0'), rpm.RPMTAG_REQUIRENAME))
deps.append(rpm.ds(('bar', rpm.RPMSENSE_EQUAL, '2.0'), rpm.RPMTAG_RECOMMENDNAME))
deps.append(rpm.ds(('bar', rpm.RPMSENSE_EQUAL|rpm.RPMSENSE_MISSINGOK, '2.0'), rpm.RPMTAG_REQUIRENAME))
deps.append(rpm.ds(('(foo if bar)',), rpm.RPMTAG_REQUIRENAME))
deps.append(rpm.ds(('(foo if bar)',), rpm.RPMTAG_SUGGESTNAME))
deps.append(rpm.ds(('(foo if bar)',), rpm.RPMTAG_SUPPLEMENTNAME))
for d in deps:
    myprint("%s %s %s %s" % (d.DNEVR(), d.IsWeak(), d.IsRich(), d.IsReverse()))

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "R foo = 2.0 False False False
r bar = 2.0 True False False
R bar = 2.0 True False False
R (foo if bar) False True False
s (foo if bar) True True False
S (foo if bar) True True True
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:568"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_181
#AT_START_182
at_fn_group_banner 182 'rpmpython.at:588' \
  "file info sets 1" "                               " 4
at_xfail=no
(
  $as_echo "182. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmpython.at:588" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:588"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:588:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

ts = rpm.ts()
h = ts.hdrFromFdno('\${RPMDATA}/RPMS/hello-2.0-1.i686.rpm')
fi = rpm.fi(h)
myprint(fi.FC())
for f in fi:
   myprint('%x: %s' % (fi.FFlags(), fi.FN()))

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:588"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

ts = rpm.ts()
h = ts.hdrFromFdno('${RPMDATA}/RPMS/hello-2.0-1.i686.rpm')
fi = rpm.fi(h)
myprint(fi.FC())
for f in fi:
   myprint('%x: %s' % (fi.FFlags(), fi.FN()))

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "5
0: /usr/bin/hello
0: /usr/share/doc/hello-2.0
2: /usr/share/doc/hello-2.0/COPYING
2: /usr/share/doc/hello-2.0/FAQ
2: /usr/share/doc/hello-2.0/README
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:588"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_182
#AT_START_183
at_fn_group_banner 183 'rpmpython.at:605' \
  "string pool 1" "                                  " 4
at_xfail=no
(
  $as_echo "183. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmpython.at:605" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:605"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:605:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

p = rpm.strpool()
for s in ['foo', 'bar', 'foo', 'zoo']:
    p.str2id(s)
myprint('%s' % len(p))
for i in range(1, len(p)+1):
    myprint('%s: %s' % (i, p[i]))

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:605"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

p = rpm.strpool()
for s in ['foo', 'bar', 'foo', 'zoo']:
    p.str2id(s)
myprint('%s' % len(p))
for i in range(1, len(p)+1):
    myprint('%s: %s' % (i, p[i]))

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3
1: foo
2: bar
3: zoo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:605"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_183
#AT_START_184
at_fn_group_banner 184 'rpmpython.at:620' \
  "string pool 2" "                                  " 4
at_xfail=no
(
  $as_echo "184. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmpython.at:620" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:620"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:620:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

p = rpm.strpool()
d1 = rpm.ds(('foo', rpm.RPMSENSE_EQUAL, '2.0'), rpm.RPMTAG_PROVIDES, pool=p)
d2 = rpm.ds(('bar', rpm.RPMSENSE_EQUAL, '2.0'), rpm.RPMTAG_PROVIDES, pool=p)
d3 = rpm.ds(('bar', rpm.RPMSENSE_EQUAL, '2.0'), rpm.RPMTAG_PROVIDES, pool=p)
myprint('%s' % len(p))
del p
myprint(d1.DNEVR())
myprint(d2.DNEVR())
myprint(d3.DNEVR())

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:620"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

p = rpm.strpool()
d1 = rpm.ds(('foo', rpm.RPMSENSE_EQUAL, '2.0'), rpm.RPMTAG_PROVIDES, pool=p)
d2 = rpm.ds(('bar', rpm.RPMSENSE_EQUAL, '2.0'), rpm.RPMTAG_PROVIDES, pool=p)
d3 = rpm.ds(('bar', rpm.RPMSENSE_EQUAL, '2.0'), rpm.RPMTAG_PROVIDES, pool=p)
myprint('%s' % len(p))
del p
myprint(d1.DNEVR())
myprint(d2.DNEVR())
myprint(d3.DNEVR())

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "3
P foo = 2.0
P bar = 2.0
P bar = 2.0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:620"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_184
#AT_START_185
at_fn_group_banner 185 'rpmpython.at:638' \
  "archive 1" "                                      " 4
at_xfail=no
(
  $as_echo "185. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmpython.at:638" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:638"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:638:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

import hashlib
ts = rpm.ts()
fd = rpm.fd.open('\${RPMDATA}/SRPMS/hello-1.0-1.src.rpm')
h = ts.hdrFromFdno(fd)
payload = rpm.fd.open(fd, flags=h['payloadcompressor'])
files = rpm.files(h)
archive = files.archive(payload)
for f in archive:
    if not f.fflags & rpm.RPMFILE_SPECFILE:
        continue
    spec = archive.read()
    hash = hashlib.md5(spec)
    if f.digest != hash.hexdigest():
        myprint('%s should be %s' % (hash.hexdigest(), f.digest))
    break

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:638"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

import hashlib
ts = rpm.ts()
fd = rpm.fd.open('${RPMDATA}/SRPMS/hello-1.0-1.src.rpm')
h = ts.hdrFromFdno(fd)
payload = rpm.fd.open(fd, flags=h['payloadcompressor'])
files = rpm.files(h)
archive = files.archive(payload)
for f in archive:
    if not f.fflags & rpm.RPMFILE_SPECFILE:
        continue
    spec = archive.read()
    hash = hashlib.md5(spec)
    if f.digest != hash.hexdigest():
        myprint('%s should be %s' % (hash.hexdigest(), f.digest))
    break

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:638"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_185
#AT_START_186
at_fn_group_banner 186 'rpmpython.at:658' \
  "header unload" "                                  " 4
at_xfail=no
(
  $as_echo "186. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmpython.at:658" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:658"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:658:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

ts = rpm.ts()
h = ts.hdrFromFdno('\${RPMDATA}/RPMS/hello-2.0-1.i686.rpm')
# Add some garbage to header to make it non-sorted
h['installtime'] = 0
# RhBug:1061730 causes export of non-sorted header to be larger than it should
len1 = len(h.unload())
# Accessing the header before export forces sorting to take place even on
# buggy versions
t = h['installtime']
len2 = len(h.unload())
myprint(len1 == len2)

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:658"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

ts = rpm.ts()
h = ts.hdrFromFdno('${RPMDATA}/RPMS/hello-2.0-1.i686.rpm')
# Add some garbage to header to make it non-sorted
h['installtime'] = 0
# RhBug:1061730 causes export of non-sorted header to be larger than it should
len1 = len(h.unload())
# Accessing the header before export forces sorting to take place even on
# buggy versions
t = h['installtime']
len2 = len(h.unload())
myprint(len1 == len2)

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "True
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:658"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_186
#AT_START_187
at_fn_group_banner 187 'rpmpython.at:675' \
  "version objects 1" "                              " 4
at_xfail=no
(
  $as_echo "187. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmpython.at:675" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:675"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:675:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

pv = None
for vs in [ '1.0', '1.0', '4:1.0', '1.5-1', '3:2.0-1']:
    v = rpm.ver(vs)
    myprint('(%s, %s, %s)' % (v.e, v.v, v.r))
    if pv:
        myprint('%s < %s: %s' % (pv.evr, v.evr, pv < v))
        myprint('%s > %s: %s' % (pv.evr, v.evr, pv > v))
        myprint('%s == %s: %s' % (pv.evr, v.evr, pv == v))
    pv = v

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:675"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

pv = None
for vs in [ '1.0', '1.0', '4:1.0', '1.5-1', '3:2.0-1']:
    v = rpm.ver(vs)
    myprint('(%s, %s, %s)' % (v.e, v.v, v.r))
    if pv:
        myprint('%s < %s: %s' % (pv.evr, v.evr, pv < v))
        myprint('%s > %s: %s' % (pv.evr, v.evr, pv > v))
        myprint('%s == %s: %s' % (pv.evr, v.evr, pv == v))
    pv = v

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "(None, 1.0, None)
(None, 1.0, None)
1.0 < 1.0: False
1.0 > 1.0: False
1.0 == 1.0: True
(4, 1.0, None)
1.0 < 4:1.0: True
1.0 > 4:1.0: False
1.0 == 4:1.0: False
(None, 1.5, 1)
4:1.0 < 1.5-1: False
4:1.0 > 1.5-1: True
4:1.0 == 1.5-1: False
(3, 2.0, 1)
1.5-1 < 3:2.0-1: True
1.5-1 > 3:2.0-1: False
1.5-1 == 3:2.0-1: False
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:675"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_187
#AT_START_188
at_fn_group_banner 188 'rpmpython.at:706' \
  "version objects 2" "                              " 4
at_xfail=no
(
  $as_echo "188. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmpython.at:706" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmpython.at:706"
{ set +x
$as_echo "$at_srcdir/rpmpython.at:706:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

for vt in [ (None, \"1.0\", None), (None, \"1.0\", \"2\"), (\"1\", \"1.0\", \"3\") ]:
    v = rpm.ver(vt)
    myprint(v)

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmpython.at:706"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

for vt in [ (None, "1.0", None), (None, "1.0", "2"), ("1", "1.0", "3") ]:
    v = rpm.ver(vt)
    myprint(v)

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1.0
1.0-2
1:1.0-3
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmpython.at:706"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_188
#AT_START_189
at_fn_group_banner 189 'rpmdepmatch.at:4' \
  "provide - require pairs" "                        " 5
at_xfail=no
(
  $as_echo "189. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


$as_echo "rpmdepmatch.at:4" >"$at_check_line_file"
($PYTHON_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmdepmatch.at:4"
{ set +x
$as_echo "$at_srcdir/rpmdepmatch.at:4:
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '\${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\\n' % msg)

# ((provides), (requires), match) expected values
tests = [
    # Different names never match
    (('b',),			('a',),			0),
    (('b',),			('a', '=', '1.2'),	0),
    (('b',),			('a', '>=', '1.2'),	0),
    (('b',),			('a', '<=', '1.2'),	0),
    (('b',),			('a', '<', '1.2'),	0),
    (('b',),			('a', '>', '1.2'),	0),
    (('b',),			('a', '<>', '1.2'),	0),

    # Unversioned provide matches all versions
    (('a',),			('a',),			1),
    (('a',),			('a', '=', '1.2'),	1),
    (('a',),			('a', '>=', '1.2'),	1),
    (('a',),			('a', '<=', '1.2'),	1),
    (('a',),			('a', '<', '1.2'),	1),
    (('a',),			('a', '>', '1.2'),	1),
    (('a',),			('a', '<>', '1.2'),	1),

    # Unversioned require matches all versions
    (('a', '=', '1.2'),		('a',),			1),
    (('a', '<', '1.2'),		('a',),			1),
    (('a', '>', '1.2'),		('a',),			1),
    (('a', '<=', '1.2'),	('a',),			1),
    (('a', '>=', '1.2'),	('a',),			1),
    (('a', '<>', '1.2'),	('a',),			1),

    # Simple, obvious version comparisons
    (('a', '=', '1.2'),		('a', '=', '1.2'),	1),
    (('a', '=', '1.2'),		('a', '>=', '1.2'),	1),
    (('a', '=', '1.2'),		('a', '<=', '1.2'),	1),
    (('a', '=', '1.2'),		('a', '<', '1.2'),	0),
    (('a', '=', '1.2'),		('a', '>', '1.2'),	0),
    (('a', '=', '1.2'),		('a', '<>', '1.2'),	0),

    (('a', '=', '1.2'),		('a', '=', '1.3'),	0),
    (('a', '=', '1.2'),		('a', '>=', '1.3'),	0),
    (('a', '=', '1.2'),		('a', '<=', '1.3'),	1),
    (('a', '=', '1.2'),		('a', '<', '1.3'),	1),
    (('a', '=', '1.2'),		('a', '>', '1.3'),	0),
    (('a', '=', '1.2'),		('a', '<>', '1.3'),	1),

    # Simple, obvious version-release comparisons
    (('a', '=', '1.2-1'),	('a', '=', '1.2-1'),	1),
    (('a', '=', '1.2-1'),	('a', '>=', '1.2-1'),	1),
    (('a', '=', '1.2-1'),	('a', '<=', '1.2-1'),	1),
    (('a', '=', '1.2-1'),	('a', '<', '1.2-1'),	0),
    (('a', '=', '1.2-1'),	('a', '>', '1.2-1'),	0),
    (('a', '=', '1.2-1'),	('a', '<>', '1.2-1'),	0),

    (('a', '=', '1.2-1'),	('a', '=', '1.2-2'),	0),
    (('a', '=', '1.2-1'),	('a', '>=', '1.2-2'),	0),
    (('a', '=', '1.2-1'),	('a', '<=', '1.2-2'),	1),
    (('a', '=', '1.2-1'),	('a', '<', '1.2-2'),	1),
    (('a', '=', '1.2-1'),	('a', '>', '1.2-2'),	0),
    (('a', '=', '1.2-1'),	('a', '<>', '1.2-2'),	1),

    (('a', '=', '1.3-1'),	('a', '=', '1.2-2'),	0),
    (('a', '=', '1.3-1'),	('a', '>=', '1.2-2'),	1),
    (('a', '=', '1.3-1'),	('a', '<=', '1.2-2'),	0),
    (('a', '=', '1.3-1'),	('a', '<', '1.2-2'),	0),
    (('a', '=', '1.3-1'),	('a', '>', '1.2-2'),	1),
    (('a', '=', '1.3-1'),	('a', '<>', '1.2-2'),	1),

    # Zero epoch is same as no epoch
    (('a', '=', '0:1.2'),	('a', '=', '1.2'),	1),
    (('a', '=', '0:1.2'),	('a', '>=', '1.2'),	1),
    (('a', '=', '0:1.2'),	('a', '<=', '1.2'),	1),
    (('a', '=', '0:1.2'),	('a', '<', '1.2'),	0),
    (('a', '=', '0:1.2'),	('a', '>', '1.2'),	0),
    (('a', '=', '0:1.2'),	('a', '<>', '1.2'),	0),

    (('a', '=', '1.2'),		('a', '=', '0:1.2'),	1),
    (('a', '=', '1.2'),		('a', '>=', '0:1.2'),	1),
    (('a', '=', '1.2'),		('a', '<=', '0:1.2'),	1),
    (('a', '=', '1.2'),		('a', '<', '0:1.2'),	0),
    (('a', '=', '1.2'),		('a', '>', '0:1.2'),	0),
    (('a', '=', '1.2'),		('a', '<>', '0:1.2'),	0),

    # Non-zero epochs
    (('a', '=', '1:1.2'),	('a', '=', '1.2'),	0),
    (('a', '=', '1:1.2'),	('a', '>=', '1.2'),	1),
    (('a', '=', '1:1.2'),	('a', '<=', '1.2'),	0),
    (('a', '=', '1:1.2'),	('a', '<', '1.2'),	0),
    (('a', '=', '1:1.2'),	('a', '>', '1.2'),	1),
    (('a', '=', '1:1.2'),	('a', '<>', '1.2'),	1),

    (('a', '=', '1.2'),		('a', '=', '1:1.2'),	0),
    (('a', '=', '1.2'),		('a', '>=', '1:1.2'),	0),
    (('a', '=', '1.2'),		('a', '<=', '1:1.2'),	1),
    (('a', '=', '1.2'),		('a', '<', '1:1.2'),	1),
    (('a', '=', '1.2'),		('a', '>', '1:1.2'),	0),
    (('a', '=', '1.2'),		('a', '<>', '1:1.2'),	1),

    (('a', '=', '2:1.2'),	('a', '=', '2:1.2'),	1),
    (('a', '=', '2:1.2'),	('a', '>=', '2:1.2'),	1),
    (('a', '=', '2:1.2'),	('a', '<=', '2:1.2'),	1),
    (('a', '=', '2:1.2'),	('a', '<', '2:1.2'),	0),
    (('a', '=', '2:1.2'),	('a', '>', '2:1.2'),	0),
    (('a', '=', '2:1.2'),	('a', '<>', '2:1.2'),	0),

    # Simple, obvious version comparisons with provide ranges
    (('a', '>', '1.2'),		('a', '=', '1.2'),	0),
    (('a', '>', '1.2'),		('a', '>=', '1.2'),	1),
    (('a', '>', '1.2'),		('a', '<=', '1.2'),	0),
    (('a', '>', '1.2'),		('a', '<', '1.2'),	0),
    (('a', '>', '1.2'),		('a', '>', '1.2'),	1),
    (('a', '>', '1.2'),		('a', '<>', '1.2'),	1),

    (('a', '<', '1.2'),		('a', '=', '1.2'),	0),
    (('a', '<', '1.2'),		('a', '>=', '1.2'),	0),
    (('a', '<', '1.2'),		('a', '<=', '1.2'),	1),
    (('a', '<', '1.2'),		('a', '<', '1.2'),	1),
    (('a', '<', '1.2'),		('a', '>', '1.2'),	0),
    (('a', '<', '1.2'),		('a', '<>', '1.2'),	1),

    (('a', '>=', '1.2'),	('a', '=', '1.2'),	1),
    (('a', '>=', '1.2'),	('a', '>=', '1.2'),	1),
    (('a', '>=', '1.2'),	('a', '<=', '1.2'),	1),
    (('a', '>=', '1.2'),	('a', '<', '1.2'),	0),
    (('a', '>=', '1.2'),	('a', '>', '1.2'),	1),
    (('a', '>=', '1.2'),	('a', '<>', '1.2'),	1),

    (('a', '<=', '1.2'),	('a', '=', '1.2'),	1),
    (('a', '<=', '1.2'),	('a', '>=', '1.2'),	1),
    (('a', '<=', '1.2'),	('a', '<=', '1.2'),	1),
    (('a', '<=', '1.2'),	('a', '<', '1.2'),	1),
    (('a', '<=', '1.2'),	('a', '>', '1.2'),	0),
    (('a', '<=', '1.2'),	('a', '<>', '1.2'),	1),

    (('a', '<>', '1.2'),	('a', '=', '1.2'),	0),
    (('a', '<>', '1.2'),	('a', '>=', '1.2'),	1),
    (('a', '<>', '1.2'),	('a', '<=', '1.2'),	1),
    (('a', '<>', '1.2'),	('a', '<', '1.2'),	1),
    (('a', '<>', '1.2'),	('a', '>', '1.2'),	1),
    (('a', '<>', '1.2'),	('a', '<>', '1.2'),	1),

    # Missing release should be considered \"any release will do\"
    # but this is not always so (the cases with \"???\")
    (('a', '=', '1.2-1'),	('a', '=', '1.2'),	1),
    (('a', '=', '1.2-1'),	('a', '>=', '1.2'),	1),
    (('a', '=', '1.2-1'),	('a', '<=', '1.2'),	1),
    (('a', '=', '1.2-1'),	('a', '<', '1.2'),	0),
    (('a', '=', '1.2-1'),	('a', '>', '1.2'),	0),
    (('a', '=', '1.2-1'),	('a', '<>', '1.2'),	0),

    (('a', '>', '1.2-1'),	('a', '=', '1.2'),	1),
    (('a', '>', '1.2-1'),	('a', '>=', '1.2'),	1),
    (('a', '>', '1.2-1'),	('a', '<=', '1.2'),	1),
    (('a', '>', '1.2-1'),	('a', '<', '1.2'),	0),
    (('a', '>', '1.2-1'),	('a', '>', '1.2'),	1),
    (('a', '>', '1.2-1'),	('a', '<>', '1.2'),	1),

    (('a', '<', '1.2-1'),	('a', '=', '1.2'),	1),
    (('a', '<', '1.2-1'),	('a', '>=', '1.2'),	1),
    (('a', '<', '1.2-1'),	('a', '<=', '1.2'),	1),
    (('a', '<', '1.2-1'),	('a', '<', '1.2'),	1),
    (('a', '<', '1.2-1'),	('a', '>', '1.2'),	0),
    (('a', '<', '1.2-1'),	('a', '<>', '1.2'),	1),

    (('a', '>=', '1.2-1'),	('a', '=', '1.2'),	1),
    (('a', '>=', '1.2-1'),	('a', '>=', '1.2'),	1),
    (('a', '>=', '1.2-1'),	('a', '<=', '1.2'),	1),
    (('a', '>=', '1.2-1'),	('a', '<', '1.2'),	0),
    (('a', '>=', '1.2-1'),	('a', '>', '1.2'),	1),
    (('a', '>=', '1.2-1'),	('a', '<>', '1.2'),	1),

    (('a', '<=', '1.2-1'),	('a', '=', '1.2'),	1),
    (('a', '<=', '1.2-1'),	('a', '>=', '1.2'),	1),
    (('a', '<=', '1.2-1'),	('a', '<=', '1.2'),	1),
    (('a', '<=', '1.2-1'),	('a', '<', '1.2'),	1),
    (('a', '<=', '1.2-1'),	('a', '>', '1.2'),	0),
    (('a', '<=', '1.2-1'),	('a', '<>', '1.2'),	1),

    (('a', '<>', '1.2-1'),	('a', '=', '1.2'),	1),
    (('a', '<>', '1.2-1'),	('a', '>=', '1.2'),	1),
    (('a', '<>', '1.2-1'),	('a', '<=', '1.2'),	1),
    (('a', '<>', '1.2-1'),	('a', '<', '1.2'),	1),
    (('a', '<>', '1.2-1'),	('a', '>', '1.2'),	1),
    (('a', '<>', '1.2-1'),	('a', '<>', '1.2'),	1),

    (('a', '=', '1.2'),		('a', '=', '1.2-1'),	1),
    (('a', '=', '1.2'),		('a', '>=', '1.2-1'),	1),
    (('a', '=', '1.2'),		('a', '<=', '1.2-1'),	1),
    (('a', '=', '1.2'),		('a', '<', '1.2-1'),	1),
    (('a', '=', '1.2'),		('a', '>', '1.2-1'),	1),
    (('a', '=', '1.2'),		('a', '<>', '1.2-1'),	1),

    (('a', '>', '1.2'),		('a', '=', '1.2-1'),	0),
    (('a', '>', '1.2'),		('a', '>=', '1.2-1'),	1),
    (('a', '>', '1.2'),		('a', '<=', '1.2-1'),	0),
    (('a', '>', '1.2'),		('a', '<', '1.2-1'),	0),
    (('a', '>', '1.2'),		('a', '>', '1.2-1'),	1),
    (('a', '>', '1.2'),		('a', '<>', '1.2-1'),	1),

    (('a', '<', '1.2'),		('a', '=', '1.2-1'),	0),
    (('a', '<', '1.2'),		('a', '>=', '1.2-1'),	0),
    (('a', '<', '1.2'),		('a', '<=', '1.2-1'),	1),
    (('a', '<', '1.2'),		('a', '<', '1.2-1'),	1),
    (('a', '<', '1.2'),		('a', '>', '1.2-1'),	0),
    (('a', '<', '1.2'),		('a', '<>', '1.2-1'),	1),

    (('a', '>=', '1.2'),	('a', '=', '1.2-1'),	1),
    (('a', '>=', '1.2'),	('a', '>=', '1.2-1'),	1),
    (('a', '>=', '1.2'),	('a', '<=', '1.2-1'),	1),
    (('a', '>=', '1.2'),	('a', '<', '1.2-1'),	1),
    (('a', '>=', '1.2'),	('a', '>', '1.2-1'),	1),
    (('a', '>=', '1.2'),	('a', '<>', '1.2-1'),	1),

    (('a', '<=', '1.2'),	('a', '=', '1.2-1'),	1),
    (('a', '<=', '1.2'),	('a', '>=', '1.2-1'),	1),
    (('a', '<=', '1.2'),	('a', '<=', '1.2-1'),	1),
    (('a', '<=', '1.2'),	('a', '<', '1.2-1'),	1),
    (('a', '<=', '1.2'),	('a', '>', '1.2-1'),	1),
    (('a', '<=', '1.2'),	('a', '<>', '1.2-1'),	1),

    (('a', '<>', '1.2'),	('a', '=', '1.2-1'),	0),
    (('a', '<>', '1.2'),	('a', '>=', '1.2-1'),	1),
    (('a', '<>', '1.2'),	('a', '<=', '1.2-1'),	1),
    (('a', '<>', '1.2'),	('a', '<', '1.2-1'),	1),
    (('a', '<>', '1.2'),	('a', '>', '1.2-1'),	1),
    (('a', '<>', '1.2'),	('a', '<>', '1.2-1'),	1),
]

ms = ['no match', 'match']

myprint() # dumb kludge to fixup expected output
for p, r, res in tests:
    d1 = rpm.ds(p, 'provides')
    d2 = rpm.ds(r, 'requires')
    match = d1.Compare(d2)
    if match != res:
        myprint('FAILED: %s with %s: %s' % (d1.DNEVR(), d2.DNEVR(),ms[res]))

EOF
\${PYTHON} test.py
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmdepmatch.at:4"
( $at_check_trace;
cat << EOF > test.py
# coding=utf-8
import rpm, sys, os
dbpath=rpm.expandMacro('%_dbpath')
rpm.addMacro('_dbpath', '${RPMTEST}%s' % dbpath)
rpm.addMacro('_db_backend', os.getenv('DBFORMAT'))
def myprint(msg = ''):
    sys.stdout.write('%s\n' % msg)

# ((provides), (requires), match) expected values
tests = [
    # Different names never match
    (('b',),			('a',),			0),
    (('b',),			('a', '=', '1.2'),	0),
    (('b',),			('a', '>=', '1.2'),	0),
    (('b',),			('a', '<=', '1.2'),	0),
    (('b',),			('a', '<', '1.2'),	0),
    (('b',),			('a', '>', '1.2'),	0),
    (('b',),			('a', '<>', '1.2'),	0),

    # Unversioned provide matches all versions
    (('a',),			('a',),			1),
    (('a',),			('a', '=', '1.2'),	1),
    (('a',),			('a', '>=', '1.2'),	1),
    (('a',),			('a', '<=', '1.2'),	1),
    (('a',),			('a', '<', '1.2'),	1),
    (('a',),			('a', '>', '1.2'),	1),
    (('a',),			('a', '<>', '1.2'),	1),

    # Unversioned require matches all versions
    (('a', '=', '1.2'),		('a',),			1),
    (('a', '<', '1.2'),		('a',),			1),
    (('a', '>', '1.2'),		('a',),			1),
    (('a', '<=', '1.2'),	('a',),			1),
    (('a', '>=', '1.2'),	('a',),			1),
    (('a', '<>', '1.2'),	('a',),			1),

    # Simple, obvious version comparisons
    (('a', '=', '1.2'),		('a', '=', '1.2'),	1),
    (('a', '=', '1.2'),		('a', '>=', '1.2'),	1),
    (('a', '=', '1.2'),		('a', '<=', '1.2'),	1),
    (('a', '=', '1.2'),		('a', '<', '1.2'),	0),
    (('a', '=', '1.2'),		('a', '>', '1.2'),	0),
    (('a', '=', '1.2'),		('a', '<>', '1.2'),	0),

    (('a', '=', '1.2'),		('a', '=', '1.3'),	0),
    (('a', '=', '1.2'),		('a', '>=', '1.3'),	0),
    (('a', '=', '1.2'),		('a', '<=', '1.3'),	1),
    (('a', '=', '1.2'),		('a', '<', '1.3'),	1),
    (('a', '=', '1.2'),		('a', '>', '1.3'),	0),
    (('a', '=', '1.2'),		('a', '<>', '1.3'),	1),

    # Simple, obvious version-release comparisons
    (('a', '=', '1.2-1'),	('a', '=', '1.2-1'),	1),
    (('a', '=', '1.2-1'),	('a', '>=', '1.2-1'),	1),
    (('a', '=', '1.2-1'),	('a', '<=', '1.2-1'),	1),
    (('a', '=', '1.2-1'),	('a', '<', '1.2-1'),	0),
    (('a', '=', '1.2-1'),	('a', '>', '1.2-1'),	0),
    (('a', '=', '1.2-1'),	('a', '<>', '1.2-1'),	0),

    (('a', '=', '1.2-1'),	('a', '=', '1.2-2'),	0),
    (('a', '=', '1.2-1'),	('a', '>=', '1.2-2'),	0),
    (('a', '=', '1.2-1'),	('a', '<=', '1.2-2'),	1),
    (('a', '=', '1.2-1'),	('a', '<', '1.2-2'),	1),
    (('a', '=', '1.2-1'),	('a', '>', '1.2-2'),	0),
    (('a', '=', '1.2-1'),	('a', '<>', '1.2-2'),	1),

    (('a', '=', '1.3-1'),	('a', '=', '1.2-2'),	0),
    (('a', '=', '1.3-1'),	('a', '>=', '1.2-2'),	1),
    (('a', '=', '1.3-1'),	('a', '<=', '1.2-2'),	0),
    (('a', '=', '1.3-1'),	('a', '<', '1.2-2'),	0),
    (('a', '=', '1.3-1'),	('a', '>', '1.2-2'),	1),
    (('a', '=', '1.3-1'),	('a', '<>', '1.2-2'),	1),

    # Zero epoch is same as no epoch
    (('a', '=', '0:1.2'),	('a', '=', '1.2'),	1),
    (('a', '=', '0:1.2'),	('a', '>=', '1.2'),	1),
    (('a', '=', '0:1.2'),	('a', '<=', '1.2'),	1),
    (('a', '=', '0:1.2'),	('a', '<', '1.2'),	0),
    (('a', '=', '0:1.2'),	('a', '>', '1.2'),	0),
    (('a', '=', '0:1.2'),	('a', '<>', '1.2'),	0),

    (('a', '=', '1.2'),		('a', '=', '0:1.2'),	1),
    (('a', '=', '1.2'),		('a', '>=', '0:1.2'),	1),
    (('a', '=', '1.2'),		('a', '<=', '0:1.2'),	1),
    (('a', '=', '1.2'),		('a', '<', '0:1.2'),	0),
    (('a', '=', '1.2'),		('a', '>', '0:1.2'),	0),
    (('a', '=', '1.2'),		('a', '<>', '0:1.2'),	0),

    # Non-zero epochs
    (('a', '=', '1:1.2'),	('a', '=', '1.2'),	0),
    (('a', '=', '1:1.2'),	('a', '>=', '1.2'),	1),
    (('a', '=', '1:1.2'),	('a', '<=', '1.2'),	0),
    (('a', '=', '1:1.2'),	('a', '<', '1.2'),	0),
    (('a', '=', '1:1.2'),	('a', '>', '1.2'),	1),
    (('a', '=', '1:1.2'),	('a', '<>', '1.2'),	1),

    (('a', '=', '1.2'),		('a', '=', '1:1.2'),	0),
    (('a', '=', '1.2'),		('a', '>=', '1:1.2'),	0),
    (('a', '=', '1.2'),		('a', '<=', '1:1.2'),	1),
    (('a', '=', '1.2'),		('a', '<', '1:1.2'),	1),
    (('a', '=', '1.2'),		('a', '>', '1:1.2'),	0),
    (('a', '=', '1.2'),		('a', '<>', '1:1.2'),	1),

    (('a', '=', '2:1.2'),	('a', '=', '2:1.2'),	1),
    (('a', '=', '2:1.2'),	('a', '>=', '2:1.2'),	1),
    (('a', '=', '2:1.2'),	('a', '<=', '2:1.2'),	1),
    (('a', '=', '2:1.2'),	('a', '<', '2:1.2'),	0),
    (('a', '=', '2:1.2'),	('a', '>', '2:1.2'),	0),
    (('a', '=', '2:1.2'),	('a', '<>', '2:1.2'),	0),

    # Simple, obvious version comparisons with provide ranges
    (('a', '>', '1.2'),		('a', '=', '1.2'),	0),
    (('a', '>', '1.2'),		('a', '>=', '1.2'),	1),
    (('a', '>', '1.2'),		('a', '<=', '1.2'),	0),
    (('a', '>', '1.2'),		('a', '<', '1.2'),	0),
    (('a', '>', '1.2'),		('a', '>', '1.2'),	1),
    (('a', '>', '1.2'),		('a', '<>', '1.2'),	1),

    (('a', '<', '1.2'),		('a', '=', '1.2'),	0),
    (('a', '<', '1.2'),		('a', '>=', '1.2'),	0),
    (('a', '<', '1.2'),		('a', '<=', '1.2'),	1),
    (('a', '<', '1.2'),		('a', '<', '1.2'),	1),
    (('a', '<', '1.2'),		('a', '>', '1.2'),	0),
    (('a', '<', '1.2'),		('a', '<>', '1.2'),	1),

    (('a', '>=', '1.2'),	('a', '=', '1.2'),	1),
    (('a', '>=', '1.2'),	('a', '>=', '1.2'),	1),
    (('a', '>=', '1.2'),	('a', '<=', '1.2'),	1),
    (('a', '>=', '1.2'),	('a', '<', '1.2'),	0),
    (('a', '>=', '1.2'),	('a', '>', '1.2'),	1),
    (('a', '>=', '1.2'),	('a', '<>', '1.2'),	1),

    (('a', '<=', '1.2'),	('a', '=', '1.2'),	1),
    (('a', '<=', '1.2'),	('a', '>=', '1.2'),	1),
    (('a', '<=', '1.2'),	('a', '<=', '1.2'),	1),
    (('a', '<=', '1.2'),	('a', '<', '1.2'),	1),
    (('a', '<=', '1.2'),	('a', '>', '1.2'),	0),
    (('a', '<=', '1.2'),	('a', '<>', '1.2'),	1),

    (('a', '<>', '1.2'),	('a', '=', '1.2'),	0),
    (('a', '<>', '1.2'),	('a', '>=', '1.2'),	1),
    (('a', '<>', '1.2'),	('a', '<=', '1.2'),	1),
    (('a', '<>', '1.2'),	('a', '<', '1.2'),	1),
    (('a', '<>', '1.2'),	('a', '>', '1.2'),	1),
    (('a', '<>', '1.2'),	('a', '<>', '1.2'),	1),

    # Missing release should be considered "any release will do"
    # but this is not always so (the cases with "???")
    (('a', '=', '1.2-1'),	('a', '=', '1.2'),	1),
    (('a', '=', '1.2-1'),	('a', '>=', '1.2'),	1),
    (('a', '=', '1.2-1'),	('a', '<=', '1.2'),	1),
    (('a', '=', '1.2-1'),	('a', '<', '1.2'),	0),
    (('a', '=', '1.2-1'),	('a', '>', '1.2'),	0),
    (('a', '=', '1.2-1'),	('a', '<>', '1.2'),	0),

    (('a', '>', '1.2-1'),	('a', '=', '1.2'),	1),
    (('a', '>', '1.2-1'),	('a', '>=', '1.2'),	1),
    (('a', '>', '1.2-1'),	('a', '<=', '1.2'),	1),
    (('a', '>', '1.2-1'),	('a', '<', '1.2'),	0),
    (('a', '>', '1.2-1'),	('a', '>', '1.2'),	1),
    (('a', '>', '1.2-1'),	('a', '<>', '1.2'),	1),

    (('a', '<', '1.2-1'),	('a', '=', '1.2'),	1),
    (('a', '<', '1.2-1'),	('a', '>=', '1.2'),	1),
    (('a', '<', '1.2-1'),	('a', '<=', '1.2'),	1),
    (('a', '<', '1.2-1'),	('a', '<', '1.2'),	1),
    (('a', '<', '1.2-1'),	('a', '>', '1.2'),	0),
    (('a', '<', '1.2-1'),	('a', '<>', '1.2'),	1),

    (('a', '>=', '1.2-1'),	('a', '=', '1.2'),	1),
    (('a', '>=', '1.2-1'),	('a', '>=', '1.2'),	1),
    (('a', '>=', '1.2-1'),	('a', '<=', '1.2'),	1),
    (('a', '>=', '1.2-1'),	('a', '<', '1.2'),	0),
    (('a', '>=', '1.2-1'),	('a', '>', '1.2'),	1),
    (('a', '>=', '1.2-1'),	('a', '<>', '1.2'),	1),

    (('a', '<=', '1.2-1'),	('a', '=', '1.2'),	1),
    (('a', '<=', '1.2-1'),	('a', '>=', '1.2'),	1),
    (('a', '<=', '1.2-1'),	('a', '<=', '1.2'),	1),
    (('a', '<=', '1.2-1'),	('a', '<', '1.2'),	1),
    (('a', '<=', '1.2-1'),	('a', '>', '1.2'),	0),
    (('a', '<=', '1.2-1'),	('a', '<>', '1.2'),	1),

    (('a', '<>', '1.2-1'),	('a', '=', '1.2'),	1),
    (('a', '<>', '1.2-1'),	('a', '>=', '1.2'),	1),
    (('a', '<>', '1.2-1'),	('a', '<=', '1.2'),	1),
    (('a', '<>', '1.2-1'),	('a', '<', '1.2'),	1),
    (('a', '<>', '1.2-1'),	('a', '>', '1.2'),	1),
    (('a', '<>', '1.2-1'),	('a', '<>', '1.2'),	1),

    (('a', '=', '1.2'),		('a', '=', '1.2-1'),	1),
    (('a', '=', '1.2'),		('a', '>=', '1.2-1'),	1),
    (('a', '=', '1.2'),		('a', '<=', '1.2-1'),	1),
    (('a', '=', '1.2'),		('a', '<', '1.2-1'),	1),
    (('a', '=', '1.2'),		('a', '>', '1.2-1'),	1),
    (('a', '=', '1.2'),		('a', '<>', '1.2-1'),	1),

    (('a', '>', '1.2'),		('a', '=', '1.2-1'),	0),
    (('a', '>', '1.2'),		('a', '>=', '1.2-1'),	1),
    (('a', '>', '1.2'),		('a', '<=', '1.2-1'),	0),
    (('a', '>', '1.2'),		('a', '<', '1.2-1'),	0),
    (('a', '>', '1.2'),		('a', '>', '1.2-1'),	1),
    (('a', '>', '1.2'),		('a', '<>', '1.2-1'),	1),

    (('a', '<', '1.2'),		('a', '=', '1.2-1'),	0),
    (('a', '<', '1.2'),		('a', '>=', '1.2-1'),	0),
    (('a', '<', '1.2'),		('a', '<=', '1.2-1'),	1),
    (('a', '<', '1.2'),		('a', '<', '1.2-1'),	1),
    (('a', '<', '1.2'),		('a', '>', '1.2-1'),	0),
    (('a', '<', '1.2'),		('a', '<>', '1.2-1'),	1),

    (('a', '>=', '1.2'),	('a', '=', '1.2-1'),	1),
    (('a', '>=', '1.2'),	('a', '>=', '1.2-1'),	1),
    (('a', '>=', '1.2'),	('a', '<=', '1.2-1'),	1),
    (('a', '>=', '1.2'),	('a', '<', '1.2-1'),	1),
    (('a', '>=', '1.2'),	('a', '>', '1.2-1'),	1),
    (('a', '>=', '1.2'),	('a', '<>', '1.2-1'),	1),

    (('a', '<=', '1.2'),	('a', '=', '1.2-1'),	1),
    (('a', '<=', '1.2'),	('a', '>=', '1.2-1'),	1),
    (('a', '<=', '1.2'),	('a', '<=', '1.2-1'),	1),
    (('a', '<=', '1.2'),	('a', '<', '1.2-1'),	1),
    (('a', '<=', '1.2'),	('a', '>', '1.2-1'),	1),
    (('a', '<=', '1.2'),	('a', '<>', '1.2-1'),	1),

    (('a', '<>', '1.2'),	('a', '=', '1.2-1'),	0),
    (('a', '<>', '1.2'),	('a', '>=', '1.2-1'),	1),
    (('a', '<>', '1.2'),	('a', '<=', '1.2-1'),	1),
    (('a', '<>', '1.2'),	('a', '<', '1.2-1'),	1),
    (('a', '<>', '1.2'),	('a', '>', '1.2-1'),	1),
    (('a', '<>', '1.2'),	('a', '<>', '1.2-1'),	1),
]

ms = ['no match', 'match']

myprint() # dumb kludge to fixup expected output
for p, r, res in tests:
    d1 = rpm.ds(p, 'provides')
    d2 = rpm.ds(r, 'requires')
    match = d1.Compare(d2)
    if match != res:
        myprint('FAILED: %s with %s: %s' % (d1.DNEVR(), d2.DNEVR(),ms[res]))

EOF
${PYTHON} test.py

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdepmatch.at:4"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_189
#AT_START_190
at_fn_group_banner 190 'rpmquery.at:22' \
  "rpm --qf -p *.i386.rpm" "                         " 6
at_xfail=no
(
  $as_echo "190. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:24:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
  -q --qf \"%{NAME}-%{VERSION}-%{RELEASE}.%{ARCH}\\n\" \\
  -p /data/RPMS/hello-1.0-1.i386.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:24"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
  -q --qf "%{NAME}-%{VERSION}-%{RELEASE}.%{ARCH}\n" \
  -p /data/RPMS/hello-1.0-1.i386.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "hello-1.0-1.i386
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:24"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_190
#AT_START_191
at_fn_group_banner 191 'rpmquery.at:37' \
  "rpm --qf -p *.src.rpm" "                          " 6
at_xfail=no
(
  $as_echo "191. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:39:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
  -q --qf \"%{NAME}-%{VERSION}-%{RELEASE}.%{ARCH}\\n\" \\
  -p /data/SRPMS/hello-1.0-1.src.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:39"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
  -q --qf "%{NAME}-%{VERSION}-%{RELEASE}.%{ARCH}\n" \
  -p /data/SRPMS/hello-1.0-1.src.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "hello-1.0-1.i386
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:39"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_191
#AT_START_192
at_fn_group_banner 192 'rpmquery.at:52' \
  "rpm -ql -p *.src.rpm" "                           " 6
at_xfail=no
(
  $as_echo "192. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:54:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
  -ql \\
  -p /data/SRPMS/hello-1.0-1.src.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:54"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
  -ql \
  -p /data/SRPMS/hello-1.0-1.src.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "hello-1.0.tar.gz
hello.spec
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:54"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_192
#AT_START_193
at_fn_group_banner 193 'rpmquery.at:68' \
  "rpm -ql multiple *.rpm" "                         " 6
at_xfail=no
(
  $as_echo "193. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:70:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
  -ql \\
  /data/SRPMS/hello-1.0-1.src.rpm /data/RPMS/hello-1.0-1.i386.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:70"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
  -ql \
  /data/SRPMS/hello-1.0-1.src.rpm /data/RPMS/hello-1.0-1.i386.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "hello-1.0.tar.gz
hello.spec
/usr/local/bin/hello
/usr/share/doc/hello-1.0
/usr/share/doc/hello-1.0/FAQ
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:70"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_193
#AT_START_194
at_fn_group_banner 194 'rpmquery.at:87' \
  "rpmspec -q" "                                     " 6
at_xfail=no
(
  $as_echo "194. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:89:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpmspec \\
  -q --qf \"%{name}\" /data/SPECS/hello.spec
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:89"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpmspec \
  -q --qf "%{name}" /data/SPECS/hello.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "hello" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:89"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_194
#AT_START_195
at_fn_group_banner 195 'rpmquery.at:100' \
  "rpm -ql -p *.i386.rpm" "                          " 6
at_xfail=no
(
  $as_echo "195. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:102:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
  -ql \\
  -p /data/RPMS/hello-1.0-1.i386.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:102"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
  -ql \
  -p /data/RPMS/hello-1.0-1.i386.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "/usr/local/bin/hello
/usr/share/doc/hello-1.0
/usr/share/doc/hello-1.0/FAQ
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:102"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_195
#AT_START_196
at_fn_group_banner 196 'rpmquery.at:118' \
  "rpm -qp <manifest>" "                             " 6
at_xfail=no
(
  $as_echo "196. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:120:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cat << EOF > \${RPMTEST}/query.mft
/data/RPMS/hello-1.0-1.i386.rpm
/data/RPMS/hello-1.0-1.ppc64.rpm
/data/RPMS/foo-1.0-1.noarch.rpm
EOF
runroot rpm -qp --qf \"%{nvr}\\n\" /query.mft
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:120"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cat << EOF > ${RPMTEST}/query.mft
/data/RPMS/hello-1.0-1.i386.rpm
/data/RPMS/hello-1.0-1.ppc64.rpm
/data/RPMS/foo-1.0-1.noarch.rpm
EOF
runroot rpm -qp --qf "%{nvr}\n" /query.mft

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "hello-1.0-1
hello-1.0-1
foo-1.0-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:120"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_196
#AT_START_197
at_fn_group_banner 197 'rpmquery.at:140' \
  "rpm -q --scripts -p *.i386.rpm" "                 " 6
at_xfail=no
(
  $as_echo "197. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:142:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
  -q --scripts \\
  -p /data/RPMS/hello-1.0-1.i386.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:142"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
  -q --scripts \
  -p /data/RPMS/hello-1.0-1.i386.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "preinstall program: /bin/sh
postinstall program: /bin/sh
preuninstall program: /bin/sh
postuninstall program: /bin/sh
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:142"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_197
#AT_START_198
at_fn_group_banner 198 'rpmquery.at:162' \
  "rpm -q on installed package" "                    " 6
at_xfail=no
(
  $as_echo "198. $at_setup_line: testing $at_desc ..."
  $at_traceon



{ set +x
$as_echo "$at_srcdir/rpmquery.at:165:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm \\
  --noscripts --nodeps --ignorearch --relocate=/usr=/check \\
  -i /data/RPMS/hello-1.0-1.ppc64.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:165"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm \
  --noscripts --nodeps --ignorearch --relocate=/usr=/check \
  -i /data/RPMS/hello-1.0-1.ppc64.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:165"
$at_failed && at_fn_log_failure
$at_traceon; }


# check common NVRA combinations
{ set +x
$as_echo "$at_srcdir/rpmquery.at:175:
runroot rpm \\
  -q hello hello-1.0 hello-1.0-1 \\
     hello.ppc64 hello-1.0.ppc64 hello-1.0-1.ppc64
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmquery.at:175"
( $at_check_trace;
runroot rpm \
  -q hello hello-1.0 hello-1.0-1 \
     hello.ppc64 hello-1.0.ppc64 hello-1.0-1.ppc64

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "hello-1.0-1.ppc64
hello-1.0-1.ppc64
hello-1.0-1.ppc64
hello-1.0-1.ppc64
hello-1.0-1.ppc64
hello-1.0-1.ppc64
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:175"
$at_failed && at_fn_log_failure
$at_traceon; }



{ set +x
$as_echo "$at_srcdir/rpmquery.at:191:
runroot rpm \\
  -ql hello
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmquery.at:191"
( $at_check_trace;
runroot rpm \
  -ql hello

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "/check/local/bin/hello
/check/share/doc/hello-1.0
/check/share/doc/hello-1.0/FAQ
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:191"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_198
#AT_START_199
at_fn_group_banner 199 'rpmquery.at:205' \
  "integer array query" "                            " 6
at_xfail=no
(
  $as_echo "199. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:207:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
  --queryformat=\"[%{filemodes}\\n]\" \\
  -qp /data/RPMS/hello-1.0-1.i386.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:207"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
  --queryformat="[%{filemodes}\n]" \
  -qp /data/RPMS/hello-1.0-1.i386.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "33257
16877
33188
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:207"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_199
#AT_START_200
at_fn_group_banner 200 'rpmquery.at:222' \
  "formatted filesbypkg query" "                     " 6
at_xfail=no
(
  $as_echo "200. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:224:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
  --queryformat=\"[%-10{=NAME} %{FILENAMES}\\n]\" \\
  -qp /data/RPMS/hello-1.0-1.i386.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:224"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
  --queryformat="[%-10{=NAME} %{FILENAMES}\n]" \
  -qp /data/RPMS/hello-1.0-1.i386.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "hello      /usr/local/bin/hello
hello      /usr/share/doc/hello-1.0
hello      /usr/share/doc/hello-1.0/FAQ
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:224"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_200
#AT_START_201
at_fn_group_banner 201 'rpmquery.at:239' \
  "hex formatted integer array extension query" "    " 6
at_xfail=no
(
  $as_echo "201. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:241:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
  --queryformat=\"[%5{longfilesizes:hex}\\n]\" \\
  -qp /data/RPMS/hello-1.0-1.i386.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:241"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
  --queryformat="[%5{longfilesizes:hex}\n]" \
  -qp /data/RPMS/hello-1.0-1.i386.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "  b40
 1000
   24
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:241"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_201
#AT_START_202
at_fn_group_banner 202 'rpmquery.at:256' \
  "base64 extension query" "                         " 6
at_xfail=no
(
  $as_echo "202. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:258:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
  --queryformat=\"%{pkgid:base64}\" \\
  -qp /data/RPMS/foo-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:258"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
  --queryformat="%{pkgid:base64}" \
  -qp /data/RPMS/foo-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "qt8W635v5FKy1pILrW+0uw==
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:258"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_202
#AT_START_203
at_fn_group_banner 203 'rpmquery.at:270' \
  "pgpsig extension query" "                         " 6
at_xfail=no
(
  $as_echo "203. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:272:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
    --queryformat=\"%{rsaheader:pgpsig}\" \\
    -qp /data/RPMS/hello-2.0-1.x86_64-signed.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:272"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
    --queryformat="%{rsaheader:pgpsig}" \
    -qp /data/RPMS/hello-2.0-1.x86_64-signed.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "warning: /data/RPMS/hello-2.0-1.x86_64-signed.rpm: Header V4 RSA/SHA256 Signature, key ID 1964c5fc: NOKEY
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "RSA/SHA256, Thu Apr  6 13:02:33 2017, Key ID 4344591e1964c5fc" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:272"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_203
#AT_START_204
at_fn_group_banner 204 'rpmquery.at:285' \
  "integer array perms format query" "               " 6
at_xfail=no
(
  $as_echo "204. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:287:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
  --queryformat=\"[%{filemodes:perms}\\n]\" \\
  -qp /data/RPMS/hello-1.0-1.i386.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:287"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
  --queryformat="[%{filemodes:perms}\n]" \
  -qp /data/RPMS/hello-1.0-1.i386.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-rwxr-x--x
drwxr-xr-x
-rw-r--r--
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:287"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_204
#AT_START_205
at_fn_group_banner 205 'rpmquery.at:302' \
  "string array query" "                             " 6
at_xfail=no
(
  $as_echo "205. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:304:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
  --queryformat=\"[%{basenames} ]\" \\
  -qp /data/RPMS/hello-1.0-1.i386.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:304"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
  --queryformat="[%{basenames} ]" \
  -qp /data/RPMS/hello-1.0-1.i386.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "hello hello-1.0 FAQ " | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:304"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_205
#AT_START_206
at_fn_group_banner 206 'rpmquery.at:316' \
  "empty string array query" "                       " 6
at_xfail=no
(
  $as_echo "206. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:318:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
  --queryformat=\"[%{basenames}]\" \\
  -qp /data/RPMS/foo-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:318"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
  --queryformat="[%{basenames}]" \
  -qp /data/RPMS/foo-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:318"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_206
#AT_START_207
at_fn_group_banner 207 'rpmquery.at:330' \
  "empty string array extension array format" "      " 6
at_xfail=no
(
  $as_echo "207. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:332:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
  --queryformat=\"[%{filenames}]\" \\
  -qp /data/RPMS/foo-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:332"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
  --queryformat="[%{filenames}]" \
  -qp /data/RPMS/foo-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:332"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_207
#AT_START_208
at_fn_group_banner 208 'rpmquery.at:344' \
  "empty string array extension query" "             " 6
at_xfail=no
(
  $as_echo "208. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:346:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
  --queryformat=\"%{filenames}\" \\
  -qp /data/RPMS/foo-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:346"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
  --queryformat="%{filenames}" \
  -qp /data/RPMS/foo-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "(none)" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:346"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_208
#AT_START_209
at_fn_group_banner 209 'rpmquery.at:358' \
  "different sizes arrays query 1" "                 " 6
at_xfail=no
(
  $as_echo "209. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:360:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
  --queryformat=\"[%{basenames} %{changelogname}]\\n\" \\
  -qp /data/RPMS/hello-1.0-1.i386.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:360"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
  --queryformat="[%{basenames} %{changelogname}]\n" \
  -qp /data/RPMS/hello-1.0-1.i386.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: incorrect format: array iterator used with different sized arrays
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:360"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_209
#AT_START_210
at_fn_group_banner 210 'rpmquery.at:375' \
  "different sizes arrays query 2" "                 " 6
at_xfail=no
(
  $as_echo "210. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:377:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
  --queryformat=\"[%{name} %{changelogtime}]\\n\" \\
  -qp /data/RPMS/hello-1.0-1.i386.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:377"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
  --queryformat="[%{name} %{changelogtime}]\n" \
  -qp /data/RPMS/hello-1.0-1.i386.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "hello 908877600
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:377"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_210
#AT_START_211
at_fn_group_banner 211 'rpmquery.at:390' \
  "different sizes arrays query 3" "                 " 6
at_xfail=no
(
  $as_echo "211. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:392:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
  --queryformat=\"[%{name} %{basenames}]\\n\" \\
  -qp /data/RPMS/hello-1.0-1.i386.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:392"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
  --queryformat="[%{name} %{basenames}]\n" \
  -qp /data/RPMS/hello-1.0-1.i386.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: incorrect format: array iterator used with different sized arrays
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:392"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_211
#AT_START_212
at_fn_group_banner 212 'rpmquery.at:405' \
  "different sizes arrays query 4" "                 " 6
at_xfail=no
(
  $as_echo "212. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:407:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
  --queryformat=\"[%{=name} %{basenames}\\n]\" \\
  -qp /data/RPMS/hello-1.0-1.i386.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:407"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
  --queryformat="[%{=name} %{basenames}\n]" \
  -qp /data/RPMS/hello-1.0-1.i386.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "hello hello
hello hello-1.0
hello FAQ
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:407"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_212
#AT_START_213
at_fn_group_banner 213 'rpmquery.at:422' \
  "non-existent string tag" "                        " 6
at_xfail=no
(
  $as_echo "213. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:424:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
  --queryformat=\"%{vendor}\" \\
  -qp /data/RPMS/foo-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:424"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
  --queryformat="%{vendor}" \
  -qp /data/RPMS/foo-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "(none)" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:424"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_213
#AT_START_214
at_fn_group_banner 214 'rpmquery.at:436' \
  "non-existent integer tag query" "                 " 6
at_xfail=no
(
  $as_echo "214. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:438:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
  --queryformat=\"%{installcolor}\" \\
  -qp /data/RPMS/foo-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:438"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
  --queryformat="%{installcolor}" \
  -qp /data/RPMS/foo-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "(none)" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:438"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_214
#AT_START_215
at_fn_group_banner 215 'rpmquery.at:450' \
  "conditional queryformat" "                        " 6
at_xfail=no
(
  $as_echo "215. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:452:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
  --queryformat=\"%|name?{%{name}}:{no}| %|installtime?{%{installtime}}:{(not installed)}|\" \\
  -qp /data/RPMS/foo-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:452"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
  --queryformat="%|name?{%{name}}:{no}| %|installtime?{%{installtime}}:{(not installed)}|" \
  -qp /data/RPMS/foo-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo (not installed)" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:452"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_215
#AT_START_216
at_fn_group_banner 216 'rpmquery.at:464' \
  "invalid tag query" "                              " 6
at_xfail=no
(
  $as_echo "216. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:466:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
  --queryformat=\"%{notag}\" \\
  -qp /data/RPMS/foo-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:466"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
  --queryformat="%{notag}" \
  -qp /data/RPMS/foo-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: incorrect format: unknown tag: \"notag\"
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:466"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_216
#AT_START_217
at_fn_group_banner 217 'rpmquery.at:479' \
  "invalid data for format query" "                  " 6
at_xfail=no
(
  $as_echo "217. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:481:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
  --queryformat=\"%{name:depflags}\" \\
  -qp /data/RPMS/foo-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:481"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
  --queryformat="%{name:depflags}" \
  -qp /data/RPMS/foo-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "(not a number)" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:481"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_217
#AT_START_218
at_fn_group_banner 218 'rpmquery.at:493' \
  "invalid format width query" "                     " 6
at_xfail=no
(
  $as_echo "218. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:495:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
  --queryformat=\"%ss{size}\" \\
  -qp /data/RPMS/foo-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:495"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
  --queryformat="%ss{size}" \
  -qp /data/RPMS/foo-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: incorrect format: invalid field width
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:495"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_218
#AT_START_219
at_fn_group_banner 219 'rpmquery.at:507' \
  "xml format" "                                     " 6
at_xfail=no
(
  $as_echo "219. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:509:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm -qp --xml  data/RPMS/hello-2.0-1.x86_64.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:509"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm -qp --xml  data/RPMS/hello-2.0-1.x86_64.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "<rpmHeader>
  <rpmTag name=\"Headeri18ntable\">
	<string>C</string>
  </rpmTag>
  <rpmTag name=\"Sigsize\">
	<integer>5411</integer>
  </rpmTag>
  <rpmTag name=\"Sigmd5\">
	<base64>E3yh2LNcygKhhUujAcVDLg==
</base64>
  </rpmTag>
  <rpmTag name=\"Sha1header\">
	<string>5cd9874c510b67b44483f9e382a1649ef7743bac</string>
  </rpmTag>
  <rpmTag name=\"Sha256header\">
	<string>ef920781af3bf072ae9888eec3de1c589143101dff9cc0b561468d395fb766d9</string>
  </rpmTag>
  <rpmTag name=\"Name\">
	<string>hello</string>
  </rpmTag>
  <rpmTag name=\"Version\">
	<string>2.0</string>
  </rpmTag>
  <rpmTag name=\"Release\">
	<string>1</string>
  </rpmTag>
  <rpmTag name=\"Summary\">
	<string>hello -- hello, world rpm</string>
  </rpmTag>
  <rpmTag name=\"Description\">
	<string>Simple rpm demonstration.</string>
  </rpmTag>
  <rpmTag name=\"Buildtime\">
	<integer>1227355200</integer>
  </rpmTag>
  <rpmTag name=\"Buildhost\">
	<string>localhost</string>
  </rpmTag>
  <rpmTag name=\"Size\">
	<integer>7243</integer>
  </rpmTag>
  <rpmTag name=\"License\">
	<string>GPL</string>
  </rpmTag>
  <rpmTag name=\"Group\">
	<string>Testing</string>
  </rpmTag>
  <rpmTag name=\"Os\">
	<string>linux</string>
  </rpmTag>
  <rpmTag name=\"Arch\">
	<string>x86_64</string>
  </rpmTag>
  <rpmTag name=\"Filesizes\">
	<integer>7120</integer>
	<integer>4096</integer>
	<integer>48</integer>
	<integer>36</integer>
	<integer>39</integer>
  </rpmTag>
  <rpmTag name=\"Filemodes\">
	<integer>33257</integer>
	<integer>16877</integer>
	<integer>33188</integer>
	<integer>33188</integer>
	<integer>33188</integer>
  </rpmTag>
  <rpmTag name=\"Filerdevs\">
	<integer>0</integer>
	<integer>0</integer>
	<integer>0</integer>
	<integer>0</integer>
	<integer>0</integer>
  </rpmTag>
  <rpmTag name=\"Filemtimes\">
	<integer>1489670606</integer>
	<integer>1489670606</integer>
	<integer>908894882</integer>
	<integer>908895030</integer>
	<integer>908884468</integer>
  </rpmTag>
  <rpmTag name=\"Filedigests\">
	<string>c89fa87aeb1143969c0b6be9334b21d932f77f74e8f60120b5de316406369cf0</string>
	<string/>
	<string>fac3b28492ecdc16da172a6f1a432ceed356ca4d9248157b2a962b395e37b3b0</string>
	<string>678b87e217a415f05e43460e2c7b668245b412e2b4f18a75aa7399d9774ed0b4</string>
	<string>d63fdc6c986106f57230f217d36b2395d83ecf491d2b7187af714dc8db9629e9</string>
  </rpmTag>
  <rpmTag name=\"Filelinktos\">
	<string/>
	<string/>
	<string/>
	<string/>
	<string/>
  </rpmTag>
  <rpmTag name=\"Fileflags\">
	<integer>0</integer>
	<integer>0</integer>
	<integer>2</integer>
	<integer>2</integer>
	<integer>2</integer>
  </rpmTag>
  <rpmTag name=\"Fileusername\">
	<string>root</string>
	<string>root</string>
	<string>root</string>
	<string>root</string>
	<string>root</string>
  </rpmTag>
  <rpmTag name=\"Filegroupname\">
	<string>root</string>
	<string>root</string>
	<string>root</string>
	<string>root</string>
	<string>root</string>
  </rpmTag>
  <rpmTag name=\"Sourcerpm\">
	<string>hello-2.0-1.src.rpm</string>
  </rpmTag>
  <rpmTag name=\"Fileverifyflags\">
	<integer>4294967295</integer>
	<integer>0</integer>
	<integer>4294967295</integer>
	<integer>4294967295</integer>
	<integer>4294967295</integer>
  </rpmTag>
  <rpmTag name=\"Archivesize\">
	<integer>8060</integer>
  </rpmTag>
  <rpmTag name=\"Providename\">
	<string>hello</string>
	<string>hello(x86-64)</string>
  </rpmTag>
  <rpmTag name=\"Requireflags\">
	<integer>16384</integer>
	<integer>16384</integer>
	<integer>16777226</integer>
	<integer>16777226</integer>
	<integer>16777226</integer>
	<integer>16384</integer>
  </rpmTag>
  <rpmTag name=\"Requirename\">
	<string>libc.so.6()(64bit)</string>
	<string>libc.so.6(GLIBC_2.2.5)(64bit)</string>
	<string>rpmlib(CompressedFileNames)</string>
	<string>rpmlib(FileDigests)</string>
	<string>rpmlib(PayloadFilesHavePrefix)</string>
	<string>rtld(GNU_HASH)</string>
  </rpmTag>
  <rpmTag name=\"Requireversion\">
	<string/>
	<string/>
	<string>3.0.4-1</string>
	<string>4.6.0-1</string>
	<string>4.0-1</string>
	<string/>
  </rpmTag>
  <rpmTag name=\"Rpmversion\">
	<string>4.13.90</string>
  </rpmTag>
  <rpmTag name=\"Changelogtime\">
	<integer>1227355200</integer>
	<integer>908884800</integer>
  </rpmTag>
  <rpmTag name=\"Changelogname\">
	<string>Panu Matilainen &lt;pmatilai@redhat.com&gt;</string>
	<string>Jeff Johnson &lt;jbj@redhat.com&gt;</string>
  </rpmTag>
  <rpmTag name=\"Changelogtext\">
	<string>- updated version</string>
	<string>- create.</string>
  </rpmTag>
  <rpmTag name=\"Filedevices\">
	<integer>1</integer>
	<integer>1</integer>
	<integer>1</integer>
	<integer>1</integer>
	<integer>1</integer>
  </rpmTag>
  <rpmTag name=\"Fileinodes\">
	<integer>1</integer>
	<integer>2</integer>
	<integer>3</integer>
	<integer>4</integer>
	<integer>5</integer>
  </rpmTag>
  <rpmTag name=\"Filelangs\">
	<string/>
	<string/>
	<string/>
	<string/>
	<string/>
  </rpmTag>
  <rpmTag name=\"Prefixes\">
	<string>/usr</string>
  </rpmTag>
  <rpmTag name=\"Provideflags\">
	<integer>8</integer>
	<integer>8</integer>
  </rpmTag>
  <rpmTag name=\"Provideversion\">
	<string>2.0-1</string>
	<string>2.0-1</string>
  </rpmTag>
  <rpmTag name=\"Dirindexes\">
	<integer>0</integer>
	<integer>1</integer>
	<integer>2</integer>
	<integer>2</integer>
	<integer>2</integer>
  </rpmTag>
  <rpmTag name=\"Basenames\">
	<string>hello</string>
	<string>hello-2.0</string>
	<string>COPYING</string>
	<string>FAQ</string>
	<string>README</string>
  </rpmTag>
  <rpmTag name=\"Dirnames\">
	<string>/usr/bin/</string>
	<string>/usr/share/doc/</string>
	<string>/usr/share/doc/hello-2.0/</string>
  </rpmTag>
  <rpmTag name=\"Optflags\">
	<string>-O2 -g -pipe -Wall -Werror=format-security -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches -specs=/usr/lib/rpm/redhat/redhat-hardened-cc1 -m64 -mtune=generic</string>
  </rpmTag>
  <rpmTag name=\"Payloadformat\">
	<string>cpio</string>
  </rpmTag>
  <rpmTag name=\"Payloadcompressor\">
	<string>gzip</string>
  </rpmTag>
  <rpmTag name=\"Payloadflags\">
	<string>9</string>
  </rpmTag>
  <rpmTag name=\"Platform\">
	<string>x86_64-redhat-linux-gnu</string>
  </rpmTag>
  <rpmTag name=\"Filecolors\">
	<integer>2</integer>
	<integer>0</integer>
	<integer>0</integer>
	<integer>0</integer>
	<integer>0</integer>
  </rpmTag>
  <rpmTag name=\"Fileclass\">
	<integer>0</integer>
	<integer>1</integer>
	<integer>2</integer>
	<integer>2</integer>
	<integer>2</integer>
  </rpmTag>
  <rpmTag name=\"Classdict\">
	<string>ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 2.6.32, BuildID[sha1]=775fdcb927e4300adbe83cfacec3cfeb1f63fe17, stripped</string>
	<string>directory</string>
	<string>ASCII text</string>
  </rpmTag>
  <rpmTag name=\"Filedependsx\">
	<integer>0</integer>
	<integer>0</integer>
	<integer>0</integer>
	<integer>0</integer>
	<integer>0</integer>
  </rpmTag>
  <rpmTag name=\"Filedependsn\">
	<integer>3</integer>
	<integer>0</integer>
	<integer>0</integer>
	<integer>0</integer>
	<integer>0</integer>
  </rpmTag>
  <rpmTag name=\"Dependsdict\">
	<integer>1375731713</integer>
	<integer>1375731712</integer>
	<integer>1375731717</integer>
  </rpmTag>
  <rpmTag name=\"Filedigestalgo\">
	<integer>8</integer>
  </rpmTag>
  <rpmTag name=\"Encoding\">
	<string>utf-8</string>
  </rpmTag>
  <rpmTag name=\"Payloaddigest\">
	<string>84a7338287bf19715c4eed0243f5cdb447eeb0ade37b2af718d4060aefca2f7c</string>
  </rpmTag>
  <rpmTag name=\"Payloaddigestalgo\">
	<integer>8</integer>
  </rpmTag>
</rpmHeader>
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:509"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_219
#AT_START_220
at_fn_group_banner 220 'rpmquery.at:807' \
  "query file attribute filtering" "                 " 6
at_xfail=no
(
  $as_echo "220. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:809:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpmbuild -bb --quiet \\
  /data/SPECS/vattrtest.spec

pkg=\"/build/RPMS/noarch/vattrtest-1.0-1.noarch.rpm\"
cmd=\"rpm -qpl\"
for filter in --noconfig --noghost --noartifact -A -c -d -L; do
    echo \${filter}
    runroot \${cmd} \${filter} \${pkg}
done
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:809"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpmbuild -bb --quiet \
  /data/SPECS/vattrtest.spec

pkg="/build/RPMS/noarch/vattrtest-1.0-1.noarch.rpm"
cmd="rpm -qpl"
for filter in --noconfig --noghost --noartifact -A -c -d -L; do
    echo ${filter}
    runroot ${cmd} ${filter} ${pkg}
done

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "--noconfig
/opt/vattrtest
/opt/vattrtest/a
/opt/vattrtest/d
/opt/vattrtest/g
/opt/vattrtest/l
/opt/vattrtest/m
/opt/vattrtest/r
--noghost
/opt/vattrtest
/opt/vattrtest/a
/opt/vattrtest/c
/opt/vattrtest/cn
/opt/vattrtest/d
/opt/vattrtest/l
/opt/vattrtest/m
/opt/vattrtest/r
--noartifact
/opt/vattrtest
/opt/vattrtest/c
/opt/vattrtest/cn
/opt/vattrtest/d
/opt/vattrtest/g
/opt/vattrtest/l
/opt/vattrtest/m
/opt/vattrtest/r
-A
/opt/vattrtest/a
-c
/opt/vattrtest/c
/opt/vattrtest/cn
-d
/opt/vattrtest/d
-L
/opt/vattrtest/l
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:809"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_220
#AT_START_221
at_fn_group_banner 221 'rpmquery.at:862' \
  "formatting name humansi, humaniec" "              " 6
at_xfail=no
(
  $as_echo "221. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:864:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
  --queryformat '%{SIZE:humansi} %{SIZE:humaniec}\\n' \\
  -qp /data/RPMS/hello-1.0-1.i386.rpm
runroot rpm \\
  --queryformat '%{SIZE:humansi} %{SIZE:humaniec}\\n' \\
  -qp /data/RPMS/foo-1.0-1.noarch.rpm
runroot rpm \\
  --queryformat '%{SIZE:humansi} %{SIZE:humaniec}\\n' \\
  -qp /data/SRPMS/foo-1.0-1.src.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:864"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
  --queryformat '%{SIZE:humansi} %{SIZE:humaniec}\n' \
  -qp /data/RPMS/hello-1.0-1.i386.rpm
runroot rpm \
  --queryformat '%{SIZE:humansi} %{SIZE:humaniec}\n' \
  -qp /data/RPMS/foo-1.0-1.noarch.rpm
runroot rpm \
  --queryformat '%{SIZE:humansi} %{SIZE:humaniec}\n' \
  -qp /data/SRPMS/foo-1.0-1.src.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "2.9K 2.8K
0 0
355 355
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:864"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_221
#AT_START_222
at_fn_group_banner 222 'rpmquery.at:885' \
  "incomplete escape sequence for format query" "    " 6
at_xfail=no
(
  $as_echo "222. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmquery.at:887:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
  --queryformat='%{NAME}\\n\\' \\
  -qp /data/RPMS/foo-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmquery.at:887"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
  --queryformat='%{NAME}\n\' \
  -qp /data/RPMS/foo-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: incorrect format: escaped char expected after \\
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:887"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_222
#AT_START_223
at_fn_group_banner 223 'rpmquery.at:900' \
  "query format iteration" "                         " 6
at_xfail=no
(
  $as_echo "223. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


{ set +x
$as_echo "$at_srcdir/rpmquery.at:904:
runroot rpmspec -q --qf \"[%{*:tagnum}\\n]\" --srpm /data/SPECS/mini.spec
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmquery.at:904"
( $at_check_trace;
runroot rpmspec -q --qf "[%{*:tagnum}\n]" --srpm /data/SPECS/mini.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "100
1000
1001
1002
1004
1005
1014
1016
1021
1022
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:904"
$at_failed && at_fn_log_failure
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/rpmquery.at:921:
runroot rpmspec -q --qf \"[%{*:tagname}\\n]\" --srpm /data/SPECS/mini.spec
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmquery.at:921"
( $at_check_trace;
runroot rpmspec -q --qf "[%{*:tagname}\n]" --srpm /data/SPECS/mini.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "Headeri18ntable
Name
Version
Release
Summary
Description
License
Group
Os
Arch
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmquery.at:921"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_223
#AT_START_224
at_fn_group_banner 224 'rpmspec.at:12' \
  "rpmspec --query Requires" "                       " 7
at_xfail=no
(
  $as_echo "224. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmspec.at:14:
runroot rpmspec --query \\
  --qf '[%{REQUIRENAME} %{REQUIREFLAGS:hex}\\n]' \\
  /data/SPECS/test-parsebits.spec
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmspec.at:14"
( $at_check_trace;
runroot rpmspec --query \
  --qf '[%{REQUIRENAME} %{REQUIREFLAGS:hex}\n]' \
  /data/SPECS/test-parsebits.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "good.0.1 0
good.0.2 8
good.1.1 104
good.19.1 1003fa0
good.2.1 80c
good.3.1 202
good.34.1 120a
good.4.1 100a
good.5.1 400
good.6.1 1000008
good.7.1 2004
good.8.1 8c
good.9.1 22
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmspec.at:14"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_224
#AT_START_225
at_fn_group_banner 225 'rpmspec.at:37' \
  "rpmspec --query Requires(,)" "                    " 7
at_xfail=no
(
  $as_echo "225. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmspec.at:39:
runroot rpmspec --query \\
  --define 'extra Requires(,): bad' \\
  --qf '[%{REQUIRENAME} %{REQUIREFLAGS:hex} %{REQUIREVERSION}\\n]' \\
  /data/SPECS/test-parsebits.spec
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmspec.at:39"
( $at_check_trace;
runroot rpmspec --query \
  --define 'extra Requires(,): bad' \
  --qf '[%{REQUIRENAME} %{REQUIREFLAGS:hex} %{REQUIREVERSION}\n]' \
  /data/SPECS/test-parsebits.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: line 9: Bad Requirename: qualifiers: Requires(,): bad
error: query of specfile /data/SPECS/test-parsebits.spec failed, can't parse
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmspec.at:39"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_225
#AT_START_226
at_fn_group_banner 226 'rpmspec.at:52' \
  "rpmspec --query Requires(;)" "                    " 7
at_xfail=no
(
  $as_echo "226. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmspec.at:54:
runroot rpmspec --query \\
  --define 'extra Requires(;): bad' \\
  --qf '[%{REQUIRENAME} %{REQUIREFLAGS:hex} %{REQUIREVERSION}\\n]' \\
  /data/SPECS/test-parsebits.spec
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmspec.at:54"
( $at_check_trace;
runroot rpmspec --query \
  --define 'extra Requires(;): bad' \
  --qf '[%{REQUIRENAME} %{REQUIREFLAGS:hex} %{REQUIREVERSION}\n]' \
  /data/SPECS/test-parsebits.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: line 9: Bad Requirename: qualifiers: Requires(;): bad
error: query of specfile /data/SPECS/test-parsebits.spec failed, can't parse
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmspec.at:54"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_226
#AT_START_227
at_fn_group_banner 227 'rpmspec.at:67' \
  "rpmspec --query Requires(junk)" "                 " 7
at_xfail=no
(
  $as_echo "227. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmspec.at:69:
runroot rpmspec --query \\
  --define 'extra Requires(junk): bad' \\
  --qf '[%{REQUIRENAME} %{REQUIREFLAGS:hex} %{REQUIREVERSION}\\n]' \\
  /data/SPECS/test-parsebits.spec
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmspec.at:69"
( $at_check_trace;
runroot rpmspec --query \
  --define 'extra Requires(junk): bad' \
  --qf '[%{REQUIRENAME} %{REQUIREFLAGS:hex} %{REQUIREVERSION}\n]' \
  /data/SPECS/test-parsebits.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: line 9: Bad Requirename: qualifiers: Requires(junk): bad
error: query of specfile /data/SPECS/test-parsebits.spec failed, can't parse
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmspec.at:69"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_227
#AT_START_228
at_fn_group_banner 228 'rpmspec.at:82' \
  "rpmspec --query Requires(pre,junk)" "             " 7
at_xfail=no
(
  $as_echo "228. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmspec.at:84:
runroot rpmspec --query \\
  --define 'extra Requires(pre,junk): bad' \\
  --qf '[%{REQUIRENAME} %{REQUIREFLAGS:hex} %{REQUIREVERSION}\\n]' \\
  /data/SPECS/test-parsebits.spec
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmspec.at:84"
( $at_check_trace;
runroot rpmspec --query \
  --define 'extra Requires(pre,junk): bad' \
  --qf '[%{REQUIRENAME} %{REQUIREFLAGS:hex} %{REQUIREVERSION}\n]' \
  /data/SPECS/test-parsebits.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: line 9: Bad Requirename: qualifiers: Requires(pre,junk): bad
error: query of specfile /data/SPECS/test-parsebits.spec failed, can't parse
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmspec.at:84"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_228
#AT_START_229
at_fn_group_banner 229 'rpmspec.at:97' \
  "rpmspec --query Requires(junk,pre)" "             " 7
at_xfail=no
(
  $as_echo "229. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmspec.at:99:
runroot rpmspec --query \\
  --define 'extra Requires(junk,pre): bad' \\
  --qf '[%{REQUIRENAME} %{REQUIREFLAGS:hex} %{REQUIREVERSION}\\n]' \\
  /data/SPECS/test-parsebits.spec
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmspec.at:99"
( $at_check_trace;
runroot rpmspec --query \
  --define 'extra Requires(junk,pre): bad' \
  --qf '[%{REQUIRENAME} %{REQUIREFLAGS:hex} %{REQUIREVERSION}\n]' \
  /data/SPECS/test-parsebits.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: line 9: Bad Requirename: qualifiers: Requires(junk,pre): bad
error: query of specfile /data/SPECS/test-parsebits.spec failed, can't parse
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmspec.at:99"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_229
#AT_START_230
at_fn_group_banner 230 'rpmspec.at:112' \
  "rpmspec --query Requires(,pre)" "                 " 7
at_xfail=no
(
  $as_echo "230. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmspec.at:114:
runroot rpmspec --query \\
  --define 'extra Requires(,pre): bad' \\
  --qf '[%{REQUIRENAME} %{REQUIREFLAGS:hex} %{REQUIREVERSION}\\n]' \\
  /data/SPECS/test-parsebits.spec
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmspec.at:114"
( $at_check_trace;
runroot rpmspec --query \
  --define 'extra Requires(,pre): bad' \
  --qf '[%{REQUIRENAME} %{REQUIREFLAGS:hex} %{REQUIREVERSION}\n]' \
  /data/SPECS/test-parsebits.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: line 9: Bad Requirename: qualifiers: Requires(,pre): bad
error: query of specfile /data/SPECS/test-parsebits.spec failed, can't parse
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmspec.at:114"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_230
#AT_START_231
at_fn_group_banner 231 'rpmspec.at:127' \
  "rpmspec --query Requires(pre,)" "                 " 7
at_xfail=no
(
  $as_echo "231. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmspec.at:129:
runroot rpmspec --query \\
  --define 'extra Requires(pre,): bad' \\
  --qf '[%{REQUIRENAME} %{REQUIREFLAGS:hex} %{REQUIREVERSION}\\n]' \\
  /data/SPECS/test-parsebits.spec
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmspec.at:129"
( $at_check_trace;
runroot rpmspec --query \
  --define 'extra Requires(pre,): bad' \
  --qf '[%{REQUIRENAME} %{REQUIREFLAGS:hex} %{REQUIREVERSION}\n]' \
  /data/SPECS/test-parsebits.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: line 9: Bad Requirename: qualifiers: Requires(pre,): bad
error: query of specfile /data/SPECS/test-parsebits.spec failed, can't parse
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmspec.at:129"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_231
#AT_START_232
at_fn_group_banner 232 'rpmspec.at:142' \
  "rpmspec --query Requires(pre,,postun)" "          " 7
at_xfail=no
(
  $as_echo "232. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmspec.at:144:
runroot rpmspec --query \\
  --define 'extra Requires(pre,,postun): bad' \\
  --qf '[%{REQUIRENAME} %{REQUIREFLAGS:hex} %{REQUIREVERSION}\\n]' \\
  /data/SPECS/test-parsebits.spec
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmspec.at:144"
( $at_check_trace;
runroot rpmspec --query \
  --define 'extra Requires(pre,,postun): bad' \
  --qf '[%{REQUIRENAME} %{REQUIREFLAGS:hex} %{REQUIREVERSION}\n]' \
  /data/SPECS/test-parsebits.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: line 9: Bad Requirename: qualifiers: Requires(pre,,postun): bad
error: query of specfile /data/SPECS/test-parsebits.spec failed, can't parse
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmspec.at:144"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_232
#AT_START_233
at_fn_group_banner 233 'rpmspec.at:157' \
  "rpmspec --query Requires(pre,,junk)" "            " 7
at_xfail=no
(
  $as_echo "233. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmspec.at:159:
runroot rpmspec --query \\
  --define 'extra Requires(pre,,junk): bad' \\
  --qf '[%{REQUIRENAME} %{REQUIREFLAGS:hex} %{REQUIREVERSION}\\n]' \\
  /data/SPECS/test-parsebits.spec
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmspec.at:159"
( $at_check_trace;
runroot rpmspec --query \
  --define 'extra Requires(pre,,junk): bad' \
  --qf '[%{REQUIRENAME} %{REQUIREFLAGS:hex} %{REQUIREVERSION}\n]' \
  /data/SPECS/test-parsebits.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: line 9: Bad Requirename: qualifiers: Requires(pre,,junk): bad
error: query of specfile /data/SPECS/test-parsebits.spec failed, can't parse
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmspec.at:159"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_233
#AT_START_234
at_fn_group_banner 234 'rpmspec.at:172' \
  "rpmspec --query Requires(;pre)" "                 " 7
at_xfail=no
(
  $as_echo "234. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmspec.at:174:
runroot rpmspec --query \\
  --define 'extra Requires(;pre): bad' \\
  --qf '[%{REQUIRENAME} %{REQUIREFLAGS:hex} %{REQUIREVERSION}\\n]' \\
  /data/SPECS/test-parsebits.spec
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmspec.at:174"
( $at_check_trace;
runroot rpmspec --query \
  --define 'extra Requires(;pre): bad' \
  --qf '[%{REQUIRENAME} %{REQUIREFLAGS:hex} %{REQUIREVERSION}\n]' \
  /data/SPECS/test-parsebits.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: line 9: Bad Requirename: qualifiers: Requires(;pre): bad
error: query of specfile /data/SPECS/test-parsebits.spec failed, can't parse
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmspec.at:174"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_234
#AT_START_235
at_fn_group_banner 235 'rpmspec.at:187' \
  "rpmspec --query Requires(pre;)" "                 " 7
at_xfail=no
(
  $as_echo "235. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmspec.at:189:
runroot rpmspec --query \\
  --define 'extra Requires(pre;): bad' \\
  --qf '[%{REQUIRENAME} %{REQUIREFLAGS:hex} %{REQUIREVERSION}\\n]' \\
  /data/SPECS/test-parsebits.spec
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmspec.at:189"
( $at_check_trace;
runroot rpmspec --query \
  --define 'extra Requires(pre;): bad' \
  --qf '[%{REQUIRENAME} %{REQUIREFLAGS:hex} %{REQUIREVERSION}\n]' \
  /data/SPECS/test-parsebits.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: line 9: Bad Requirename: qualifiers: Requires(pre;): bad
error: query of specfile /data/SPECS/test-parsebits.spec failed, can't parse
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmspec.at:189"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_235
#AT_START_236
at_fn_group_banner 236 'rpmspec.at:202' \
  "rpmspec --query Requires(pre;postun)" "           " 7
at_xfail=no
(
  $as_echo "236. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmspec.at:204:
runroot rpmspec --query \\
  --define 'extra Requires(pre;postun): bad' \\
  --qf '[%{REQUIRENAME} %{REQUIREFLAGS:hex} %{REQUIREVERSION}\\n]' \\
  /data/SPECS/test-parsebits.spec
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmspec.at:204"
( $at_check_trace;
runroot rpmspec --query \
  --define 'extra Requires(pre;postun): bad' \
  --qf '[%{REQUIRENAME} %{REQUIREFLAGS:hex} %{REQUIREVERSION}\n]' \
  /data/SPECS/test-parsebits.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: line 9: Bad Requirename: qualifiers: Requires(pre;postun): bad
error: query of specfile /data/SPECS/test-parsebits.spec failed, can't parse
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmspec.at:204"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_236
#AT_START_237
at_fn_group_banner 237 'rpmspec.at:217' \
  "rpmspec --query Requires(pre;junk)" "             " 7
at_xfail=no
(
  $as_echo "237. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmspec.at:219:
runroot rpmspec --query \\
  --define 'extra Requires(pre;junk): bad' \\
  --qf '[%{REQUIRENAME} %{REQUIREFLAGS:hex} %{REQUIREVERSION}\\n]' \\
  /data/SPECS/test-parsebits.spec
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmspec.at:219"
( $at_check_trace;
runroot rpmspec --query \
  --define 'extra Requires(pre;junk): bad' \
  --qf '[%{REQUIRENAME} %{REQUIREFLAGS:hex} %{REQUIREVERSION}\n]' \
  /data/SPECS/test-parsebits.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: line 9: Bad Requirename: qualifiers: Requires(pre;junk): bad
error: query of specfile /data/SPECS/test-parsebits.spec failed, can't parse
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmspec.at:219"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_237
#AT_START_238
at_fn_group_banner 238 'rpmspec.at:232' \
  "rpmspec --parse" "                                " 7
at_xfail=no
(
  $as_echo "238. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmspec.at:234: runroot rpmspec --parse /data/SPECS/foo.spec"
at_fn_check_prepare_trace "rpmspec.at:234"
( $at_check_trace; runroot rpmspec --parse /data/SPECS/foo.spec
) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "

Summary: foo
Name: foo
Version: 1.0
Release: 1
Source: hello-2.0.tar.gz
Patch1: hello-1.0-modernize.patch
Group: Testing
License: GPLv2+
BuildArch: noarch

%description
Simple rpm demonstration.

%package sub
Summary: foo
Requires: foo = 1.0-1

%description sub
foo

%package bus
Summary: foo
Requires: foo = 1.0-1

%description bus
foo

%files

%files sub

" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmspec.at:234"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_238
#AT_START_239
at_fn_group_banner 239 'rpmspec.at:273' \
  "rpmspec --srpm provides" "                        " 7
at_xfail=no
(
  $as_echo "239. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmspec.at:275:
runroot rpmspec -q --srpm --provides /data/SPECS/foo.spec
runroot rpmspec -q --srpm --provides --with bus /data/SPECS/foo.spec
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmspec.at:275"
( $at_check_trace;
runroot rpmspec -q --srpm --provides /data/SPECS/foo.spec
runroot rpmspec -q --srpm --provides --with bus /data/SPECS/foo.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo = 1.0-1
foo-sub = 1.0-1
foo = 1.0-1
foo-sub = 1.0-1
foo-bus = 1.0-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmspec.at:275"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_239
#AT_START_240
at_fn_group_banner 240 'rpmvfylevel.at:3' \
  "rpmkeys -K <unsigned 1> verifylevel" "            " 8
at_xfail=no
(
  $as_echo "240. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvfylevel.at:5:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


for lvl in none digest signature all; do
    echo \"LEVEL \${lvl}\"
    for dis in \"\" \"--nodigest\" \"--nosignature\" \"--nodigest --nosignature\"; do
	    echo \"\${dis}\"
	    runroot rpmkeys -K \${dis} \\
		--define \"_pkgverify_level \${lvl}\" \\
		/data/RPMS/hello-2.0-1.x86_64.rpm; echo \$?
    done
done
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmvfylevel.at:5"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


for lvl in none digest signature all; do
    echo "LEVEL ${lvl}"
    for dis in "" "--nodigest" "--nosignature" "--nodigest --nosignature"; do
	    echo "${dis}"
	    runroot rpmkeys -K ${dis} \
		--define "_pkgverify_level ${lvl}" \
		/data/RPMS/hello-2.0-1.x86_64.rpm; echo $?
    done
done

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "LEVEL none

/data/RPMS/hello-2.0-1.x86_64.rpm: digests OK
0
--nodigest
/data/RPMS/hello-2.0-1.x86_64.rpm: OK
0
--nosignature
/data/RPMS/hello-2.0-1.x86_64.rpm: digests OK
0
--nodigest --nosignature
/data/RPMS/hello-2.0-1.x86_64.rpm: OK
0
LEVEL digest

/data/RPMS/hello-2.0-1.x86_64.rpm: digests OK
0
--nodigest
/data/RPMS/hello-2.0-1.x86_64.rpm: OK
0
--nosignature
/data/RPMS/hello-2.0-1.x86_64.rpm: digests OK
0
--nodigest --nosignature
/data/RPMS/hello-2.0-1.x86_64.rpm: OK
0
LEVEL signature

/data/RPMS/hello-2.0-1.x86_64.rpm: digests SIGNATURES NOT OK
1
--nodigest
/data/RPMS/hello-2.0-1.x86_64.rpm: SIGNATURES NOT OK
1
--nosignature
/data/RPMS/hello-2.0-1.x86_64.rpm: digests OK
0
--nodigest --nosignature
/data/RPMS/hello-2.0-1.x86_64.rpm: OK
0
LEVEL all

/data/RPMS/hello-2.0-1.x86_64.rpm: digests SIGNATURES NOT OK
1
--nodigest
/data/RPMS/hello-2.0-1.x86_64.rpm: SIGNATURES NOT OK
1
--nosignature
/data/RPMS/hello-2.0-1.x86_64.rpm: digests OK
0
--nodigest --nosignature
/data/RPMS/hello-2.0-1.x86_64.rpm: OK
0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvfylevel.at:5"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_240
#AT_START_241
at_fn_group_banner 241 'rpmvfylevel.at:75' \
  "rpmkeys -K <unsigned 2> verifylevel" "            " 8
at_xfail=no
(
  $as_echo "241. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvfylevel.at:77:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


nomd5=\"0x20000\"
nopld=\"0x10000\"
nopl=\"0x30000\"
nosha1=\"0x100\"
nosha2=\"0x200\"
nosha=\"0x300\"
nohdr=\"0x20300\"

lvl=\"digest\"
for dis in nomd5 nopld nopl nosha1 nosha2 nosha nohdr; do
    vsf=\"\$(eval echo \\\$\${dis})\"
    echo \${dis}
    runroot rpmkeys -Kv \\
	--define \"_pkgverify_level \${lvl}\" \\
	--define \"_pkgverify_flags \${vsf}\" \\
	/data/RPMS/hello-2.0-1.x86_64.rpm; echo \$?
done
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmvfylevel.at:77"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


nomd5="0x20000"
nopld="0x10000"
nopl="0x30000"
nosha1="0x100"
nosha2="0x200"
nosha="0x300"
nohdr="0x20300"

lvl="digest"
for dis in nomd5 nopld nopl nosha1 nosha2 nosha nohdr; do
    vsf="$(eval echo \$${dis})"
    echo ${dis}
    runroot rpmkeys -Kv \
	--define "_pkgverify_level ${lvl}" \
	--define "_pkgverify_flags ${vsf}" \
	/data/RPMS/hello-2.0-1.x86_64.rpm; echo $?
done

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "nomd5
/data/RPMS/hello-2.0-1.x86_64.rpm:
    Header SHA256 digest: OK
    Header SHA1 digest: OK
    Payload SHA256 digest: OK
0
nopld
/data/RPMS/hello-2.0-1.x86_64.rpm:
    Header SHA256 digest: OK
    Header SHA1 digest: OK
    MD5 digest: OK
0
nopl
/data/RPMS/hello-2.0-1.x86_64.rpm:
    Header SHA256 digest: OK
    Header SHA1 digest: OK
    Payload SHA256 digest: NOTFOUND
    Payload SHA256 ALT digest: NOTFOUND
    MD5 digest: NOTFOUND
1
nosha1
/data/RPMS/hello-2.0-1.x86_64.rpm:
    Header SHA256 digest: OK
    Payload SHA256 digest: OK
    MD5 digest: OK
0
nosha2
/data/RPMS/hello-2.0-1.x86_64.rpm:
    Header SHA1 digest: OK
    Payload SHA256 digest: OK
    MD5 digest: OK
0
nosha
/data/RPMS/hello-2.0-1.x86_64.rpm:
    Payload SHA256 digest: OK
    MD5 digest: OK
0
nohdr
/data/RPMS/hello-2.0-1.x86_64.rpm:
    Header SHA256 digest: NOTFOUND
    Header SHA1 digest: NOTFOUND
    Payload SHA256 digest: OK
    MD5 digest: NOTFOUND
1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvfylevel.at:77"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_241
#AT_START_242
at_fn_group_banner 242 'rpmvfylevel.at:147' \
  "rpmkeys -K <signed 1> verifylevel" "              " 8
at_xfail=no
(
  $as_echo "242. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvfylevel.at:149:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


for lvl in none digest signature all; do
    echo \"LEVEL \${lvl}\"
    for dis in \"\" \"--nodigest\" \"--nosignature\" \"--nodigest --nosignature\"; do
	    echo \"\${dis}\"
	    runroot rpmkeys -K \${dis} \\
		--define \"_pkgverify_level \${lvl}\" \\
		/data/RPMS/hello-2.0-1.x86_64-signed.rpm; echo \$?
    done
done
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmvfylevel.at:149"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


for lvl in none digest signature all; do
    echo "LEVEL ${lvl}"
    for dis in "" "--nodigest" "--nosignature" "--nodigest --nosignature"; do
	    echo "${dis}"
	    runroot rpmkeys -K ${dis} \
		--define "_pkgverify_level ${lvl}" \
		/data/RPMS/hello-2.0-1.x86_64-signed.rpm; echo $?
    done
done

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "LEVEL none

/data/RPMS/hello-2.0-1.x86_64-signed.rpm: digests SIGNATURES NOT OK
1
--nodigest
/data/RPMS/hello-2.0-1.x86_64-signed.rpm: SIGNATURES NOT OK
1
--nosignature
/data/RPMS/hello-2.0-1.x86_64-signed.rpm: digests OK
0
--nodigest --nosignature
/data/RPMS/hello-2.0-1.x86_64-signed.rpm: OK
0
LEVEL digest

/data/RPMS/hello-2.0-1.x86_64-signed.rpm: digests SIGNATURES NOT OK
1
--nodigest
/data/RPMS/hello-2.0-1.x86_64-signed.rpm: SIGNATURES NOT OK
1
--nosignature
/data/RPMS/hello-2.0-1.x86_64-signed.rpm: digests OK
0
--nodigest --nosignature
/data/RPMS/hello-2.0-1.x86_64-signed.rpm: OK
0
LEVEL signature

/data/RPMS/hello-2.0-1.x86_64-signed.rpm: digests SIGNATURES NOT OK
1
--nodigest
/data/RPMS/hello-2.0-1.x86_64-signed.rpm: SIGNATURES NOT OK
1
--nosignature
/data/RPMS/hello-2.0-1.x86_64-signed.rpm: digests OK
0
--nodigest --nosignature
/data/RPMS/hello-2.0-1.x86_64-signed.rpm: OK
0
LEVEL all

/data/RPMS/hello-2.0-1.x86_64-signed.rpm: digests SIGNATURES NOT OK
1
--nodigest
/data/RPMS/hello-2.0-1.x86_64-signed.rpm: SIGNATURES NOT OK
1
--nosignature
/data/RPMS/hello-2.0-1.x86_64-signed.rpm: digests OK
0
--nodigest --nosignature
/data/RPMS/hello-2.0-1.x86_64-signed.rpm: OK
0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvfylevel.at:149"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_242
#AT_START_243
at_fn_group_banner 243 'rpmvfylevel.at:219' \
  "rpmkeys -K <signed 2> verifylevel" "              " 8
at_xfail=no
(
  $as_echo "243. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvfylevel.at:221:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmkeys --import /data/keys/rpm.org-rsa-2048-test.pub
for lvl in none digest signature all; do
    echo \"LEVEL \${lvl}\"
    for dis in \"\" \"--nodigest\" \"--nosignature\" \"--nodigest --nosignature\"; do
	    echo \"\${dis}\"
	    runroot rpmkeys -K \${dis} \\
		--define \"_pkgverify_level \${lvl}\" \\
		/data/RPMS/hello-2.0-1.x86_64-signed.rpm; echo \$?
    done
done
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmvfylevel.at:221"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmkeys --import /data/keys/rpm.org-rsa-2048-test.pub
for lvl in none digest signature all; do
    echo "LEVEL ${lvl}"
    for dis in "" "--nodigest" "--nosignature" "--nodigest --nosignature"; do
	    echo "${dis}"
	    runroot rpmkeys -K ${dis} \
		--define "_pkgverify_level ${lvl}" \
		/data/RPMS/hello-2.0-1.x86_64-signed.rpm; echo $?
    done
done

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "LEVEL none

/data/RPMS/hello-2.0-1.x86_64-signed.rpm: digests signatures OK
0
--nodigest
/data/RPMS/hello-2.0-1.x86_64-signed.rpm: signatures OK
0
--nosignature
/data/RPMS/hello-2.0-1.x86_64-signed.rpm: digests OK
0
--nodigest --nosignature
/data/RPMS/hello-2.0-1.x86_64-signed.rpm: OK
0
LEVEL digest

/data/RPMS/hello-2.0-1.x86_64-signed.rpm: digests signatures OK
0
--nodigest
/data/RPMS/hello-2.0-1.x86_64-signed.rpm: signatures OK
0
--nosignature
/data/RPMS/hello-2.0-1.x86_64-signed.rpm: digests OK
0
--nodigest --nosignature
/data/RPMS/hello-2.0-1.x86_64-signed.rpm: OK
0
LEVEL signature

/data/RPMS/hello-2.0-1.x86_64-signed.rpm: digests signatures OK
0
--nodigest
/data/RPMS/hello-2.0-1.x86_64-signed.rpm: signatures OK
0
--nosignature
/data/RPMS/hello-2.0-1.x86_64-signed.rpm: digests OK
0
--nodigest --nosignature
/data/RPMS/hello-2.0-1.x86_64-signed.rpm: OK
0
LEVEL all

/data/RPMS/hello-2.0-1.x86_64-signed.rpm: digests signatures OK
0
--nodigest
/data/RPMS/hello-2.0-1.x86_64-signed.rpm: signatures OK
0
--nosignature
/data/RPMS/hello-2.0-1.x86_64-signed.rpm: digests OK
0
--nodigest --nosignature
/data/RPMS/hello-2.0-1.x86_64-signed.rpm: OK
0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvfylevel.at:221"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_243
#AT_START_244
at_fn_group_banner 244 'rpmvfylevel.at:292' \
  "rpmkeys -K <signed 3> verifylevel" "              " 8
at_xfail=no
(
  $as_echo "244. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmvfylevel.at:294:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


nomd5=\"0x20000\"
nopld=\"0x10000\"
nopl=\"0x30000\"

nopls=\"0xc0000\"
noplds=\"0xd0000\"
nohdrs=\"0x00c00\"
nosig=\"0xc0c00\"

runroot rpmkeys --import /data/keys/rpm.org-rsa-2048-test.pub
lvl=\"all\"
for dis in nopls noplds nohdrs nosig; do
    vsf=\"\$(eval echo \\\$\${dis})\"
    echo \${dis}
    runroot rpmkeys -Kv \\
	--define \"_pkgverify_level \${lvl}\" \\
	--define \"_pkgverify_flags \${vsf}\" \\
	/data/RPMS/hello-2.0-1.x86_64-signed.rpm; echo \$?
done
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmvfylevel.at:294"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


nomd5="0x20000"
nopld="0x10000"
nopl="0x30000"

nopls="0xc0000"
noplds="0xd0000"
nohdrs="0x00c00"
nosig="0xc0c00"

runroot rpmkeys --import /data/keys/rpm.org-rsa-2048-test.pub
lvl="all"
for dis in nopls noplds nohdrs nosig; do
    vsf="$(eval echo \$${dis})"
    echo ${dis}
    runroot rpmkeys -Kv \
	--define "_pkgverify_level ${lvl}" \
	--define "_pkgverify_flags ${vsf}" \
	/data/RPMS/hello-2.0-1.x86_64-signed.rpm; echo $?
done

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "nopls
/data/RPMS/hello-2.0-1.x86_64-signed.rpm:
    Header V4 RSA/SHA256 Signature, key ID 1964c5fc: OK
    Header SHA256 digest: OK
    Header SHA1 digest: OK
    Payload SHA256 digest: OK
    MD5 digest: OK
0
noplds
/data/RPMS/hello-2.0-1.x86_64-signed.rpm:
    Header V4 RSA/SHA256 Signature, key ID 1964c5fc: OK
    Header SHA256 digest: OK
    Header SHA1 digest: OK
    Payload SHA256 digest: NOTFOUND
    Payload SHA256 ALT digest: NOTFOUND
    RSA signature: NOTFOUND
    DSA signature: NOTFOUND
    MD5 digest: OK
1
nohdrs
/data/RPMS/hello-2.0-1.x86_64-signed.rpm:
    Header SHA256 digest: OK
    Header SHA1 digest: OK
    Payload SHA256 digest: OK
    V4 RSA/SHA256 Signature, key ID 1964c5fc: OK
    MD5 digest: OK
0
nosig
/data/RPMS/hello-2.0-1.x86_64-signed.rpm:
    Header RSA signature: NOTFOUND
    Header DSA signature: NOTFOUND
    Header SHA256 digest: OK
    Header SHA1 digest: OK
    Payload SHA256 digest: OK
    RSA signature: NOTFOUND
    DSA signature: NOTFOUND
    MD5 digest: OK
1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmvfylevel.at:294"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_244
#AT_START_245
at_fn_group_banner 245 'rpmsigdig.at:7' \
  "rpmkeys -Kv <unsigned> 1" "                       " 9
at_xfail=no
(
  $as_echo "245. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmsigdig.at:9:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmkeys -Kv /data/RPMS/hello-2.0-1.x86_64.rpm /data/RPMS/hello-1.0-1.i386.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmsigdig.at:9"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmkeys -Kv /data/RPMS/hello-2.0-1.x86_64.rpm /data/RPMS/hello-1.0-1.i386.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "/data/RPMS/hello-2.0-1.x86_64.rpm:
    Header SHA256 digest: OK
    Header SHA1 digest: OK
    Payload SHA256 digest: OK
    MD5 digest: OK
/data/RPMS/hello-1.0-1.i386.rpm:
    Header SHA1 digest: OK
    MD5 digest: OK
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmsigdig.at:9"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_245
#AT_START_246
at_fn_group_banner 246 'rpmsigdig.at:27' \
  "rpmkeys -Kv <reconstructed> 1" "                  " 9
at_xfail=no
(
  $as_echo "246. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmsigdig.at:29:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


cp \"\${RPMTEST}\"/data/misc/hello.intro \"\${RPMTEST}\"/data/misc/hello.payload .
gzip -cd < hello.payload > hello.uc-payload
cat hello.intro hello.payload > \"\${RPMTEST}\"/tmp/hello-c.rpm
cat hello.intro hello.uc-payload > \"\${RPMTEST}\"/tmp/hello-uc.rpm
runroot rpmkeys -Kv /tmp/hello-c.rpm /tmp/hello-uc.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmsigdig.at:29"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


cp "${RPMTEST}"/data/misc/hello.intro "${RPMTEST}"/data/misc/hello.payload .
gzip -cd < hello.payload > hello.uc-payload
cat hello.intro hello.payload > "${RPMTEST}"/tmp/hello-c.rpm
cat hello.intro hello.uc-payload > "${RPMTEST}"/tmp/hello-uc.rpm
runroot rpmkeys -Kv /tmp/hello-c.rpm /tmp/hello-uc.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "/tmp/hello-c.rpm:
    Header SHA256 digest: OK
    Header SHA1 digest: OK
    Payload SHA256 digest: OK
    MD5 digest: OK
/tmp/hello-uc.rpm:
    Header SHA256 digest: OK
    Header SHA1 digest: OK
    Payload SHA256 ALT digest: OK
    MD5 digest: BAD (Expected 055607c4dee6464b9415ae726e7d81a7 != 839d24c30e5188e0b83599fbe3865919)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmsigdig.at:29"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_246
#AT_START_247
at_fn_group_banner 247 'rpmsigdig.at:55' \
  "rpmkeys -Kv <corrupted unsigned> 1" "             " 9
at_xfail=no
(
  $as_echo "247. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmsigdig.at:57:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


pkg=\"hello-2.0-1.x86_64.rpm\"
cp \"\${RPMTEST}\"/data/RPMS/\${pkg} \"\${RPMTEST}\"/tmp/\${pkg}
# conv=notrunc bs=1 seek=261 count=6 2> /dev/null
dd if=/dev/zero of=\"\${RPMTEST}\"/tmp/\${pkg} \\
   conv=notrunc bs=1 seek=333 count=4 2> /dev/null
runroot rpmkeys -Kv /tmp/\${pkg}
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmsigdig.at:57"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


pkg="hello-2.0-1.x86_64.rpm"
cp "${RPMTEST}"/data/RPMS/${pkg} "${RPMTEST}"/tmp/${pkg}
# conv=notrunc bs=1 seek=261 count=6 2> /dev/null
dd if=/dev/zero of="${RPMTEST}"/tmp/${pkg} \
   conv=notrunc bs=1 seek=333 count=4 2> /dev/null
runroot rpmkeys -Kv /tmp/${pkg}

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "/tmp/hello-2.0-1.x86_64.rpm:
    Header SHA256 digest: OK
    Header SHA1 digest: OK
    Payload SHA256 digest: OK
    MD5 digest: BAD (Expected 007ca1d8b35cca02a1854ba301c5432e != 137ca1d8b35cca02a1854ba301c5432e)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmsigdig.at:57"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_247
#AT_START_248
at_fn_group_banner 248 'rpmsigdig.at:78' \
  "rpmkeys -Kv <corrupted unsigned> 2" "             " 9
at_xfail=no
(
  $as_echo "248. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmsigdig.at:80:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


pkg=\"hello-2.0-1.x86_64.rpm\"
cp \"\${RPMTEST}\"/data/RPMS/\${pkg} \"\${RPMTEST}\"/tmp/\${pkg}
dd if=/dev/zero of=\"\${RPMTEST}\"/tmp/\${pkg} \\
   conv=notrunc bs=1 seek=5555 count=6 2> /dev/null
runroot rpmkeys -Kv /tmp/\${pkg}
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmsigdig.at:80"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


pkg="hello-2.0-1.x86_64.rpm"
cp "${RPMTEST}"/data/RPMS/${pkg} "${RPMTEST}"/tmp/${pkg}
dd if=/dev/zero of="${RPMTEST}"/tmp/${pkg} \
   conv=notrunc bs=1 seek=5555 count=6 2> /dev/null
runroot rpmkeys -Kv /tmp/${pkg}

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "/tmp/hello-2.0-1.x86_64.rpm:
    Header SHA256 digest: BAD (Expected ef920781af3bf072ae9888eec3de1c589143101dff9cc0b561468d395fb766d9 != 29fdfe92782fb0470a9a164a6c94af87d3b138c63b39d4c30e0223ca1202ba82)
    Header SHA1 digest: BAD (Expected 5cd9874c510b67b44483f9e382a1649ef7743bac != 4261b2c1eb861a4152c2239bce20bfbcaa8971ba)
    Payload SHA256 digest: OK
    MD5 digest: BAD (Expected 137ca1d8b35cca02a1854ba301c5432e != de65519eeb4ab52eb076ec054d42e34e)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmsigdig.at:80"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_248
#AT_START_249
at_fn_group_banner 249 'rpmsigdig.at:101' \
  "rpmkeys -Kv <corrupted unsigned> 3" "             " 9
at_xfail=no
(
  $as_echo "249. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmsigdig.at:103:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


pkg=\"hello-2.0-1.x86_64.rpm\"
cp \"\${RPMTEST}\"/data/RPMS/\${pkg} \"\${RPMTEST}\"/tmp/\${pkg}
dd if=/dev/zero of=\"\${RPMTEST}\"/tmp/\${pkg} \\
   conv=notrunc bs=1 seek=7777 count=6 2> /dev/null
runroot rpmkeys -Kv /tmp/\${pkg}
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmsigdig.at:103"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


pkg="hello-2.0-1.x86_64.rpm"
cp "${RPMTEST}"/data/RPMS/${pkg} "${RPMTEST}"/tmp/${pkg}
dd if=/dev/zero of="${RPMTEST}"/tmp/${pkg} \
   conv=notrunc bs=1 seek=7777 count=6 2> /dev/null
runroot rpmkeys -Kv /tmp/${pkg}

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "/tmp/hello-2.0-1.x86_64.rpm:
    Header SHA256 digest: OK
    Header SHA1 digest: OK
    Payload SHA256 digest: BAD (Expected 84a7338287bf19715c4eed0243f5cdb447eeb0ade37b2af718d4060aefca2f7c != bea903609dceac36e1f26a983c493c98064d320fdfeb423034ed63d649b2c8dc)
    Payload SHA256 ALT digest: NOTFOUND
    MD5 digest: BAD (Expected 137ca1d8b35cca02a1854ba301c5432e != d662cd0d81601a7107312684ad1ddf38)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmsigdig.at:103"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_249
#AT_START_250
at_fn_group_banner 250 'rpmsigdig.at:125' \
  "rpmkeys -Kv <corrupted unsigned> 4" "             " 9
at_xfail=no
(
  $as_echo "250. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmsigdig.at:127:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


pkg=\"hello-2.0-1.x86_64.rpm\"
cp \"\${RPMTEST}\"/data/RPMS/\${pkg} \"\${RPMTEST}\"/tmp/\${pkg}
dd if=/dev/zero of=\"\${RPMTEST}\"/tmp/\${pkg} \\
   conv=notrunc bs=1 seek=4750 count=4 2> /dev/null
runroot rpmkeys -Kv /tmp/\${pkg}
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmsigdig.at:127"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


pkg="hello-2.0-1.x86_64.rpm"
cp "${RPMTEST}"/data/RPMS/${pkg} "${RPMTEST}"/tmp/${pkg}
dd if=/dev/zero of="${RPMTEST}"/tmp/${pkg} \
   conv=notrunc bs=1 seek=4750 count=4 2> /dev/null
runroot rpmkeys -Kv /tmp/${pkg}

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: /tmp/hello-2.0-1.x86_64.rpm: tag[13]: BAD, tag 1028 type 0 offset 116 count 5 len 7
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "/tmp/hello-2.0-1.x86_64.rpm:
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmsigdig.at:127"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_250
#AT_START_251
at_fn_group_banner 251 'rpmsigdig.at:144' \
  "rpmkeys -Kv <unsigned> 2" "                       " 9
at_xfail=no
(
  $as_echo "251. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmsigdig.at:146:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild -bb --quiet \\
	--define \"%optflags -O2 -g\" \\
	--define \"%_target_platform noarch-linux\" \\
	--define \"%_binary_payload w.ufdio\" \\
	--define \"%_buildhost localhost\" \\
	--define \"%use_source_date_epoch_as_buildtime 1\" \\
	--define \"%source_date_epoch_from_changelog 1\" \\
	--define \"%clamp_mtime_to_source_date_epoch 1\" \\
	/data/SPECS/attrtest.spec
for v in SHA256HEADER SHA1HEADER SIGMD5 PAYLOADDIGEST PAYLOADDIGESTALT; do
    runroot rpm -q --qf \"\${v}: %{\${v}}\\n\" /build/RPMS/noarch/attrtest-1.0-1.noarch.rpm
done
runroot rpmkeys -Kv /build/RPMS/noarch/attrtest-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmsigdig.at:146"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild -bb --quiet \
	--define "%optflags -O2 -g" \
	--define "%_target_platform noarch-linux" \
	--define "%_binary_payload w.ufdio" \
	--define "%_buildhost localhost" \
	--define "%use_source_date_epoch_as_buildtime 1" \
	--define "%source_date_epoch_from_changelog 1" \
	--define "%clamp_mtime_to_source_date_epoch 1" \
	/data/SPECS/attrtest.spec
for v in SHA256HEADER SHA1HEADER SIGMD5 PAYLOADDIGEST PAYLOADDIGESTALT; do
    runroot rpm -q --qf "${v}: %{${v}}\n" /build/RPMS/noarch/attrtest-1.0-1.noarch.rpm
done
runroot rpmkeys -Kv /build/RPMS/noarch/attrtest-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "SHA256HEADER: 31aafe5445b1c2fff4241b305caff48941460c9eddb51b78266cb7ebd2c46d72
SHA1HEADER: 8c7829525fadcd91d936a4ab5768f0cbdec9675d
SIGMD5: 0830400183c795c6f9f086d9b1470154
PAYLOADDIGEST: ba951e9327654ed94e5261315ef8a74269ccf7ae93412ce9627d02e34247f9bc
PAYLOADDIGESTALT: ba951e9327654ed94e5261315ef8a74269ccf7ae93412ce9627d02e34247f9bc
/build/RPMS/noarch/attrtest-1.0-1.noarch.rpm:
    Header SHA256 digest: OK
    Header SHA1 digest: OK
    Payload SHA256 ALT digest: OK
    Payload SHA256 digest: OK
    MD5 digest: OK
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmsigdig.at:146"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_251
#AT_START_252
at_fn_group_banner 252 'rpmsigdig.at:181' \
  "rpmkeys --import rsa" "                           " 9
at_xfail=no
(
  $as_echo "252. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmsigdig.at:183:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmkeys --import /data/keys/rpm.org-rsa-2048-test.pub
runroot rpm -qi gpg-pubkey-1964c5fc-58e63918|grep -v Date|grep -v Version:
runroot rpm -q --provides gpg-pubkey-1964c5fc-58e63918
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmsigdig.at:183"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmkeys --import /data/keys/rpm.org-rsa-2048-test.pub
runroot rpm -qi gpg-pubkey-1964c5fc-58e63918|grep -v Date|grep -v Version:
runroot rpm -q --provides gpg-pubkey-1964c5fc-58e63918

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "Name        : gpg-pubkey
Version     : 1964c5fc
Release     : 58e63918
Architecture: (none)
Group       : Public Keys
Size        : 0
License     : pubkey
Signature   : (none)
Source RPM  : (none)
Build Host  : localhost
Packager    : rpm.org RSA testkey <rsa@rpm.org>
Summary     : rpm.org RSA testkey <rsa@rpm.org> public key
Description :
-----BEGIN PGP PUBLIC KEY BLOCK-----

mQENBFjmORgBCAC7TMEk6wnjSs8Dr4yqSScWdU2pjcqrkTxuzdWvowcIUPZI0w/g
HkRqGd4apjvY2V15kjL10gk3QhFP3pZ/9p7zh8o8NHX7aGdSGDK7NOq1eFaErPRY
91LW9RiZ0lbOjXEzIL0KHxUiTQEmdXJT43DJMFPyW9fkCWg0OltiX618FUdWWfI8
eySdLur1utnqBvdEbCUvWK2RX3vQZQdvEBODnNk2pxqTyV0w6VPQ96W++lF/5Aas
7rUv3HIyIXxIggc8FRrnH+y9XvvHDonhTIlGnYZN4ubm9i4y3gOkrZlGTrEw7elQ
1QeMyG2QQEbze8YjpTm4iLABCBrRfPRaQpwrABEBAAG0IXJwbS5vcmcgUlNBIHRl
c3RrZXkgPHJzYUBycG0ub3JnPokBNwQTAQgAIQUCWOY5GAIbAwULCQgHAgYVCAkK
CwIEFgIDAQIeAQIXgAAKCRBDRFkeGWTF/MxxCACnjqFL+MmPh9W9JQKT2DcLbBzf
Cqo6wcEBoCOcwgRSk8dSikhARoteoa55JRJhuMyeKhhEAogE9HRmCPFdjezFTwgB
BDVBpO2dZ023mLXDVCYX3S8pShOgCP6Tn4wqCnYeAdLcGg106N4xcmgtcssJE+Pr
XzTZksbZsrTVEmL/Ym+R5w5jBfFnGk7Yw7ndwfQsfNXQb5AZynClFxnX546lcyZX
fEx3/e6ezw57WNOUK6WT+8b+EGovPkbetK/rGxNXuWaP6X4A/QUm8O98nCuHYFQq
+mvNdsCBqGf7mhaRGtpHk/JgCn5rFvArMDqLVrR9hX0LdCSsH7EGE+bR3r7wuQEN
BFjmORgBCACk+vDZrIXQuFXEYToZVwb2attzbbJJCqD71vmZTLsW0QxuPKRgbcYY
zp4K4lVBnHhFrF8MOUOxJ7kQWIJZMZFt+BDcptCYurbD2H4W2xvnWViiC+LzCMzz
iMJT6165uefL4JHTDPxC2fFiM9yrc72LmylJNkM/vepT128J5Qv0gRUaQbHiQuS6
Dm/+WRnUfx3i89SV4mnBxb/Ta93GVqoOciWwzWSnwEnWYAvOb95JL4U7c5J5f/+c
KnQDHsW7sIiIdscsWzvgf6qs2Ra1Zrt7Fdk4+ZS2f/adagLhDO1C24sXf5XfMk5m
L0OGwZSr9m5s17VXxfspgU5ugc8kBJfzABEBAAGJAR8EGAEIAAkFAljmORgCGwwA
CgkQQ0RZHhlkxfzwDQf/Y5on5o+s/xD3tDyRYa6SErfT44lEArdCD7Yi+cygJFox
3jyM8ovtJAkwRegwyxcaLN7zeG1p1Sk9ZAYWQEJT6qSU4Ppu+CVGHgxgnTcfUiu6
EZZQE6srvua53IMY1lT50M7vx0T5VicHFRWBFV2C/Mc32p7cEE6nn45nEZgUXQNl
ySEyvoRlsAJq6gFsfqucVz2vMJDTMVczUtq1CjvUqFbif8JVL36EoZCf1SeRw6d6
s1Kp3AA33Rjd+Uw87HJ4EIB75zMFQX2H0ggAVdYTQcqGXHP5MZK1jJrHfxJyMi3d
UNW2iqnN3BA7guhOv6OMiROF1+I7Q5nWT63mQC7IgQ==
=Z6nu
-----END PGP PUBLIC KEY BLOCK-----

gpg(rpm.org RSA testkey <rsa@rpm.org>) = 4:4344591e1964c5fc-58e63918
gpg(1964c5fc) = 4:4344591e1964c5fc-58e63918
gpg(4344591e1964c5fc) = 4:4344591e1964c5fc-58e63918
gpg(f00650f8) = 4:185e6146f00650f8-58e63918
gpg(185e6146f00650f8) = 4:185e6146f00650f8-58e63918
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmsigdig.at:183"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_252
#AT_START_253
at_fn_group_banner 253 'rpmsigdig.at:245' \
  "rpmkeys -K <signed> 1" "                          " 9
at_xfail=no
(
  $as_echo "253. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmsigdig.at:247:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmkeys -K /data/RPMS/hello-2.0-1.x86_64-signed.rpm
runroot rpmkeys --import /data/keys/rpm.org-rsa-2048-test.pub
runroot rpmkeys -K /data/RPMS/hello-2.0-1.x86_64-signed.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmsigdig.at:247"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmkeys -K /data/RPMS/hello-2.0-1.x86_64-signed.rpm
runroot rpmkeys --import /data/keys/rpm.org-rsa-2048-test.pub
runroot rpmkeys -K /data/RPMS/hello-2.0-1.x86_64-signed.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "/data/RPMS/hello-2.0-1.x86_64-signed.rpm: digests SIGNATURES NOT OK
/data/RPMS/hello-2.0-1.x86_64-signed.rpm: digests signatures OK
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmsigdig.at:247"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_253
#AT_START_254
at_fn_group_banner 254 'rpmsigdig.at:263' \
  "rpmkeys -Kv <signed> 1" "                         " 9
at_xfail=no
(
  $as_echo "254. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmsigdig.at:265:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmkeys -Kv /data/RPMS/hello-2.0-1.x86_64-signed.rpm; echo \$?
runroot rpmkeys --import /data/keys/rpm.org-rsa-2048-test.pub; echo \$?
runroot rpmkeys -Kv /data/RPMS/hello-2.0-1.x86_64-signed.rpm; echo \$?
runroot rpmkeys -Kv --nodigest /data/RPMS/hello-2.0-1.x86_64-signed.rpm; echo \$?
runroot rpmkeys -Kv --nosignature /data/RPMS/hello-2.0-1.x86_64-signed.rpm; echo \$?
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmsigdig.at:265"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmkeys -Kv /data/RPMS/hello-2.0-1.x86_64-signed.rpm; echo $?
runroot rpmkeys --import /data/keys/rpm.org-rsa-2048-test.pub; echo $?
runroot rpmkeys -Kv /data/RPMS/hello-2.0-1.x86_64-signed.rpm; echo $?
runroot rpmkeys -Kv --nodigest /data/RPMS/hello-2.0-1.x86_64-signed.rpm; echo $?
runroot rpmkeys -Kv --nosignature /data/RPMS/hello-2.0-1.x86_64-signed.rpm; echo $?

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "/data/RPMS/hello-2.0-1.x86_64-signed.rpm:
    Header V4 RSA/SHA256 Signature, key ID 1964c5fc: NOKEY
    Header SHA256 digest: OK
    Header SHA1 digest: OK
    Payload SHA256 digest: OK
    V4 RSA/SHA256 Signature, key ID 1964c5fc: NOKEY
    MD5 digest: OK
1
0
/data/RPMS/hello-2.0-1.x86_64-signed.rpm:
    Header V4 RSA/SHA256 Signature, key ID 1964c5fc: OK
    Header SHA256 digest: OK
    Header SHA1 digest: OK
    Payload SHA256 digest: OK
    V4 RSA/SHA256 Signature, key ID 1964c5fc: OK
    MD5 digest: OK
0
/data/RPMS/hello-2.0-1.x86_64-signed.rpm:
    Header V4 RSA/SHA256 Signature, key ID 1964c5fc: OK
    V4 RSA/SHA256 Signature, key ID 1964c5fc: OK
0
/data/RPMS/hello-2.0-1.x86_64-signed.rpm:
    Header SHA256 digest: OK
    Header SHA1 digest: OK
    Payload SHA256 digest: OK
    MD5 digest: OK
0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmsigdig.at:265"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_254
#AT_START_255
at_fn_group_banner 255 'rpmsigdig.at:308' \
  "rpmkeys -Kv <corrupted signed> 1" "               " 9
at_xfail=no
(
  $as_echo "255. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmsigdig.at:310:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


pkg=\"hello-2.0-1.x86_64-signed.rpm\"
cp \"\${RPMTEST}\"/data/RPMS/\${pkg} \"\${RPMTEST}\"/tmp/\${pkg}
dd if=/dev/zero of=\"\${RPMTEST}\"/tmp/\${pkg} \\
   conv=notrunc bs=1 seek=264 count=6 2> /dev/null

runroot rpmkeys -Kv /tmp/\${pkg}
runroot rpmkeys --import /data/keys/rpm.org-rsa-2048-test.pub
runroot rpmkeys -Kv /tmp/\${pkg}
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmsigdig.at:310"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


pkg="hello-2.0-1.x86_64-signed.rpm"
cp "${RPMTEST}"/data/RPMS/${pkg} "${RPMTEST}"/tmp/${pkg}
dd if=/dev/zero of="${RPMTEST}"/tmp/${pkg} \
   conv=notrunc bs=1 seek=264 count=6 2> /dev/null

runroot rpmkeys -Kv /tmp/${pkg}
runroot rpmkeys --import /data/keys/rpm.org-rsa-2048-test.pub
runroot rpmkeys -Kv /tmp/${pkg}

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "/tmp/hello-2.0-1.x86_64-signed.rpm:
    Header RSA signature: BAD (package tag 268: invalid OpenPGP signature)
    Header SHA256 digest: OK
    Header SHA1 digest: OK
    Payload SHA256 digest: OK
    V4 RSA/SHA256 Signature, key ID 1964c5fc: NOKEY
    MD5 digest: OK
/tmp/hello-2.0-1.x86_64-signed.rpm:
    Header RSA signature: BAD (package tag 268: invalid OpenPGP signature)
    Header SHA256 digest: OK
    Header SHA1 digest: OK
    Payload SHA256 digest: OK
    V4 RSA/SHA256 Signature, key ID 1964c5fc: OK
    MD5 digest: OK
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmsigdig.at:310"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_255
#AT_START_256
at_fn_group_banner 256 'rpmsigdig.at:342' \
  "rpmkeys -Kv <corrupted signed> 2" "               " 9
at_xfail=no
(
  $as_echo "256. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmsigdig.at:344:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


pkg=\"hello-2.0-1.x86_64-signed.rpm\"
cp \"\${RPMTEST}\"/data/RPMS/\${pkg} \"\${RPMTEST}\"/tmp/\${pkg}
dd if=/dev/zero of=\"\${RPMTEST}\"/tmp/\${pkg} \\
   conv=notrunc bs=1 seek=5555 count=6 2> /dev/null

runroot rpmkeys -Kv /tmp/\${pkg}
runroot rpmkeys --import /data/keys/rpm.org-rsa-2048-test.pub
runroot rpmkeys -Kv /tmp/\${pkg}
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmsigdig.at:344"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


pkg="hello-2.0-1.x86_64-signed.rpm"
cp "${RPMTEST}"/data/RPMS/${pkg} "${RPMTEST}"/tmp/${pkg}
dd if=/dev/zero of="${RPMTEST}"/tmp/${pkg} \
   conv=notrunc bs=1 seek=5555 count=6 2> /dev/null

runroot rpmkeys -Kv /tmp/${pkg}
runroot rpmkeys --import /data/keys/rpm.org-rsa-2048-test.pub
runroot rpmkeys -Kv /tmp/${pkg}

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "/tmp/hello-2.0-1.x86_64-signed.rpm:
    Header V4 RSA/SHA256 Signature, key ID 1964c5fc: BAD
    Header SHA256 digest: BAD (Expected ef920781af3bf072ae9888eec3de1c589143101dff9cc0b561468d395fb766d9 != 29fdfe92782fb0470a9a164a6c94af87d3b138c63b39d4c30e0223ca1202ba82)
    Header SHA1 digest: BAD (Expected 5cd9874c510b67b44483f9e382a1649ef7743bac != 4261b2c1eb861a4152c2239bce20bfbcaa8971ba)
    Payload SHA256 digest: OK
    V4 RSA/SHA256 Signature, key ID 1964c5fc: BAD
    MD5 digest: BAD (Expected 137ca1d8b35cca02a1854ba301c5432e != de65519eeb4ab52eb076ec054d42e34e)
/tmp/hello-2.0-1.x86_64-signed.rpm:
    Header V4 RSA/SHA256 Signature, key ID 1964c5fc: BAD
    Header SHA256 digest: BAD (Expected ef920781af3bf072ae9888eec3de1c589143101dff9cc0b561468d395fb766d9 != 29fdfe92782fb0470a9a164a6c94af87d3b138c63b39d4c30e0223ca1202ba82)
    Header SHA1 digest: BAD (Expected 5cd9874c510b67b44483f9e382a1649ef7743bac != 4261b2c1eb861a4152c2239bce20bfbcaa8971ba)
    Payload SHA256 digest: OK
    V4 RSA/SHA256 Signature, key ID 1964c5fc: BAD
    MD5 digest: BAD (Expected 137ca1d8b35cca02a1854ba301c5432e != de65519eeb4ab52eb076ec054d42e34e)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmsigdig.at:344"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_256
#AT_START_257
at_fn_group_banner 257 'rpmsigdig.at:377' \
  "rpmkeys -Kv <corrupted signed> 3" "               " 9
at_xfail=no
(
  $as_echo "257. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmsigdig.at:379:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


pkg=\"hello-2.0-1.x86_64-signed.rpm\"
cp \"\${RPMTEST}\"/data/RPMS/\${pkg} \"\${RPMTEST}\"/tmp/\${pkg}
dd if=/dev/zero of=\"\${RPMTEST}\"/tmp/\${pkg} \\
   conv=notrunc bs=1 seek=7777 count=6 2> /dev/null

runroot rpmkeys -Kv /tmp/\${pkg}
runroot rpmkeys --import /data/keys/rpm.org-rsa-2048-test.pub
runroot rpmkeys -Kv /tmp/\${pkg}
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmsigdig.at:379"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


pkg="hello-2.0-1.x86_64-signed.rpm"
cp "${RPMTEST}"/data/RPMS/${pkg} "${RPMTEST}"/tmp/${pkg}
dd if=/dev/zero of="${RPMTEST}"/tmp/${pkg} \
   conv=notrunc bs=1 seek=7777 count=6 2> /dev/null

runroot rpmkeys -Kv /tmp/${pkg}
runroot rpmkeys --import /data/keys/rpm.org-rsa-2048-test.pub
runroot rpmkeys -Kv /tmp/${pkg}

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "/tmp/hello-2.0-1.x86_64-signed.rpm:
    Header V4 RSA/SHA256 Signature, key ID 1964c5fc: NOKEY
    Header SHA256 digest: OK
    Header SHA1 digest: OK
    Payload SHA256 digest: BAD (Expected 84a7338287bf19715c4eed0243f5cdb447eeb0ade37b2af718d4060aefca2f7c != bea903609dceac36e1f26a983c493c98064d320fdfeb423034ed63d649b2c8dc)
    Payload SHA256 ALT digest: NOTFOUND
    V4 RSA/SHA256 Signature, key ID 1964c5fc: BAD
    MD5 digest: BAD (Expected 137ca1d8b35cca02a1854ba301c5432e != d662cd0d81601a7107312684ad1ddf38)
/tmp/hello-2.0-1.x86_64-signed.rpm:
    Header V4 RSA/SHA256 Signature, key ID 1964c5fc: OK
    Header SHA256 digest: OK
    Header SHA1 digest: OK
    Payload SHA256 digest: BAD (Expected 84a7338287bf19715c4eed0243f5cdb447eeb0ade37b2af718d4060aefca2f7c != bea903609dceac36e1f26a983c493c98064d320fdfeb423034ed63d649b2c8dc)
    Payload SHA256 ALT digest: NOTFOUND
    V4 RSA/SHA256 Signature, key ID 1964c5fc: BAD
    MD5 digest: BAD (Expected 137ca1d8b35cca02a1854ba301c5432e != d662cd0d81601a7107312684ad1ddf38)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmsigdig.at:379"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_257
#AT_START_258
at_fn_group_banner 258 'rpmsigdig.at:414' \
  "rpmsign --addsign" "                              " 9
at_xfail=no
(
  $as_echo "258. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

gpg2 --import ${RPMTEST}/data/keys/*.secret
# Our keys have no passphrases to be asked, silence GPG_TTY warning
export GPG_TTY=""

# rpmsign --addsign --rpmv3 <unsigned>
{ set +x
$as_echo "$at_srcdir/rpmsigdig.at:422:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


cp \"\${RPMTEST}\"/data/RPMS/hello-2.0-1.x86_64.rpm \"\${RPMTEST}\"/tmp/
run rpmsign --key-id 1964C5FC --rpmv3 --addsign \"\${RPMTEST}\"/tmp/hello-2.0-1.x86_64.rpm > /dev/null
echo PRE-IMPORT
runroot rpmkeys -Kv /tmp/hello-2.0-1.x86_64.rpm|grep -v digest
echo POST-IMPORT
runroot rpmkeys --import /data/keys/rpm.org-rsa-2048-test.pub
runroot rpmkeys -Kv /tmp/hello-2.0-1.x86_64.rpm|grep -v digest
run rpmsign --delsign \"\${RPMTEST}\"/tmp/hello-2.0-1.x86_64.rpm > /dev/null
echo POST-DELSIGN
runroot rpmkeys -Kv /tmp/hello-2.0-1.x86_64.rpm|grep -v digest
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmsigdig.at:422"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


cp "${RPMTEST}"/data/RPMS/hello-2.0-1.x86_64.rpm "${RPMTEST}"/tmp/
run rpmsign --key-id 1964C5FC --rpmv3 --addsign "${RPMTEST}"/tmp/hello-2.0-1.x86_64.rpm > /dev/null
echo PRE-IMPORT
runroot rpmkeys -Kv /tmp/hello-2.0-1.x86_64.rpm|grep -v digest
echo POST-IMPORT
runroot rpmkeys --import /data/keys/rpm.org-rsa-2048-test.pub
runroot rpmkeys -Kv /tmp/hello-2.0-1.x86_64.rpm|grep -v digest
run rpmsign --delsign "${RPMTEST}"/tmp/hello-2.0-1.x86_64.rpm > /dev/null
echo POST-DELSIGN
runroot rpmkeys -Kv /tmp/hello-2.0-1.x86_64.rpm|grep -v digest

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "PRE-IMPORT
/tmp/hello-2.0-1.x86_64.rpm:
    Header V4 RSA/SHA256 Signature, key ID 1964c5fc: NOKEY
    V4 RSA/SHA256 Signature, key ID 1964c5fc: NOKEY
POST-IMPORT
/tmp/hello-2.0-1.x86_64.rpm:
    Header V4 RSA/SHA256 Signature, key ID 1964c5fc: OK
    V4 RSA/SHA256 Signature, key ID 1964c5fc: OK
POST-DELSIGN
/tmp/hello-2.0-1.x86_64.rpm:
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmsigdig.at:422"
$at_failed && at_fn_log_failure
$at_traceon; }


# rpmsign --addsign <unsigned>
{ set +x
$as_echo "$at_srcdir/rpmsigdig.at:451:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


cp \"\${RPMTEST}\"/data/RPMS/hello-2.0-1.x86_64.rpm \"\${RPMTEST}\"/tmp/
run rpmsign --key-id 1964C5FC --addsign \"\${RPMTEST}\"/tmp/hello-2.0-1.x86_64.rpm > /dev/null
echo PRE-IMPORT
runroot rpmkeys -Kv /tmp/hello-2.0-1.x86_64.rpm|grep -v digest
echo POST-IMPORT
runroot rpmkeys --import /data/keys/rpm.org-rsa-2048-test.pub
runroot rpmkeys -Kv /tmp/hello-2.0-1.x86_64.rpm|grep -v digest
run rpmsign --delsign \"\${RPMTEST}\"/tmp/hello-2.0-1.x86_64.rpm > /dev/null
echo POST-DELSIGN
runroot rpmkeys -Kv /tmp/hello-2.0-1.x86_64.rpm|grep -v digest
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmsigdig.at:451"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


cp "${RPMTEST}"/data/RPMS/hello-2.0-1.x86_64.rpm "${RPMTEST}"/tmp/
run rpmsign --key-id 1964C5FC --addsign "${RPMTEST}"/tmp/hello-2.0-1.x86_64.rpm > /dev/null
echo PRE-IMPORT
runroot rpmkeys -Kv /tmp/hello-2.0-1.x86_64.rpm|grep -v digest
echo POST-IMPORT
runroot rpmkeys --import /data/keys/rpm.org-rsa-2048-test.pub
runroot rpmkeys -Kv /tmp/hello-2.0-1.x86_64.rpm|grep -v digest
run rpmsign --delsign "${RPMTEST}"/tmp/hello-2.0-1.x86_64.rpm > /dev/null
echo POST-DELSIGN
runroot rpmkeys -Kv /tmp/hello-2.0-1.x86_64.rpm|grep -v digest

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "PRE-IMPORT
/tmp/hello-2.0-1.x86_64.rpm:
    Header V4 RSA/SHA256 Signature, key ID 1964c5fc: NOKEY
POST-IMPORT
/tmp/hello-2.0-1.x86_64.rpm:
    Header V4 RSA/SHA256 Signature, key ID 1964c5fc: OK
POST-DELSIGN
/tmp/hello-2.0-1.x86_64.rpm:
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmsigdig.at:451"
$at_failed && at_fn_log_failure
$at_traceon; }


# rpmsign --addsign <signed>
{ set +x
$as_echo "$at_srcdir/rpmsigdig.at:478:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


cp \"\${RPMTEST}\"/data/RPMS/hello-2.0-1.x86_64-signed.rpm \"\${RPMTEST}\"/tmp/
run rpmsign --key-id 1964C5FC --addsign \"\${RPMTEST}\"/tmp/hello-2.0-1.x86_64-signed.rpm 2>&1 |grep -q \"already contains identical signature, skipping\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmsigdig.at:478"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


cp "${RPMTEST}"/data/RPMS/hello-2.0-1.x86_64-signed.rpm "${RPMTEST}"/tmp/
run rpmsign --key-id 1964C5FC --addsign "${RPMTEST}"/tmp/hello-2.0-1.x86_64-signed.rpm 2>&1 |grep -q "already contains identical signature, skipping"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmsigdig.at:478"
$at_failed && at_fn_log_failure
$at_traceon; }


# rpmsign --addsign <corrupted>
{ set +x
$as_echo "$at_srcdir/rpmsigdig.at:489:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


pkg=\"hello-2.0-1.x86_64.rpm\"
cp \"\${RPMTEST}\"/data/RPMS/\${pkg} \"\${RPMTEST}\"/tmp/\${pkg}
dd if=/dev/zero of=\"\${RPMTEST}\"/tmp/\${pkg} \\
   conv=notrunc bs=1 seek=333 count=4 2> /dev/null
run rpmsign --key-id 1964C5FC --addsign \"\${RPMTEST}/tmp/\${pkg}\" >/dev/null 2> stderr
echo \$?
grep -c \"error: not signing corrupt package \" stderr
runroot rpmkeys -Kv /tmp/hello-2.0-1.x86_64.rpm
echo \$?
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmsigdig.at:489"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


pkg="hello-2.0-1.x86_64.rpm"
cp "${RPMTEST}"/data/RPMS/${pkg} "${RPMTEST}"/tmp/${pkg}
dd if=/dev/zero of="${RPMTEST}"/tmp/${pkg} \
   conv=notrunc bs=1 seek=333 count=4 2> /dev/null
run rpmsign --key-id 1964C5FC --addsign "${RPMTEST}/tmp/${pkg}" >/dev/null 2> stderr
echo $?
grep -c "error: not signing corrupt package " stderr
runroot rpmkeys -Kv /tmp/hello-2.0-1.x86_64.rpm
echo $?

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
1
/tmp/hello-2.0-1.x86_64.rpm:
    Header SHA256 digest: OK
    Header SHA1 digest: OK
    Payload SHA256 digest: OK
    MD5 digest: BAD (Expected 007ca1d8b35cca02a1854ba301c5432e != 137ca1d8b35cca02a1854ba301c5432e)
1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmsigdig.at:489"
$at_failed && at_fn_log_failure
$at_traceon; }

gpgconf --kill gpg-agent
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_258
#AT_START_259
at_fn_group_banner 259 'rpmsigdig.at:518' \
  "rpmsign --delsign" "                              " 9
at_xfail=no
(
  $as_echo "259. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmsigdig.at:520:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


cp \"\${RPMTEST}\"/data/RPMS/hello-2.0-1.x86_64-signed.rpm \"\${RPMTEST}\"/tmp/
echo PRE-DELSIGN
runroot rpmkeys -Kv /tmp/hello-2.0-1.x86_64-signed.rpm|grep -v digest
echo POST-DELSIGN
run rpmsign --delsign \"\${RPMTEST}\"/tmp/hello-2.0-1.x86_64-signed.rpm > /dev/null
runroot rpmkeys -Kv /tmp/hello-2.0-1.x86_64-signed.rpm|grep -v digest
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmsigdig.at:520"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


cp "${RPMTEST}"/data/RPMS/hello-2.0-1.x86_64-signed.rpm "${RPMTEST}"/tmp/
echo PRE-DELSIGN
runroot rpmkeys -Kv /tmp/hello-2.0-1.x86_64-signed.rpm|grep -v digest
echo POST-DELSIGN
run rpmsign --delsign "${RPMTEST}"/tmp/hello-2.0-1.x86_64-signed.rpm > /dev/null
runroot rpmkeys -Kv /tmp/hello-2.0-1.x86_64-signed.rpm|grep -v digest

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "PRE-DELSIGN
/tmp/hello-2.0-1.x86_64-signed.rpm:
    Header V4 RSA/SHA256 Signature, key ID 1964c5fc: NOKEY
    V4 RSA/SHA256 Signature, key ID 1964c5fc: NOKEY
POST-DELSIGN
/tmp/hello-2.0-1.x86_64-signed.rpm:
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmsigdig.at:520"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_259
#AT_START_260
at_fn_group_banner 260 'rpmio.at:21' \
  "SIGPIPE from install scriptlet" "                 " 10
at_xfail=no
(
  $as_echo "260. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmio.at:23:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/sigpipe.spec
runroot rpm -U --nodeps /build/RPMS/noarch/sigpipe-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmio.at:23"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/sigpipe.spec
runroot rpm -U --nodeps /build/RPMS/noarch/sigpipe-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmio.at:23"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_260
#AT_START_261
at_fn_group_banner 261 'rpmio.at:50' \
  "rpmlog error handling" "                          " 10
at_xfail=no
(
  $as_echo "261. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmio.at:52:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -qpl /data/RPMS/hello-2.0-1.x86_64.rpm > /dev/full
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmio.at:52"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -qpl /data/RPMS/hello-2.0-1.x86_64.rpm > /dev/full

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "Error writing to log: No space left on device
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmio.at:52"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_261
#AT_START_262
at_fn_group_banner 262 'rpmverify.at:7' \
  "dependency problems" "                            " 11
at_xfail=no
(
  $as_echo "262. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmverify.at:9:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \\
	--define \"pkg one\" \\
	--define \"reqs deptest-two\" \\
	  /data/SPECS/deptest.spec

runroot rpm -U --nodeps /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm
runroot rpm -Va --nofiles
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmverify.at:9"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
	--define "pkg one" \
	--define "reqs deptest-two" \
	  /data/SPECS/deptest.spec

runroot rpm -U --nodeps /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm
runroot rpm -Va --nofiles

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "Unsatisfied dependencies for deptest-one-1.0-1.noarch:
	deptest-two is needed by (installed) deptest-one-1.0-1.noarch
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmverify.at:9"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_262
#AT_START_263
at_fn_group_banner 263 'rpmverify.at:30' \
  "files with no problems" "                         " 11
at_xfail=no
(
  $as_echo "263. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmverify.at:32:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U --nodeps --noscripts --ignorearch --ignoreos \\
	/data/RPMS/hello-1.0-1.i386.rpm
runroot rpm -Va --nodeps --nouser --nogroup
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmverify.at:32"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U --nodeps --noscripts --ignorearch --ignoreos \
	/data/RPMS/hello-1.0-1.i386.rpm
runroot rpm -Va --nodeps --nouser --nogroup

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmverify.at:32"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_263
#AT_START_264
at_fn_group_banner 264 'rpmverify.at:45' \
  "files with no problems in verbose mode" "         " 11
at_xfail=no
(
  $as_echo "264. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmverify.at:47:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U --nodeps --noscripts --ignorearch --ignoreos \\
	/data/RPMS/hello-1.0-1.i386.rpm
runroot rpm -Vva --nodeps --nouser --nogroup
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmverify.at:47"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U --nodeps --noscripts --ignorearch --ignoreos \
	/data/RPMS/hello-1.0-1.i386.rpm
runroot rpm -Vva --nodeps --nouser --nogroup

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo ".........    /usr/local/bin/hello
.........    /usr/share/doc/hello-1.0
.........  d /usr/share/doc/hello-1.0/FAQ
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmverify.at:47"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_264
#AT_START_265
at_fn_group_banner 265 'rpmverify.at:63' \
  "directory replaced with a directory symlink" "    " 11
at_xfail=no
(
  $as_echo "265. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmverify.at:65:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

tf=\"\${RPMTEST}\"/opt/foo
rm -rf \"\${RPMTEST}\"/opt/*

runroot rpmbuild --quiet -bb \\
        --define \"ver 1.0\" \\
        --define \"filetype datadir\" \\
        --define \"filedata README1\" \\
        --define \"user \$(id -u -n)\" \\
        --define \"grp \$(id -g -n)\" \\
          /data/SPECS/replacetest.spec

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
mv \"\${RPMTEST}\"/opt/foo \"\${RPMTEST}\"/opt/was
ln -s was \"\${RPMTEST}\"/opt/foo
runroot rpm -Vv replacetest
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmverify.at:65"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

tf="${RPMTEST}"/opt/foo
rm -rf "${RPMTEST}"/opt/*

runroot rpmbuild --quiet -bb \
        --define "ver 1.0" \
        --define "filetype datadir" \
        --define "filedata README1" \
        --define "user $(id -u -n)" \
        --define "grp $(id -g -n)" \
          /data/SPECS/replacetest.spec

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
mv "${RPMTEST}"/opt/foo "${RPMTEST}"/opt/was
ln -s was "${RPMTEST}"/opt/foo
runroot rpm -Vv replacetest

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo ".........    /opt/foo
.........    /opt/foo/README1
.........    /opt/goo
.........    /opt/zoo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmverify.at:65"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_265
#AT_START_266
at_fn_group_banner 266 'rpmverify.at:92' \
  "directory replaced with an invalid directory symlink" "" 11
at_xfail=no
      test `id -u` != 0  && at_xfail=yes
(
  $as_echo "266. $at_setup_line: testing $at_desc ..."
  $at_traceon



{ set +x
$as_echo "$at_srcdir/rpmverify.at:95:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

tf=\"\${RPMTEST}\"/opt/foo
rm -rf \"\${RPMTEST}\"/opt/*

runroot rpmbuild --quiet -bb \\
        --define \"ver 1.0\" \\
        --define \"filetype datadir\" \\
        --define \"filedata README1\" \\
          /data/SPECS/replacetest.spec

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
mv \"\${RPMTEST}\"/opt/foo \"\${RPMTEST}\"/opt/was
ln -s was \"\${RPMTEST}\"/opt/foo
chown -h bin \"\${RPMTEST}\"/opt/foo
runroot rpm -Vv --nouser --nogroup replacetest
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmverify.at:95"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

tf="${RPMTEST}"/opt/foo
rm -rf "${RPMTEST}"/opt/*

runroot rpmbuild --quiet -bb \
        --define "ver 1.0" \
        --define "filetype datadir" \
        --define "filedata README1" \
          /data/SPECS/replacetest.spec

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
mv "${RPMTEST}"/opt/foo "${RPMTEST}"/opt/was
ln -s was "${RPMTEST}"/opt/foo
chown -h bin "${RPMTEST}"/opt/foo
runroot rpm -Vv --nouser --nogroup replacetest

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "....L....    /opt/foo
.........    /opt/foo/README1
.........    /opt/goo
.........    /opt/zoo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmverify.at:95"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_266
#AT_START_267
at_fn_group_banner 267 'rpmverify.at:122' \
  "verify from db, with problems present" "          " 11
at_xfail=no
(
  $as_echo "267. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmverify.at:124:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U --nodeps --noscripts --ignorearch --ignoreos \\
	/data/RPMS/hello-1.0-1.i386.rpm
rm -f \"\${RPMTEST}\"/usr/share/doc/hello-1.0/FAQ
chmod u-x \"\${RPMTEST}\"/usr/local/bin/hello
dd if=/dev/zero of=\"\${RPMTEST}\"/usr/local/bin/hello \\
   conv=notrunc bs=1 seek=5 count=6 2> /dev/null
runroot rpm -Va --nodeps --nouser --nogroup
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmverify.at:124"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U --nodeps --noscripts --ignorearch --ignoreos \
	/data/RPMS/hello-1.0-1.i386.rpm
rm -f "${RPMTEST}"/usr/share/doc/hello-1.0/FAQ
chmod u-x "${RPMTEST}"/usr/local/bin/hello
dd if=/dev/zero of="${RPMTEST}"/usr/local/bin/hello \
   conv=notrunc bs=1 seek=5 count=6 2> /dev/null
runroot rpm -Va --nodeps --nouser --nogroup

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo ".M5....T.    /usr/local/bin/hello
missing   d /usr/share/doc/hello-1.0/FAQ
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmverify.at:124"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_267
#AT_START_268
at_fn_group_banner 268 'rpmverify.at:143' \
  "verify from package, with problems present" "     " 11
at_xfail=no
(
  $as_echo "268. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmverify.at:145:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U --nodeps --noscripts --ignorearch --ignoreos \\
	/data/RPMS/hello-1.0-1.i386.rpm
rm -f \"\${RPMTEST}\"/usr/share/doc/hello-1.0/FAQ
chmod u-x \"\${RPMTEST}\"/usr/local/bin/hello
dd if=/dev/zero of=\"\${RPMTEST}\"/usr/local/bin/hello \\
   conv=notrunc bs=1 seek=5 count=6 2> /dev/null
runroot rpm -Vp --nodeps --nouser --nogroup /data/RPMS/hello-1.0-1.i386.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmverify.at:145"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U --nodeps --noscripts --ignorearch --ignoreos \
	/data/RPMS/hello-1.0-1.i386.rpm
rm -f "${RPMTEST}"/usr/share/doc/hello-1.0/FAQ
chmod u-x "${RPMTEST}"/usr/local/bin/hello
dd if=/dev/zero of="${RPMTEST}"/usr/local/bin/hello \
   conv=notrunc bs=1 seek=5 count=6 2> /dev/null
runroot rpm -Vp --nodeps --nouser --nogroup /data/RPMS/hello-1.0-1.i386.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo ".M5....T.    /usr/local/bin/hello
missing   d /usr/share/doc/hello-1.0/FAQ
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmverify.at:145"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_268
#AT_START_269
at_fn_group_banner 269 'rpmverify.at:163' \
  "verify file attribute filtering" "                " 11
at_xfail=no
(
  $as_echo "269. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmverify.at:165:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild -bb --quiet \\
  /data/SPECS/vattrtest.spec

runroot rpm -U /build/RPMS/noarch/vattrtest-1.0-1.noarch.rpm
runroot_other touch /opt/vattrtest/g
runroot_other chmod 644 /opt/vattrtest/g

cmd=\"rpm -Vv --nouser --nogroup\"
for filter in --noconfig --noghost --noartifact -A -c -d -L; do
    echo \${filter}
    runroot \${cmd} \${filter} vattrtest
done
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmverify.at:165"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild -bb --quiet \
  /data/SPECS/vattrtest.spec

runroot rpm -U /build/RPMS/noarch/vattrtest-1.0-1.noarch.rpm
runroot_other touch /opt/vattrtest/g
runroot_other chmod 644 /opt/vattrtest/g

cmd="rpm -Vv --nouser --nogroup"
for filter in --noconfig --noghost --noartifact -A -c -d -L; do
    echo ${filter}
    runroot ${cmd} ${filter} vattrtest
done

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "--noconfig
.........    /opt/vattrtest
.........  a /opt/vattrtest/a
.........  d /opt/vattrtest/d
.........  g /opt/vattrtest/g
.........  l /opt/vattrtest/l
.........  m /opt/vattrtest/m
.........  r /opt/vattrtest/r
--noghost
.........    /opt/vattrtest
.........  a /opt/vattrtest/a
.........  c /opt/vattrtest/c
.........  c /opt/vattrtest/cn
.........  d /opt/vattrtest/d
.........  l /opt/vattrtest/l
.........  m /opt/vattrtest/m
.........  r /opt/vattrtest/r
--noartifact
.........    /opt/vattrtest
.........  c /opt/vattrtest/c
.........  c /opt/vattrtest/cn
.........  d /opt/vattrtest/d
.........  g /opt/vattrtest/g
.........  l /opt/vattrtest/l
.........  m /opt/vattrtest/m
.........  r /opt/vattrtest/r
-A
.........  a /opt/vattrtest/a
-c
.........  c /opt/vattrtest/c
.........  c /opt/vattrtest/cn
-d
.........  d /opt/vattrtest/d
-L
.........  l /opt/vattrtest/l
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_skip $at_status "$at_srcdir/rpmverify.at:165"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_269
#AT_START_270
at_fn_group_banner 270 'rpmverify.at:223' \
  "verifyscript failure" "                           " 11
at_xfail=no
(
  $as_echo "270. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmverify.at:225:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/verifyscript.spec
runroot rpm -U --nodeps /build/RPMS/noarch/verifyscript-1.0-1.noarch.rpm
rm -f \"\${RPMTEST}\"/var/checkme
runroot rpm -V --nodeps verifyscript
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmverify.at:225"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/verifyscript.spec
runroot rpm -U --nodeps /build/RPMS/noarch/verifyscript-1.0-1.noarch.rpm
rm -f "${RPMTEST}"/var/checkme
runroot rpm -V --nodeps verifyscript

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmverify.at:225"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_270
#AT_START_271
at_fn_group_banner 271 'rpmverify.at:238' \
  "verifyscript success" "                           " 11
at_xfail=no
(
  $as_echo "271. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmverify.at:240:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/verifyscript.spec
runroot rpm -U --nodeps /build/RPMS/noarch/verifyscript-1.0-1.noarch.rpm
touch \"\${RPMTEST}\"/var/checkme
runroot rpm -V --nodeps verifyscript
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmverify.at:240"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/verifyscript.spec
runroot rpm -U --nodeps /build/RPMS/noarch/verifyscript-1.0-1.noarch.rpm
touch "${RPMTEST}"/var/checkme
runroot rpm -V --nodeps verifyscript

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmverify.at:240"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_271
#AT_START_272
at_fn_group_banner 272 'rpmverify.at:255' \
  "shared file timestamp behavior" "                 " 11
at_xfail=no
(
  $as_echo "272. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmverify.at:257:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


# create packages sharing a file but with different timestamp
for p in \"one\" \"two\"; do
    runroot rpmbuild --quiet -bb \\
        --define \"pkg \$p\" \\
	--define \"filedata same_stuff\" \\
          /data/SPECS/conflicttest.spec
    sleep 1
done

# first instance of a shared file is the one that actually gets created,
# force the order so we know what to expect as these dont depend on each other
runroot rpm -U --noorder /build/RPMS/noarch/conflictone-1.0-1.noarch.rpm /build/RPMS/noarch/conflicttwo-1.0-1.noarch.rpm
runroot rpm -e conflicttwo
runroot rpm -Va --nouser --nogroup
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmverify.at:257"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


# create packages sharing a file but with different timestamp
for p in "one" "two"; do
    runroot rpmbuild --quiet -bb \
        --define "pkg $p" \
	--define "filedata same_stuff" \
          /data/SPECS/conflicttest.spec
    sleep 1
done

# first instance of a shared file is the one that actually gets created,
# force the order so we know what to expect as these dont depend on each other
runroot rpm -U --noorder /build/RPMS/noarch/conflictone-1.0-1.noarch.rpm /build/RPMS/noarch/conflicttwo-1.0-1.noarch.rpm
runroot rpm -e conflicttwo
runroot rpm -Va --nouser --nogroup

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmverify.at:257"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_272
#AT_START_273
at_fn_group_banner 273 'rpmverify.at:281' \
  "minimize writes (files)" "                        " 11
at_xfail=no
(
  $as_echo "273. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


for v in "1.0" "2.0"; do
    runroot rpmbuild --quiet -bb \
        --define "ver $v" \
	--define "filetype file" \
	--define "filedata foo" \
          /data/SPECS/replacetest.spec
done

for v in "3.0" "4.0"; do
    runroot rpmbuild --quiet -bb \
        --define "ver $v" \
	--define "filetype file" \
	--define "filedata fox" \
          /data/SPECS/replacetest.spec
done

{ set +x
$as_echo "$at_srcdir/rpmverify.at:301:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

tf=\"\${RPMTEST}\"/opt/foo
rm -rf \"\${tf}\"*

runroot rpm -i /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
cat \"\${tf}\"
touch -t 201703171717 \${tf}

runroot rpm -U \\
	--define \"_minimize_writes 1\" \\
	 /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
runroot rpm -Va --nouser --nogroup replacetest
cat \"\${tf}\"

runroot rpm -U \\
	--define \"_minimize_writes 1\" \\
	/build/RPMS/noarch/replacetest-3.0-1.noarch.rpm
runroot rpm -Va  --nouser --nogroup replacetest
cat \"\${tf}\"

echo \"xx\" > \"\${tf}\"
cat \"\${tf}\"

runroot rpm -U \\
	--define \"_minimize_writes 1\" \\
	/build/RPMS/noarch/replacetest-4.0-1.noarch.rpm
runroot rpm -Va  --nouser --nogroup replacetest
cat \"\${tf}\"

touch -t 201703171717 \${tf}

runroot rpm -U --oldpackage \\
	--define \"_minimize_writes 1\" \\
	/build/RPMS/noarch/replacetest-3.0-1.noarch.rpm
runroot rpm -Va  --nouser --nogroup replacetest
cat \"\${tf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmverify.at:301"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

tf="${RPMTEST}"/opt/foo
rm -rf "${tf}"*

runroot rpm -i /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
cat "${tf}"
touch -t 201703171717 ${tf}

runroot rpm -U \
	--define "_minimize_writes 1" \
	 /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
runroot rpm -Va --nouser --nogroup replacetest
cat "${tf}"

runroot rpm -U \
	--define "_minimize_writes 1" \
	/build/RPMS/noarch/replacetest-3.0-1.noarch.rpm
runroot rpm -Va  --nouser --nogroup replacetest
cat "${tf}"

echo "xx" > "${tf}"
cat "${tf}"

runroot rpm -U \
	--define "_minimize_writes 1" \
	/build/RPMS/noarch/replacetest-4.0-1.noarch.rpm
runroot rpm -Va  --nouser --nogroup replacetest
cat "${tf}"

touch -t 201703171717 ${tf}

runroot rpm -U --oldpackage \
	--define "_minimize_writes 1" \
	/build/RPMS/noarch/replacetest-3.0-1.noarch.rpm
runroot rpm -Va  --nouser --nogroup replacetest
cat "${tf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
foo
fox
xx
fox
fox
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmverify.at:301"
$at_failed && at_fn_log_failure
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/rpmverify.at:349:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

tf=\"\${RPMTEST}\"/opt/foo
rm -rf \"\${tf}\"*

runroot rpm -i /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
cat \"\${tf}\"
touch -t 201703171717 \${tf}

runroot rpm -Uvv --fsmdebug \\
	--define \"_minimize_writes 1\" \\
	 /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm > output.txt 2>&1
runroot rpm -Va --nouser --nogroup replacetest
grep -c \"touch\" output.txt
cat \"\${tf}\"


runroot rpm -Uvv --fsmdebug \\
	--define \"_minimize_writes 1\" \\
	/build/RPMS/noarch/replacetest-3.0-1.noarch.rpm  > output.txt 2>&1
runroot rpm -Va  --nouser --nogroup replacetest
grep -c \"touch\" output.txt
cat \"\${tf}\"
echo \"xx\" > \"\${tf}\"
cat \"\${tf}\"

runroot rpm -Uvv --fsmdebug \\
	--define \"_minimize_writes 1\" \\
	/build/RPMS/noarch/replacetest-4.0-1.noarch.rpm  > output.txt 2>&1
runroot rpm -Va  --nouser --nogroup replacetest
grep -c \"touch\" output.txt
cat \"\${tf}\"

touch -t 201703171717 \${tf}

runroot rpm -U -Uvv --fsmdebug  --oldpackage \\
	--define \"_minimize_writes 1\" \\
	/build/RPMS/noarch/replacetest-3.0-1.noarch.rpm  > output.txt 2>&1
runroot rpm -Va  --nouser --nogroup replacetest
grep -c  \"touch\" output.txt
cat \"\${tf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmverify.at:349"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

tf="${RPMTEST}"/opt/foo
rm -rf "${tf}"*

runroot rpm -i /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
cat "${tf}"
touch -t 201703171717 ${tf}

runroot rpm -Uvv --fsmdebug \
	--define "_minimize_writes 1" \
	 /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm > output.txt 2>&1
runroot rpm -Va --nouser --nogroup replacetest
grep -c "touch" output.txt
cat "${tf}"


runroot rpm -Uvv --fsmdebug \
	--define "_minimize_writes 1" \
	/build/RPMS/noarch/replacetest-3.0-1.noarch.rpm  > output.txt 2>&1
runroot rpm -Va  --nouser --nogroup replacetest
grep -c "touch" output.txt
cat "${tf}"
echo "xx" > "${tf}"
cat "${tf}"

runroot rpm -Uvv --fsmdebug \
	--define "_minimize_writes 1" \
	/build/RPMS/noarch/replacetest-4.0-1.noarch.rpm  > output.txt 2>&1
runroot rpm -Va  --nouser --nogroup replacetest
grep -c "touch" output.txt
cat "${tf}"

touch -t 201703171717 ${tf}

runroot rpm -U -Uvv --fsmdebug  --oldpackage \
	--define "_minimize_writes 1" \
	/build/RPMS/noarch/replacetest-3.0-1.noarch.rpm  > output.txt 2>&1
runroot rpm -Va  --nouser --nogroup replacetest
grep -c  "touch" output.txt
cat "${tf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
2
foo
1
fox
xx
1
fox
2
fox
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmverify.at:349"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_273
#AT_START_274
at_fn_group_banner 274 'rpmverify.at:406' \
  "minimize writes (hardlinks)" "                    " 11
at_xfail=no
(
  $as_echo "274. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

for v in "0" "1"; do
    runroot rpmbuild --quiet -bb --define "ver ${v}" /data/SPECS/hlbreak.spec
done
{ set +x
$as_echo "$at_srcdir/rpmverify.at:412:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm -U --define \"_minimize_writes 1\" /build/RPMS/noarch/hlbreak-0-0.noarch.rpm
runroot rpm -Vav --nouser --nogroup
runroot rpm -U --define \"_minimize_writes 1\" /build/RPMS/noarch/hlbreak-1-0.noarch.rpm
runroot rpm -Vav --nouser --nogroup
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmverify.at:412"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm -U --define "_minimize_writes 1" /build/RPMS/noarch/hlbreak-0-0.noarch.rpm
runroot rpm -Vav --nouser --nogroup
runroot rpm -U --define "_minimize_writes 1" /build/RPMS/noarch/hlbreak-1-0.noarch.rpm
runroot rpm -Vav --nouser --nogroup

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo ".........    /opt/file2
.........    /opt/file1
.........    /opt/file2
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmverify.at:412"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_274
#AT_START_275
at_fn_group_banner 275 'rpmverify.at:428' \
  "minimize writes (symlinks)" "                     " 11
at_xfail=no
(
  $as_echo "275. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

for v in "1.0" "2.0"; do
    runroot rpmbuild --quiet -bb \
        --define "ver $v" \
	--define "filetype link" \
	--define "filedata doh" \
          /data/SPECS/replacetest.spec
done

for v in "3.0" "4.0"; do
    runroot rpmbuild --quiet -bb \
        --define "ver $v" \
	--define "filetype link" \
	--define "filedata fox" \
          /data/SPECS/replacetest.spec
done

{ set +x
$as_echo "$at_srcdir/rpmverify.at:447:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

tf=\"\${RPMTEST}\"/opt/foo
rm -rf \"\${tf}\"*

runroot rpm -i /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
readlink \"\${tf}\"

runroot rpm -U \\
	--define \"_minimize_writes 1\" \\
	 /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
runroot rpm -Va --nouser --nogroup replacetest
readlink \"\${tf}\"

runroot rpm -U \\
	--define \"_minimize_writes 1\" \\
	/build/RPMS/noarch/replacetest-3.0-1.noarch.rpm
runroot rpm -Va  --nouser --nogroup replacetest
readlink \"\${tf}\"

ln -sf \"xx\" \"\${tf}\"
readlink \"\${tf}\"

runroot rpm -U \\
	--define \"_minimize_writes 1\" \\
	/build/RPMS/noarch/replacetest-4.0-1.noarch.rpm
runroot rpm -Va  --nouser --nogroup replacetest
readlink \"\${tf}\"

runroot rpm -U --oldpackage \\
	--define \"_minimize_writes 1\" \\
	/build/RPMS/noarch/replacetest-3.0-1.noarch.rpm
runroot rpm -Va  --nouser --nogroup replacetest
readlink \"\${tf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmverify.at:447"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

tf="${RPMTEST}"/opt/foo
rm -rf "${tf}"*

runroot rpm -i /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
readlink "${tf}"

runroot rpm -U \
	--define "_minimize_writes 1" \
	 /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
runroot rpm -Va --nouser --nogroup replacetest
readlink "${tf}"

runroot rpm -U \
	--define "_minimize_writes 1" \
	/build/RPMS/noarch/replacetest-3.0-1.noarch.rpm
runroot rpm -Va  --nouser --nogroup replacetest
readlink "${tf}"

ln -sf "xx" "${tf}"
readlink "${tf}"

runroot rpm -U \
	--define "_minimize_writes 1" \
	/build/RPMS/noarch/replacetest-4.0-1.noarch.rpm
runroot rpm -Va  --nouser --nogroup replacetest
readlink "${tf}"

runroot rpm -U --oldpackage \
	--define "_minimize_writes 1" \
	/build/RPMS/noarch/replacetest-3.0-1.noarch.rpm
runroot rpm -Va  --nouser --nogroup replacetest
readlink "${tf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "doh
doh
fox
xx
fox
fox
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmverify.at:447"
$at_failed && at_fn_log_failure
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/rpmverify.at:492:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

tf=\"\${RPMTEST}\"/opt/foo
rm -rf \"\${tf}\" \"\${tf}\".rpm*

runroot rpm -i /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
readlink \"\${tf}\"

runroot rpm -Uvv --fsmdebug \\
	--define \"_minimize_writes 1\" \\
	 /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm > output.txt 2>&1
runroot rpm -Va --nouser --nogroup replacetest
grep -c \"touch\" output.txt
readlink \"\${tf}\"


runroot rpm -Uvv --fsmdebug \\
	--define \"_minimize_writes 1\" \\
	/build/RPMS/noarch/replacetest-3.0-1.noarch.rpm > output.txt 2>&1
runroot rpm -Va  --nouser --nogroup replacetest
grep -c \"touch\" output.txt
readlink \"\${tf}\"
ln -sf \"xx\" \"\${tf}\"
readlink \"\${tf}\"

runroot rpm -Uvv --fsmdebug \\
	--define \"_minimize_writes 1\" \\
	/build/RPMS/noarch/replacetest-4.0-1.noarch.rpm  > output.txt 2>&1
runroot rpm -Va  --nouser --nogroup replacetest
grep -c \"touch\" output.txt
readlink \"\${tf}\"

runroot rpm -U -Uvv --fsmdebug  --oldpackage \\
	--define \"_minimize_writes 1\" \\
	/build/RPMS/noarch/replacetest-3.0-1.noarch.rpm  > output.txt 2>&1
runroot rpm -Va  --nouser --nogroup replacetest
grep -c  \"touch\" output.txt
readlink \"\${tf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmverify.at:492"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

tf="${RPMTEST}"/opt/foo
rm -rf "${tf}" "${tf}".rpm*

runroot rpm -i /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
readlink "${tf}"

runroot rpm -Uvv --fsmdebug \
	--define "_minimize_writes 1" \
	 /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm > output.txt 2>&1
runroot rpm -Va --nouser --nogroup replacetest
grep -c "touch" output.txt
readlink "${tf}"


runroot rpm -Uvv --fsmdebug \
	--define "_minimize_writes 1" \
	/build/RPMS/noarch/replacetest-3.0-1.noarch.rpm > output.txt 2>&1
runroot rpm -Va  --nouser --nogroup replacetest
grep -c "touch" output.txt
readlink "${tf}"
ln -sf "xx" "${tf}"
readlink "${tf}"

runroot rpm -Uvv --fsmdebug \
	--define "_minimize_writes 1" \
	/build/RPMS/noarch/replacetest-4.0-1.noarch.rpm  > output.txt 2>&1
runroot rpm -Va  --nouser --nogroup replacetest
grep -c "touch" output.txt
readlink "${tf}"

runroot rpm -U -Uvv --fsmdebug  --oldpackage \
	--define "_minimize_writes 1" \
	/build/RPMS/noarch/replacetest-3.0-1.noarch.rpm  > output.txt 2>&1
runroot rpm -Va  --nouser --nogroup replacetest
grep -c  "touch" output.txt
readlink "${tf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "doh
2
doh
1
fox
xx
1
fox
2
fox
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmverify.at:492"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_275
#AT_START_276
at_fn_group_banner 276 'rpmverify.at:546' \
  "minimize writes (SUID files)" "                   " 11
at_xfail=no
(
  $as_echo "276. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmverify.at:548:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

tf=\"\${RPMTEST}\"/opt/foo
rm -rf \"\${tf}\" \"\${tf}\".rpm*

for v in \"1.0\" \"2.0\"; do
    runroot rpmbuild --quiet -bb \\
        --define \"ver \$v\" \\
	--define \"filetype file\" \\
	--define \"filedata foo\" \\
	--define \"fileattr %attr(2755,-,-)\" \\
          /data/SPECS/replacetest.spec
done

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
runroot rpm -Va --nouser --nogroup replacetest
runroot rpm -U \\
	--define \"_minimize_writes 1\" \\
	 /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
runroot rpm -Va --nouser --nogroup replacetest
chmod 777 \"\${tf}\"
runroot rpm -U \\
	--oldpackage \\
	--define \"_minimize_writes 1\" \\
	 /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
runroot rpm -Va --nouser --nogroup replacetest
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmverify.at:548"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

tf="${RPMTEST}"/opt/foo
rm -rf "${tf}" "${tf}".rpm*

for v in "1.0" "2.0"; do
    runroot rpmbuild --quiet -bb \
        --define "ver $v" \
	--define "filetype file" \
	--define "filedata foo" \
	--define "fileattr %attr(2755,-,-)" \
          /data/SPECS/replacetest.spec
done

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
runroot rpm -Va --nouser --nogroup replacetest
runroot rpm -U \
	--define "_minimize_writes 1" \
	 /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
runroot rpm -Va --nouser --nogroup replacetest
chmod 777 "${tf}"
runroot rpm -U \
	--oldpackage \
	--define "_minimize_writes 1" \
	 /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
runroot rpm -Va --nouser --nogroup replacetest

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmverify.at:548"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_276
#AT_START_277
at_fn_group_banner 277 'rpmverify.at:580' \
  "verify empty/no capabilities 1" "                 " 11
at_xfail=no
(
  $as_echo "277. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmverify.at:582" >"$at_check_line_file"
($CAP_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmverify.at:582"
{ set +x
$as_echo "$at_srcdir/rpmverify.at:583:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U --nocaps --ignoreos \\
	/data/RPMS/capstest-1.0-1.noarch.rpm

runroot rpm -Va --nouser --nogroup
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmverify.at:583"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U --nocaps --ignoreos \
	/data/RPMS/capstest-1.0-1.noarch.rpm

runroot rpm -Va --nouser --nogroup

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "........P    /a/emptyCaps1
........P    /a/emptyCaps2
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmverify.at:583"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_277
#AT_START_278
at_fn_group_banner 278 'rpmverify.at:599' \
  "verify empty/no capabilities 2" "                 " 11
at_xfail=no
(
  $as_echo "278. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmverify.at:601" >"$at_check_line_file"
($CAP_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmverify.at:601"
{ set +x
$as_echo "$at_srcdir/rpmverify.at:602:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U --nocaps --nodeps --noscripts --ignorearch --ignoreos \\
	/data/RPMS/hello-1.0-1.ppc64.rpm

runroot rpm -Va --nouser --nogroup --nodeps | grep \"/bin/hello\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmverify.at:602"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U --nocaps --nodeps --noscripts --ignorearch --ignoreos \
	/data/RPMS/hello-1.0-1.ppc64.rpm

runroot rpm -Va --nouser --nogroup --nodeps | grep "/bin/hello"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmverify.at:602"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_278
#AT_START_279
at_fn_group_banner 279 'rpmdb.at:23' \
  "rpm --initdb" "                                   " 12
at_xfail=no
(
  $as_echo "279. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmdb.at:25:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdb.at:25"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo stdout:; cat "$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/rpmdb.at:25"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_279
#AT_START_280
at_fn_group_banner 280 'rpmdb.at:35' \
  "rpm -qa" "                                        " 12
at_xfail=no
(
  $as_echo "280. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmdb.at:37:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
  -qa
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdb.at:37"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
  -qa

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdb.at:37"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_280
#AT_START_281
at_fn_group_banner 281 'rpmdb.at:46' \
  "rpm -qa" "                                        " 12
at_xfail=no
(
  $as_echo "281. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmdb.at:48:

if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

runroot rpm \\
  -qa
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmdb.at:48"
( $at_check_trace;

if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

runroot rpm \
  -qa

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdb.at:48"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_281
#AT_START_282
at_fn_group_banner 282 'rpmdb.at:60' \
  "rpm -q foo" "                                     " 12
at_xfail=no
(
  $as_echo "282. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmdb.at:62:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -i \\
  /data/RPMS/foo-1.0-1.noarch.rpm

runroot rpm -q foo

"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdb.at:62"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -i \
  /data/RPMS/foo-1.0-1.noarch.rpm

runroot rpm -q foo


) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo-1.0-1.noarch
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdb.at:62"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_282
#AT_START_283
at_fn_group_banner 283 'rpmdb.at:79' \
  "rpm -q foo-" "                                    " 12
at_xfail=no
(
  $as_echo "283. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmdb.at:81:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -i \\
  /data/RPMS/foo-1.0-1.noarch.rpm

runroot rpm -q foo-

"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdb.at:81"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -i \
  /data/RPMS/foo-1.0-1.noarch.rpm

runroot rpm -q foo-


) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "package foo- is not installed
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmdb.at:81"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_283
#AT_START_284
at_fn_group_banner 284 'rpmdb.at:96' \
  "rpmdb header numbering" "                         " 12
at_xfail=no
(
  $as_echo "284. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmdb.at:98:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


for i in 1 2 3; do
    runroot rpm -i /data/RPMS/foo-1.0-1.noarch.rpm
    runroot rpm -q --qf \"%{dbinstance} %{name}\\n\" foo
    runroot rpm -e foo
done

"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdb.at:98"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


for i in 1 2 3; do
    runroot rpm -i /data/RPMS/foo-1.0-1.noarch.rpm
    runroot rpm -q --qf "%{dbinstance} %{name}\n" foo
    runroot rpm -e foo
done


) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1 foo
2 foo
3 foo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdb.at:98"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_284
#AT_START_285
at_fn_group_banner 285 'rpmdb.at:116' \
  "rpm -q --querybynumber" "                         " 12
at_xfail=no
(
  $as_echo "285. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmdb.at:118:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -i \\
  /data/RPMS/foo-1.0-1.noarch.rpm

"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdb.at:118"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -i \
  /data/RPMS/foo-1.0-1.noarch.rpm


) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdb.at:118"
$at_failed && at_fn_log_failure
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/rpmdb.at:129:
runroot rpm -q --querybynumber 1
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmdb.at:129"
( $at_check_trace;
runroot rpm -q --querybynumber 1

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo-1.0-1.noarch
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdb.at:129"
$at_failed && at_fn_log_failure
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/rpmdb.at:137:
runroot rpm -q --querybynumber 999
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmdb.at:137"
( $at_check_trace;
runroot rpm -q --querybynumber 999

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: record 999 could not be read
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmdb.at:137"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_285
#AT_START_286
at_fn_group_banner 286 'rpmdb.at:149' \
  "rpm -i *.noarch.rpm" "                            " 12
at_xfail=no
(
  $as_echo "286. $at_setup_line: testing $at_desc ..."
  $at_traceon



{ set +x
$as_echo "$at_srcdir/rpmdb.at:152:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -i \\
  /data/RPMS/foo-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdb.at:152"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -i \
  /data/RPMS/foo-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdb.at:152"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_286
#AT_START_287
at_fn_group_banner 287 'rpmdb.at:164' \
  "rpm -U --replacepkgs 1" "                         " 12
at_xfail=no
(
  $as_echo "287. $at_setup_line: testing $at_desc ..."
  $at_traceon



{ set +x
$as_echo "$at_srcdir/rpmdb.at:167:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


tpkg=\"/data/RPMS/foo-1.0-1.noarch.rpm\"

runroot rpm -i \"\${tpkg}\" &&
  runroot rpm -U --replacepkgs \"\${tpkg}\" &&
  runroot rpm -qa
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdb.at:167"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


tpkg="/data/RPMS/foo-1.0-1.noarch.rpm"

runroot rpm -i "${tpkg}" &&
  runroot rpm -U --replacepkgs "${tpkg}" &&
  runroot rpm -qa

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo-1.0-1.noarch
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdb.at:167"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_287
#AT_START_288
at_fn_group_banner 288 'rpmdb.at:185' \
  "rpm -U --replacepkgs 2" "                         " 12
at_xfail=no
(
  $as_echo "288. $at_setup_line: testing $at_desc ..."
  $at_traceon



{ set +x
$as_echo "$at_srcdir/rpmdb.at:188:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


tpkg=\"/data/RPMS/hello-2.0-1.i686.rpm\"

runroot rpm -U --nodeps --ignorearch \"\${tpkg}\" &&
  runroot rpm -U --nodeps --ignorearch --nodocs --replacepkgs \"\${tpkg}\" &&
  runroot rpm -e hello
test -d \"\${RPMTEST}\"/usr/share/doc/hello-2.0
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdb.at:188"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


tpkg="/data/RPMS/hello-2.0-1.i686.rpm"

runroot rpm -U --nodeps --ignorearch "${tpkg}" &&
  runroot rpm -U --nodeps --ignorearch --nodocs --replacepkgs "${tpkg}" &&
  runroot rpm -e hello
test -d "${RPMTEST}"/usr/share/doc/hello-2.0

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmdb.at:188"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_288
#AT_START_289
at_fn_group_banner 289 'rpmdb.at:205' \
  "rpm --reinstall 1" "                              " 12
at_xfail=no
(
  $as_echo "289. $at_setup_line: testing $at_desc ..."
  $at_traceon



{ set +x
$as_echo "$at_srcdir/rpmdb.at:208:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


tpkg=\"/data/RPMS/hello-2.0-1.i686.rpm\"

runroot rpm -U --nodeps --ignorearch \"\${tpkg}\" &&
  runroot rpm --reinstall --nodeps --ignorearch --nodocs \"\${tpkg}\" &&
  runroot rpm -e hello
test -d \"\${RPMTEST}\"/usr/share/doc/hello-2.0
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdb.at:208"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


tpkg="/data/RPMS/hello-2.0-1.i686.rpm"

runroot rpm -U --nodeps --ignorearch "${tpkg}" &&
  runroot rpm --reinstall --nodeps --ignorearch --nodocs "${tpkg}" &&
  runroot rpm -e hello
test -d "${RPMTEST}"/usr/share/doc/hello-2.0

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmdb.at:208"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_289
#AT_START_290
at_fn_group_banner 290 'rpmdb.at:227' \
  "rpm -i --relocate=.. *.i386.rpm" "                " 12
at_xfail=no
(
  $as_echo "290. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmdb.at:229:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -i \\
  --noscripts --nodeps --ignorearch --relocate=/usr=/check \\
  /data/RPMS/hello-1.0-1.i386.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdb.at:229"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -i \
  --noscripts --nodeps --ignorearch --relocate=/usr=/check \
  /data/RPMS/hello-1.0-1.i386.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdb.at:229"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_290
#AT_START_291
at_fn_group_banner 291 'rpmdb.at:245' \
  "rpm -i --relocate=.. *.ppc64.rpm" "               " 12
at_xfail=no
(
  $as_echo "291. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmdb.at:247:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -i \\
  --noscripts --nodeps --ignorearch --relocate=/usr=/check \\
  /data/RPMS/hello-1.0-1.ppc64.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdb.at:247"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -i \
  --noscripts --nodeps --ignorearch --relocate=/usr=/check \
  /data/RPMS/hello-1.0-1.ppc64.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo stdout:; cat "$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/rpmdb.at:247"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_291
#AT_START_292
at_fn_group_banner 292 'rpmdb.at:260' \
  "rpmdb --rebuilddb" "                              " 12
at_xfail=no
(
  $as_echo "292. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmdb.at:262:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U --noscripts --nodeps --ignorearch \\
  /data/RPMS/hello-1.0-1.i386.rpm
runroot rpm -qa --qf \"%{nevra} %{dbinstance}\\n\"
runroot rpm -U --noscripts --nodeps --ignorearch \\
  /data/RPMS/hello-2.0-1.i686.rpm
runroot rpm -qa --qf \"%{nevra} %{dbinstance}\\n\"
runroot rpmdb --rebuilddb
runroot rpm -qa --qf \"%{nevra} %{dbinstance}\\n\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdb.at:262"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U --noscripts --nodeps --ignorearch \
  /data/RPMS/hello-1.0-1.i386.rpm
runroot rpm -qa --qf "%{nevra} %{dbinstance}\n"
runroot rpm -U --noscripts --nodeps --ignorearch \
  /data/RPMS/hello-2.0-1.i686.rpm
runroot rpm -qa --qf "%{nevra} %{dbinstance}\n"
runroot rpmdb --rebuilddb
runroot rpm -qa --qf "%{nevra} %{dbinstance}\n"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "hello-1.0-1.i386 1
hello-2.0-1.i686 2
hello-2.0-1.i686 1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdb.at:262"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_292
#AT_START_293
at_fn_group_banner 293 'rpmdb.at:284' \
  "rpmdb --rebuilddb and verify empty database" "    " 12
at_xfail=no
(
  $as_echo "293. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmdb.at:286:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpmdb --rebuilddb
runroot rpmdb --verifydb
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdb.at:286"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpmdb --rebuilddb
runroot rpmdb --verifydb

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdb.at:286"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_293
#AT_START_294
at_fn_group_banner 294 'rpmdb.at:298' \
  "rpm -U and verify status" "                       " 12
at_xfail=no
(
  $as_echo "294. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmdb.at:300:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \\
        --define \"pkg status\" \\
	--define \"filedata same_stuff\" \\
          /data/SPECS/conflicttest.spec

runroot rpm -U /build/RPMS/noarch/conflictstatus-1.0-1.noarch.rpm
runroot rpm -qls conflictstatus
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdb.at:300"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
        --define "pkg status" \
	--define "filedata same_stuff" \
          /data/SPECS/conflicttest.spec

runroot rpm -U /build/RPMS/noarch/conflictstatus-1.0-1.noarch.rpm
runroot rpm -qls conflictstatus

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "normal        /usr/share/my.version
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdb.at:300"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_294
#AT_START_295
at_fn_group_banner 295 'rpmdb.at:319' \
  "rpm -U with _install_lang and verify status" "    " 12
at_xfail=no
(
  $as_echo "295. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmdb.at:321:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \\
          /data/SPECS/flangtest.spec

runroot rpm -U --define \"_install_langs de:fi\" /build/RPMS/noarch/flangtest-1.0-1.noarch.rpm
runroot rpm -qls flangtest
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdb.at:321"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
          /data/SPECS/flangtest.spec

runroot rpm -U --define "_install_langs de:fi" /build/RPMS/noarch/flangtest-1.0-1.noarch.rpm
runroot rpm -qls flangtest

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "normal        /usr/share/flangtest/de.txt
normal        /usr/share/flangtest/empty.txt
not installed /usr/share/flangtest/en.txt
normal        /usr/share/flangtest/fi.txt
normal        /usr/share/flangtest/none.txt
not installed /usr/share/flangtest/pl.txt
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdb.at:321"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_295
#AT_START_296
at_fn_group_banner 296 'rpmdb.at:343' \
  "rpm -U and verify files on disk" "                " 12
at_xfail=no
(
  $as_echo "296. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmdb.at:345:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

rm -rf \"\${RPMTEST}\"/opt/*

runroot rpmbuild --quiet -bb /data/SPECS/selfconflict.spec
runroot rpm -U /build/RPMS/noarch/selfconflict-1.0-1.noarch.rpm
find \"\${RPMTEST}\"/opt | wc -l
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdb.at:345"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

rm -rf "${RPMTEST}"/opt/*

runroot rpmbuild --quiet -bb /data/SPECS/selfconflict.spec
runroot rpm -U /build/RPMS/noarch/selfconflict-1.0-1.noarch.rpm
find "${RPMTEST}"/opt | wc -l

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "6
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdb.at:345"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_296
#AT_START_297
at_fn_group_banner 297 'rpmdb.at:362' \
  "rpm -e and verify files removed" "                " 12
at_xfail=no
(
  $as_echo "297. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmdb.at:364:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

rm -rf \"\${RPMTEST}\"/opt/*

runroot rpmbuild --quiet -bb /data/SPECS/selfconflict.spec
runroot rpm -U /build/RPMS/noarch/selfconflict-1.0-1.noarch.rpm
runroot rpm -e selfconflict
find \"\${RPMTEST}\"/opt | wc -l
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdb.at:364"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

rm -rf "${RPMTEST}"/opt/*

runroot rpmbuild --quiet -bb /data/SPECS/selfconflict.spec
runroot rpm -U /build/RPMS/noarch/selfconflict-1.0-1.noarch.rpm
runroot rpm -e selfconflict
find "${RPMTEST}"/opt | wc -l

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdb.at:364"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_297
#AT_START_298
at_fn_group_banner 298 'rpmi.at:21' \
  "rpm -U <manifest>" "                              " 13
at_xfail=no
(
  $as_echo "298. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmi.at:23:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


echo /data/RPMS/hello-2.0-1.x86_64.rpm > \${RPMTEST}/tmp/test.mft
runroot rpm -U --ignorearch --ignoreos --nodeps \\
	/tmp/test.mft
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:23"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


echo /data/RPMS/hello-2.0-1.x86_64.rpm > ${RPMTEST}/tmp/test.mft
runroot rpm -U --ignorearch --ignoreos --nodeps \
	/tmp/test.mft

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmi.at:23"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_298
#AT_START_299
at_fn_group_banner 299 'rpmi.at:35' \
  "rpm -U <manifest notfound 1>" "                   " 13
at_xfail=no
(
  $as_echo "299. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmi.at:37:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


echo /data/RPMS/hello-2.0-1.x86_64.rpm > \${RPMTEST}/tmp/test.mft
runroot rpm -U --ignorearch --ignoreos --nodeps \\
	/tmp/test-not-there.mft
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:37"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


echo /data/RPMS/hello-2.0-1.x86_64.rpm > ${RPMTEST}/tmp/test.mft
runroot rpm -U --ignorearch --ignoreos --nodeps \
	/tmp/test-not-there.mft

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: open of /tmp/test-not-there.mft failed: No such file or directory
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmi.at:37"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_299
#AT_START_300
at_fn_group_banner 300 'rpmi.at:50' \
  "rpm -U <manifest notfound 2>" "                   " 13
at_xfail=no
(
  $as_echo "300. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmi.at:52:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


echo /data/RPMS/hello-not-there-2.0-1.x86_64.rpm > \${RPMTEST}/tmp/test.mft
runroot rpm -U --ignorearch --ignoreos --nodeps \\
	/tmp/test.mft
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:52"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


echo /data/RPMS/hello-not-there-2.0-1.x86_64.rpm > ${RPMTEST}/tmp/test.mft
runroot rpm -U --ignorearch --ignoreos --nodeps \
	/tmp/test.mft

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: open of /data/RPMS/hello-not-there-2.0-1.x86_64.rpm failed: No such file or directory
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmi.at:52"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_300
#AT_START_301
at_fn_group_banner 301 'rpmi.at:65' \
  "rpm -U <notfound>" "                              " 13
at_xfail=no
(
  $as_echo "301. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmi.at:67:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U --ignorearch --ignoreos --nodeps \\
	/data/RPMS/hello-not-there-2.0-1.x86_64.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:67"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U --ignorearch --ignoreos --nodeps \
	/data/RPMS/hello-not-there-2.0-1.x86_64.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: open of /data/RPMS/hello-not-there-2.0-1.x86_64.rpm failed: No such file or directory
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmi.at:67"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_301
#AT_START_302
at_fn_group_banner 302 'rpmi.at:79' \
  "rpm -U <unsigned 1>" "                            " 13
at_xfail=no
(
  $as_echo "302. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmi.at:81:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U --ignorearch --ignoreos --nodeps \\
	/data/RPMS/hello-2.0-1.x86_64.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:81"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U --ignorearch --ignoreos --nodeps \
	/data/RPMS/hello-2.0-1.x86_64.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmi.at:81"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_302
#AT_START_303
at_fn_group_banner 303 'rpmi.at:92' \
  "rpm -U <unsigned 2>" "                            " 13
at_xfail=no
(
  $as_echo "303. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmi.at:94:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U --ignorearch --ignoreos --nodeps \\
	--define \"_pkgverify_level signature\" \\
	/data/RPMS/hello-2.0-1.x86_64.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:94"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U --ignorearch --ignoreos --nodeps \
	--define "_pkgverify_level signature" \
	/data/RPMS/hello-2.0-1.x86_64.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "	package hello-2.0-1.x86_64 does not verify: no signature
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmi.at:94"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_303
#AT_START_304
at_fn_group_banner 304 'rpmi.at:107' \
  "rpm -U <corrupted unsigned 1>" "                  " 13
at_xfail=no
(
  $as_echo "304. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmi.at:109:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


pkg=\"hello-2.0-1.x86_64.rpm\"
cp \"\${RPMTEST}\"/data/RPMS/\${pkg} \"\${RPMTEST}\"/tmp/\${pkg}
dd if=/dev/zero of=\"\${RPMTEST}\"/tmp/\${pkg} \\
   conv=notrunc bs=1 seek=5555 count=6 2> /dev/null

echo \"INSTALL 1\"
runroot rpm -U --ignorearch --ignoreos --nodeps --nodigest \\
	--define \"_pkgverify_level none\" \\
	/tmp/\${pkg} 2>&1 | sed -e 's/;.*\$//g'
echo \"INSTALL 2\"
runroot rpm -U --ignorearch --ignoreos --nodeps \\
	--define \"_pkgverify_level digest\" \\
	/tmp/\${pkg} 2>&1
echo \"INSTALL 3\"
runroot rpm -U --ignorearch --ignoreos --nodeps \\
	--define \"_pkgverify_flags 0x30300\" \\
	--define \"__vsflags 0x30300\" \\
	--define \"_pkgverify_level digest\" \\
	/tmp/\${pkg} 2>&1
echo \"INSTALL 4\"
runroot rpm -U --ignorearch --ignoreos --nodeps --nodigest --noverify \\
	--define \"_pkgverify_level digest\" \\
	/tmp/\${pkg} 2>&1 | sed -e 's/;.*\$//g'
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:109"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


pkg="hello-2.0-1.x86_64.rpm"
cp "${RPMTEST}"/data/RPMS/${pkg} "${RPMTEST}"/tmp/${pkg}
dd if=/dev/zero of="${RPMTEST}"/tmp/${pkg} \
   conv=notrunc bs=1 seek=5555 count=6 2> /dev/null

echo "INSTALL 1"
runroot rpm -U --ignorearch --ignoreos --nodeps --nodigest \
	--define "_pkgverify_level none" \
	/tmp/${pkg} 2>&1 | sed -e 's/;.*$//g'
echo "INSTALL 2"
runroot rpm -U --ignorearch --ignoreos --nodeps \
	--define "_pkgverify_level digest" \
	/tmp/${pkg} 2>&1
echo "INSTALL 3"
runroot rpm -U --ignorearch --ignoreos --nodeps \
	--define "_pkgverify_flags 0x30300" \
	--define "__vsflags 0x30300" \
	--define "_pkgverify_level digest" \
	/tmp/${pkg} 2>&1
echo "INSTALL 4"
runroot rpm -U --ignorearch --ignoreos --nodeps --nodigest --noverify \
	--define "_pkgverify_level digest" \
	/tmp/${pkg} 2>&1 | sed -e 's/;.*$//g'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "INSTALL 1
error: unpacking of archive failed on file /usr/share/doc/hello-2.0/COPYING
error: hello-2.0-1.x86_64: install failed
INSTALL 2
error: /tmp/hello-2.0-1.x86_64.rpm: Header SHA256 digest: BAD (Expected ef920781af3bf072ae9888eec3de1c589143101dff9cc0b561468d395fb766d9 != 29fdfe92782fb0470a9a164a6c94af87d3b138c63b39d4c30e0223ca1202ba82)
error: /tmp/hello-2.0-1.x86_64.rpm: Header SHA1 digest: BAD (Expected 5cd9874c510b67b44483f9e382a1649ef7743bac != 4261b2c1eb861a4152c2239bce20bfbcaa8971ba)
error: /tmp/hello-2.0-1.x86_64.rpm cannot be installed
INSTALL 3
	package hello-2.0-1.x86_64 does not verify: no digest
INSTALL 4
error: unpacking of archive failed on file /usr/share/doc/hello-2.0/COPYING
error: hello-2.0-1.x86_64: install failed
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmi.at:109"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_304
#AT_START_305
at_fn_group_banner 305 'rpmi.at:153' \
  "rpm -U <corrupted unsigned 2>" "                  " 13
at_xfail=no
(
  $as_echo "305. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmi.at:155:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


pkg=\"hello-2.0-1.x86_64.rpm\"
cp \"\${RPMTEST}\"/data/RPMS/\${pkg} \"\${RPMTEST}\"/tmp/\${pkg}
dd if=/dev/zero of=\"\${RPMTEST}\"/tmp/\${pkg} \\
   conv=notrunc bs=1 seek=7777 count=6 2> /dev/null

echo \"INSTALL 1\"
runroot rpm -U --ignorearch --ignoreos --nodeps \\
	--define \"_pkgverify_level none\" \\
	/tmp/\${pkg} 2>&1
echo \"INSTALL 2\"
runroot rpm -U --ignorearch --ignoreos --nodeps \\
	--define \"_pkgverify_level digest\" \\
	/tmp/\${pkg} 2>&1
echo \"INSTALL 3\"
runroot rpm -U --ignorearch --ignoreos --nodeps \\
	--define \"_pkgverify_flags 0x30300\" \\
	--define \"_pkgverify_level digest\" \\
	/tmp/\${pkg} 2>&1
echo \"INSTALL 4\"
runroot rpm -U --ignorearch --ignoreos --nodeps --nodigest --noverify \\
	--define \"_pkgverify_level digest\" \\
	/tmp/\${pkg} 2>&1
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:155"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


pkg="hello-2.0-1.x86_64.rpm"
cp "${RPMTEST}"/data/RPMS/${pkg} "${RPMTEST}"/tmp/${pkg}
dd if=/dev/zero of="${RPMTEST}"/tmp/${pkg} \
   conv=notrunc bs=1 seek=7777 count=6 2> /dev/null

echo "INSTALL 1"
runroot rpm -U --ignorearch --ignoreos --nodeps \
	--define "_pkgverify_level none" \
	/tmp/${pkg} 2>&1
echo "INSTALL 2"
runroot rpm -U --ignorearch --ignoreos --nodeps \
	--define "_pkgverify_level digest" \
	/tmp/${pkg} 2>&1
echo "INSTALL 3"
runroot rpm -U --ignorearch --ignoreos --nodeps \
	--define "_pkgverify_flags 0x30300" \
	--define "_pkgverify_level digest" \
	/tmp/${pkg} 2>&1
echo "INSTALL 4"
runroot rpm -U --ignorearch --ignoreos --nodeps --nodigest --noverify \
	--define "_pkgverify_level digest" \
	/tmp/${pkg} 2>&1

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "INSTALL 1
error: unpacking of archive failed: cpio: Bad magic
error: hello-2.0-1.x86_64: install failed
INSTALL 2
	package hello-2.0-1.x86_64 does not verify: Payload SHA256 digest: BAD (Expected 84a7338287bf19715c4eed0243f5cdb447eeb0ade37b2af718d4060aefca2f7c != bea903609dceac36e1f26a983c493c98064d320fdfeb423034ed63d649b2c8dc)
INSTALL 3
	package hello-2.0-1.x86_64 does not verify: no digest
INSTALL 4
error: unpacking of archive failed: cpio: Bad magic
error: hello-2.0-1.x86_64: install failed
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmi.at:155"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_305
#AT_START_306
at_fn_group_banner 306 'rpmi.at:196' \
  "rpm -U <signed nokey 1>" "                        " 13
at_xfail=no
(
  $as_echo "306. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmi.at:198:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U --ignorearch --ignoreos --nodeps \\
	/data/RPMS/hello-2.0-1.x86_64-signed.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:198"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U --ignorearch --ignoreos --nodeps \
	/data/RPMS/hello-2.0-1.x86_64-signed.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "warning: /data/RPMS/hello-2.0-1.x86_64-signed.rpm: Header V4 RSA/SHA256 Signature, key ID 1964c5fc: NOKEY
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmi.at:198"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_306
#AT_START_307
at_fn_group_banner 307 'rpmi.at:210' \
  "rpm -U <signed nokey 2>" "                        " 13
at_xfail=no
(
  $as_echo "307. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmi.at:212:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U --ignorearch --ignoreos --nodeps \\
	--define \"_pkgverify_level signature\" \\
	/data/RPMS/hello-2.0-1.x86_64-signed.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:212"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U --ignorearch --ignoreos --nodeps \
	--define "_pkgverify_level signature" \
	/data/RPMS/hello-2.0-1.x86_64-signed.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "warning: /data/RPMS/hello-2.0-1.x86_64-signed.rpm: Header V4 RSA/SHA256 Signature, key ID 1964c5fc: NOKEY
	package hello-2.0-1.x86_64 does not verify: Header V4 RSA/SHA256 Signature, key ID 1964c5fc: NOKEY
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmi.at:212"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_307
#AT_START_308
at_fn_group_banner 308 'rpmi.at:226' \
  "rpm -U <signed 1>" "                              " 13
at_xfail=no
(
  $as_echo "308. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmi.at:228:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmkeys --import /data/keys/rpm.org-rsa-2048-test.pub
runroot rpm -U --ignorearch --ignoreos --nodeps \\
	/data/RPMS/hello-2.0-1.x86_64-signed.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:228"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmkeys --import /data/keys/rpm.org-rsa-2048-test.pub
runroot rpm -U --ignorearch --ignoreos --nodeps \
	/data/RPMS/hello-2.0-1.x86_64-signed.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmi.at:228"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_308
#AT_START_309
at_fn_group_banner 309 'rpmi.at:240' \
  "rpm -U <signed 2>" "                              " 13
at_xfail=no
(
  $as_echo "309. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmi.at:242:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmkeys --import /data/keys/rpm.org-rsa-2048-test.pub
runroot rpm -U --ignorearch --ignoreos --nodeps \\
	--define \"_pkgverify_level signature\" \\
	/data/RPMS/hello-2.0-1.x86_64-signed.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:242"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmkeys --import /data/keys/rpm.org-rsa-2048-test.pub
runroot rpm -U --ignorearch --ignoreos --nodeps \
	--define "_pkgverify_level signature" \
	/data/RPMS/hello-2.0-1.x86_64-signed.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmi.at:242"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_309
#AT_START_310
at_fn_group_banner 310 'rpmi.at:255' \
  "rpm -U <corrupted signed 1>" "                    " 13
at_xfail=no
(
  $as_echo "310. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmi.at:257:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


pkg=\"hello-2.0-1.x86_64-signed.rpm\"
cp \"\${RPMTEST}\"/data/RPMS/\${pkg} \"\${RPMTEST}\"/tmp/\${pkg}
dd if=/dev/zero of=\"\${RPMTEST}\"/tmp/\${pkg} \\
   conv=notrunc bs=1 seek=264 count=2 2> /dev/null

runroot rpm -U --ignorearch --ignoreos --nodeps \\
	/tmp/\${pkg}
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:257"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


pkg="hello-2.0-1.x86_64-signed.rpm"
cp "${RPMTEST}"/data/RPMS/${pkg} "${RPMTEST}"/tmp/${pkg}
dd if=/dev/zero of="${RPMTEST}"/tmp/${pkg} \
   conv=notrunc bs=1 seek=264 count=2 2> /dev/null

runroot rpm -U --ignorearch --ignoreos --nodeps \
	/tmp/${pkg}

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: /tmp/hello-2.0-1.x86_64-signed.rpm: Header RSA signature: BAD (package tag 268: invalid OpenPGP signature)
error: /tmp/hello-2.0-1.x86_64-signed.rpm cannot be installed
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmi.at:257"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_310
#AT_START_311
at_fn_group_banner 311 'rpmi.at:275' \
  "rpm -U <corrupted signed 2>" "                    " 13
at_xfail=no
(
  $as_echo "311. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmi.at:277:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


pkg=\"hello-2.0-1.x86_64-signed.rpm\"
cp \"\${RPMTEST}\"/data/RPMS/\${pkg} \"\${RPMTEST}\"/tmp/\${pkg}
dd if=/dev/zero of=\"\${RPMTEST}\"/tmp/\${pkg} \\
   conv=notrunc bs=1 seek=5555 count=6 2> /dev/null

runroot rpm -U --ignorearch --ignoreos --nodeps \\
	/tmp/\${pkg}
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:277"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


pkg="hello-2.0-1.x86_64-signed.rpm"
cp "${RPMTEST}"/data/RPMS/${pkg} "${RPMTEST}"/tmp/${pkg}
dd if=/dev/zero of="${RPMTEST}"/tmp/${pkg} \
   conv=notrunc bs=1 seek=5555 count=6 2> /dev/null

runroot rpm -U --ignorearch --ignoreos --nodeps \
	/tmp/${pkg}

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: /tmp/hello-2.0-1.x86_64-signed.rpm: Header V4 RSA/SHA256 Signature, key ID 1964c5fc: BAD
error: /tmp/hello-2.0-1.x86_64-signed.rpm: Header SHA256 digest: BAD (Expected ef920781af3bf072ae9888eec3de1c589143101dff9cc0b561468d395fb766d9 != 29fdfe92782fb0470a9a164a6c94af87d3b138c63b39d4c30e0223ca1202ba82)
error: /tmp/hello-2.0-1.x86_64-signed.rpm: Header SHA1 digest: BAD (Expected 5cd9874c510b67b44483f9e382a1649ef7743bac != 4261b2c1eb861a4152c2239bce20bfbcaa8971ba)
error: /tmp/hello-2.0-1.x86_64-signed.rpm cannot be installed
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmi.at:277"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_311
#AT_START_312
at_fn_group_banner 312 'rpmi.at:297' \
  "rpm -U <corrupted signed 3>" "                    " 13
at_xfail=no
(
  $as_echo "312. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmi.at:299:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


pkg=\"hello-2.0-1.x86_64-signed.rpm\"
cp \"\${RPMTEST}\"/data/RPMS/\${pkg} \"\${RPMTEST}\"/tmp/\${pkg}
dd if=/dev/zero of=\"\${RPMTEST}\"/tmp/\${pkg} \\
   conv=notrunc bs=1 seek=7711 count=6 2> /dev/null

echo \"INSTALL 1\"
runroot rpm -U --ignorearch --ignoreos --nodeps \\
	--define \"_pkgverify_level none\" \\
	/tmp/\${pkg} 2>&1

echo \"INSTALL 2\"
runroot rpm -U --ignorearch --ignoreos --nodeps --nosignature \\
	--define \"_pkgverify_level none\" \\
	/tmp/\${pkg} 2>&1

echo \"INSTALL 3\"
runroot rpm -U --ignorearch --ignoreos --nodeps \\
	--define \"_pkgverify_level signature\" \\
	/tmp/\${pkg} 2>&1

echo \"INSTALL 4\"
runroot rpm -U --ignorearch --ignoreos --nodeps \\
	--define \"_pkgverify_flags 0xc0c00\" \\
	--define \"__vsflags 0xc0c00\" \\
	--define \"_pkgverify_level signature\" \\
	/tmp/\${pkg} 2>&1

echo \"INSTALL 5\"
runroot rpm -U --ignorearch --ignoreos --nodeps --noverify \\
	--define \"_pkgverify_level signature\" \\
	/tmp/\${pkg} 2>&1
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:299"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


pkg="hello-2.0-1.x86_64-signed.rpm"
cp "${RPMTEST}"/data/RPMS/${pkg} "${RPMTEST}"/tmp/${pkg}
dd if=/dev/zero of="${RPMTEST}"/tmp/${pkg} \
   conv=notrunc bs=1 seek=7711 count=6 2> /dev/null

echo "INSTALL 1"
runroot rpm -U --ignorearch --ignoreos --nodeps \
	--define "_pkgverify_level none" \
	/tmp/${pkg} 2>&1

echo "INSTALL 2"
runroot rpm -U --ignorearch --ignoreos --nodeps --nosignature \
	--define "_pkgverify_level none" \
	/tmp/${pkg} 2>&1

echo "INSTALL 3"
runroot rpm -U --ignorearch --ignoreos --nodeps \
	--define "_pkgverify_level signature" \
	/tmp/${pkg} 2>&1

echo "INSTALL 4"
runroot rpm -U --ignorearch --ignoreos --nodeps \
	--define "_pkgverify_flags 0xc0c00" \
	--define "__vsflags 0xc0c00" \
	--define "_pkgverify_level signature" \
	/tmp/${pkg} 2>&1

echo "INSTALL 5"
runroot rpm -U --ignorearch --ignoreos --nodeps --noverify \
	--define "_pkgverify_level signature" \
	/tmp/${pkg} 2>&1

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "INSTALL 1
warning: /tmp/hello-2.0-1.x86_64-signed.rpm: Header V4 RSA/SHA256 Signature, key ID 1964c5fc: NOKEY
error: unpacking of archive failed: cpio: Bad magic
error: hello-2.0-1.x86_64: install failed
INSTALL 2
error: unpacking of archive failed: cpio: Bad magic
error: hello-2.0-1.x86_64: install failed
INSTALL 3
warning: /tmp/hello-2.0-1.x86_64-signed.rpm: Header V4 RSA/SHA256 Signature, key ID 1964c5fc: NOKEY
	package hello-2.0-1.x86_64 does not verify: Header V4 RSA/SHA256 Signature, key ID 1964c5fc: NOKEY
INSTALL 4
	package hello-2.0-1.x86_64 does not verify: no signature
INSTALL 5
warning: /tmp/hello-2.0-1.x86_64-signed.rpm: Header V4 RSA/SHA256 Signature, key ID 1964c5fc: NOKEY
error: unpacking of archive failed: cpio: Bad magic
error: hello-2.0-1.x86_64: install failed
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmi.at:299"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_312
#AT_START_313
at_fn_group_banner 313 'rpmi.at:357' \
  "rpm -U *.src.rpm" "                               " 13
at_xfail=no
(
  $as_echo "313. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmi.at:359:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

rm -rf \${TOPDIR}

runroot rpm \\
  -U /data/SRPMS/hello-1.0-1.src.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:359"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

rm -rf ${TOPDIR}

runroot rpm \
  -U /data/SRPMS/hello-1.0-1.src.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo stdout:; cat "$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/rpmi.at:359"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_313
#AT_START_314
at_fn_group_banner 314 'rpmi.at:373' \
  "rpm -i *.src.rpm" "                               " 13
at_xfail=no
(
  $as_echo "314. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmi.at:375:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

rm -rf \${TOPDIR}

runroot rpm \\
  -i /data/SRPMS/hello-1.0-1.src.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:375"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

rm -rf ${TOPDIR}

runroot rpm \
  -i /data/SRPMS/hello-1.0-1.src.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo stdout:; cat "$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/rpmi.at:375"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_314
#AT_START_315
at_fn_group_banner 315 'rpmi.at:390' \
  "rpm -i <nonexistent file>" "                      " 13
at_xfail=no
(
  $as_echo "315. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmi.at:392:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm \\
  -i no_such_file
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:392"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm \
  -i no_such_file

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: open of no_such_file failed: No such file or directory
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmi.at:392"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_315
#AT_START_316
at_fn_group_banner 316 'rpmi.at:403' \
  "rpm -i --nomanifest <garbage text file>" "        " 13
at_xfail=no
(
  $as_echo "316. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmi.at:405:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

junk=\"\${RPMTEST}/textfile\"
cat << EOF > \"\${junk}\"
no_such.file
not_an.rpm
EOF

runroot rpm \\
  -Uv --nomanifest /textfile
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:405"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

junk="${RPMTEST}/textfile"
cat << EOF > "${junk}"
no_such.file
not_an.rpm
EOF

runroot rpm \
  -Uv --nomanifest /textfile

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: /textfile cannot be installed
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmi.at:405"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_316
#AT_START_317
at_fn_group_banner 317 'rpmi.at:422' \
  "rpm -i <garbage text file" "                      " 13
at_xfail=no
(
  $as_echo "317. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmi.at:424:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

junk=\"\${RPMTEST}/not_an.rpm\"
cat << EOF > \"\${junk}\"
no_such.file
not_pkg.rpm
EOF

runroot rpm \\
  -Uv /not_an.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:424"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

junk="${RPMTEST}/not_an.rpm"
cat << EOF > "${junk}"
no_such.file
not_pkg.rpm
EOF

runroot rpm \
  -Uv /not_an.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: open of no_such.file failed: No such file or directory
error: open of not_pkg.rpm failed: No such file or directory
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/rpmi.at:424"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_317
#AT_START_318
at_fn_group_banner 318 'rpmi.at:443' \
  "rpm upgrade/downgrade" "                          " 13
at_xfail=no
(
  $as_echo "318. $at_setup_line: testing $at_desc ..."
  $at_traceon



if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


for v in "1.0" "2.0"; do
    runroot rpmbuild --quiet -bb \
        --define "ver $v" \
          /data/SPECS/versiontest.spec
done

# Test normal upgrade
{ set +x
$as_echo "$at_srcdir/rpmi.at:453:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm -U /build/RPMS/noarch/versiontest-1.0-1.noarch.rpm
runroot rpm -U /build/RPMS/noarch/versiontest-2.0-1.noarch.rpm
runroot rpm -q versiontest
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:453"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm -U /build/RPMS/noarch/versiontest-1.0-1.noarch.rpm
runroot rpm -U /build/RPMS/noarch/versiontest-2.0-1.noarch.rpm
runroot rpm -q versiontest

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "versiontest-2.0-1.noarch
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmi.at:453"
$at_failed && at_fn_log_failure
$at_traceon; }


# Test upgrading to older package (should fail)
{ set +x
$as_echo "$at_srcdir/rpmi.at:465:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/versiontest-2.0-1.noarch.rpm
runroot rpm -U /build/RPMS/noarch/versiontest-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:465"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/versiontest-2.0-1.noarch.rpm
runroot rpm -U /build/RPMS/noarch/versiontest-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "	package versiontest-2.0-1.noarch (which is newer than versiontest-1.0-1.noarch) is already installed
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/rpmi.at:465"
$at_failed && at_fn_log_failure
$at_traceon; }


# Test downgrading to older package with --oldpackage
{ set +x
$as_echo "$at_srcdir/rpmi.at:477:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/versiontest-2.0-1.noarch.rpm
runroot rpm -U --oldpackage /build/RPMS/noarch/versiontest-1.0-1.noarch.rpm
runroot rpm -q versiontest
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:477"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/versiontest-2.0-1.noarch.rpm
runroot rpm -U --oldpackage /build/RPMS/noarch/versiontest-1.0-1.noarch.rpm
runroot rpm -q versiontest

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "versiontest-1.0-1.noarch
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmi.at:477"
$at_failed && at_fn_log_failure
$at_traceon; }


# Test upgrade of different versions in same transaction
{ set +x
$as_echo "$at_srcdir/rpmi.at:490:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -Uv \\
  /build/RPMS/noarch/versiontest-1.0-1.noarch.rpm \\
  /build/RPMS/noarch/versiontest-2.0-1.noarch.rpm
runroot rpm -q versiontest
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:490"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -Uv \
  /build/RPMS/noarch/versiontest-1.0-1.noarch.rpm \
  /build/RPMS/noarch/versiontest-2.0-1.noarch.rpm
runroot rpm -q versiontest

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "warning: package versiontest-1.0-1.noarch was already added, replacing with versiontest-2.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "Verifying packages...
Preparing packages...
versiontest-2.0-1.noarch
versiontest-2.0-1.noarch
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmi.at:490"
$at_failed && at_fn_log_failure
$at_traceon; }


# Test upgrade of different versions in same transaction
{ set +x
$as_echo "$at_srcdir/rpmi.at:508:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -Uv \\
  /build/RPMS/noarch/versiontest-2.0-1.noarch.rpm \\
  /build/RPMS/noarch/versiontest-1.0-1.noarch.rpm
runroot rpm -q versiontest
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:508"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -Uv \
  /build/RPMS/noarch/versiontest-2.0-1.noarch.rpm \
  /build/RPMS/noarch/versiontest-1.0-1.noarch.rpm
runroot rpm -q versiontest

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "warning: package versiontest-2.0-1.noarch was already added, skipping versiontest-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "Verifying packages...
Preparing packages...
versiontest-2.0-1.noarch
versiontest-2.0-1.noarch
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmi.at:508"
$at_failed && at_fn_log_failure
$at_traceon; }


# Test install of two different versions in same transaction
{ set +x
$as_echo "$at_srcdir/rpmi.at:526:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -i \\
  /build/RPMS/noarch/versiontest-1.0-1.noarch.rpm \\
  /build/RPMS/noarch/versiontest-2.0-1.noarch.rpm
runroot rpm -q versiontest
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:526"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -i \
  /build/RPMS/noarch/versiontest-1.0-1.noarch.rpm \
  /build/RPMS/noarch/versiontest-2.0-1.noarch.rpm
runroot rpm -q versiontest

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "versiontest-2.0-1.noarch
versiontest-1.0-1.noarch
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmi.at:526"
$at_failed && at_fn_log_failure
$at_traceon; }


# Test install of two different versions in same transaction
# TODO: test only one was installed
{ set +x
$as_echo "$at_srcdir/rpmi.at:542:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -i \\
  /build/RPMS/noarch/versiontest-1.0-1.noarch.rpm \\
  /build/RPMS/noarch/versiontest-1.0-1.noarch.rpm
runroot rpm -q versiontest
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:542"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -i \
  /build/RPMS/noarch/versiontest-1.0-1.noarch.rpm \
  /build/RPMS/noarch/versiontest-1.0-1.noarch.rpm
runroot rpm -q versiontest

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "versiontest-1.0-1.noarch
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmi.at:542"
$at_failed && at_fn_log_failure
$at_traceon; }

# TODO: the same with epoch vs no epoch
  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_318
#AT_START_319
at_fn_group_banner 319 'rpmi.at:557' \
  "rpm -U obsoleted packages" "                      " 13
at_xfail=no
(
  $as_echo "319. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpmbuild --quiet -bb \
	--define "pkg one" \
	--define "obs deptest-two <= 1.0" \
	/data/SPECS/deptest.spec
runroot rpmbuild --quiet -bb \
	--define "pkg two" \
	/data/SPECS/deptest.spec

# Test upgrade of obsoleted package in same transaction
{ set +x
$as_echo "$at_srcdir/rpmi.at:569:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -Uv \\
  /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm \\
  /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm
runroot rpm -q deptest-one
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:569"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -Uv \
  /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm \
  /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm
runroot rpm -q deptest-one

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "warning: package deptest-two-1.0-1.noarch was already added, replacing with deptest-one-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "Verifying packages...
Preparing packages...
deptest-one-1.0-1.noarch
deptest-one-1.0-1.noarch
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmi.at:569"
$at_failed && at_fn_log_failure
$at_traceon; }


# Test upgrade of obsoleted package in same transaction
{ set +x
$as_echo "$at_srcdir/rpmi.at:587:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -Uv \\
  /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm \\
  /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm
runroot rpm -q deptest-one
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:587"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -Uv \
  /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm \
  /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm
runroot rpm -q deptest-one

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "warning: package deptest-one-1.0-1.noarch was already added, skipping deptest-two-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "Verifying packages...
Preparing packages...
deptest-one-1.0-1.noarch
deptest-one-1.0-1.noarch
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmi.at:587"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_319
#AT_START_320
at_fn_group_banner 320 'rpmi.at:605' \
  "rpm -U with invalid --relocate" "                 " 13
at_xfail=no
(
  $as_echo "320. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmi.at:607:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/hello-script.spec

runroot rpm -U --test --ignoreos --relocate /usr=/opt \\
  /build/RPMS/noarch/hello-script-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:607"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/hello-script.spec

runroot rpm -U --test --ignoreos --relocate /usr=/opt \
  /build/RPMS/noarch/hello-script-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "	path /usr in package hello-script-1.0-1.noarch is not relocatable
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmi.at:607"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_320
#AT_START_321
at_fn_group_banner 321 'rpmi.at:621' \
  "rpm -U --badreloc with invalid --relocate" "      " 13
at_xfail=no
(
  $as_echo "321. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmi.at:623:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/hello-script.spec

runroot rpm -U --test --ignoreos --badreloc --relocate /usr=/opt \\
  /build/RPMS/noarch/hello-script-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:623"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/hello-script.spec

runroot rpm -U --test --ignoreos --badreloc --relocate /usr=/opt \
  /build/RPMS/noarch/hello-script-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmi.at:623"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_321
#AT_START_322
at_fn_group_banner 322 'rpmi.at:636' \
  "rpm -i with/without --excludedocs" "              " 13
at_xfail=no
(
  $as_echo "322. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmi.at:638:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/testdoc.spec

runroot rpm -i --excludedocs \\
  /build/RPMS/noarch/testdoc-1.0-1.noarch.rpm

RPM_DOCDIR=\$(runroot rpm --eval '%_defaultdocdir')
RPM_DATADIR=\$(runroot rpm --eval '%_datadir')

test ! -e \${RPMTEST}\${RPM_DOCDIR}/testdoc || exit 1
test -e \${RPMTEST}\${RPM_DATADIR}/testdoc/nodoc || exit 1

runroot rpm -e testdoc

runroot rpm -i \\
  /build/RPMS/noarch/testdoc-1.0-1.noarch.rpm
test -e \${RPMTEST}\${RPM_DOCDIR}/testdoc/documentation1 || exit 1
test -e \${RPMTEST}\${RPM_DOCDIR}/testdoc/documentation2 || exit 1
test -e \${RPMTEST}\${RPM_DOCDIR}/testdoc/examples/example1 || exit 1
test -e \${RPMTEST}\${RPM_DOCDIR}/testdoc/examples/example2 || exit 1
test -e \${RPMTEST}\${RPM_DATADIR}/testdoc/nodoc || exit 1

runroot rpm -e testdoc
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:638"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/testdoc.spec

runroot rpm -i --excludedocs \
  /build/RPMS/noarch/testdoc-1.0-1.noarch.rpm

RPM_DOCDIR=$(runroot rpm --eval '%_defaultdocdir')
RPM_DATADIR=$(runroot rpm --eval '%_datadir')

test ! -e ${RPMTEST}${RPM_DOCDIR}/testdoc || exit 1
test -e ${RPMTEST}${RPM_DATADIR}/testdoc/nodoc || exit 1

runroot rpm -e testdoc

runroot rpm -i \
  /build/RPMS/noarch/testdoc-1.0-1.noarch.rpm
test -e ${RPMTEST}${RPM_DOCDIR}/testdoc/documentation1 || exit 1
test -e ${RPMTEST}${RPM_DOCDIR}/testdoc/documentation2 || exit 1
test -e ${RPMTEST}${RPM_DOCDIR}/testdoc/examples/example1 || exit 1
test -e ${RPMTEST}${RPM_DOCDIR}/testdoc/examples/example2 || exit 1
test -e ${RPMTEST}${RPM_DATADIR}/testdoc/nodoc || exit 1

runroot rpm -e testdoc

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmi.at:638"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_322
#AT_START_323
at_fn_group_banner 323 'rpmi.at:669' \
  "rpm -i --excludeartifacts" "                      " 13
at_xfail=no
(
  $as_echo "323. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpmbuild --quiet -bb /data/SPECS/vattrtest.spec

{ set +x
$as_echo "$at_srcdir/rpmi.at:674:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm -i --excludeartifacts /build/RPMS/noarch/vattrtest-1.0-1.noarch.rpm
test -e \${RPMTEST}/opt/vattrtest/a && exit 1
runroot rpm -e vattrtest
runroot rpm -i /build/RPMS/noarch/vattrtest-1.0-1.noarch.rpm
test -e \${RPMTEST}/opt/vattrtest/a || exit 1
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:674"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm -i --excludeartifacts /build/RPMS/noarch/vattrtest-1.0-1.noarch.rpm
test -e ${RPMTEST}/opt/vattrtest/a && exit 1
runroot rpm -e vattrtest
runroot rpm -i /build/RPMS/noarch/vattrtest-1.0-1.noarch.rpm
test -e ${RPMTEST}/opt/vattrtest/a || exit 1

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmi.at:674"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_323
#AT_START_324
at_fn_group_banner 324 'rpmi.at:687' \
  "rpm -U <suicidal>" "                              " 13
at_xfail=no
(
  $as_echo "324. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


for r in 1 2; do
    runroot rpmbuild -bb --quiet \
		--define "rel ${r}" \
		/data/SPECS/suicidal.spec
done

{ set +x
$as_echo "$at_srcdir/rpmi.at:697:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


for r in 1 2; do
    runroot rpm -U \\
	--define \"_minimize_writes 0\" \\
	/build/RPMS/noarch/suicidal-1-\${r}.noarch.rpm
done
runroot rpm -V --nouser --nogroup suicidal
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:697"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


for r in 1 2; do
    runroot rpm -U \
	--define "_minimize_writes 0" \
	/build/RPMS/noarch/suicidal-1-${r}.noarch.rpm
done
runroot rpm -V --nouser --nogroup suicidal

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmi.at:697"
$at_failed && at_fn_log_failure
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/rpmi.at:711:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


for r in 1 2; do
    runroot rpm -U \\
	--define \"_minimize_writes 1\" \\
	/build/RPMS/noarch/suicidal-1-\${r}.noarch.rpm
done
runroot rpm -V --nouser --nogroup suicidal
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:711"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


for r in 1 2; do
    runroot rpm -U \
	--define "_minimize_writes 1" \
	/build/RPMS/noarch/suicidal-1-${r}.noarch.rpm
done
runroot rpm -V --nouser --nogroup suicidal

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmi.at:711"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_324
#AT_START_325
at_fn_group_banner 325 'rpmi.at:728' \
  "rpm -i hardlinks" "                               " 13
at_xfail=no
(
  $as_echo "325. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


pkg="/data/RPMS/hlinktest-1.0-1.noarch.rpm"

cp "${RPMTEST}/${pkg}" "${RPMTEST}/tmp/1.rpm"
dd if=/dev/zero of="${RPMTEST}/tmp/1.rpm" \
   conv=notrunc bs=1 seek=8180 count=6 2> /dev/null

cp "${RPMTEST}/${pkg}" "${RPMTEST}/tmp/2.rpm"
dd if=/dev/zero of="${RPMTEST}/tmp/2.rpm" \
   conv=notrunc bs=1 seek=8150 count=6 2> /dev/null

cp "${RPMTEST}/${pkg}" "${RPMTEST}/tmp/3.rpm"
dd if=/dev/zero of="${RPMTEST}/tmp/3.rpm" \
   conv=notrunc bs=1 seek=8050 count=6 2> /dev/null

{ set +x
$as_echo "$at_srcdir/rpmi.at:746:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm -i --noverify /tmp/1.rpm
# test that nothing of the contents remains after failure
test -d \"\${RPMTEST}/foo\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:746"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm -i --noverify /tmp/1.rpm
# test that nothing of the contents remains after failure
test -d "${RPMTEST}/foo"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: unpacking of archive failed: cpio: Archive file not in header
error: hlinktest-1.0-1.noarch: install failed
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmi.at:746"
$at_failed && at_fn_log_failure
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/rpmi.at:758:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm -i --noverify /tmp/2.rpm
# test that nothing of the contents remains after failure
test -d \"\${RPMTEST}/foo\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:758"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm -i --noverify /tmp/2.rpm
# test that nothing of the contents remains after failure
test -d "${RPMTEST}/foo"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: unpacking of archive failed: cpio: Bad/unreadable  header
error: hlinktest-1.0-1.noarch: install failed
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmi.at:758"
$at_failed && at_fn_log_failure
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/rpmi.at:770:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm -i --noverify /tmp/3.rpm 2>&1| sed 's/;.*:/:/g'
# test that nothing of the contents remains after failure
test -d \"\${RPMTEST}/foo\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:770"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm -i --noverify /tmp/3.rpm 2>&1| sed 's/;.*:/:/g'
# test that nothing of the contents remains after failure
test -d "${RPMTEST}/foo"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "error: unpacking of archive failed on file /foo/hello-world: Digest mismatch
error: hlinktest-1.0-1.noarch: install failed
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmi.at:770"
$at_failed && at_fn_log_failure
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/rpmi.at:782:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm -i \"\${pkg}\"
runroot rpm -q --qf \"[%{filenlinks} %{filenames}\\n]%{longsize}\\n\" hlinktest
ls -i \"\${RPMTEST}\"/foo/hello* | awk {'print \$1'} | sort -u | wc -l
runroot rpm -e hlinktest

"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:782"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm -i "${pkg}"
runroot rpm -q --qf "[%{filenlinks} %{filenames}\n]%{longsize}\n" hlinktest
ls -i "${RPMTEST}"/foo/hello* | awk {'print $1'} | sort -u | wc -l
runroot rpm -e hlinktest


) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1 /foo
2 /foo/aaaa
1 /foo/copyllo
4 /foo/hello
4 /foo/hello-bar
4 /foo/hello-foo
4 /foo/hello-world
2 /foo/zzzz
87
1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmi.at:782"
$at_failed && at_fn_log_failure
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/rpmi.at:804:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm -i --excludepath=/foo/zzzz \"\${pkg}\"
runroot rpm -Vv --nogroup --nouser hlinktest
runroot rpm -e hlinktest
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:804"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm -i --excludepath=/foo/zzzz "${pkg}"
runroot rpm -Vv --nogroup --nouser hlinktest
runroot rpm -e hlinktest

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo ".........    /foo
.........    /foo/aaaa
.........    /foo/copyllo
.........    /foo/hello
.........    /foo/hello-bar
.........    /foo/hello-foo
.........    /foo/hello-world
.........    /foo/zzzz (not installed)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmi.at:804"
$at_failed && at_fn_log_failure
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/rpmi.at:822:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm -i --excludepath=/foo/aaaa \"\${pkg}\"
runroot rpm -Vv --nogroup --nouser hlinktest
runroot rpm -e hlinktest
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:822"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm -i --excludepath=/foo/aaaa "${pkg}"
runroot rpm -Vv --nogroup --nouser hlinktest
runroot rpm -e hlinktest

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo ".........    /foo
.........    /foo/aaaa (not installed)
.........    /foo/copyllo
.........    /foo/hello
.........    /foo/hello-bar
.........    /foo/hello-foo
.........    /foo/hello-world
.........    /foo/zzzz
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmi.at:822"
$at_failed && at_fn_log_failure
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/rpmi.at:840:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm -i --excludepath=/foo/aaaa --excludepath=/foo/zzzz \"\${pkg}\"
runroot rpm -Vv --nogroup --nouser hlinktest
runroot rpm -e hlinktest
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:840"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm -i --excludepath=/foo/aaaa --excludepath=/foo/zzzz "${pkg}"
runroot rpm -Vv --nogroup --nouser hlinktest
runroot rpm -e hlinktest

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo ".........    /foo
.........    /foo/aaaa (not installed)
.........    /foo/copyllo
.........    /foo/hello
.........    /foo/hello-bar
.........    /foo/hello-foo
.........    /foo/hello-world
.........    /foo/zzzz (not installed)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmi.at:840"
$at_failed && at_fn_log_failure
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/rpmi.at:858:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm -i --excludepath=/foo/hello-foo \"\${pkg}\"
runroot rpm -Vv --nogroup --nouser hlinktest
runroot rpm -e hlinktest
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmi.at:858"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm -i --excludepath=/foo/hello-foo "${pkg}"
runroot rpm -Vv --nogroup --nouser hlinktest
runroot rpm -e hlinktest

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo ".........    /foo
.........    /foo/aaaa
.........    /foo/copyllo
.........    /foo/hello
.........    /foo/hello-bar
.........    /foo/hello-foo (not installed)
.........    /foo/hello-world
.........    /foo/zzzz
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmi.at:858"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_325
#AT_START_326
at_fn_group_banner 326 'rpmorder.at:3' \
  "basic install/erase order 1" "                    " 14
at_xfail=no
(
  $as_echo "326. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmorder.at:5:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \\
	--define \"pkg one\" \\
	--define \"reqs deptest-two\" \\
	/data/SPECS/deptest.spec
runroot rpmbuild --quiet -bb \\
	--define \"pkg two\" \\
	--define \"ord deptest-three\" \\
	/data/SPECS/deptest.spec
runroot rpmbuild --quiet -bb \\
	--define \"pkg three\" \\
	/data/SPECS/deptest.spec

echo INSTALL:
runroot rpm -Uv --justdb \\
	/build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm \\
	/build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm \\
	/build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm
echo ERASE:
runroot rpm -ev --justdb \\
        deptest-three \\
	deptest-one \\
	deptest-two
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmorder.at:5"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
	--define "pkg one" \
	--define "reqs deptest-two" \
	/data/SPECS/deptest.spec
runroot rpmbuild --quiet -bb \
	--define "pkg two" \
	--define "ord deptest-three" \
	/data/SPECS/deptest.spec
runroot rpmbuild --quiet -bb \
	--define "pkg three" \
	/data/SPECS/deptest.spec

echo INSTALL:
runroot rpm -Uv --justdb \
	/build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm \
	/build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm \
	/build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm
echo ERASE:
runroot rpm -ev --justdb \
        deptest-three \
	deptest-one \
	deptest-two

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "INSTALL:
Verifying packages...
Preparing packages...
deptest-three-1.0-1.noarch
deptest-two-1.0-1.noarch
deptest-one-1.0-1.noarch
ERASE:
Preparing packages...
deptest-one-1.0-1.noarch
deptest-two-1.0-1.noarch
deptest-three-1.0-1.noarch
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmorder.at:5"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_326
#AT_START_327
at_fn_group_banner 327 'rpmorder.at:48' \
  "basic install/erase order 2" "                    " 14
at_xfail=no
(
  $as_echo "327. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmorder.at:50:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \\
	--define \"pkg one\" \\
	--define \"recs deptest-two\" \\
	/data/SPECS/deptest.spec
runroot rpmbuild --quiet -bb \\
	--define \"pkg two\" \\
	--define \"sugs deptest-three\" \\
	/data/SPECS/deptest.spec
runroot rpmbuild --quiet -bb \\
	--define \"pkg three\" \\
	/data/SPECS/deptest.spec

echo INSTALL:
runroot rpm -Uv --justdb \\
	/build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm \\
	/build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm \\
	/build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm
echo ERASE:
runroot rpm -ev --justdb \\
        deptest-three \\
	deptest-one \\
	deptest-two
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmorder.at:50"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
	--define "pkg one" \
	--define "recs deptest-two" \
	/data/SPECS/deptest.spec
runroot rpmbuild --quiet -bb \
	--define "pkg two" \
	--define "sugs deptest-three" \
	/data/SPECS/deptest.spec
runroot rpmbuild --quiet -bb \
	--define "pkg three" \
	/data/SPECS/deptest.spec

echo INSTALL:
runroot rpm -Uv --justdb \
	/build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm \
	/build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm \
	/build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm
echo ERASE:
runroot rpm -ev --justdb \
        deptest-three \
	deptest-one \
	deptest-two

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "INSTALL:
Verifying packages...
Preparing packages...
deptest-three-1.0-1.noarch
deptest-two-1.0-1.noarch
deptest-one-1.0-1.noarch
ERASE:
Preparing packages...
deptest-one-1.0-1.noarch
deptest-two-1.0-1.noarch
deptest-three-1.0-1.noarch
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmorder.at:50"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_327
#AT_START_328
at_fn_group_banner 328 'rpmorder.at:93' \
  "basic install/erase order 3" "                    " 14
at_xfail=no
(
  $as_echo "328. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmorder.at:95:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \\
	--define \"pkg one\" \\
	/data/SPECS/deptest.spec
runroot rpmbuild --quiet -bb \\
	--define \"pkg two\" \\
	--define \"sups deptest-one\" \\
	/data/SPECS/deptest.spec
runroot rpmbuild --quiet -bb \\
	--define \"pkg three\" \\
	--define \"ens deptest-two\" \\
	/data/SPECS/deptest.spec

echo INSTALL:
runroot rpm -Uv --justdb \\
	/build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm \\
	/build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm \\
	/build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm
echo ERASE:
runroot rpm -ev --justdb \\
        deptest-three \\
	deptest-one \\
	deptest-two
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmorder.at:95"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
	--define "pkg one" \
	/data/SPECS/deptest.spec
runroot rpmbuild --quiet -bb \
	--define "pkg two" \
	--define "sups deptest-one" \
	/data/SPECS/deptest.spec
runroot rpmbuild --quiet -bb \
	--define "pkg three" \
	--define "ens deptest-two" \
	/data/SPECS/deptest.spec

echo INSTALL:
runroot rpm -Uv --justdb \
	/build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm \
	/build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm \
	/build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm
echo ERASE:
runroot rpm -ev --justdb \
        deptest-three \
	deptest-one \
	deptest-two

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "INSTALL:
Verifying packages...
Preparing packages...
deptest-three-1.0-1.noarch
deptest-two-1.0-1.noarch
deptest-one-1.0-1.noarch
ERASE:
Preparing packages...
deptest-one-1.0-1.noarch
deptest-two-1.0-1.noarch
deptest-three-1.0-1.noarch
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmorder.at:95"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_328
#AT_START_329
at_fn_group_banner 329 'rpmbuild.at:23' \
  "rpmbuild -ba *.spec" "                            " 15
at_xfail=no
(
  $as_echo "329. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

{ set +x
$as_echo "$at_srcdir/rpmbuild.at:26:

run rpmbuild \\
  -ba \"\${abs_srcdir}\"/data/SPECS/hello.spec
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmbuild.at:26"
( $at_check_trace;

run rpmbuild \
  -ba "${abs_srcdir}"/data/SPECS/hello.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo stdout:; cat "$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:26"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_329
#AT_START_330
at_fn_group_banner 330 'rpmbuild.at:36' \
  "rpmbuild -ba autosetup" "                         " 15
at_xfail=no
(
  $as_echo "330. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

{ set +x
$as_echo "$at_srcdir/rpmbuild.at:39:

run rpmbuild \\
  -ba \"\${abs_srcdir}\"/data/SPECS/hello-auto.spec
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmbuild.at:39"
( $at_check_trace;

run rpmbuild \
  -ba "${abs_srcdir}"/data/SPECS/hello-auto.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo stdout:; cat "$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:39"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_330
#AT_START_331
at_fn_group_banner 331 'rpmbuild.at:51' \
  "rpmbuild --rebuild" "                             " 15
at_xfail=no
(
  $as_echo "331. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

{ set +x
$as_echo "$at_srcdir/rpmbuild.at:54:

run rpmbuild \\
  --rebuild \"\${abs_srcdir}\"/data/SRPMS/hello-1.0-1.src.rpm
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmbuild.at:54"
( $at_check_trace;

run rpmbuild \
  --rebuild "${abs_srcdir}"/data/SRPMS/hello-1.0-1.src.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo stdout:; cat "$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:54"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_331
#AT_START_332
at_fn_group_banner 332 'rpmbuild.at:64' \
  "rpmbuild --short-circuit -bl" "                   " 15
at_xfail=no
(
  $as_echo "332. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

{ set +x
$as_echo "$at_srcdir/rpmbuild.at:67:

run rpmbuild -bi \"\${abs_srcdir}\"/data/SPECS/hello.spec &> /dev/null
run rpmbuild --quiet -bl --short-circuit \"\${abs_srcdir}\"/data/SPECS/hello.spec
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmbuild.at:67"
( $at_check_trace;

run rpmbuild -bi "${abs_srcdir}"/data/SPECS/hello.spec &> /dev/null
run rpmbuild --quiet -bl --short-circuit "${abs_srcdir}"/data/SPECS/hello.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:67"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_332
#AT_START_333
at_fn_group_banner 333 'rpmbuild.at:79' \
  "rpmbuild -tb <tar with bad spec>" "               " 15
at_xfail=no
(
  $as_echo "333. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

{ set +x
$as_echo "$at_srcdir/rpmbuild.at:82:

runroot rpmbuild \\
  -tb /data/SOURCES/hello-1.0.tar.gz
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmbuild.at:82"
( $at_check_trace;

runroot rpmbuild \
  -tb /data/SOURCES/hello-1.0.tar.gz

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: line 5: Unknown tag: Serial:	1
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo stdout:; cat "$at_stdout"
at_fn_check_status 1 $at_status "$at_srcdir/rpmbuild.at:82"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_333
#AT_START_334
at_fn_group_banner 334 'rpmbuild.at:93' \
  "rpmbuild -ts <spec>" "                            " 15
at_xfail=no
(
  $as_echo "334. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

{ set +x
$as_echo "$at_srcdir/rpmbuild.at:96:

runroot rpmbuild --quiet -ts /data/SOURCES/hello-2.0.tar.gz
runroot rpm -qpl /build/SRPMS/hello-2.0-1.src.rpm
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmbuild.at:96"
( $at_check_trace;

runroot rpmbuild --quiet -ts /data/SOURCES/hello-2.0.tar.gz
runroot rpm -qpl /build/SRPMS/hello-2.0-1.src.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "hello-2.0.tar.gz
hello.spec
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:96"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_334
#AT_START_335
at_fn_group_banner 335 'rpmbuild.at:109' \
  "rpmbuild package with weird filenames" "          " 15
at_xfail=no
(
  $as_echo "335. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

{ set +x
$as_echo "$at_srcdir/rpmbuild.at:112:

runroot rpmbuild -bb --quiet /data/SPECS/weirdnames.spec
runroot rpm -qpl /build/RPMS/noarch/weirdnames-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmbuild.at:112"
( $at_check_trace;

runroot rpmbuild -bb --quiet /data/SPECS/weirdnames.spec
runroot rpm -qpl /build/RPMS/noarch/weirdnames-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "/opt/!absolutely
/opt/#nocomment
/opt/\$talks
/opt/&ground
/opt/(maybe)
/opt/<namehere>
/opt/\\.back
/opt/after{all}
/opt/bar\"ed
/opt/equals=not
/opt/foo'ed
/opt/index[this]
/opt/just space
/opt/perhaps;not
/opt/tee|two
/opt/the * are falling
/opt/to?be
/opt/true:false
/opt/~right
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:112"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_335
#AT_START_336
at_fn_group_banner 336 'rpmbuild.at:141' \
  "rpmbuild package with illegal filenames" "        " 15
at_xfail=no
(
  $as_echo "336. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

{ set +x
$as_echo "$at_srcdir/rpmbuild.at:144:
# XXX current output is not well suited for grab + compare, just ignore
runroot rpmbuild -bb --quiet --with illegal /data/SPECS/weirdnames.spec
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmbuild.at:144"
( $at_check_trace;
# XXX current output is not well suited for grab + compare, just ignore
runroot rpmbuild -bb --quiet --with illegal /data/SPECS/weirdnames.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmbuild.at:144"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_336
#AT_START_337
at_fn_group_banner 337 'rpmbuild.at:156' \
  "rpmbuild -tb" "                                   " 15
at_xfail=no
(
  $as_echo "337. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

{ set +x
$as_echo "$at_srcdir/rpmbuild.at:159:

run rpmbuild \\
  -ta \"\${RPMDATA}/SOURCES/hello-2.0.tar.gz\"
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmbuild.at:159"
( $at_check_trace;

run rpmbuild \
  -ta "${RPMDATA}/SOURCES/hello-2.0.tar.gz"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo stdout:; cat "$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:159"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_337
#AT_START_338
at_fn_group_banner 338 'rpmbuild.at:169' \
  "rpmbuild scriptlet -f" "                          " 15
at_xfail=no
(
  $as_echo "338. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

{ set +x
$as_echo "$at_srcdir/rpmbuild.at:172:

runroot rpmbuild \\
	-bb --quiet /data/SPECS/scriptfile.spec
runroot rpm -qp --scripts --triggers --filetriggers \\
	/build/RPMS/noarch/scriptfile-1-1.noarch.rpm
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmbuild.at:172"
( $at_check_trace;

runroot rpmbuild \
	-bb --quiet /data/SPECS/scriptfile.spec
runroot rpm -qp --scripts --triggers --filetriggers \
	/build/RPMS/noarch/scriptfile-1-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "preinstall scriptlet (using /bin/sh):
#!/bin/sh
echo one

postuninstall scriptlet (using /bin/sh):
#!/bin/sh
echo two

triggerin scriptlet (using /bin/sh) -- scriptfile
#!/bin/sh
echo one

triggerun scriptlet (using /bin/sh) -- scriptfile
#!/bin/sh
echo two

filetriggerin scriptlet (using /bin/sh) -- /path
#!/bin/sh
echo one

filetriggerin scriptlet (using /bin/sh) -- /path
#!/bin/sh
echo two

transfiletriggerin scriptlet (using /bin/sh) -- /path
#!/bin/sh
echo one

transfiletriggerun scriptlet (using /bin/sh) -- /path
#!/bin/sh
echo two

" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:172"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_338
#AT_START_339
at_fn_group_banner 339 'rpmbuild.at:218' \
  "rpmbuild %attr and %defattr" "                    " 15
at_xfail=no
(
  $as_echo "339. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

{ set +x
$as_echo "$at_srcdir/rpmbuild.at:221:

runroot rpmbuild \\
  -bb --quiet /data/SPECS/attrtest.spec

runroot rpm -qp --qf \\
  \"\\n[%{filemodes:perms} %-8{fileusername} %-8{filegroupname} %{filenames}\\n]\"\\
  /build/RPMS/noarch/attrtest-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmbuild.at:221"
( $at_check_trace;

runroot rpmbuild \
  -bb --quiet /data/SPECS/attrtest.spec

runroot rpm -qp --qf \
  "\n[%{filemodes:perms} %-8{fileusername} %-8{filegroupname} %{filenames}\n]"\
  /build/RPMS/noarch/attrtest-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "
drwx------ root     root     /a/dir
-r-------- root     root     /a/file
drwx------ daemon   adm      /b/dir
-r-------- daemon   adm      /b/file
drwxr-x--- root     adm      /c/dir
-rw-r----- daemon   root     /c/file
drwxr-x--x daemon   bin      /d/dir
-rw-r--r-- bin      daemon   /d/file
drwx------ foo      bar      /e/dir
-r-------- foo      bar      /e/file
drwxrwx--- bar      foo      /f/dir
-rw-rw---- bar      foo      /f/file
drwx------ adm      foo      /g/dir
-r-------- bar      adm      /g/file
drwxr-xr-x foo      bar      /h/dir
-rw-r--r-- foo      bar      /h/file
drwxr-x--- adm      root     /i/dir
-rwsr-xr-x root     adm      /i/file
drwxrwxrwx zoot     zoot     /j/dir
--w--w--w- zoot     zoot     /j/file
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:221"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_339
#AT_START_340
at_fn_group_banner 340 'rpmbuild.at:256' \
  "rpmbuild unpackaged files" "                      " 15
at_xfail=no
(
  $as_echo "340. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

{ set +x
$as_echo "$at_srcdir/rpmbuild.at:259:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild \\
  -bb --quiet --with unpackaged_files /data/SPECS/hlinktest.spec
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:259"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild \
  -bb --quiet --with unpackaged_files /data/SPECS/hlinktest.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Installed (but unpackaged) file(s) found:
   /toot
    Installed (but unpackaged) file(s) found:
   /toot
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmbuild.at:259"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_340
#AT_START_341
at_fn_group_banner 341 'rpmbuild.at:275' \
  "rpmbuild unpackaged directories" "                " 15
at_xfail=no
      test $RPM_XFAIL -ne 0 && at_xfail=yes
(
  $as_echo "341. $at_setup_line: testing $at_desc ..."
  $at_traceon





if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

{ set +x
$as_echo "$at_srcdir/rpmbuild.at:279:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild \\
  -bb --quiet --with unpackaged_dirs /data/SPECS/hlinktest.spec
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:279"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild \
  -bb --quiet --with unpackaged_dirs /data/SPECS/hlinktest.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Installed (but unpackaged) file(s) found:
   /zoo
    Installed (but unpackaged) file(s) found:
   /zoo
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmbuild.at:279"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_341
#AT_START_342
at_fn_group_banner 342 'rpmbuild.at:294' \
  "rpmbuild glob" "                                  " 15
at_xfail=no
(
  $as_echo "342. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

{ set +x
$as_echo "$at_srcdir/rpmbuild.at:297:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild -bb --quiet /data/SPECS/globtest.spec
runroot rpm -qp \\
	--qf \"[%{filemodes:perms} %{filenames}\\n]\" \\
	/build/RPMS/noarch/globtest-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:297"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild -bb --quiet /data/SPECS/globtest.spec
runroot rpm -qp \
	--qf "[%{filemodes:perms} %{filenames}\n]" \
	/build/RPMS/noarch/globtest-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "warning: absolute symlink: /opt/globtest/linkbad -> /opt/globtest/zub
warning: absolute symlink: /opt/globtest/linkgood -> /opt/globtest/zab
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-rw-r--r-- /opt/globtest/baf
drwxr-xr-x /opt/globtest/bang
-rw-r--r-- /opt/globtest/bif
drwxr-xr-x /opt/globtest/bing
drwxr-xr-x /opt/globtest/bong
drwxr-xr-x /opt/globtest/foo
-rw-r--r-- /opt/globtest/foo/one
-rw-r--r-- /opt/globtest/foo/three
-rw-r--r-- /opt/globtest/foo/two
lrwxrwxrwx /opt/globtest/linkbad
lrwxrwxrwx /opt/globtest/linkgood
-rw-r--r-- /opt/globtest/weird%name
-rw-r--r-- /opt/globtest/zab
-rw-r--r-- /opt/globtest/zeb
-rw-r--r-- /opt/globtest/zib
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:297"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_342
#AT_START_343
at_fn_group_banner 343 'rpmbuild.at:327' \
  "rpmbuild prefixpostfix" "                         " 15
at_xfail=no
(
  $as_echo "343. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmbuild.at:329:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild -bb --quiet \\
	/data/SPECS/prefixtest.spec
runroot rpm -qp \\
	--qf \"[%{filemodes:perms} %{filenames}\\n]\" \\
	/build/RPMS/noarch/prefixtest-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:329"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild -bb --quiet \
	/data/SPECS/prefixtest.spec
runroot rpm -qp \
	--qf "[%{filemodes:perms} %{filenames}\n]" \
	/build/RPMS/noarch/prefixtest-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "warning: absolute symlink: /opt/prefixtest/linkbad -> /opt/prefixtest/zub
warning: absolute symlink: /opt/prefixtest/linkgood -> /opt/prefixtest/zab
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "-rw-r--r-- /opt/prefixtest/ba
drwxr-xr-x /opt/prefixtest/ban
-rw-r--r-- /opt/prefixtest/bi
drwxr-xr-x /opt/prefixtest/bin
drwxr-xr-x /opt/prefixtest/bon
drwxr-xr-x /opt/prefixtest/foo
-rw-r--r-- /opt/prefixtest/foo/one
-rw-r--r-- /opt/prefixtest/foo/three
-rw-r--r-- /opt/prefixtest/foo/two
lrwxrwxrwx /opt/prefixtest/linkbad
lrwxrwxrwx /opt/prefixtest/linkgood
-rw-r--r-- /opt/prefixtest/weird%name
-rw-r--r-- /opt/prefixtest/zab
-rw-r--r-- /opt/prefixtest/zeb
-rw-r--r-- /opt/prefixtest/zib
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:329"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_343
#AT_START_344
at_fn_group_banner 344 'rpmbuild.at:362' \
  "Weak and reverse requires" "                      " 15
at_xfail=no
(
  $as_echo "344. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmbuild.at:364:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild -bb --quiet \\
	--define \"pkg weakdeps\" \\
	--define \"recs foo > 1.2.3\" \\
	--define \"sugs bar >= 0.1.2\" \\
	--define \"sups baz\" \\
	--define \"ens zap = 3\" \\
	  /data/SPECS/deptest.spec

runroot rpm -qp --recommends /build/RPMS/noarch/deptest-weakdeps-1.0-1.noarch.rpm
runroot rpm -qp --suggests /build/RPMS/noarch/deptest-weakdeps-1.0-1.noarch.rpm
runroot rpm -qp --supplements /build/RPMS/noarch/deptest-weakdeps-1.0-1.noarch.rpm
runroot rpm -qp --enhances /build/RPMS/noarch/deptest-weakdeps-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:364"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild -bb --quiet \
	--define "pkg weakdeps" \
	--define "recs foo > 1.2.3" \
	--define "sugs bar >= 0.1.2" \
	--define "sups baz" \
	--define "ens zap = 3" \
	  /data/SPECS/deptest.spec

runroot rpm -qp --recommends /build/RPMS/noarch/deptest-weakdeps-1.0-1.noarch.rpm
runroot rpm -qp --suggests /build/RPMS/noarch/deptest-weakdeps-1.0-1.noarch.rpm
runroot rpm -qp --supplements /build/RPMS/noarch/deptest-weakdeps-1.0-1.noarch.rpm
runroot rpm -qp --enhances /build/RPMS/noarch/deptest-weakdeps-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "foo > 1.2.3
bar >= 0.1.2
baz
zap = 3
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:364"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_344
#AT_START_345
at_fn_group_banner 345 'rpmbuild.at:391' \
  "Build requires" "                                 " 15
at_xfail=no
(
  $as_echo "345. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmbuild.at:393:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild -bb --quiet \\
		--define \"pkg buildreq\" \\
		--define \"buildreqs foo > 1.2.3\" \\
		/data/SPECS/deptest.spec
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:393"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild -bb --quiet \
		--define "pkg buildreq" \
		--define "buildreqs foo > 1.2.3" \
		/data/SPECS/deptest.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Failed build dependencies:
	foo > 1.2.3 is needed by deptest-buildreq-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 11 $at_status "$at_srcdir/rpmbuild.at:393"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_345
#AT_START_346
at_fn_group_banner 346 'rpmbuild.at:408' \
  "Dependency generation 1" "                        " 15
at_xfail=no
(
  $as_echo "346. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmbuild.at:410:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild -bb --quiet \\
		--define \"_binary_payload w9.gzdio\" \\
		/data/SPECS/filedep.spec
echo Requires:
runroot rpm  -qp --requires /build/RPMS/noarch/filedep-1.0-1.noarch.rpm
echo Provides:
runroot rpm -qp --provides /build/RPMS/noarch/filedep-1.0-1.noarch.rpm
echo Filerequires:
runroot rpm -qp --qf '[\"%{FILENAMES}\\t%{FILEREQUIRE}\"\\n]' /build/RPMS/noarch/filedep-1.0-1.noarch.rpm
echo Fileprovides:
runroot rpm -qp --qf '[\"%{FILENAMES}\\t%{FILEPROVIDE}\"\\n]' /build/RPMS/noarch/filedep-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:410"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild -bb --quiet \
		--define "_binary_payload w9.gzdio" \
		/data/SPECS/filedep.spec
echo Requires:
runroot rpm  -qp --requires /build/RPMS/noarch/filedep-1.0-1.noarch.rpm
echo Provides:
runroot rpm -qp --provides /build/RPMS/noarch/filedep-1.0-1.noarch.rpm
echo Filerequires:
runroot rpm -qp --qf '["%{FILENAMES}\t%{FILEREQUIRE}"\n]' /build/RPMS/noarch/filedep-1.0-1.noarch.rpm
echo Fileprovides:
runroot rpm -qp --qf '["%{FILENAMES}\t%{FILEPROVIDE}"\n]' /build/RPMS/noarch/filedep-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "Requires:
/bin/f00f
/bin/sh
rpmlib(CompressedFileNames) <= 3.0.4-1
rpmlib(FileDigests) <= 4.6.0-1
rpmlib(PayloadFilesHavePrefix) <= 4.0-1
Provides:
filedep = 1.0-1
Filerequires:
\"/etc/foo.conf	\"
\"/usr/bin/bar	/bin/f00f\"
\"/usr/bin/foo	/bin/sh\"
\"/usr/share/doc/filedep	\"
\"/usr/share/doc/filedep/README	\"
Fileprovides:
\"/etc/foo.conf	\"
\"/usr/bin/bar	\"
\"/usr/bin/foo	\"
\"/usr/share/doc/filedep	\"
\"/usr/share/doc/filedep/README	\"
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:410"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_346
#AT_START_347
at_fn_group_banner 347 'rpmbuild.at:450' \
  "Dependency generation 2" "                        " 15
at_xfail=no
(
  $as_echo "347. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmbuild.at:452:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild -bb --quiet \\
		/data/SPECS/shebang.spec
runroot rpm -qp --requires /build/RPMS/noarch/shebang-0.1-1.noarch.rpm|grep -v ^rpmlib
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:452"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild -bb --quiet \
		/data/SPECS/shebang.spec
runroot rpm -qp --requires /build/RPMS/noarch/shebang-0.1-1.noarch.rpm|grep -v ^rpmlib

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "/bin/blabla
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:452"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_347
#AT_START_348
at_fn_group_banner 348 'rpmbuild.at:465' \
  "Dependency generation 3" "                        " 15
at_xfail=no
(
  $as_echo "348. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmbuild.at:467:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


cat << EOF > \"\${RPMTEST}\"/tmp/bad.req
#!/bin/sh
echo 'bad = *'
EOF
chmod a+x \"\${RPMTEST}\"/tmp/bad.req

runroot rpmbuild -bb --quiet \\
		--define \"__script_requires /tmp/bad.req\" \\
		/data/SPECS/shebang.spec
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:467"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


cat << EOF > "${RPMTEST}"/tmp/bad.req
#!/bin/sh
echo 'bad = *'
EOF
chmod a+x "${RPMTEST}"/tmp/bad.req

runroot rpmbuild -bb --quiet \
		--define "__script_requires /tmp/bad.req" \
		/data/SPECS/shebang.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Illegal char '*' (0x2a) in: *
    Illegal char '*' (0x2a) in: *
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmbuild.at:467"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_348
#AT_START_349
at_fn_group_banner 349 'rpmbuild.at:487' \
  "Dependency generation 4" "                        " 15
at_xfail=no
(
  $as_echo "349. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmbuild.at:489:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild -bb --quiet \\
		--define '__script_requires() foo(%{basename:%{1}})' \\
		/data/SPECS/shebang.spec
runroot rpm -qp --requires /build/RPMS/noarch/shebang-0.1-1.noarch.rpm|grep -v ^rpmlib
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:489"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild -bb --quiet \
		--define '__script_requires() foo(%{basename:%{1}})' \
		/data/SPECS/shebang.spec
runroot rpm -qp --requires /build/RPMS/noarch/shebang-0.1-1.noarch.rpm|grep -v ^rpmlib

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo(shebang)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:489"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_349
#AT_START_350
at_fn_group_banner 350 'rpmbuild.at:503' \
  "Dependency generation 5" "                        " 15
at_xfail=no
(
  $as_echo "350. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmbuild.at:505:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild -bb --quiet \\
		--define '__script_mime text/plain' \\
		--undefine '__script_magic' \\
		/data/SPECS/shebang.spec
runroot rpm -qp --requires /build/RPMS/noarch/shebang-0.1-1.noarch.rpm|grep -v ^rpmlib
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:505"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild -bb --quiet \
		--define '__script_mime text/plain' \
		--undefine '__script_magic' \
		/data/SPECS/shebang.spec
runroot rpm -qp --requires /build/RPMS/noarch/shebang-0.1-1.noarch.rpm|grep -v ^rpmlib

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "/bin/blabla
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:505"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_350
#AT_START_351
at_fn_group_banner 351 'rpmbuild.at:520' \
  "elf dependencies" "                               " 15
at_xfail=no
(
  $as_echo "351. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


{ set +x
$as_echo "$at_srcdir/rpmbuild.at:524:
runroot_other chmod a-x /data/misc/libhello.so
runroot_other \${RPM_CONFIGDIR}/elfdeps -R /data/misc/libhello.so
runroot_other chmod a+x /data/misc/libhello.so
runroot_other \${RPM_CONFIGDIR}/elfdeps -R /data/misc/libhello.so
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmbuild.at:524"
( $at_check_trace;
runroot_other chmod a-x /data/misc/libhello.so
runroot_other ${RPM_CONFIGDIR}/elfdeps -R /data/misc/libhello.so
runroot_other chmod a+x /data/misc/libhello.so
runroot_other ${RPM_CONFIGDIR}/elfdeps -R /data/misc/libhello.so

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "libc.so.6(GLIBC_2.2.5)(64bit)
libc.so.6()(64bit)
rtld(GNU_HASH)
libc.so.6(GLIBC_2.2.5)(64bit)
libc.so.6()(64bit)
rtld(GNU_HASH)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:524"
$at_failed && at_fn_log_failure
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/rpmbuild.at:540:
runroot_other chmod a-x /data/misc/libhello.so
runroot_other \${RPM_CONFIGDIR}/elfdeps -P /data/misc/libhello.so
runroot_other chmod a+x /data/misc/libhello.so
runroot_other \${RPM_CONFIGDIR}/elfdeps -P /data/misc/libhello.so
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmbuild.at:540"
( $at_check_trace;
runroot_other chmod a-x /data/misc/libhello.so
runroot_other ${RPM_CONFIGDIR}/elfdeps -P /data/misc/libhello.so
runroot_other chmod a+x /data/misc/libhello.so
runroot_other ${RPM_CONFIGDIR}/elfdeps -P /data/misc/libhello.so

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "libhello.so()(64bit)
libhello.so()(64bit)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:540"
$at_failed && at_fn_log_failure
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/rpmbuild.at:552:
runroot_other chmod a-x /data/misc/helloexe
runroot_other \${RPM_CONFIGDIR}/elfdeps -R /data/misc/helloexe
runroot_other chmod a+x /data/misc/helloexe
runroot_other \${RPM_CONFIGDIR}/elfdeps -R /data/misc/helloexe
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmbuild.at:552"
( $at_check_trace;
runroot_other chmod a-x /data/misc/helloexe
runroot_other ${RPM_CONFIGDIR}/elfdeps -R /data/misc/helloexe
runroot_other chmod a+x /data/misc/helloexe
runroot_other ${RPM_CONFIGDIR}/elfdeps -R /data/misc/helloexe

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "libc.so.6(GLIBC_2.2.5)(64bit)
libhello.so()(64bit)
libc.so.6()(64bit)
rtld(GNU_HASH)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:552"
$at_failed && at_fn_log_failure
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/rpmbuild.at:566:
runroot_other chmod a-x /data/misc/hellopie
runroot_other \${RPM_CONFIGDIR}/elfdeps -R /data/misc/hellopie
runroot_other chmod a+x /data/misc/hellopie
runroot_other \${RPM_CONFIGDIR}/elfdeps -R /data/misc/hellopie
"
at_fn_check_prepare_notrace 'a ${...} parameter expansion' "rpmbuild.at:566"
( $at_check_trace;
runroot_other chmod a-x /data/misc/hellopie
runroot_other ${RPM_CONFIGDIR}/elfdeps -R /data/misc/hellopie
runroot_other chmod a+x /data/misc/hellopie
runroot_other ${RPM_CONFIGDIR}/elfdeps -R /data/misc/hellopie

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "libc.so.6(GLIBC_2.2.5)(64bit)
libhello.so()(64bit)
libc.so.6()(64bit)
rtld(GNU_HASH)
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:566"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_351
#AT_START_352
at_fn_group_banner 352 'rpmbuild.at:583' \
  "rpmspec query 1" "                                " 15
at_xfail=no
(
  $as_echo "352. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmbuild.at:585:

runroot rpmspec -q \\
		--define \"pkg dep\" \\
		--define \"reqs foo > 1.2.3 bar <= 2.3\" \\
		--requires \\
		/data/SPECS/deptest.spec
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmbuild.at:585"
( $at_check_trace;

runroot rpmspec -q \
		--define "pkg dep" \
		--define "reqs foo > 1.2.3 bar <= 2.3" \
		--requires \
		/data/SPECS/deptest.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "bar <= 2.3
foo > 1.2.3
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:585"
$at_failed && at_fn_log_failure
$at_traceon; }


  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_352
#AT_START_353
at_fn_group_banner 353 'rpmbuild.at:603' \
  "rpmbuild archive sanity" "                        " 15
at_xfail=no
(
  $as_echo "353. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmbuild.at:605:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild \\
  -bb --quiet /data/SPECS/attrtest.spec

runroot rpm2cpio \\
  /build/RPMS/noarch/attrtest-1.0-1.noarch.rpm > \"\${RPMTEST}\"/tmp/attrtest.cpio
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:605"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild \
  -bb --quiet /data/SPECS/attrtest.spec

runroot rpm2cpio \
  /build/RPMS/noarch/attrtest-1.0-1.noarch.rpm > "${RPMTEST}"/tmp/attrtest.cpio

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:605"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_353
#AT_START_354
at_fn_group_banner 354 'rpmbuild.at:621' \
  "rpmbuild debuginfo minisymtab" "                  " 15
at_xfail=no
(
  $as_echo "354. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuild.at:623" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuild.at:623"
{ set +x
$as_echo "$at_srcdir/rpmbuild.at:624:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


# Use macros.debug to generate a debuginfo package.
export CFLAGS=\"-g\"
rundebug rpmbuild --quiet \\
  --rebuild \"\${abs_srcdir}\"/data/SRPMS/hello-1.0-1.src.rpm

# Extract the main package and inspect the hello binary
# It should contain .gnu_debugdata, but not the full .symtab
rpm2cpio \${RPMTEST}/build/RPMS/*/hello-1.0-1.*.rpm | cpio -diu
test -f ./usr/local/bin/hello || exit 1
readelf -S ./usr/local/bin/hello |\\
   grep -q .gnu_debugdata; test \$? == 0 || exit 1
readelf -S ./usr/local/bin/hello \\
  | grep -q .symtab; test \$? == 1 || exit 1

# And the opposite for the debuginfo package
rpm2cpio \${RPMTEST}/build/RPMS/*/hello-debuginfo-1.0-1.*.rpm \\
  | cpio -diu
test -f ./usr/lib/debug/usr/local/bin/hello*.debug || exit 1
readelf -S ./usr/lib/debug/usr/local/bin/hello*.debug \\
  | grep -q .gnu_debugdata; test \$? == 1 || exit 1
readelf -S ./usr/lib/debug/usr/local/bin/hello*.debug \\
  | grep -q .symtab; test \$? == 0 || exit 1
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:624"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


# Use macros.debug to generate a debuginfo package.
export CFLAGS="-g"
rundebug rpmbuild --quiet \
  --rebuild "${abs_srcdir}"/data/SRPMS/hello-1.0-1.src.rpm

# Extract the main package and inspect the hello binary
# It should contain .gnu_debugdata, but not the full .symtab
rpm2cpio ${RPMTEST}/build/RPMS/*/hello-1.0-1.*.rpm | cpio -diu
test -f ./usr/local/bin/hello || exit 1
readelf -S ./usr/local/bin/hello |\
   grep -q .gnu_debugdata; test $? == 0 || exit 1
readelf -S ./usr/local/bin/hello \
  | grep -q .symtab; test $? == 1 || exit 1

# And the opposite for the debuginfo package
rpm2cpio ${RPMTEST}/build/RPMS/*/hello-debuginfo-1.0-1.*.rpm \
  | cpio -diu
test -f ./usr/lib/debug/usr/local/bin/hello*.debug || exit 1
readelf -S ./usr/lib/debug/usr/local/bin/hello*.debug \
  | grep -q .gnu_debugdata; test $? == 1 || exit 1
readelf -S ./usr/lib/debug/usr/local/bin/hello*.debug \
  | grep -q .symtab; test $? == 0 || exit 1

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:624"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_354
#AT_START_355
at_fn_group_banner 355 'rpmbuild.at:659' \
  "rpmbuild debuginfo minisymtab strip -g" "         " 15
at_xfail=no
(
  $as_echo "355. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuild.at:661" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuild.at:661"
{ set +x
$as_echo "$at_srcdir/rpmbuild.at:662:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


# Use macros.debug to generate a debuginfo package.
export CFLAGS=\"-g\"
rundebug rpmbuild --quiet \\
  --define=\"_find_debuginfo_opts -g\" \\
  --rebuild \"\${abs_srcdir}\"/data/SRPMS/hello-1.0-1.src.rpm

# Extract the main package and inspect the hello binary
# It should contain .symtab (because of strip -g), so doesn't .gnu_debugdata.
rpm2cpio \${RPMTEST}/build/RPMS/*/hello-1.0-1.*.rpm | cpio -diu
test -f ./usr/local/bin/hello || exit 1
readelf -S ./usr/local/bin/hello \\
  | grep -q .gnu_debugdata; test \$? == 1 || exit 1
readelf -S ./usr/local/bin/hello \\
  | grep -q .symtab; test \$? == 0 || exit 1

# The debuginfo package should contain neither. The .symtab is NOBITS.
rpm2cpio \${RPMTEST}/build/RPMS/*/hello-debuginfo-1.0-1.*.rpm \\
  | cpio -diu
test -f ./usr/lib/debug/usr/local/bin/hello*.debug || exit 1
readelf -S ./usr/lib/debug/usr/local/bin/hello*.debug \\
  | grep -q .gnu_debugdata; test \$? == 1 || exit 1
readelf -S ./usr/lib/debug/usr/local/bin/hello*.debug \\
  | grep .symtab | grep -q NOBITS; test \$? == 0 || exit 1
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:662"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


# Use macros.debug to generate a debuginfo package.
export CFLAGS="-g"
rundebug rpmbuild --quiet \
  --define="_find_debuginfo_opts -g" \
  --rebuild "${abs_srcdir}"/data/SRPMS/hello-1.0-1.src.rpm

# Extract the main package and inspect the hello binary
# It should contain .symtab (because of strip -g), so doesn't .gnu_debugdata.
rpm2cpio ${RPMTEST}/build/RPMS/*/hello-1.0-1.*.rpm | cpio -diu
test -f ./usr/local/bin/hello || exit 1
readelf -S ./usr/local/bin/hello \
  | grep -q .gnu_debugdata; test $? == 1 || exit 1
readelf -S ./usr/local/bin/hello \
  | grep -q .symtab; test $? == 0 || exit 1

# The debuginfo package should contain neither. The .symtab is NOBITS.
rpm2cpio ${RPMTEST}/build/RPMS/*/hello-debuginfo-1.0-1.*.rpm \
  | cpio -diu
test -f ./usr/lib/debug/usr/local/bin/hello*.debug || exit 1
readelf -S ./usr/lib/debug/usr/local/bin/hello*.debug \
  | grep -q .gnu_debugdata; test $? == 1 || exit 1
readelf -S ./usr/lib/debug/usr/local/bin/hello*.debug \
  | grep .symtab | grep -q NOBITS; test $? == 0 || exit 1

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:662"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_355
#AT_START_356
at_fn_group_banner 356 'rpmbuild.at:699' \
  "rpmbuild debuginfo dwz" "                         " 15
at_xfail=no
(
  $as_echo "356. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuild.at:701" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuild.at:701"
{ set +x
$as_echo "$at_srcdir/rpmbuild.at:702:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


rundebug rpmbuild --quiet \\
  --undefine \"_unique_debug_names\" \\
  --undefine \"_unique_debug_srcs\" \\
  -ba \"\${abs_srcdir}\"/data/SPECS/hello2.spec

# The debuginfo package should contain a .debug file for each binary
# and a dwz multi file that contains the shared debuginfo between them.
rpm2cpio \${RPMTEST}/build/RPMS/*/hello2-debuginfo-1.0-1.*.rpm \\
  | cpio -diu

hello_file_debug=./usr/lib/debug/usr/local/bin/hello.debug
hello2_file_debug=./usr/lib/debug/usr/local/bin/hello2.debug
hello_multi_file=./usr/lib/debug/.dwz/hello2-1.0-1.*
test -f \$hello_file_debug || echo \"no hello debug file: \$hello_file_debug\"
test -f \$hello2_file_debug || echo \"no hello2 debug file: \$hello2_file_debug\"
test -f \$hello_multi_file || echo \"no dwz multi file: \$hello_multi_file\"

# Make sure the main package binaries contain the correct build-ids
# linking them to the debug packages.
rpm2cpio \${RPMTEST}/build/RPMS/*/hello2-1.0-1.*.rpm \\
  | cpio -diu
hello_file=./usr/local/bin/hello
hello2_file=./usr/local/bin/hello2
test -f \$hello_file || echo \"no hello file: \$hello_file\"
test -f \$hello2_file || echo \"no hello2 file: \$hello2_file\"

id1=\$(file \$hello_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')
id2=\$(file \$hello2_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')
id1debug=\$(file \$hello_file_debug | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')
id2debug=\$(file \$hello2_file_debug | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')
idmulti=\$(file \$hello_multi_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')

test \"\$id1\" = \"\$id1debug\" || echo \"id1: \$id1 != id1debug: \$id1debug\"
test \"\$id2\" = \"\$id2debug\" || echo \"id2: \$id2 != id2debug: \$id2debug\"

# The build-id files should link to the .debug files.
id1file=\"./usr/lib/debug/.build-id/\${id1:0:2}/\${id1:2}\"
canonid1file=\$(readlink -f \${id1file})
canonfile1=\$(readlink -f \$hello_file)
canonid1debug=\$(readlink -f \${id1file}.debug)
canondebug1=\$(readlink -f \$hello_file_debug)

test \"\$canonid1file\" = \"\$canonfile1\" \\
  || echo \"canonid1file: \$canonid1file != \$canonfile1\"
test \"\$canonid1debug\" = \"\$canondebug1\" \\
  || echo \"canonid1debug: \$canonid1debug != \$canondebug1\"

id2file=\"./usr/lib/debug/.build-id/\${id2:0:2}/\${id2:2}\"
canonid2file=\$(readlink -f \${id2file})
canonfile2=\$(readlink -f \$hello2_file)
canonid2debug=\$(readlink -f \${id2file}.debug)
canondebug2=\$(readlink -f \$hello2_file_debug)

test \"\$canonid2file\" = \"\$canonfile2\" \\
  || echo \"canonid2: \$canonid2file != \$canonfile2\"
test \"\$canonid2debug\" = \"\$canondebug2\" \\
  || echo \"canonid2debug: \$canonid2debug\" != \"\$canondebug2\"

# Both .debug files should point to the dwz multi file.
# It would be nice to also test that they contain the correct dwz build-id
# but that is a bit hard to grep out of the section data.
multiref1=\$(readelf --string-dump=.gnu_debugaltlink \$hello_file_debug \\
  | grep '     0' | cut -c13-)
multiref2=\$(readelf --string-dump=.gnu_debugaltlink \$hello2_file_debug \\
  | grep '     0' | cut -c13-)

test \"\$multiref1\" = \"\$multiref2\" || echo \"multiref: \$multiref1 != \$multiref2\"

canonmultiref=\$(readlink -f \$(dirname \$canondebug1)/\$multiref1)
canonmultifile=\$(readlink -f \$hello_multi_file)

test \"\$canonmultiref\" = \"\$canonmultifile\" \\
  || echo \"canonmultiref: \$canonmultiref\" != \"\$canonmultifile\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:702"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


rundebug rpmbuild --quiet \
  --undefine "_unique_debug_names" \
  --undefine "_unique_debug_srcs" \
  -ba "${abs_srcdir}"/data/SPECS/hello2.spec

# The debuginfo package should contain a .debug file for each binary
# and a dwz multi file that contains the shared debuginfo between them.
rpm2cpio ${RPMTEST}/build/RPMS/*/hello2-debuginfo-1.0-1.*.rpm \
  | cpio -diu

hello_file_debug=./usr/lib/debug/usr/local/bin/hello.debug
hello2_file_debug=./usr/lib/debug/usr/local/bin/hello2.debug
hello_multi_file=./usr/lib/debug/.dwz/hello2-1.0-1.*
test -f $hello_file_debug || echo "no hello debug file: $hello_file_debug"
test -f $hello2_file_debug || echo "no hello2 debug file: $hello2_file_debug"
test -f $hello_multi_file || echo "no dwz multi file: $hello_multi_file"

# Make sure the main package binaries contain the correct build-ids
# linking them to the debug packages.
rpm2cpio ${RPMTEST}/build/RPMS/*/hello2-1.0-1.*.rpm \
  | cpio -diu
hello_file=./usr/local/bin/hello
hello2_file=./usr/local/bin/hello2
test -f $hello_file || echo "no hello file: $hello_file"
test -f $hello2_file || echo "no hello2 file: $hello2_file"

id1=$(file $hello_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')
id2=$(file $hello2_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')
id1debug=$(file $hello_file_debug | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')
id2debug=$(file $hello2_file_debug | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')
idmulti=$(file $hello_multi_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')

test "$id1" = "$id1debug" || echo "id1: $id1 != id1debug: $id1debug"
test "$id2" = "$id2debug" || echo "id2: $id2 != id2debug: $id2debug"

# The build-id files should link to the .debug files.
id1file="./usr/lib/debug/.build-id/${id1:0:2}/${id1:2}"
canonid1file=$(readlink -f ${id1file})
canonfile1=$(readlink -f $hello_file)
canonid1debug=$(readlink -f ${id1file}.debug)
canondebug1=$(readlink -f $hello_file_debug)

test "$canonid1file" = "$canonfile1" \
  || echo "canonid1file: $canonid1file != $canonfile1"
test "$canonid1debug" = "$canondebug1" \
  || echo "canonid1debug: $canonid1debug != $canondebug1"

id2file="./usr/lib/debug/.build-id/${id2:0:2}/${id2:2}"
canonid2file=$(readlink -f ${id2file})
canonfile2=$(readlink -f $hello2_file)
canonid2debug=$(readlink -f ${id2file}.debug)
canondebug2=$(readlink -f $hello2_file_debug)

test "$canonid2file" = "$canonfile2" \
  || echo "canonid2: $canonid2file != $canonfile2"
test "$canonid2debug" = "$canondebug2" \
  || echo "canonid2debug: $canonid2debug" != "$canondebug2"

# Both .debug files should point to the dwz multi file.
# It would be nice to also test that they contain the correct dwz build-id
# but that is a bit hard to grep out of the section data.
multiref1=$(readelf --string-dump=.gnu_debugaltlink $hello_file_debug \
  | grep '     0' | cut -c13-)
multiref2=$(readelf --string-dump=.gnu_debugaltlink $hello2_file_debug \
  | grep '     0' | cut -c13-)

test "$multiref1" = "$multiref2" || echo "multiref: $multiref1 != $multiref2"

canonmultiref=$(readlink -f $(dirname $canondebug1)/$multiref1)
canonmultifile=$(readlink -f $hello_multi_file)

test "$canonmultiref" = "$canonmultifile" \
  || echo "canonmultiref: $canonmultiref" != "$canonmultifile"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:702"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_356
#AT_START_357
at_fn_group_banner 357 'rpmbuild.at:786' \
  "rpmbuild no debuginfo" "                          " 15
at_xfail=no
(
  $as_echo "357. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuild.at:788" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuild.at:788"
{ set +x
$as_echo "$at_srcdir/rpmbuild.at:789:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


# Use macros.debug to generate a debuginfo package,
# but pass --nodebuginfo to skip it.
export CFLAGS=\"-g\"
rundebug rpmbuild --quiet --nodebuginfo \\
  --rebuild \"\${abs_srcdir}\"/data/SRPMS/hello-1.0-1.src.rpm

# Extract the main package and inspect the hello binary
# It should not contain .gnu_debugdata, but the full .symtab
rpm2cpio \${RPMTEST}/build/RPMS/*/hello-1.0-1.*.rpm | cpio -diu
test -f ./usr/local/bin/hello || exit 1
readelf -S ./usr/local/bin/hello |\\
   grep -q .gnu_debugdata; test \$? == 1 || exit 1
readelf -S ./usr/local/bin/hello \\
  | grep -q .symtab; test \$? == 0 || exit 1

# And the opposite for the debuginfo package
test ! -e \${RPMTEST}/build/RPMS/*/hello-debuginfo-1.0-1.*.rpm || exit 1
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:789"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


# Use macros.debug to generate a debuginfo package,
# but pass --nodebuginfo to skip it.
export CFLAGS="-g"
rundebug rpmbuild --quiet --nodebuginfo \
  --rebuild "${abs_srcdir}"/data/SRPMS/hello-1.0-1.src.rpm

# Extract the main package and inspect the hello binary
# It should not contain .gnu_debugdata, but the full .symtab
rpm2cpio ${RPMTEST}/build/RPMS/*/hello-1.0-1.*.rpm | cpio -diu
test -f ./usr/local/bin/hello || exit 1
readelf -S ./usr/local/bin/hello |\
   grep -q .gnu_debugdata; test $? == 1 || exit 1
readelf -S ./usr/local/bin/hello \
  | grep -q .symtab; test $? == 0 || exit 1

# And the opposite for the debuginfo package
test ! -e ${RPMTEST}/build/RPMS/*/hello-debuginfo-1.0-1.*.rpm || exit 1

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:789"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_357
#AT_START_358
at_fn_group_banner 358 'rpmbuild.at:820' \
  "rpmbuild debuginfo dwz unique debug names" "      " 15
at_xfail=no
(
  $as_echo "358. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuild.at:822" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuild.at:822"
{ set +x
$as_echo "$at_srcdir/rpmbuild.at:823:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


rundebug rpmbuild --quiet \\
  --define \"_unique_debug_names 1\" \\
  -ba \"\${abs_srcdir}\"/data/SPECS/hello2.spec

# The debuginfo package should contain a .debug file for each binary
# and a dwz multi file that contains the shared debuginfo between them.
rpm2cpio \${RPMTEST}/build/RPMS/*/hello2-debuginfo-1.0-1.*.rpm \\
  | cpio -diu

hello_file_debug=./usr/lib/debug/usr/local/bin/hello-*.debug
hello2_file_debug=./usr/lib/debug/usr/local/bin/hello2-*.debug
hello_multi_file=./usr/lib/debug/.dwz/hello2-1.0-1.*
test -f \$hello_file_debug || echo \"no hello debug file: \$hello_file_debug\"
test -f \$hello2_file_debug || echo \"no hello2 debug file: \$hello2_file_debug\"
test -f \$hello_multi_file || echo \"no dwz multi file: \$hello_multi_file\"

# Make sure the main package binaries contain the correct build-ids
# linking them to the debug packages.
rpm2cpio \${RPMTEST}/build/RPMS/*/hello2-1.0-1.*.rpm \\
  | cpio -diu
hello_file=./usr/local/bin/hello
hello2_file=./usr/local/bin/hello2
test -f \$hello_file || echo \"no hello file: \$hello_file\"
test -f \$hello2_file || echo \"no hello2 file: \$hello2_file\"

id1=\$(file \$hello_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')
id2=\$(file \$hello2_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')
id1debug=\$(file \$hello_file_debug | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')
id2debug=\$(file \$hello2_file_debug | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')
idmulti=\$(file \$hello_multi_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')

test \"\$id1\" = \"\$id1debug\" || echo \"id1: \$id1 != id1debug: \$id1debug\"
test \"\$id2\" = \"\$id2debug\" || echo \"id2: \$id2 != id2debug: \$id2debug\"

# The build-id files should link to the .debug files.
id1file=\"./usr/lib/debug/.build-id/\${id1:0:2}/\${id1:2}\"
canonid1file=\$(readlink -f \${id1file})
canonfile1=\$(readlink -f \$hello_file)
canonid1debug=\$(readlink -f \${id1file}.debug)
canondebug1=\$(readlink -f \$hello_file_debug)

test \"\$canonid1file\" = \"\$canonfile1\" \\
  || echo \"canonid1file: \$canonid1file != \$canonfile1\"
test \"\$canonid1debug\" = \"\$canondebug1\" \\
  || echo \"canonid1debug: \$canonid1debug != \$canondebug1\"

id2file=\"./usr/lib/debug/.build-id/\${id2:0:2}/\${id2:2}\"
canonid2file=\$(readlink -f \${id2file})
canonfile2=\$(readlink -f \$hello2_file)
canonid2debug=\$(readlink -f \${id2file}.debug)
canondebug2=\$(readlink -f \$hello2_file_debug)

test \"\$canonid2file\" = \"\$canonfile2\" \\
  || echo \"canonid2: \$canonid2file != \$canonfile2\"
test \"\$canonid2debug\" = \"\$canondebug2\" \\
  || echo \"canonid2debug: \$canonid2debug\" != \"\$canondebug2\"

# Both .debug files should point to the dwz multi file.
# It would be nice to also test that they contain the correct dwz build-id
# but that is a bit hard to grep out of the section data.
multiref1=\$(readelf --string-dump=.gnu_debugaltlink \$hello_file_debug \\
  | grep '     0' | cut -c13-)
multiref2=\$(readelf --string-dump=.gnu_debugaltlink \$hello2_file_debug \\
  | grep '     0' | cut -c13-)

test \"\$multiref1\" = \"\$multiref2\" || echo \"multiref: \$multiref1 != \$multiref2\"

canonmultiref=\$(readlink -f \$(dirname \$canondebug1)/\$multiref1)
canonmultifile=\$(readlink -f \$hello_multi_file)

test \"\$canonmultiref\" = \"\$canonmultifile\" \\
  || echo \"canonmultiref: \$canonmultiref\" != \"\$canonmultifile\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:823"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


rundebug rpmbuild --quiet \
  --define "_unique_debug_names 1" \
  -ba "${abs_srcdir}"/data/SPECS/hello2.spec

# The debuginfo package should contain a .debug file for each binary
# and a dwz multi file that contains the shared debuginfo between them.
rpm2cpio ${RPMTEST}/build/RPMS/*/hello2-debuginfo-1.0-1.*.rpm \
  | cpio -diu

hello_file_debug=./usr/lib/debug/usr/local/bin/hello-*.debug
hello2_file_debug=./usr/lib/debug/usr/local/bin/hello2-*.debug
hello_multi_file=./usr/lib/debug/.dwz/hello2-1.0-1.*
test -f $hello_file_debug || echo "no hello debug file: $hello_file_debug"
test -f $hello2_file_debug || echo "no hello2 debug file: $hello2_file_debug"
test -f $hello_multi_file || echo "no dwz multi file: $hello_multi_file"

# Make sure the main package binaries contain the correct build-ids
# linking them to the debug packages.
rpm2cpio ${RPMTEST}/build/RPMS/*/hello2-1.0-1.*.rpm \
  | cpio -diu
hello_file=./usr/local/bin/hello
hello2_file=./usr/local/bin/hello2
test -f $hello_file || echo "no hello file: $hello_file"
test -f $hello2_file || echo "no hello2 file: $hello2_file"

id1=$(file $hello_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')
id2=$(file $hello2_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')
id1debug=$(file $hello_file_debug | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')
id2debug=$(file $hello2_file_debug | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')
idmulti=$(file $hello_multi_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')

test "$id1" = "$id1debug" || echo "id1: $id1 != id1debug: $id1debug"
test "$id2" = "$id2debug" || echo "id2: $id2 != id2debug: $id2debug"

# The build-id files should link to the .debug files.
id1file="./usr/lib/debug/.build-id/${id1:0:2}/${id1:2}"
canonid1file=$(readlink -f ${id1file})
canonfile1=$(readlink -f $hello_file)
canonid1debug=$(readlink -f ${id1file}.debug)
canondebug1=$(readlink -f $hello_file_debug)

test "$canonid1file" = "$canonfile1" \
  || echo "canonid1file: $canonid1file != $canonfile1"
test "$canonid1debug" = "$canondebug1" \
  || echo "canonid1debug: $canonid1debug != $canondebug1"

id2file="./usr/lib/debug/.build-id/${id2:0:2}/${id2:2}"
canonid2file=$(readlink -f ${id2file})
canonfile2=$(readlink -f $hello2_file)
canonid2debug=$(readlink -f ${id2file}.debug)
canondebug2=$(readlink -f $hello2_file_debug)

test "$canonid2file" = "$canonfile2" \
  || echo "canonid2: $canonid2file != $canonfile2"
test "$canonid2debug" = "$canondebug2" \
  || echo "canonid2debug: $canonid2debug" != "$canondebug2"

# Both .debug files should point to the dwz multi file.
# It would be nice to also test that they contain the correct dwz build-id
# but that is a bit hard to grep out of the section data.
multiref1=$(readelf --string-dump=.gnu_debugaltlink $hello_file_debug \
  | grep '     0' | cut -c13-)
multiref2=$(readelf --string-dump=.gnu_debugaltlink $hello2_file_debug \
  | grep '     0' | cut -c13-)

test "$multiref1" = "$multiref2" || echo "multiref: $multiref1 != $multiref2"

canonmultiref=$(readlink -f $(dirname $canondebug1)/$multiref1)
canonmultifile=$(readlink -f $hello_multi_file)

test "$canonmultiref" = "$canonmultifile" \
  || echo "canonmultiref: $canonmultiref" != "$canonmultifile"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:823"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_358
#AT_START_359
at_fn_group_banner 359 'rpmbuild.at:907' \
  "rpmbuild implicit suid binary" "                  " 15
at_xfail=no
(
  $as_echo "359. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuild.at:909" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuild.at:909"
{ set +x
$as_echo "$at_srcdir/rpmbuild.at:910:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


# Build a package that has some debuginfo
rundebug rpmbuild --quiet \\
  -ba \"\${abs_srcdir}\"/data/SPECS/hello2-suid.spec

# Unpack rpm so we can check the included binaries.
rpm2cpio \${RPMTEST}/build/RPMS/*/hello2-1.0-1.*.rpm \\
  | cpio -diu --quiet

# List all binaries with suid bit set (should be one, hello).
echo \"suid:\"
find usr -executable -type f -perm /4000
# List all binaries without suid bit set (should also be one, hello2).
echo \"no-suid:\"
find usr -executable -type f \\! -perm /4000
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:910"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


# Build a package that has some debuginfo
rundebug rpmbuild --quiet \
  -ba "${abs_srcdir}"/data/SPECS/hello2-suid.spec

# Unpack rpm so we can check the included binaries.
rpm2cpio ${RPMTEST}/build/RPMS/*/hello2-1.0-1.*.rpm \
  | cpio -diu --quiet

# List all binaries with suid bit set (should be one, hello).
echo "suid:"
find usr -executable -type f -perm /4000
# List all binaries without suid bit set (should also be one, hello2).
echo "no-suid:"
find usr -executable -type f \! -perm /4000

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "suid:
usr/local/bin/hello
no-suid:
usr/local/bin/hello2
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:910"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_359
#AT_START_360
at_fn_group_banner 360 'rpmbuild.at:939' \
  "rpmbuild debuginfo gdb index included" "          " 15
at_xfail=no
(
  $as_echo "360. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuild.at:941" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuild.at:941"
{ set +x
$as_echo "$at_srcdir/rpmbuild.at:942:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


# Build a package that has some debuginfo
rundebug rpmbuild --quiet \\
  --define \"_include_gdb_index 1\" \\
  -ba \"\${abs_srcdir}\"/data/SPECS/hello2.spec

# Unpack the debuginfo rpms so we can check the .debug files.
rpm2cpio \${RPMTEST}/build/RPMS/*/hello2-debuginfo-1.0-1.*.rpm \\
  | cpio -diu --quiet

# Check that gdb-add-index has ran and a .gdb_index section has been added
readelf -S ./usr/lib/debug/usr/local/bin/hello2*.debug \\
  | grep gdb_index | cut -c8-17
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:942"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


# Build a package that has some debuginfo
rundebug rpmbuild --quiet \
  --define "_include_gdb_index 1" \
  -ba "${abs_srcdir}"/data/SPECS/hello2.spec

# Unpack the debuginfo rpms so we can check the .debug files.
rpm2cpio ${RPMTEST}/build/RPMS/*/hello2-debuginfo-1.0-1.*.rpm \
  | cpio -diu --quiet

# Check that gdb-add-index has ran and a .gdb_index section has been added
readelf -S ./usr/lib/debug/usr/local/bin/hello2*.debug \
  | grep gdb_index | cut -c8-17

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo ".gdb_index
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:942"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_360
#AT_START_361
at_fn_group_banner 361 'rpmbuild.at:966' \
  "rpmbuild debuginfo no gdb index included" "       " 15
at_xfail=no
(
  $as_echo "361. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuild.at:968" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuild.at:968"
{ set +x
$as_echo "$at_srcdir/rpmbuild.at:969:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


# Build a package that has some debuginfo
rundebug rpmbuild --quiet \\
  --undefine \"_include_gdb_index\" \\
  -ba \"\${abs_srcdir}\"/data/SPECS/hello2.spec

# Unpack the debuginfo rpms so we can check the .debug files.
rpm2cpio \${RPMTEST}/build/RPMS/*/hello2-debuginfo-1.0-1.*.rpm \\
  | cpio -diu --quiet

# Check that gdb-add-index has not ran and no .gdb_index section has been added
readelf -S ./usr/lib/debug/usr/local/bin/hello2*.debug \\
  | grep gdb_index | cut -c8-17
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:969"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


# Build a package that has some debuginfo
rundebug rpmbuild --quiet \
  --undefine "_include_gdb_index" \
  -ba "${abs_srcdir}"/data/SPECS/hello2.spec

# Unpack the debuginfo rpms so we can check the .debug files.
rpm2cpio ${RPMTEST}/build/RPMS/*/hello2-debuginfo-1.0-1.*.rpm \
  | cpio -diu --quiet

# Check that gdb-add-index has not ran and no .gdb_index section has been added
readelf -S ./usr/lib/debug/usr/local/bin/hello2*.debug \
  | grep gdb_index | cut -c8-17

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:969"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_361
#AT_START_362
at_fn_group_banner 362 'rpmbuild.at:992' \
  "rpmbuild debuginfo -g3 .debug_macro" "            " 15
at_xfail=no
(
  $as_echo "362. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuild.at:994" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuild.at:994"
{ set +x
$as_echo "$at_srcdir/rpmbuild.at:995:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


# Build a package that has some debuginfo generated with -g3.
# Specifically it uses -DDEBUG_DEFINE=1, which we want to see back
# in the .debug_macro section of the .debug file.
rundebug rpmbuild --quiet \\
  --define \"_include_gdb_index 1\" \\
  -ba \"\${abs_srcdir}\"/data/SPECS/hello-g3.spec

# Unpack the debuginfo rpms so we can check the .debug files.
rpm2cpio \${RPMTEST}/build/RPMS/*/hello-g3-debuginfo-1.0-1.*.rpm \\
  | cpio -diu --quiet

# We are looking for a line like:
#  DW_MACRO_define_strp - lineno : 0 macro : DEBUG_DEFINE 1
readelf --debug-dump=macro ./usr/lib/debug/usr/local/bin/hello-g3*.debug \\
  | grep DEBUG_DEFINE | cut -f3 -d:
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:995"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


# Build a package that has some debuginfo generated with -g3.
# Specifically it uses -DDEBUG_DEFINE=1, which we want to see back
# in the .debug_macro section of the .debug file.
rundebug rpmbuild --quiet \
  --define "_include_gdb_index 1" \
  -ba "${abs_srcdir}"/data/SPECS/hello-g3.spec

# Unpack the debuginfo rpms so we can check the .debug files.
rpm2cpio ${RPMTEST}/build/RPMS/*/hello-g3-debuginfo-1.0-1.*.rpm \
  | cpio -diu --quiet

# We are looking for a line like:
#  DW_MACRO_define_strp - lineno : 0 macro : DEBUG_DEFINE 1
readelf --debug-dump=macro ./usr/lib/debug/usr/local/bin/hello-g3*.debug \
  | grep DEBUG_DEFINE | cut -f3 -d:

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo " DEBUG_DEFINE 1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:995"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_362
#AT_START_363
at_fn_group_banner 363 'rpmbuild.at:1023' \
  "rpmbuild debuginfo unique debug src dir" "        " 15
at_xfail=no
(
  $as_echo "363. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuild.at:1025" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuild.at:1025"
{ set +x
$as_echo "$at_srcdir/rpmbuild.at:1026:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


# Build a package that has some debuginfo
# Note that the spec defines hello2 as name, but the source is hello-1.0.
# Disable dwz to make debuginfo path rewrite checking easier.
rundebug rpmbuild --quiet \\
  --undefine \"_find_debuginfo_dwz_opts\" \\
  --define \"_unique_debug_srcs 1\" \\
  -ba \"\${abs_srcdir}\"/data/SPECS/hello2.spec

# Unpack the debuginfo rpms so we can check the .debug files.
rpm2cpio \${RPMTEST}/build/RPMS/*/hello2-debuginfo-1.0-1.*.rpm \\
  | cpio -diu --quiet

# Check that the source path is \"unique\"
# Drop the final arch prefix to make the test arch-independent.
ls ./usr/src/debug/ | cut -f1,2 -d\\.

# Check that the source path has been rewritten in the .debug file.
# Drop the final arch prefix to make the test arch-independent.
readelf --debug-dump=info ./usr/lib/debug/usr/local/bin/hello2*.debug \\
  | grep comp_dir | sed -e 's/\\t\$//' | cut -f5- -d/ | cut -f1,2 -d\\.
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:1026"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


# Build a package that has some debuginfo
# Note that the spec defines hello2 as name, but the source is hello-1.0.
# Disable dwz to make debuginfo path rewrite checking easier.
rundebug rpmbuild --quiet \
  --undefine "_find_debuginfo_dwz_opts" \
  --define "_unique_debug_srcs 1" \
  -ba "${abs_srcdir}"/data/SPECS/hello2.spec

# Unpack the debuginfo rpms so we can check the .debug files.
rpm2cpio ${RPMTEST}/build/RPMS/*/hello2-debuginfo-1.0-1.*.rpm \
  | cpio -diu --quiet

# Check that the source path is "unique"
# Drop the final arch prefix to make the test arch-independent.
ls ./usr/src/debug/ | cut -f1,2 -d\.

# Check that the source path has been rewritten in the .debug file.
# Drop the final arch prefix to make the test arch-independent.
readelf --debug-dump=info ./usr/lib/debug/usr/local/bin/hello2*.debug \
  | grep comp_dir | sed -e 's/\t$//' | cut -f5- -d/ | cut -f1,2 -d\.

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "hello2-1.0-1
hello2-1.0-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:1026"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_363
#AT_START_364
at_fn_group_banner 364 'rpmbuild.at:1060' \
  "rpmbuild debuginfo no unique debug src dir" "     " 15
at_xfail=no
(
  $as_echo "364. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuild.at:1062" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuild.at:1062"
{ set +x
$as_echo "$at_srcdir/rpmbuild.at:1063:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


# Build a package that has some debuginfo
# Note that the spec defines hello2 as name, but the source is hello-1.0.
# Disable dwz to make debuginfo path rewrite checking easier.
rundebug rpmbuild --quiet \\
  --undefine \"_find_debuginfo_dwz_opts\" \\
  --undefine \"_unique_debug_srcs\" \\
  -ba \"\${abs_srcdir}\"/data/SPECS/hello2.spec

# Unpack the debuginfo rpms so we can check the .debug files.
rpm2cpio \${RPMTEST}/build/RPMS/*/hello2-debuginfo-1.0-1.*.rpm \\
  | cpio -diu --quiet

# Check that the source path is \"unique\"
ls ./usr/src/debug/

# Check that the source path has been rewritten in the .debug file.
readelf --debug-dump=info ./usr/lib/debug/usr/local/bin/hello2*.debug \\
  | grep comp_dir | sed -e 's/\\t\$//' | cut -f5- -d/
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:1063"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


# Build a package that has some debuginfo
# Note that the spec defines hello2 as name, but the source is hello-1.0.
# Disable dwz to make debuginfo path rewrite checking easier.
rundebug rpmbuild --quiet \
  --undefine "_find_debuginfo_dwz_opts" \
  --undefine "_unique_debug_srcs" \
  -ba "${abs_srcdir}"/data/SPECS/hello2.spec

# Unpack the debuginfo rpms so we can check the .debug files.
rpm2cpio ${RPMTEST}/build/RPMS/*/hello2-debuginfo-1.0-1.*.rpm \
  | cpio -diu --quiet

# Check that the source path is "unique"
ls ./usr/src/debug/

# Check that the source path has been rewritten in the .debug file.
readelf --debug-dump=info ./usr/lib/debug/usr/local/bin/hello2*.debug \
  | grep comp_dir | sed -e 's/\t$//' | cut -f5- -d/

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "hello-1.0
hello-1.0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:1063"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_364
#AT_START_365
at_fn_group_banner 365 'rpmbuild.at:1094' \
  "rpmbuild debugsource" "                           " 15
at_xfail=no
(
  $as_echo "365. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuild.at:1096" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuild.at:1096"
{ set +x
$as_echo "$at_srcdir/rpmbuild.at:1097:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


rundebug rpmbuild --quiet \\
  --define \"_debugsource_packages 1\" \\
  -ba \"\${abs_srcdir}\"/data/SPECS/hello2.spec

# Unpack the debugsource rpm so we can check the sources are there.
rpm2cpio \${RPMTEST}/build/RPMS/*/hello2-debugsource-1.0-1.*.rpm \\
  | cpio -diu --quiet

# Check that hello.c is there.
ls ./usr/src/debug/hello2-1.0*/

# The debuginfo package should recommend the debugsource package (ignore arch).
echo -n \"Recommends: \"
runroot rpm -qp --recommends /build/RPMS/*/hello2-debuginfo-1.0-1.*.rpm | sed -E 's/([-.a-z0-9]+)\\(.*\\) = ([-.0-9]+)/\\1\\(ignore-arch\\) = \\2/'
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:1097"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


rundebug rpmbuild --quiet \
  --define "_debugsource_packages 1" \
  -ba "${abs_srcdir}"/data/SPECS/hello2.spec

# Unpack the debugsource rpm so we can check the sources are there.
rpm2cpio ${RPMTEST}/build/RPMS/*/hello2-debugsource-1.0-1.*.rpm \
  | cpio -diu --quiet

# Check that hello.c is there.
ls ./usr/src/debug/hello2-1.0*/

# The debuginfo package should recommend the debugsource package (ignore arch).
echo -n "Recommends: "
runroot rpm -qp --recommends /build/RPMS/*/hello2-debuginfo-1.0-1.*.rpm | sed -E 's/([-.a-z0-9]+)\(.*\) = ([-.0-9]+)/\1\(ignore-arch\) = \2/'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "hello.c
Recommends: hello2-debugsource(ignore-arch) = 1.0-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:1097"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_365
#AT_START_366
at_fn_group_banner 366 'rpmbuild.at:1126' \
  "rpmbuild debugsource debugsourcefiles.list path" "" 15
at_xfail=no
(
  $as_echo "366. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuild.at:1128" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuild.at:1128"
{ set +x
$as_echo "$at_srcdir/rpmbuild.at:1129:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


rundebug rpmbuild --quiet \\
  --define \"_debugsource_packages 1\" \\
  -ba \"\${abs_srcdir}\"/data/SPECS/hello-cd.spec

# Unpack the debuginfo rpms so we can check the sources are there.
rpm2cpio \${RPMTEST}/build/RPMS/*/test-debugsource-1.0-1.*.rpm \\
  | cpio -diu --quiet

# Check that hello.c is there.
ls ./usr/src/debug/test-1.0*/
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:1129"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


rundebug rpmbuild --quiet \
  --define "_debugsource_packages 1" \
  -ba "${abs_srcdir}"/data/SPECS/hello-cd.spec

# Unpack the debuginfo rpms so we can check the sources are there.
rpm2cpio ${RPMTEST}/build/RPMS/*/test-debugsource-1.0-1.*.rpm \
  | cpio -diu --quiet

# Check that hello.c is there.
ls ./usr/src/debug/test-1.0*/

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "hello.c
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:1129"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_366
#AT_START_367
at_fn_group_banner 367 'rpmbuild.at:1151' \
  "rpmbuild debuginfo subpackages single" "          " 15
at_xfail=no
(
  $as_echo "367. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuild.at:1153" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuild.at:1153"
{ set +x
$as_echo "$at_srcdir/rpmbuild.at:1154:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


rundebug rpmbuild --quiet \\
  --undefine \"_unique_debug_names\" \\
  --undefine \"_unique_debug_srcs\" \\
  --undefine \"_debugsource_packages\" \\
  --undefine \"_debuginfo_subpackages\" \\
  -ba \"\${abs_srcdir}\"/data/SPECS/test-subpackages.spec

# Check that there is just one debuginfo package.
ls \${RPMTEST}/build/RPMS/*/*debuginfo*rpm | wc --lines

# Which contains hello.debug
rpm2cpio \${RPMTEST}/build/RPMS/*/test-1.0-1.*.rpm \\
  | cpio -diu --quiet
# Extract the debug name from the exe (.gnu_debuglink section, first string)
debug_name=\$(readelf -p .gnu_debuglink ./bin/hello | grep hello | cut -c13-)

rpm2cpio \${RPMTEST}/build/RPMS/*/test-debuginfo-1.0-1.*.rpm \\
  | cpio -diu --quiet
if test -f ./usr/lib/debug/bin/\$debug_name; then
  echo \"hello debug exists\"
else
  echo \"No hello: \$debug_name\"
fi
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:1154"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


rundebug rpmbuild --quiet \
  --undefine "_unique_debug_names" \
  --undefine "_unique_debug_srcs" \
  --undefine "_debugsource_packages" \
  --undefine "_debuginfo_subpackages" \
  -ba "${abs_srcdir}"/data/SPECS/test-subpackages.spec

# Check that there is just one debuginfo package.
ls ${RPMTEST}/build/RPMS/*/*debuginfo*rpm | wc --lines

# Which contains hello.debug
rpm2cpio ${RPMTEST}/build/RPMS/*/test-1.0-1.*.rpm \
  | cpio -diu --quiet
# Extract the debug name from the exe (.gnu_debuglink section, first string)
debug_name=$(readelf -p .gnu_debuglink ./bin/hello | grep hello | cut -c13-)

rpm2cpio ${RPMTEST}/build/RPMS/*/test-debuginfo-1.0-1.*.rpm \
  | cpio -diu --quiet
if test -f ./usr/lib/debug/bin/$debug_name; then
  echo "hello debug exists"
else
  echo "No hello: $debug_name"
fi

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "1
hello debug exists
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:1154"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_367
#AT_START_368
at_fn_group_banner 368 'rpmbuild.at:1190' \
  "rpmbuild debuginfo subpackages multiple" "        " 15
at_xfail=no
(
  $as_echo "368. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuild.at:1192" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuild.at:1192"
{ set +x
$as_echo "$at_srcdir/rpmbuild.at:1193:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


rundebug rpmbuild --quiet \\
  --undefine \"_unique_debug_names\" \\
  --undefine \"_unique_debug_srcs\" \\
  --undefine \"_debugsource_packages\" \\
  --define \"_debuginfo_subpackages 1\" \\
  -ba \"\${abs_srcdir}\"/data/SPECS/test-subpackages.spec

# Check that there are 3 debuginfo packages.
ls \${RPMTEST}/build/RPMS/*/*debuginfo*rpm | wc --lines

# First contains hello.debug
rpm2cpio \${RPMTEST}/build/RPMS/*/test-1.0-1.*.rpm \\
  | cpio -diu --quiet
# Extract the debug name from the exe (.gnu_debuglink section, first string)
debug_name=\$(readelf -p .gnu_debuglink ./bin/hello | grep hello | cut -c13-)

rpm2cpio \${RPMTEST}/build/RPMS/*/test-debuginfo-1.0-1.*.rpm \\
  | cpio -diu --quiet
if test -f ./usr/lib/debug/bin/\$debug_name; then
  echo \"hello debug exists\"
else
  echo \"No hello: \$debug_name\"
fi

# Second contains hello2.debug
rpm2cpio \${RPMTEST}/build/RPMS/*/test-test2-1.0-1.*.rpm \\
  | cpio -diu --quiet
# Extract the debug name from the exe (.gnu_debuglink section, first string)
debug_name=\$(readelf -p .gnu_debuglink ./bin/hello2 | grep hello | cut -c13-)

rpm2cpio \${RPMTEST}/build/RPMS/*/test-test2-debuginfo-1.0-1.*.rpm \\
  | cpio -diu --quiet
if test -f ./usr/lib/debug/bin/\$debug_name; then
  echo \"hello2 debug exists\"
else
  echo \"No hello2: \$debug_name\"
fi

# No debugsource package, so sources are in the main debuginfo package.
# Make sure it is recommended.
echo -n \"Recommends: \"
runroot rpm -qp --recommends /build/RPMS/*/test-test2-debuginfo-1.0-1.*.rpm | sed -E 's/([-.a-z0-9]+)\\(.*\\) = ([-.0-9]+)/\\1\\(ignore-arch\\) = \\2/'

# Third contains hello3.debug
rpm2cpio \${RPMTEST}/build/RPMS/*/test-test3-1.0-1.*.rpm \\
  | cpio -diu --quiet
# Extract the debug name from the exe (.gnu_debuglink section, first string)
debug_name=\$(readelf -p .gnu_debuglink ./bin/hello3 | grep hello | cut -c13-)

rpm2cpio \${RPMTEST}/build/RPMS/*/test-test3-debuginfo-1.0-1.*.rpm \\
  | cpio -diu --quiet
if test -f ./usr/lib/debug/bin/\$debug_name; then
  echo \"hello3 debug exists\"
else
  echo \"No hello3: \$debug_name\"
fi

# No debugsource package, so sources are in the main debuginfo package.
# Make sure it is recommended.
echo -n \"Recommends: \"
runroot rpm -qp --recommends /build/RPMS/*/test-test3-debuginfo-1.0-1.*.rpm | sed -E 's/([-.a-z0-9]+)\\(.*\\) = ([-.0-9]+)/\\1\\(ignore-arch\\) = \\2/'
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:1193"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


rundebug rpmbuild --quiet \
  --undefine "_unique_debug_names" \
  --undefine "_unique_debug_srcs" \
  --undefine "_debugsource_packages" \
  --define "_debuginfo_subpackages 1" \
  -ba "${abs_srcdir}"/data/SPECS/test-subpackages.spec

# Check that there are 3 debuginfo packages.
ls ${RPMTEST}/build/RPMS/*/*debuginfo*rpm | wc --lines

# First contains hello.debug
rpm2cpio ${RPMTEST}/build/RPMS/*/test-1.0-1.*.rpm \
  | cpio -diu --quiet
# Extract the debug name from the exe (.gnu_debuglink section, first string)
debug_name=$(readelf -p .gnu_debuglink ./bin/hello | grep hello | cut -c13-)

rpm2cpio ${RPMTEST}/build/RPMS/*/test-debuginfo-1.0-1.*.rpm \
  | cpio -diu --quiet
if test -f ./usr/lib/debug/bin/$debug_name; then
  echo "hello debug exists"
else
  echo "No hello: $debug_name"
fi

# Second contains hello2.debug
rpm2cpio ${RPMTEST}/build/RPMS/*/test-test2-1.0-1.*.rpm \
  | cpio -diu --quiet
# Extract the debug name from the exe (.gnu_debuglink section, first string)
debug_name=$(readelf -p .gnu_debuglink ./bin/hello2 | grep hello | cut -c13-)

rpm2cpio ${RPMTEST}/build/RPMS/*/test-test2-debuginfo-1.0-1.*.rpm \
  | cpio -diu --quiet
if test -f ./usr/lib/debug/bin/$debug_name; then
  echo "hello2 debug exists"
else
  echo "No hello2: $debug_name"
fi

# No debugsource package, so sources are in the main debuginfo package.
# Make sure it is recommended.
echo -n "Recommends: "
runroot rpm -qp --recommends /build/RPMS/*/test-test2-debuginfo-1.0-1.*.rpm | sed -E 's/([-.a-z0-9]+)\(.*\) = ([-.0-9]+)/\1\(ignore-arch\) = \2/'

# Third contains hello3.debug
rpm2cpio ${RPMTEST}/build/RPMS/*/test-test3-1.0-1.*.rpm \
  | cpio -diu --quiet
# Extract the debug name from the exe (.gnu_debuglink section, first string)
debug_name=$(readelf -p .gnu_debuglink ./bin/hello3 | grep hello | cut -c13-)

rpm2cpio ${RPMTEST}/build/RPMS/*/test-test3-debuginfo-1.0-1.*.rpm \
  | cpio -diu --quiet
if test -f ./usr/lib/debug/bin/$debug_name; then
  echo "hello3 debug exists"
else
  echo "No hello3: $debug_name"
fi

# No debugsource package, so sources are in the main debuginfo package.
# Make sure it is recommended.
echo -n "Recommends: "
runroot rpm -qp --recommends /build/RPMS/*/test-test3-debuginfo-1.0-1.*.rpm | sed -E 's/([-.a-z0-9]+)\(.*\) = ([-.0-9]+)/\1\(ignore-arch\) = \2/'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "3
hello debug exists
hello2 debug exists
Recommends: test-debuginfo(ignore-arch) = 1.0-1
hello3 debug exists
Recommends: test-debuginfo(ignore-arch) = 1.0-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:1193"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_368
#AT_START_369
at_fn_group_banner 369 'rpmbuild.at:1271' \
  "rpmbuild debuginfo subpackages multiple unique" " " 15
at_xfail=no
(
  $as_echo "369. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuild.at:1273" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuild.at:1273"
{ set +x
$as_echo "$at_srcdir/rpmbuild.at:1274:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


rundebug rpmbuild --quiet \\
  --define \"_unique_debug_names 1\" \\
  --define \"_unique_debug_srcs 1\" \\
  --undefine \"_debugsource_packages\" \\
  --define \"_debuginfo_subpackages 1\" \\
  -ba \"\${abs_srcdir}\"/data/SPECS/test-subpackages.spec

# Check that there are 3 debuginfo packages.
ls \${RPMTEST}/build/RPMS/*/*debuginfo*rpm | wc --lines

# First contains hello.debug
rpm2cpio \${RPMTEST}/build/RPMS/*/test-1.0-1.*.rpm \\
  | cpio -diu --quiet
# Extract the debug name from the exe (.gnu_debuglink section, first string)
debug_name=\$(readelf -p .gnu_debuglink ./bin/hello | grep hello | cut -c13-)

rpm2cpio \${RPMTEST}/build/RPMS/*/test-debuginfo-1.0-1.*.rpm \\
  | cpio -diu --quiet
if test -f ./usr/lib/debug/bin/\$debug_name; then
  echo \"hello debug exists\"
else
  echo \"No hello: \$debug_name\"
fi

# Second contains hello2.debug
rpm2cpio \${RPMTEST}/build/RPMS/*/test-test2-1.0-1.*.rpm \\
  | cpio -diu --quiet
# Extract the debug name from the exe (.gnu_debuglink section, first string)
debug_name=\$(readelf -p .gnu_debuglink ./bin/hello2 | grep hello | cut -c13-)

rpm2cpio \${RPMTEST}/build/RPMS/*/test-test2-debuginfo-1.0-1.*.rpm \\
  | cpio -diu --quiet
if test -f ./usr/lib/debug/bin/\$debug_name; then
  echo \"hello2 debug exists\"
else
  echo \"No hello2: \$debug_name\"
fi

# No debugsource package, so sources are in the main debuginfo package.
# Make sure it is recommended.
echo -n \"Recommends: \"
runroot rpm -qp --recommends /build/RPMS/*/test-test2-debuginfo-1.0-1.*.rpm | sed -E 's/([-.a-z0-9]+)\\(.*\\) = ([-.0-9]+)/\\1\\(ignore-arch\\) = \\2/'

# Third contains hello3.debug
rpm2cpio \${RPMTEST}/build/RPMS/*/test-test3-1.0-1.*.rpm \\
  | cpio -diu --quiet
# Extract the debug name from the exe (.gnu_debuglink section, first string)
debug_name=\$(readelf -p .gnu_debuglink ./bin/hello3 | grep hello | cut -c13-)

rpm2cpio \${RPMTEST}/build/RPMS/*/test-test3-debuginfo-1.0-1.*.rpm \\
  | cpio -diu --quiet
if test -f ./usr/lib/debug/bin/\$debug_name; then
  echo \"hello3 debug exists\"
else
  echo \"No hello3: \$debug_name\"
fi

# No debugsource package, so sources are in the main debuginfo package.
# Make sure it is recommended.
echo -n \"Recommends: \"
runroot rpm -qp --recommends /build/RPMS/*/test-test3-debuginfo-1.0-1.*.rpm | sed -E 's/([-.a-z0-9]+)\\(.*\\) = ([-.0-9]+)/\\1\\(ignore-arch\\) = \\2/'
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:1274"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


rundebug rpmbuild --quiet \
  --define "_unique_debug_names 1" \
  --define "_unique_debug_srcs 1" \
  --undefine "_debugsource_packages" \
  --define "_debuginfo_subpackages 1" \
  -ba "${abs_srcdir}"/data/SPECS/test-subpackages.spec

# Check that there are 3 debuginfo packages.
ls ${RPMTEST}/build/RPMS/*/*debuginfo*rpm | wc --lines

# First contains hello.debug
rpm2cpio ${RPMTEST}/build/RPMS/*/test-1.0-1.*.rpm \
  | cpio -diu --quiet
# Extract the debug name from the exe (.gnu_debuglink section, first string)
debug_name=$(readelf -p .gnu_debuglink ./bin/hello | grep hello | cut -c13-)

rpm2cpio ${RPMTEST}/build/RPMS/*/test-debuginfo-1.0-1.*.rpm \
  | cpio -diu --quiet
if test -f ./usr/lib/debug/bin/$debug_name; then
  echo "hello debug exists"
else
  echo "No hello: $debug_name"
fi

# Second contains hello2.debug
rpm2cpio ${RPMTEST}/build/RPMS/*/test-test2-1.0-1.*.rpm \
  | cpio -diu --quiet
# Extract the debug name from the exe (.gnu_debuglink section, first string)
debug_name=$(readelf -p .gnu_debuglink ./bin/hello2 | grep hello | cut -c13-)

rpm2cpio ${RPMTEST}/build/RPMS/*/test-test2-debuginfo-1.0-1.*.rpm \
  | cpio -diu --quiet
if test -f ./usr/lib/debug/bin/$debug_name; then
  echo "hello2 debug exists"
else
  echo "No hello2: $debug_name"
fi

# No debugsource package, so sources are in the main debuginfo package.
# Make sure it is recommended.
echo -n "Recommends: "
runroot rpm -qp --recommends /build/RPMS/*/test-test2-debuginfo-1.0-1.*.rpm | sed -E 's/([-.a-z0-9]+)\(.*\) = ([-.0-9]+)/\1\(ignore-arch\) = \2/'

# Third contains hello3.debug
rpm2cpio ${RPMTEST}/build/RPMS/*/test-test3-1.0-1.*.rpm \
  | cpio -diu --quiet
# Extract the debug name from the exe (.gnu_debuglink section, first string)
debug_name=$(readelf -p .gnu_debuglink ./bin/hello3 | grep hello | cut -c13-)

rpm2cpio ${RPMTEST}/build/RPMS/*/test-test3-debuginfo-1.0-1.*.rpm \
  | cpio -diu --quiet
if test -f ./usr/lib/debug/bin/$debug_name; then
  echo "hello3 debug exists"
else
  echo "No hello3: $debug_name"
fi

# No debugsource package, so sources are in the main debuginfo package.
# Make sure it is recommended.
echo -n "Recommends: "
runroot rpm -qp --recommends /build/RPMS/*/test-test3-debuginfo-1.0-1.*.rpm | sed -E 's/([-.a-z0-9]+)\(.*\) = ([-.0-9]+)/\1\(ignore-arch\) = \2/'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "3
hello debug exists
hello2 debug exists
Recommends: test-debuginfo(ignore-arch) = 1.0-1
hello3 debug exists
Recommends: test-debuginfo(ignore-arch) = 1.0-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:1274"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_369
#AT_START_370
at_fn_group_banner 370 'rpmbuild.at:1352' \
  "rpmbuild debuginfo subpackages multiple unique debugsource" "" 15
at_xfail=no
(
  $as_echo "370. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuild.at:1354" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuild.at:1354"
{ set +x
$as_echo "$at_srcdir/rpmbuild.at:1355:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


rundebug rpmbuild --quiet \\
  --define \"_unique_debug_names 1\" \\
  --define \"_unique_debug_srcs 1\" \\
  --define \"_debugsource_packages 1\" \\
  --define \"_debuginfo_subpackages 1\" \\
  -ba \"\${abs_srcdir}\"/data/SPECS/test-subpackages.spec

# Check that there are 3 debuginfo packages.
ls \${RPMTEST}/build/RPMS/*/*debuginfo*rpm | wc --lines

# First contains hello.debug
rpm2cpio \${RPMTEST}/build/RPMS/*/test-1.0-1.*.rpm \\
  | cpio -diu --quiet
# Extract the debug name from the exe (.gnu_debuglink section, first string)
debug_name=\$(readelf -p .gnu_debuglink ./bin/hello | grep hello | cut -c13-)

rpm2cpio \${RPMTEST}/build/RPMS/*/test-debuginfo-1.0-1.*.rpm \\
  | cpio -diu --quiet
if test -f ./usr/lib/debug/bin/\$debug_name; then
  echo \"hello debug exists\"
else
  echo \"No hello: \$debug_name\"
fi

# Sources are in debugsource package. Make sure it is recommended.
echo -n \"Recommends: \"
runroot rpm -qp --recommends /build/RPMS/*/test-debuginfo-1.0-1.*.rpm | sed -E 's/([-.a-z0-9]+)\\(.*\\) = ([-.0-9]+)/\\1\\(ignore-arch\\) = \\2/'

# Second contains hello2.debug
rpm2cpio \${RPMTEST}/build/RPMS/*/test-test2-1.0-1.*.rpm \\
  | cpio -diu --quiet
# Extract the debug name from the exe (.gnu_debuglink section, first string)
debug_name=\$(readelf -p .gnu_debuglink ./bin/hello2 | grep hello | cut -c13-)

rpm2cpio \${RPMTEST}/build/RPMS/*/test-test2-debuginfo-1.0-1.*.rpm \\
  | cpio -diu --quiet
if test -f ./usr/lib/debug/bin/\$debug_name; then
  echo \"hello2 debug exists\"
else
  echo \"No hello2: \$debug_name\"
fi

# Sources are in debugsource package. Make sure it is recommended.
echo -n \"Recommends: \"
runroot rpm -qp --recommends /build/RPMS/*/test-test2-debuginfo-1.0-1.*.rpm | sed -E 's/([-.a-z0-9]+)\\(.*\\) = ([-.0-9]+)/\\1\\(ignore-arch\\) = \\2/'

# Third contains hello3.debug
rpm2cpio \${RPMTEST}/build/RPMS/*/test-test3-1.0-1.*.rpm \\
  | cpio -diu --quiet
# Extract the debug name from the exe (.gnu_debuglink section, first string)
debug_name=\$(readelf -p .gnu_debuglink ./bin/hello3 | grep hello | cut -c13-)

rpm2cpio \${RPMTEST}/build/RPMS/*/test-test3-debuginfo-1.0-1.*.rpm \\
  | cpio -diu --quiet
if test -f ./usr/lib/debug/bin/\$debug_name; then
  echo \"hello3 debug exists\"
else
  echo \"No hello3: \$debug_name\"
fi

# Sources are in debugsource package. Make sure it is recommended.
echo -n \"Recommends: \"
runroot rpm -qp --recommends /build/RPMS/*/test-test3-debuginfo-1.0-1.*.rpm | sed -E 's/([-.a-z0-9]+)\\(.*\\) = ([-.0-9]+)/\\1\\(ignore-arch\\) = \\2/'
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:1355"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


rundebug rpmbuild --quiet \
  --define "_unique_debug_names 1" \
  --define "_unique_debug_srcs 1" \
  --define "_debugsource_packages 1" \
  --define "_debuginfo_subpackages 1" \
  -ba "${abs_srcdir}"/data/SPECS/test-subpackages.spec

# Check that there are 3 debuginfo packages.
ls ${RPMTEST}/build/RPMS/*/*debuginfo*rpm | wc --lines

# First contains hello.debug
rpm2cpio ${RPMTEST}/build/RPMS/*/test-1.0-1.*.rpm \
  | cpio -diu --quiet
# Extract the debug name from the exe (.gnu_debuglink section, first string)
debug_name=$(readelf -p .gnu_debuglink ./bin/hello | grep hello | cut -c13-)

rpm2cpio ${RPMTEST}/build/RPMS/*/test-debuginfo-1.0-1.*.rpm \
  | cpio -diu --quiet
if test -f ./usr/lib/debug/bin/$debug_name; then
  echo "hello debug exists"
else
  echo "No hello: $debug_name"
fi

# Sources are in debugsource package. Make sure it is recommended.
echo -n "Recommends: "
runroot rpm -qp --recommends /build/RPMS/*/test-debuginfo-1.0-1.*.rpm | sed -E 's/([-.a-z0-9]+)\(.*\) = ([-.0-9]+)/\1\(ignore-arch\) = \2/'

# Second contains hello2.debug
rpm2cpio ${RPMTEST}/build/RPMS/*/test-test2-1.0-1.*.rpm \
  | cpio -diu --quiet
# Extract the debug name from the exe (.gnu_debuglink section, first string)
debug_name=$(readelf -p .gnu_debuglink ./bin/hello2 | grep hello | cut -c13-)

rpm2cpio ${RPMTEST}/build/RPMS/*/test-test2-debuginfo-1.0-1.*.rpm \
  | cpio -diu --quiet
if test -f ./usr/lib/debug/bin/$debug_name; then
  echo "hello2 debug exists"
else
  echo "No hello2: $debug_name"
fi

# Sources are in debugsource package. Make sure it is recommended.
echo -n "Recommends: "
runroot rpm -qp --recommends /build/RPMS/*/test-test2-debuginfo-1.0-1.*.rpm | sed -E 's/([-.a-z0-9]+)\(.*\) = ([-.0-9]+)/\1\(ignore-arch\) = \2/'

# Third contains hello3.debug
rpm2cpio ${RPMTEST}/build/RPMS/*/test-test3-1.0-1.*.rpm \
  | cpio -diu --quiet
# Extract the debug name from the exe (.gnu_debuglink section, first string)
debug_name=$(readelf -p .gnu_debuglink ./bin/hello3 | grep hello | cut -c13-)

rpm2cpio ${RPMTEST}/build/RPMS/*/test-test3-debuginfo-1.0-1.*.rpm \
  | cpio -diu --quiet
if test -f ./usr/lib/debug/bin/$debug_name; then
  echo "hello3 debug exists"
else
  echo "No hello3: $debug_name"
fi

# Sources are in debugsource package. Make sure it is recommended.
echo -n "Recommends: "
runroot rpm -qp --recommends /build/RPMS/*/test-test3-debuginfo-1.0-1.*.rpm | sed -E 's/([-.a-z0-9]+)\(.*\) = ([-.0-9]+)/\1\(ignore-arch\) = \2/'

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "3
hello debug exists
Recommends: test-debugsource(ignore-arch) = 1.0-1
hello2 debug exists
Recommends: test-debugsource(ignore-arch) = 1.0-1
hello3 debug exists
Recommends: test-debugsource(ignore-arch) = 1.0-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:1355"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_370
#AT_START_371
at_fn_group_banner 371 'rpmbuild.at:1436' \
  "rpmbuild debuginfo subpackages multiple excluded" "" 15
at_xfail=no
(
  $as_echo "371. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuild.at:1438" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuild.at:1438"
{ set +x
$as_echo "$at_srcdir/rpmbuild.at:1439:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


rundebug rpmbuild --quiet \\
  --define \"_unique_debug_names 1\" \\
  --define \"_unique_debug_srcs 1\" \\
  --define \"_debugsource_packages 1\" \\
  --define \"_debuginfo_subpackages 1\" \\
  -ba \"\${abs_srcdir}\"/data/SPECS/test-subpackages-exclude.spec

# Check that there are 2 debuginfo packages.
ls \${RPMTEST}/build/RPMS/*/*debuginfo*rpm | wc --lines

# First contains hello.debug
rpm2cpio \${RPMTEST}/build/RPMS/*/test-1.0-1.*.rpm \\
  | cpio -diu --quiet
# Extract the debug name from the exe (.gnu_debuglink section, first string)
debug_name=\$(readelf -p .gnu_debuglink ./bin/hello | grep hello | cut -c13-)

rpm2cpio \${RPMTEST}/build/RPMS/*/test-debuginfo-1.0-1.*.rpm \\
  | cpio -diu --quiet
if test -f ./usr/lib/debug/bin/\$debug_name; then
  echo \"hello debug exists\"
else
  echo \"No hello: \$debug_name\"
fi

# Second contains hello2.debug but NOT hello3.debug
rpm2cpio \${RPMTEST}/build/RPMS/*/test-test2-1.0-1.*.rpm \\
  | cpio -diu --quiet
# Extract the debug name from the exe (.gnu_debuglink section, first string)
debug_name=\$(readelf -p .gnu_debuglink ./bin/hello2 | grep hello | cut -c13-)

rpm2cpio \${RPMTEST}/build/RPMS/*/test-test2-debuginfo-1.0-1.*.rpm \\
  | cpio -diu --quiet
if test -f ./usr/lib/debug/bin/\$debug_name; then
  echo \"hello2 debug exists\"
else
  echo \"No hello2: \$debug_name\"
fi

if test -f ./usr/lib/debug/bin/hello3*; then
  echo \"hello3 debug exists\"
else
  echo \"No hello3 debug\"
fi
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:1439"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


rundebug rpmbuild --quiet \
  --define "_unique_debug_names 1" \
  --define "_unique_debug_srcs 1" \
  --define "_debugsource_packages 1" \
  --define "_debuginfo_subpackages 1" \
  -ba "${abs_srcdir}"/data/SPECS/test-subpackages-exclude.spec

# Check that there are 2 debuginfo packages.
ls ${RPMTEST}/build/RPMS/*/*debuginfo*rpm | wc --lines

# First contains hello.debug
rpm2cpio ${RPMTEST}/build/RPMS/*/test-1.0-1.*.rpm \
  | cpio -diu --quiet
# Extract the debug name from the exe (.gnu_debuglink section, first string)
debug_name=$(readelf -p .gnu_debuglink ./bin/hello | grep hello | cut -c13-)

rpm2cpio ${RPMTEST}/build/RPMS/*/test-debuginfo-1.0-1.*.rpm \
  | cpio -diu --quiet
if test -f ./usr/lib/debug/bin/$debug_name; then
  echo "hello debug exists"
else
  echo "No hello: $debug_name"
fi

# Second contains hello2.debug but NOT hello3.debug
rpm2cpio ${RPMTEST}/build/RPMS/*/test-test2-1.0-1.*.rpm \
  | cpio -diu --quiet
# Extract the debug name from the exe (.gnu_debuglink section, first string)
debug_name=$(readelf -p .gnu_debuglink ./bin/hello2 | grep hello | cut -c13-)

rpm2cpio ${RPMTEST}/build/RPMS/*/test-test2-debuginfo-1.0-1.*.rpm \
  | cpio -diu --quiet
if test -f ./usr/lib/debug/bin/$debug_name; then
  echo "hello2 debug exists"
else
  echo "No hello2: $debug_name"
fi

if test -f ./usr/lib/debug/bin/hello3*; then
  echo "hello3 debug exists"
else
  echo "No hello3 debug"
fi

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "2
hello debug exists
hello2 debug exists
No hello3 debug
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:1439"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_371
#AT_START_372
at_fn_group_banner 372 'rpmbuild.at:1497' \
  "rpmbuild debuginfo subpackages multiple excluded" "" 15
at_xfail=no
(
  $as_echo "372. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuild.at:1499" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuild.at:1499"
{ set +x
$as_echo "$at_srcdir/rpmbuild.at:1500:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


rundebug rpmbuild --quiet \\
  --define \"_unique_debug_names 1\" \\
  --define \"_unique_debug_srcs 1\" \\
  --define \"_debugsource_packages 1\" \\
  --define \"_debuginfo_subpackages 1\" \\
  -ba \"\${abs_srcdir}\"/data/SPECS/test-subpackages-pathpostfixes.spec

# Check that there are 2 debuginfo packages.
ls \${RPMTEST}/build/RPMS/*/*debuginfo*rpm | wc --lines

# First contains hello.debug
rpm2cpio \${RPMTEST}/build/RPMS/*/test-1.0-1.*.rpm \\
  | cpio -diu --quiet
# Extract the debug name from the exe (.gnu_debuglink section, first string)
debug_name=\$(readelf -p .gnu_debuglink ./bin/hello | grep hello | cut -c13-)

rpm2cpio \${RPMTEST}/build/RPMS/*/test-debuginfo-1.0-1.*.rpm \\
  | cpio -diu --quiet
if test -f ./usr/lib/debug/bin/\$debug_name; then
  echo \"hello debug exists\"
else
  echo \"No hello: \$debug_name\"
fi

# remove it, we are going to check the other debuginfo package.
rm ./bin/hello
rm ./usr/lib/debug/bin/\$debug_name
orig_debugname=\$debugname

# Second contains hello.foobar.debug but NOT hello.debug
rpm2cpio \${RPMTEST}/build/RPMS/*/test-test2-1.0-1.*.rpm \\
  | cpio -diu --quiet
# Extract the debug name from the exe (.gnu_debuglink section, first string)
debug_name=\$(readelf -p .gnu_debuglink ./bin/hello | grep hello | cut -c13-)

rpm2cpio \${RPMTEST}/build/RPMS/*/test-test2-debuginfo-1.0-1.*.rpm \\
  | cpio -diu --quiet
if test -f ./usr/lib/debug/bin/\$debug_name; then
  echo \"hello.foobar debug exists\"
else
  echo \"No hello2: \$debug_name\"
fi

if test -f ./usr/lib/debug/bin/\$orig_debugname; then
  echo \"\$orig_debugname exists\"
else
  echo \"No hello.debug\"
fi
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:1500"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


rundebug rpmbuild --quiet \
  --define "_unique_debug_names 1" \
  --define "_unique_debug_srcs 1" \
  --define "_debugsource_packages 1" \
  --define "_debuginfo_subpackages 1" \
  -ba "${abs_srcdir}"/data/SPECS/test-subpackages-pathpostfixes.spec

# Check that there are 2 debuginfo packages.
ls ${RPMTEST}/build/RPMS/*/*debuginfo*rpm | wc --lines

# First contains hello.debug
rpm2cpio ${RPMTEST}/build/RPMS/*/test-1.0-1.*.rpm \
  | cpio -diu --quiet
# Extract the debug name from the exe (.gnu_debuglink section, first string)
debug_name=$(readelf -p .gnu_debuglink ./bin/hello | grep hello | cut -c13-)

rpm2cpio ${RPMTEST}/build/RPMS/*/test-debuginfo-1.0-1.*.rpm \
  | cpio -diu --quiet
if test -f ./usr/lib/debug/bin/$debug_name; then
  echo "hello debug exists"
else
  echo "No hello: $debug_name"
fi

# remove it, we are going to check the other debuginfo package.
rm ./bin/hello
rm ./usr/lib/debug/bin/$debug_name
orig_debugname=$debugname

# Second contains hello.foobar.debug but NOT hello.debug
rpm2cpio ${RPMTEST}/build/RPMS/*/test-test2-1.0-1.*.rpm \
  | cpio -diu --quiet
# Extract the debug name from the exe (.gnu_debuglink section, first string)
debug_name=$(readelf -p .gnu_debuglink ./bin/hello | grep hello | cut -c13-)

rpm2cpio ${RPMTEST}/build/RPMS/*/test-test2-debuginfo-1.0-1.*.rpm \
  | cpio -diu --quiet
if test -f ./usr/lib/debug/bin/$debug_name; then
  echo "hello.foobar debug exists"
else
  echo "No hello2: $debug_name"
fi

if test -f ./usr/lib/debug/bin/$orig_debugname; then
  echo "$orig_debugname exists"
else
  echo "No hello.debug"
fi

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "2
hello debug exists
hello.foobar debug exists
No hello.debug
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:1500"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_372
#AT_START_373
at_fn_group_banner 373 'rpmbuild.at:1565' \
  "dynamic build requires rpmbuild -bs" "            " 15
at_xfail=no
(
  $as_echo "373. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmbuild.at:1567:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild \\
  --quiet -bs /data/SPECS/buildrequires.spec
runroot rpm -qpR /build/SRPMS/buildrequires-1.0-1.src.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:1567"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild \
  --quiet -bs /data/SPECS/buildrequires.spec
runroot rpm -qpR /build/SRPMS/buildrequires-1.0-1.src.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "rpmlib(CompressedFileNames) <= 3.0.4-1
rpmlib(DynamicBuildRequires) <= 4.15.0-1
rpmlib(FileDigests) <= 4.6.0-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:1567"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_373
#AT_START_374
at_fn_group_banner 374 'rpmbuild.at:1584' \
  "rpmbuild -br" "                                   " 15
at_xfail=no
(
  $as_echo "374. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmbuild.at:1586:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild \\
  -br  --quiet /data/SPECS/buildrequires.spec
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:1586"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild \
  -br  --quiet /data/SPECS/buildrequires.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Failed build dependencies:
	(bar = 3.4 or bar = 3.5) is needed by buildrequires-1.0-1.noarch
	foo > 1.3 is needed by buildrequires-1.0-1.noarch
	foo-bar = 2.0 is needed by buildrequires-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 11 $at_status "$at_srcdir/rpmbuild.at:1586"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_374
#AT_START_375
at_fn_group_banner 375 'rpmbuild.at:1604' \
  "rpmbuild -ba" "                                   " 15
at_xfail=no
(
  $as_echo "375. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmbuild.at:1606:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild \\
  -ba  --quiet /data/SPECS/buildrequires.spec
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:1606"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild \
  -ba  --quiet /data/SPECS/buildrequires.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Failed build dependencies:
	(bar = 3.4 or bar = 3.5) is needed by buildrequires-1.0-1.noarch
	foo > 1.3 is needed by buildrequires-1.0-1.noarch
	foo-bar = 2.0 is needed by buildrequires-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 11 $at_status "$at_srcdir/rpmbuild.at:1606"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_375
#AT_START_376
at_fn_group_banner 376 'rpmbuild.at:1625' \
  "rpmbuild -br --nodeps" "                          " 15
at_xfail=no
(
  $as_echo "376. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmbuild.at:1627:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild \\
  -br  --quiet --nodeps /data/SPECS/buildrequires.spec
runroot rpm -qpvR /build/SRPMS/buildrequires-1.0-1.buildreqs.nosrc.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:1627"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild \
  -br  --quiet --nodeps /data/SPECS/buildrequires.spec
runroot rpm -qpvR /build/SRPMS/buildrequires-1.0-1.buildreqs.nosrc.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "auto: (bar = 3.4 or bar = 3.5)
auto: foo > 1.3
auto: foo-bar = 2.0
rpmlib: rpmlib(CompressedFileNames) <= 3.0.4-1
rpmlib,missingok: rpmlib(DynamicBuildRequires) <= 4.15.0-1
rpmlib: rpmlib(FileDigests) <= 4.6.0-1
rpmlib: rpmlib(RichDependencies) <= 4.12.0-1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:1627"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_376
#AT_START_377
at_fn_group_banner 377 'rpmbuild.at:1648' \
  "rpmbuild -ba missing source" "                    " 15
at_xfail=no
(
  $as_echo "377. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmbuild.at:1650:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild \\
  --define \"_sourcedir /notthere\" \\
  -bb /data/SPECS/hello.spec
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:1650"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild \
  --define "_sourcedir /notthere" \
  -bb /data/SPECS/hello.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Bad source: /notthere/hello-1.0.tar.gz: No such file or directory
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmbuild.at:1650"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_377
#AT_START_378
at_fn_group_banner 378 'rpmbuild.at:1663' \
  "rpmbuild minimal spec" "                          " 15
at_xfail=no
(
  $as_echo "378. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmbuild.at:1665:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild \\
  -bb --quiet /data/SPECS/mini.spec
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:1665"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild \
  -bb --quiet /data/SPECS/mini.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:1665"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_378
#AT_START_379
at_fn_group_banner 379 'rpmbuild.at:1676' \
  "rpmbuild missing doc" "                           " 15
at_xfail=no
(
  $as_echo "379. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmbuild.at:1678:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


for val in 1 0; do
    runroot rpmbuild \\
        -bb --quiet \\
        --define \"_missing_doc_files_terminate_build \${val}\" \\
        /data/SPECS/docmiss.spec
    echo \$?
done
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuild.at:1678"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


for val in 1 0; do
    runroot rpmbuild \
        -bb --quiet \
        --define "_missing_doc_files_terminate_build ${val}" \
        /data/SPECS/docmiss.spec
    echo $?
done

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "1
0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:1678"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_379
#AT_START_380
at_fn_group_banner 380 'rpmbuild.at:1696' \
  "spec conditionals" "                              " 15
at_xfail=no
(
  $as_echo "380. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


# %if, %else, %elif test basic
{ set +x
$as_echo "$at_srcdir/rpmbuild.at:1701:
runroot rpmbuild -ba --quiet \\
    --define \"testif 0\"      \\
   /data/SPECS/iftest.spec
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmbuild.at:1701"
( $at_check_trace;
runroot rpmbuild -ba --quiet \
    --define "testif 0"      \
   /data/SPECS/iftest.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:1701"
$at_failed && at_fn_log_failure
$at_traceon; }


# %if, %else, %elif test existing script
{ set +x
$as_echo "$at_srcdir/rpmbuild.at:1710:
runroot rpmbuild -ba --quiet  \\
    --define \"testif 2\"       \\
    --define \"fedora 1\"       \\
   /data/SPECS/iftest.spec
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmbuild.at:1710"
( $at_check_trace;
runroot rpmbuild -ba --quiet  \
    --define "testif 2"       \
    --define "fedora 1"       \
   /data/SPECS/iftest.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:1710"
$at_failed && at_fn_log_failure
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/rpmbuild.at:1719:
runroot rpmbuild -ba --quiet \\
 --define \"testif 1\"         \\
 --define \"variable1 1\"      \\
 --define \"variable2 1\"      \\
 --define \"variable3 1\"      \\
 --define \"action1 echo 0\"   \\
 --define \"action2 %if 1\"    \\
 --define \"action3 %if 1\"    \\
 --define \"action4 %if 1\"    \\
   /data/SPECS/eliftest.spec
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmbuild.at:1719"
( $at_check_trace;
runroot rpmbuild -ba --quiet \
 --define "testif 1"         \
 --define "variable1 1"      \
 --define "variable2 1"      \
 --define "variable3 1"      \
 --define "action1 echo 0"   \
 --define "action2 %if 1"    \
 --define "action3 %if 1"    \
 --define "action4 %if 1"    \
   /data/SPECS/eliftest.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:1719"
$at_failed && at_fn_log_failure
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/rpmbuild.at:1734:
runroot rpmbuild -ba --quiet   \\
 --define \"testif 1\"           \\
 --define \"variable1 0\"        \\
 --define \"variable2 0\"        \\
 --define \"variable3 1\"        \\
 --define \"action1 echo 0\"     \\
 --define \"action2 echo 0\"     \\
 --define \"action3 %if 1\"      \\
 --define \"action4 echo 0\"     \\
   /data/SPECS/eliftest.spec > /dev/null 2>&1
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmbuild.at:1734"
( $at_check_trace;
runroot rpmbuild -ba --quiet   \
 --define "testif 1"           \
 --define "variable1 0"        \
 --define "variable2 0"        \
 --define "variable3 1"        \
 --define "action1 echo 0"     \
 --define "action2 echo 0"     \
 --define "action3 %if 1"      \
 --define "action4 echo 0"     \
   /data/SPECS/eliftest.spec > /dev/null 2>&1

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmbuild.at:1734"
$at_failed && at_fn_log_failure
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/rpmbuild.at:1749:
runroot rpmbuild -ba --quiet      \\
 --define \"testif 1\"              \\
 --define \"variable1 0\"           \\
 --define \"variable2 1\"           \\
 --define \"variable3 rubbish:4-3\" \\
 --define \"action1 %if 1\"         \\
 --define \"action2 echo 0\"        \\
 --define \"action3 %if 1\"         \\
 --define \"action4 %if 1\"         \\
   /data/SPECS/eliftest.spec
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmbuild.at:1749"
( $at_check_trace;
runroot rpmbuild -ba --quiet      \
 --define "testif 1"              \
 --define "variable1 0"           \
 --define "variable2 1"           \
 --define "variable3 rubbish:4-3" \
 --define "action1 %if 1"         \
 --define "action2 echo 0"        \
 --define "action3 %if 1"         \
 --define "action4 %if 1"         \
   /data/SPECS/eliftest.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:1749"
$at_failed && at_fn_log_failure
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/rpmbuild.at:1764:
runroot rpmbuild -ba --quiet      \\
 --define \"testif 1\"              \\
 --define \"variable1 0\"           \\
 --define \"variable2 rubbish:4-3\" \\
 --define \"variable3 1\"           \\
 --define \"action1 exit 1\"        \\
 --define \"action2 echo 0\"        \\
 --define \"action3 exit 1\"        \\
 --define \"action4 exit 1\"        \\
   /data/SPECS/eliftest.spec
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmbuild.at:1764"
( $at_check_trace;
runroot rpmbuild -ba --quiet      \
 --define "testif 1"              \
 --define "variable1 0"           \
 --define "variable2 rubbish:4-3" \
 --define "variable3 1"           \
 --define "action1 exit 1"        \
 --define "action2 echo 0"        \
 --define "action3 exit 1"        \
 --define "action4 exit 1"        \
   /data/SPECS/eliftest.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: bare words are no longer supported, please use \"...\":  rubbish:4-3

error:                                                        ^
error: /data/SPECS/eliftest.spec:40: bad %elif condition:  rubbish:4-3

" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmbuild.at:1764"
$at_failed && at_fn_log_failure
$at_traceon; }


# multiline %if test
{ set +x
$as_echo "$at_srcdir/rpmbuild.at:1786:
runroot rpmbuild -ba --quiet      \\
 data/SPECS/ifmultiline.spec
"
at_fn_check_prepare_notrace 'an embedded newline' "rpmbuild.at:1786"
( $at_check_trace;
runroot rpmbuild -ba --quiet      \
 data/SPECS/ifmultiline.spec

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuild.at:1786"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_380
#AT_START_381
at_fn_group_banner 381 'rpmbuildid.at:23' \
  "rpmbuild buildid none" "                          " 16
at_xfail=no
(
  $as_echo "381. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuildid.at:25" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuildid.at:25"
{ set +x
$as_echo "$at_srcdir/rpmbuildid.at:26:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


# Build, contains one ELF which should have a buildid.
rundebug rpmbuild \\
  --define=\"_build_id_links none\" \\
  --quiet -ba \"\${abs_srcdir}\"/data/SPECS/hello.spec

# There should be zero build-id files in both the main and debuginfo package
echo -n \"hello build-id files: \"
runroot rpm -ql -p /build/RPMS/*/hello-1.0-1.*.rpm \\
  | grep /.build-id/ | wc --lines

echo -n \"hello debuginfo build-id files: \"
runroot rpm -ql -p /build/RPMS/*/hello-debuginfo-1.0-1.*.rpm \\
  | grep /.build-id/ | wc --lines

"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuildid.at:26"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


# Build, contains one ELF which should have a buildid.
rundebug rpmbuild \
  --define="_build_id_links none" \
  --quiet -ba "${abs_srcdir}"/data/SPECS/hello.spec

# There should be zero build-id files in both the main and debuginfo package
echo -n "hello build-id files: "
runroot rpm -ql -p /build/RPMS/*/hello-1.0-1.*.rpm \
  | grep /.build-id/ | wc --lines

echo -n "hello debuginfo build-id files: "
runroot rpm -ql -p /build/RPMS/*/hello-debuginfo-1.0-1.*.rpm \
  | grep /.build-id/ | wc --lines


) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "hello build-id files: 0
hello debuginfo build-id files: 0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuildid.at:26"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_381
#AT_START_382
at_fn_group_banner 382 'rpmbuildid.at:54' \
  "rpmbuild buildid alldebug" "                      " 16
at_xfail=no
(
  $as_echo "382. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuildid.at:56" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuildid.at:56"
{ set +x
$as_echo "$at_srcdir/rpmbuildid.at:57:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


# Build, contains one ELF which should have a buildid.
rundebug rpmbuild \\
  --define=\"_build_id_links alldebug\" \\
  --undefine \"_unique_debug_names\" \\
  --undefine \"_unique_debug_srcs\" \\
  --quiet -ba \"\${abs_srcdir}\"/data/SPECS/hello.spec

# There should be zero build-id files in the main package
# Main and debug should be in the debuginfo package,
# plus the .build-id/xx subdir, 3 in total.
echo -n \"hello build-id files: \"
runroot rpm -ql -p /build/RPMS/*/hello-1.0-1.*.rpm \\
  | grep /.build-id/ | wc --lines

echo -n \"hello debuginfo build-id files: \"
runroot rpm -ql -p /build/RPMS/*/hello-debuginfo-1.0-1.*.rpm \\
  | grep /.build-id/ | wc --lines

# Extract the both packages to check the build-id files link to the
# main and .debug files.
rpm2cpio \${RPMTEST}/build/RPMS/*/hello-1.0-1.*.rpm \\
  | cpio -diu
rpm2cpio \${RPMTEST}/build/RPMS/*/hello-debuginfo-1.0-1.*.rpm \\
  | cpio -diu

# Check there is a build-id symlink for the main file.
main_file=./usr/local/bin/hello
test -f \"\${main_file}\" || echo \"No main file \${main_file}\"

# Extract the build-id from the main file
id_main=\$(file \$main_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')

id_main_file=\"./usr/lib/debug/.build-id/\${id_main:0:2}/\${id_main:2}\"
test -L \"\$id_main_file\" || echo \"No build-id file \$id_main_file\"

canon_main_file=\$(readlink -f \${main_file})

test -f \"\$canon_main_file\" \\
  || echo \"Cannot resolve main file \${main_file} -> \${canon_main_file}\"

canon_main_id_file=\$(readlink -f \${id_main_file})

test -f \"\$canon_main_id_file\" \\
  || echo \"Cannot resolve main build-id file \${id_main_file} -> \${canon_main_id_file}\"

test \"\$canon_main_file\" = \"\$canon_main_id_file\" \\
  || echo \"main and build-id file not linked\"

# And check the same for the debug file.
debug_file=./usr/lib/debug/usr/local/bin/hello.debug
test -f \${debug_file} || echo \"No debug file \${debug_file}\"

# Extract the build-id from the .debug file
id_debug=\$(file \$debug_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')

test \${id_main} = \${id_debug} || echo \"unequal main and debug id\"

id_debug_file=\"./usr/lib/debug/.build-id/\${id_debug:0:2}/\${id_debug:2}.debug\"
test -L \"\$id_debug_file\" || echo \"No build-id file \$id_debug_file\"

canon_debug_file=\$(readlink -f \${debug_file})

test -f \"\$canon_debug_file\" \\
  || echo \"Cannot resolve debug file \${debug_file} -> \${canon_debug_file}\"

canon_debug_id_file=\$(readlink -f \${id_debug_file})

test -f \"\$canon_debug_id_file\" \\
  || echo \"Cannot resolve debug build-id file \${id_debug_file} -> \${canon_debug_id_file}\"

test \"\$canon_debug_file\" = \"\$canon_debug_id_file\" \\
  || echo \"debug and build-id not linked\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuildid.at:57"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


# Build, contains one ELF which should have a buildid.
rundebug rpmbuild \
  --define="_build_id_links alldebug" \
  --undefine "_unique_debug_names" \
  --undefine "_unique_debug_srcs" \
  --quiet -ba "${abs_srcdir}"/data/SPECS/hello.spec

# There should be zero build-id files in the main package
# Main and debug should be in the debuginfo package,
# plus the .build-id/xx subdir, 3 in total.
echo -n "hello build-id files: "
runroot rpm -ql -p /build/RPMS/*/hello-1.0-1.*.rpm \
  | grep /.build-id/ | wc --lines

echo -n "hello debuginfo build-id files: "
runroot rpm -ql -p /build/RPMS/*/hello-debuginfo-1.0-1.*.rpm \
  | grep /.build-id/ | wc --lines

# Extract the both packages to check the build-id files link to the
# main and .debug files.
rpm2cpio ${RPMTEST}/build/RPMS/*/hello-1.0-1.*.rpm \
  | cpio -diu
rpm2cpio ${RPMTEST}/build/RPMS/*/hello-debuginfo-1.0-1.*.rpm \
  | cpio -diu

# Check there is a build-id symlink for the main file.
main_file=./usr/local/bin/hello
test -f "${main_file}" || echo "No main file ${main_file}"

# Extract the build-id from the main file
id_main=$(file $main_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')

id_main_file="./usr/lib/debug/.build-id/${id_main:0:2}/${id_main:2}"
test -L "$id_main_file" || echo "No build-id file $id_main_file"

canon_main_file=$(readlink -f ${main_file})

test -f "$canon_main_file" \
  || echo "Cannot resolve main file ${main_file} -> ${canon_main_file}"

canon_main_id_file=$(readlink -f ${id_main_file})

test -f "$canon_main_id_file" \
  || echo "Cannot resolve main build-id file ${id_main_file} -> ${canon_main_id_file}"

test "$canon_main_file" = "$canon_main_id_file" \
  || echo "main and build-id file not linked"

# And check the same for the debug file.
debug_file=./usr/lib/debug/usr/local/bin/hello.debug
test -f ${debug_file} || echo "No debug file ${debug_file}"

# Extract the build-id from the .debug file
id_debug=$(file $debug_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')

test ${id_main} = ${id_debug} || echo "unequal main and debug id"

id_debug_file="./usr/lib/debug/.build-id/${id_debug:0:2}/${id_debug:2}.debug"
test -L "$id_debug_file" || echo "No build-id file $id_debug_file"

canon_debug_file=$(readlink -f ${debug_file})

test -f "$canon_debug_file" \
  || echo "Cannot resolve debug file ${debug_file} -> ${canon_debug_file}"

canon_debug_id_file=$(readlink -f ${id_debug_file})

test -f "$canon_debug_id_file" \
  || echo "Cannot resolve debug build-id file ${id_debug_file} -> ${canon_debug_id_file}"

test "$canon_debug_file" = "$canon_debug_id_file" \
  || echo "debug and build-id not linked"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "hello build-id files: 0
hello debuginfo build-id files: 3
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuildid.at:57"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_382
#AT_START_383
at_fn_group_banner 383 'rpmbuildid.at:143' \
  "rpmbuild buildid alldebug unique debug names" "   " 16
at_xfail=no
(
  $as_echo "383. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuildid.at:145" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuildid.at:145"
{ set +x
$as_echo "$at_srcdir/rpmbuildid.at:146:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


# Build, contains one ELF which should have a buildid.
rundebug rpmbuild \\
  --define=\"_build_id_links alldebug\" \\
  --define=\"_unique_debug_names 1\" \\
  --quiet -ba \"\${abs_srcdir}\"/data/SPECS/hello.spec

# There should be zero build-id files in the main package
# Main and debug should be in the debuginfo package,
# plus the .build-id/xx subdir, 3 in total.
echo -n \"hello build-id files: \"
runroot rpm -ql -p /build/RPMS/*/hello-1.0-1.*.rpm \\
  | grep /.build-id/ | wc --lines

echo -n \"hello debuginfo build-id files: \"
runroot rpm -ql -p /build/RPMS/*/hello-debuginfo-1.0-1.*.rpm \\
  | grep /.build-id/ | wc --lines

# Extract the both packages to check the build-id files link to the
# main and .debug files.
rpm2cpio \${RPMTEST}/build/RPMS/*/hello-1.0-1.*.rpm \\
  | cpio -diu
rpm2cpio \${RPMTEST}/build/RPMS/*/hello-debuginfo-1.0-1.*.rpm \\
  | cpio -diu

# Check there is a build-id symlink for the main file.
main_file=./usr/local/bin/hello
test -f \"\${main_file}\" || echo \"No main file \${main_file}\"

# Extract the build-id from the main file
id_main=\$(file \$main_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')

id_main_file=\"./usr/lib/debug/.build-id/\${id_main:0:2}/\${id_main:2}\"
test -L \"\$id_main_file\" || echo \"No build-id file \$id_main_file\"

canon_main_file=\$(readlink -f \${main_file})

test -f \"\$canon_main_file\" \\
  || echo \"Cannot resolve main file \${main_file} -> \${canon_main_file}\"

canon_main_id_file=\$(readlink -f \${id_main_file})

test -f \"\$canon_main_id_file\" \\
  || echo \"Cannot resolve main build-id file \${id_main_file} -> \${canon_main_id_file}\"

test \"\$canon_main_file\" = \"\$canon_main_id_file\" \\
  || echo \"main and build-id file not linked\"

# And check the same for the debug file.
debug_file=./usr/lib/debug/usr/local/bin/hello-*.debug
test -f \${debug_file} || echo \"No debug file \${debug_file}\"

# Extract the build-id from the .debug file
id_debug=\$(file \$debug_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')

test \${id_main} = \${id_debug} || echo \"unequal main and debug id\"

id_debug_file=\"./usr/lib/debug/.build-id/\${id_debug:0:2}/\${id_debug:2}.debug\"
test -L \"\$id_debug_file\" || echo \"No build-id file \$id_debug_file\"

canon_debug_file=\$(readlink -f \${debug_file})

test -f \"\$canon_debug_file\" \\
  || echo \"Cannot resolve debug file \${debug_file} -> \${canon_debug_file}\"

canon_debug_id_file=\$(readlink -f \${id_debug_file})

test -f \"\$canon_debug_id_file\" \\
  || echo \"Cannot resolve debug build-id file \${id_debug_file} -> \${canon_debug_id_file}\"

test \"\$canon_debug_file\" = \"\$canon_debug_id_file\" \\
  || echo \"debug and build-id not linked\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuildid.at:146"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


# Build, contains one ELF which should have a buildid.
rundebug rpmbuild \
  --define="_build_id_links alldebug" \
  --define="_unique_debug_names 1" \
  --quiet -ba "${abs_srcdir}"/data/SPECS/hello.spec

# There should be zero build-id files in the main package
# Main and debug should be in the debuginfo package,
# plus the .build-id/xx subdir, 3 in total.
echo -n "hello build-id files: "
runroot rpm -ql -p /build/RPMS/*/hello-1.0-1.*.rpm \
  | grep /.build-id/ | wc --lines

echo -n "hello debuginfo build-id files: "
runroot rpm -ql -p /build/RPMS/*/hello-debuginfo-1.0-1.*.rpm \
  | grep /.build-id/ | wc --lines

# Extract the both packages to check the build-id files link to the
# main and .debug files.
rpm2cpio ${RPMTEST}/build/RPMS/*/hello-1.0-1.*.rpm \
  | cpio -diu
rpm2cpio ${RPMTEST}/build/RPMS/*/hello-debuginfo-1.0-1.*.rpm \
  | cpio -diu

# Check there is a build-id symlink for the main file.
main_file=./usr/local/bin/hello
test -f "${main_file}" || echo "No main file ${main_file}"

# Extract the build-id from the main file
id_main=$(file $main_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')

id_main_file="./usr/lib/debug/.build-id/${id_main:0:2}/${id_main:2}"
test -L "$id_main_file" || echo "No build-id file $id_main_file"

canon_main_file=$(readlink -f ${main_file})

test -f "$canon_main_file" \
  || echo "Cannot resolve main file ${main_file} -> ${canon_main_file}"

canon_main_id_file=$(readlink -f ${id_main_file})

test -f "$canon_main_id_file" \
  || echo "Cannot resolve main build-id file ${id_main_file} -> ${canon_main_id_file}"

test "$canon_main_file" = "$canon_main_id_file" \
  || echo "main and build-id file not linked"

# And check the same for the debug file.
debug_file=./usr/lib/debug/usr/local/bin/hello-*.debug
test -f ${debug_file} || echo "No debug file ${debug_file}"

# Extract the build-id from the .debug file
id_debug=$(file $debug_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')

test ${id_main} = ${id_debug} || echo "unequal main and debug id"

id_debug_file="./usr/lib/debug/.build-id/${id_debug:0:2}/${id_debug:2}.debug"
test -L "$id_debug_file" || echo "No build-id file $id_debug_file"

canon_debug_file=$(readlink -f ${debug_file})

test -f "$canon_debug_file" \
  || echo "Cannot resolve debug file ${debug_file} -> ${canon_debug_file}"

canon_debug_id_file=$(readlink -f ${id_debug_file})

test -f "$canon_debug_id_file" \
  || echo "Cannot resolve debug build-id file ${id_debug_file} -> ${canon_debug_id_file}"

test "$canon_debug_file" = "$canon_debug_id_file" \
  || echo "debug and build-id not linked"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "hello build-id files: 0
hello debuginfo build-id files: 3
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuildid.at:146"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_383
#AT_START_384
at_fn_group_banner 384 'rpmbuildid.at:231' \
  "rpmbuild buildid separate" "                      " 16
at_xfail=no
(
  $as_echo "384. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuildid.at:233" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuildid.at:233"
{ set +x
$as_echo "$at_srcdir/rpmbuildid.at:234:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


# Build, contains one ELF which should have a buildid.
rundebug rpmbuild \\
  --define=\"_build_id_links separate\" \\
  --undefine \"_unique_debug_names\" \\
  --undefine \"_unique_debug_srcs\" \\
  --quiet -ba \"\${abs_srcdir}\"/data/SPECS/hello.spec

# There should be one build-id files in the main and debuginfo package
# plus the .build-id/xx subdir, 2 in total.
echo -n \"hello build-id files: \"
runroot rpm -ql -p /build/RPMS/*/hello-1.0-1.*.rpm \\
  | grep /.build-id/ | wc --lines

echo -n \"hello debuginfo build-id files: \"
runroot rpm -ql -p /build/RPMS/*/hello-debuginfo-1.0-1.*.rpm \\
  | grep /.build-id/ | wc --lines

# Extract the both packages to check the build-id files link to the
# main and .debug files.
rpm2cpio \${RPMTEST}/build/RPMS/*/hello-1.0-1.*.rpm \\
  | cpio -diu
rpm2cpio \${RPMTEST}/build/RPMS/*/hello-debuginfo-1.0-1.*.rpm \\
  | cpio -diu

# Check there is a build-id symlink for the main file.
main_file=./usr/local/bin/hello
test -f \"\${main_file}\" || echo \"No main file \${main_file}\"

# Extract the build-id from the main file
id_main=\$(file \$main_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')

id_main_file=\"./usr/lib/.build-id/\${id_main:0:2}/\${id_main:2}\"
test -L \"\$id_main_file\" || echo \"No build-id file \$id_main_file\"

canon_main_file=\$(readlink -f \${main_file})

test -f \"\$canon_main_file\" \\
  || echo \"Cannot resolve main file \${main_file} -> \${canon_main_file}\"

canon_main_id_file=\$(readlink -f \${id_main_file})

test -f \"\$canon_main_id_file\" \\
  || echo \"Cannot resolve main build-id file \${id_main_file} -> \${canon_main_id_file}\"

test \"\$canon_main_file\" = \"\$canon_main_id_file\" \\
  || echo \"main and build-id file not linked\"

# And check the same for the debug file.
debug_file=./usr/lib/debug/usr/local/bin/hello.debug
test -f \${debug_file} || echo \"No debug file \${debug_file}\"

# Extract the build-id from the .debug file
id_debug=\$(file \$debug_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')

test \${id_main} = \${id_debug} || echo \"unequal main and debug id\"

id_debug_file=\"./usr/lib/debug/.build-id/\${id_debug:0:2}/\${id_debug:2}.debug\"
test -L \"\$id_debug_file\" || echo \"No build-id file \$id_debug_file\"

canon_debug_file=\$(readlink -f \${debug_file})

test -f \"\$canon_debug_file\" \\
  || echo \"Cannot resolve debug file \${debug_file} -> \${canon_debug_file}\"

canon_debug_id_file=\$(readlink -f \${id_debug_file})

test -f \"\$canon_debug_id_file\" \\
  || echo \"Cannot resolve debug build-id file \${id_debug_file} -> \${canon_debug_id_file}\"

test \"\$canon_debug_file\" = \"\$canon_debug_id_file\" \\
  || echo \"debug and build-id not linked\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuildid.at:234"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


# Build, contains one ELF which should have a buildid.
rundebug rpmbuild \
  --define="_build_id_links separate" \
  --undefine "_unique_debug_names" \
  --undefine "_unique_debug_srcs" \
  --quiet -ba "${abs_srcdir}"/data/SPECS/hello.spec

# There should be one build-id files in the main and debuginfo package
# plus the .build-id/xx subdir, 2 in total.
echo -n "hello build-id files: "
runroot rpm -ql -p /build/RPMS/*/hello-1.0-1.*.rpm \
  | grep /.build-id/ | wc --lines

echo -n "hello debuginfo build-id files: "
runroot rpm -ql -p /build/RPMS/*/hello-debuginfo-1.0-1.*.rpm \
  | grep /.build-id/ | wc --lines

# Extract the both packages to check the build-id files link to the
# main and .debug files.
rpm2cpio ${RPMTEST}/build/RPMS/*/hello-1.0-1.*.rpm \
  | cpio -diu
rpm2cpio ${RPMTEST}/build/RPMS/*/hello-debuginfo-1.0-1.*.rpm \
  | cpio -diu

# Check there is a build-id symlink for the main file.
main_file=./usr/local/bin/hello
test -f "${main_file}" || echo "No main file ${main_file}"

# Extract the build-id from the main file
id_main=$(file $main_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')

id_main_file="./usr/lib/.build-id/${id_main:0:2}/${id_main:2}"
test -L "$id_main_file" || echo "No build-id file $id_main_file"

canon_main_file=$(readlink -f ${main_file})

test -f "$canon_main_file" \
  || echo "Cannot resolve main file ${main_file} -> ${canon_main_file}"

canon_main_id_file=$(readlink -f ${id_main_file})

test -f "$canon_main_id_file" \
  || echo "Cannot resolve main build-id file ${id_main_file} -> ${canon_main_id_file}"

test "$canon_main_file" = "$canon_main_id_file" \
  || echo "main and build-id file not linked"

# And check the same for the debug file.
debug_file=./usr/lib/debug/usr/local/bin/hello.debug
test -f ${debug_file} || echo "No debug file ${debug_file}"

# Extract the build-id from the .debug file
id_debug=$(file $debug_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')

test ${id_main} = ${id_debug} || echo "unequal main and debug id"

id_debug_file="./usr/lib/debug/.build-id/${id_debug:0:2}/${id_debug:2}.debug"
test -L "$id_debug_file" || echo "No build-id file $id_debug_file"

canon_debug_file=$(readlink -f ${debug_file})

test -f "$canon_debug_file" \
  || echo "Cannot resolve debug file ${debug_file} -> ${canon_debug_file}"

canon_debug_id_file=$(readlink -f ${id_debug_file})

test -f "$canon_debug_id_file" \
  || echo "Cannot resolve debug build-id file ${id_debug_file} -> ${canon_debug_id_file}"

test "$canon_debug_file" = "$canon_debug_id_file" \
  || echo "debug and build-id not linked"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "hello build-id files: 2
hello debuginfo build-id files: 2
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuildid.at:234"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_384
#AT_START_385
at_fn_group_banner 385 'rpmbuildid.at:319' \
  "rpmbuild buildid separate unique debug names" "   " 16
at_xfail=no
(
  $as_echo "385. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuildid.at:321" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuildid.at:321"
{ set +x
$as_echo "$at_srcdir/rpmbuildid.at:322:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


# Build, contains one ELF which should have a buildid.
rundebug rpmbuild \\
  --define=\"_build_id_links separate\" \\
  --define=\"_unique_debug_names 1\" \\
  --quiet -ba \"\${abs_srcdir}\"/data/SPECS/hello.spec

# There should be one build-id files in the main and debuginfo package
# plus the .build-id/xx subdir, 2 in total.
echo -n \"hello build-id files: \"
runroot rpm -ql -p /build/RPMS/*/hello-1.0-1.*.rpm \\
  | grep /.build-id/ | wc --lines

echo -n \"hello debuginfo build-id files: \"
runroot rpm -ql -p /build/RPMS/*/hello-debuginfo-1.0-1.*.rpm \\
  | grep /.build-id/ | wc --lines

# Extract the both packages to check the build-id files link to the
# main and .debug files.
rpm2cpio \${RPMTEST}/build/RPMS/*/hello-1.0-1.*.rpm \\
  | cpio -diu
rpm2cpio \${RPMTEST}/build/RPMS/*/hello-debuginfo-1.0-1.*.rpm \\
  | cpio -diu

# Check there is a build-id symlink for the main file.
main_file=./usr/local/bin/hello
test -f \"\${main_file}\" || echo \"No main file \${main_file}\"

# Extract the build-id from the main file
id_main=\$(file \$main_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')

id_main_file=\"./usr/lib/.build-id/\${id_main:0:2}/\${id_main:2}\"
test -L \"\$id_main_file\" || echo \"No build-id file \$id_main_file\"

canon_main_file=\$(readlink -f \${main_file})

test -f \"\$canon_main_file\" \\
  || echo \"Cannot resolve main file \${main_file} -> \${canon_main_file}\"

canon_main_id_file=\$(readlink -f \${id_main_file})

test -f \"\$canon_main_id_file\" \\
  || echo \"Cannot resolve main build-id file \${id_main_file} -> \${canon_main_id_file}\"

test \"\$canon_main_file\" = \"\$canon_main_id_file\" \\
  || echo \"main and build-id file not linked\"

# And check the same for the debug file.
debug_file=./usr/lib/debug/usr/local/bin/hello-*.debug
test -f \${debug_file} || echo \"No debug file \${debug_file}\"

# Extract the build-id from the .debug file
id_debug=\$(file \$debug_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')

test \${id_main} = \${id_debug} || echo \"unequal main and debug id\"

id_debug_file=\"./usr/lib/debug/.build-id/\${id_debug:0:2}/\${id_debug:2}.debug\"
test -L \"\$id_debug_file\" || echo \"No build-id file \$id_debug_file\"

canon_debug_file=\$(readlink -f \${debug_file})

test -f \"\$canon_debug_file\" \\
  || echo \"Cannot resolve debug file \${debug_file} -> \${canon_debug_file}\"

canon_debug_id_file=\$(readlink -f \${id_debug_file})

test -f \"\$canon_debug_id_file\" \\
  || echo \"Cannot resolve debug build-id file \${id_debug_file} -> \${canon_debug_id_file}\"

test \"\$canon_debug_file\" = \"\$canon_debug_id_file\" \\
  || echo \"debug and build-id not linked\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuildid.at:322"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


# Build, contains one ELF which should have a buildid.
rundebug rpmbuild \
  --define="_build_id_links separate" \
  --define="_unique_debug_names 1" \
  --quiet -ba "${abs_srcdir}"/data/SPECS/hello.spec

# There should be one build-id files in the main and debuginfo package
# plus the .build-id/xx subdir, 2 in total.
echo -n "hello build-id files: "
runroot rpm -ql -p /build/RPMS/*/hello-1.0-1.*.rpm \
  | grep /.build-id/ | wc --lines

echo -n "hello debuginfo build-id files: "
runroot rpm -ql -p /build/RPMS/*/hello-debuginfo-1.0-1.*.rpm \
  | grep /.build-id/ | wc --lines

# Extract the both packages to check the build-id files link to the
# main and .debug files.
rpm2cpio ${RPMTEST}/build/RPMS/*/hello-1.0-1.*.rpm \
  | cpio -diu
rpm2cpio ${RPMTEST}/build/RPMS/*/hello-debuginfo-1.0-1.*.rpm \
  | cpio -diu

# Check there is a build-id symlink for the main file.
main_file=./usr/local/bin/hello
test -f "${main_file}" || echo "No main file ${main_file}"

# Extract the build-id from the main file
id_main=$(file $main_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')

id_main_file="./usr/lib/.build-id/${id_main:0:2}/${id_main:2}"
test -L "$id_main_file" || echo "No build-id file $id_main_file"

canon_main_file=$(readlink -f ${main_file})

test -f "$canon_main_file" \
  || echo "Cannot resolve main file ${main_file} -> ${canon_main_file}"

canon_main_id_file=$(readlink -f ${id_main_file})

test -f "$canon_main_id_file" \
  || echo "Cannot resolve main build-id file ${id_main_file} -> ${canon_main_id_file}"

test "$canon_main_file" = "$canon_main_id_file" \
  || echo "main and build-id file not linked"

# And check the same for the debug file.
debug_file=./usr/lib/debug/usr/local/bin/hello-*.debug
test -f ${debug_file} || echo "No debug file ${debug_file}"

# Extract the build-id from the .debug file
id_debug=$(file $debug_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')

test ${id_main} = ${id_debug} || echo "unequal main and debug id"

id_debug_file="./usr/lib/debug/.build-id/${id_debug:0:2}/${id_debug:2}.debug"
test -L "$id_debug_file" || echo "No build-id file $id_debug_file"

canon_debug_file=$(readlink -f ${debug_file})

test -f "$canon_debug_file" \
  || echo "Cannot resolve debug file ${debug_file} -> ${canon_debug_file}"

canon_debug_id_file=$(readlink -f ${id_debug_file})

test -f "$canon_debug_id_file" \
  || echo "Cannot resolve debug build-id file ${id_debug_file} -> ${canon_debug_id_file}"

test "$canon_debug_file" = "$canon_debug_id_file" \
  || echo "debug and build-id not linked"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "hello build-id files: 2
hello debuginfo build-id files: 2
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuildid.at:322"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_385
#AT_START_386
at_fn_group_banner 386 'rpmbuildid.at:406' \
  "rpmbuild buildid compat" "                        " 16
at_xfail=no
(
  $as_echo "386. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuildid.at:408" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuildid.at:408"
{ set +x
$as_echo "$at_srcdir/rpmbuildid.at:409:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


# Build, contains one ELF which should have a buildid.
rundebug rpmbuild \\
  --define=\"_build_id_links compat\" \\
  --undefine \"_unique_debug_names\" \\
  --undefine \"_unique_debug_srcs\" \\
  --quiet -ba \"\${abs_srcdir}\"/data/SPECS/hello.spec

# There should be one build-id files in the main and debuginfo package.
# the debuginfo package has one extra main build-id compat symlink
# plus the .build-id/xx subdir, 2 in total in main, 3 in total in debug
echo -n \"hello build-id files: \"
runroot rpm -ql -p /build/RPMS/*/hello-1.0-1.*.rpm \\
  | grep /.build-id/ | wc --lines

echo -n \"hello debuginfo build-id files: \"
runroot rpm -ql -p /build/RPMS/*/hello-debuginfo-1.0-1.*.rpm \\
  | grep /.build-id/ | wc --lines

# Extract the both packages to check the build-id files link to the
# main and .debug files.
rpm2cpio \${RPMTEST}/build/RPMS/*/hello-1.0-1.*.rpm \\
  | cpio -diu
rpm2cpio \${RPMTEST}/build/RPMS/*/hello-debuginfo-1.0-1.*.rpm \\
  | cpio -diu

# Check there is a build-id symlink for the main file.
main_file=./usr/local/bin/hello
test -f \"\${main_file}\" || echo \"No main file \${main_file}\"

# Extract the build-id from the main file
id_main=\$(file \$main_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')

id_main_file=\"./usr/lib/.build-id/\${id_main:0:2}/\${id_main:2}\"
test -L \"\$id_main_file\" || echo \"No build-id file \$id_main_file\"

canon_main_file=\$(readlink -f \${main_file})

test -f \"\$canon_main_file\" \\
  || echo \"Cannot resolve main file \${main_file} -> \${canon_main_file}\"

canon_main_id_file=\$(readlink -f \${id_main_file})

test -f \"\$canon_main_id_file\" \\
  || echo \"Cannot resolve main build-id file \${id_main_file} -> \${canon_main_id_file}\"

test \"\$canon_main_file\" = \"\$canon_main_id_file\" \\
  || echo \"main and build-id file not linked\"

# And check the same for the debug file.
debug_file=./usr/lib/debug/usr/local/bin/hello.debug
test -f \${debug_file} || echo \"No debug file \${debug_file}\"

# Extract the build-id from the .debug file
id_debug=\$(file \$debug_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')

test \${id_main} = \${id_debug} || echo \"unequal main and debug id\"

id_debug_file=\"./usr/lib/debug/.build-id/\${id_debug:0:2}/\${id_debug:2}.debug\"
test -L \"\$id_debug_file\" || echo \"No build-id file \$id_debug_file\"

canon_debug_file=\$(readlink -f \${debug_file})

test -f \"\$canon_debug_file\" \\
  || echo \"Cannot resolve debug file \${debug_file} -> \${canon_debug_file}\"

canon_debug_id_file=\$(readlink -f \${id_debug_file})

test -f \"\$canon_debug_id_file\" \\
  || echo \"Cannot resolve debug build-id file \${id_debug_file} -> \${canon_debug_id_file}\"

test \"\$canon_debug_file\" = \"\$canon_debug_id_file\" \\
  || echo \"debug and build-id not linked\"

# The compat link should also point to the same (indirectly).
id_compat_file=\"./usr/lib/debug/.build-id/\${id_main:0:2}/\${id_main:2}\"
test -L \"\$id_compat_file\" || echo \"No build-id compat file \$id_compat_file\"

canon_compat_file=\$(readlink -f \${id_compat_file})

test -f \"\$canon_compat_file\" \\
  || echo \"Cannot resolve compat file \${id_compat_file} -> \${canon_compat_file}\"

test \"\$canon_compat_file\" = \"\$canon_main_file\" \\
  || echo \"compat and build-id not linked\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuildid.at:409"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


# Build, contains one ELF which should have a buildid.
rundebug rpmbuild \
  --define="_build_id_links compat" \
  --undefine "_unique_debug_names" \
  --undefine "_unique_debug_srcs" \
  --quiet -ba "${abs_srcdir}"/data/SPECS/hello.spec

# There should be one build-id files in the main and debuginfo package.
# the debuginfo package has one extra main build-id compat symlink
# plus the .build-id/xx subdir, 2 in total in main, 3 in total in debug
echo -n "hello build-id files: "
runroot rpm -ql -p /build/RPMS/*/hello-1.0-1.*.rpm \
  | grep /.build-id/ | wc --lines

echo -n "hello debuginfo build-id files: "
runroot rpm -ql -p /build/RPMS/*/hello-debuginfo-1.0-1.*.rpm \
  | grep /.build-id/ | wc --lines

# Extract the both packages to check the build-id files link to the
# main and .debug files.
rpm2cpio ${RPMTEST}/build/RPMS/*/hello-1.0-1.*.rpm \
  | cpio -diu
rpm2cpio ${RPMTEST}/build/RPMS/*/hello-debuginfo-1.0-1.*.rpm \
  | cpio -diu

# Check there is a build-id symlink for the main file.
main_file=./usr/local/bin/hello
test -f "${main_file}" || echo "No main file ${main_file}"

# Extract the build-id from the main file
id_main=$(file $main_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')

id_main_file="./usr/lib/.build-id/${id_main:0:2}/${id_main:2}"
test -L "$id_main_file" || echo "No build-id file $id_main_file"

canon_main_file=$(readlink -f ${main_file})

test -f "$canon_main_file" \
  || echo "Cannot resolve main file ${main_file} -> ${canon_main_file}"

canon_main_id_file=$(readlink -f ${id_main_file})

test -f "$canon_main_id_file" \
  || echo "Cannot resolve main build-id file ${id_main_file} -> ${canon_main_id_file}"

test "$canon_main_file" = "$canon_main_id_file" \
  || echo "main and build-id file not linked"

# And check the same for the debug file.
debug_file=./usr/lib/debug/usr/local/bin/hello.debug
test -f ${debug_file} || echo "No debug file ${debug_file}"

# Extract the build-id from the .debug file
id_debug=$(file $debug_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')

test ${id_main} = ${id_debug} || echo "unequal main and debug id"

id_debug_file="./usr/lib/debug/.build-id/${id_debug:0:2}/${id_debug:2}.debug"
test -L "$id_debug_file" || echo "No build-id file $id_debug_file"

canon_debug_file=$(readlink -f ${debug_file})

test -f "$canon_debug_file" \
  || echo "Cannot resolve debug file ${debug_file} -> ${canon_debug_file}"

canon_debug_id_file=$(readlink -f ${id_debug_file})

test -f "$canon_debug_id_file" \
  || echo "Cannot resolve debug build-id file ${id_debug_file} -> ${canon_debug_id_file}"

test "$canon_debug_file" = "$canon_debug_id_file" \
  || echo "debug and build-id not linked"

# The compat link should also point to the same (indirectly).
id_compat_file="./usr/lib/debug/.build-id/${id_main:0:2}/${id_main:2}"
test -L "$id_compat_file" || echo "No build-id compat file $id_compat_file"

canon_compat_file=$(readlink -f ${id_compat_file})

test -f "$canon_compat_file" \
  || echo "Cannot resolve compat file ${id_compat_file} -> ${canon_compat_file}"

test "$canon_compat_file" = "$canon_main_file" \
  || echo "compat and build-id not linked"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "hello build-id files: 2
hello debuginfo build-id files: 3
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuildid.at:409"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_386
#AT_START_387
at_fn_group_banner 387 'rpmbuildid.at:507' \
  "rpmbuild buildid compat unique debug names" "     " 16
at_xfail=no
(
  $as_echo "387. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuildid.at:509" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuildid.at:509"
{ set +x
$as_echo "$at_srcdir/rpmbuildid.at:510:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


# Build, contains one ELF which should have a buildid.
rundebug rpmbuild \\
  --define=\"_build_id_links compat\" \\
  --define=\"_unique_debug_names 1\" \\
  --quiet -ba \"\${abs_srcdir}\"/data/SPECS/hello.spec

# There should be one build-id files in the main and debuginfo package.
# the debuginfo package has one extra main build-id compat symlink
# plus the .build-id/xx subdir, 2 in total in main, 3 in total in debug
echo -n \"hello build-id files: \"
runroot rpm -ql -p /build/RPMS/*/hello-1.0-1.*.rpm \\
  | grep /.build-id/ | wc --lines

echo -n \"hello debuginfo build-id files: \"
runroot rpm -ql -p /build/RPMS/*/hello-debuginfo-1.0-1.*.rpm \\
  | grep /.build-id/ | wc --lines

# Extract the both packages to check the build-id files link to the
# main and .debug files.
rpm2cpio \${RPMTEST}/build/RPMS/*/hello-1.0-1.*.rpm \\
  | cpio -diu
rpm2cpio \${RPMTEST}/build/RPMS/*/hello-debuginfo-1.0-1.*.rpm \\
  | cpio -diu

# Check there is a build-id symlink for the main file.
main_file=./usr/local/bin/hello
test -f \"\${main_file}\" || echo \"No main file \${main_file}\"

# Extract the build-id from the main file
id_main=\$(file \$main_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')

id_main_file=\"./usr/lib/.build-id/\${id_main:0:2}/\${id_main:2}\"
test -L \"\$id_main_file\" || echo \"No build-id file \$id_main_file\"

canon_main_file=\$(readlink -f \${main_file})

test -f \"\$canon_main_file\" \\
  || echo \"Cannot resolve main file \${main_file} -> \${canon_main_file}\"

canon_main_id_file=\$(readlink -f \${id_main_file})

test -f \"\$canon_main_id_file\" \\
  || echo \"Cannot resolve main build-id file \${id_main_file} -> \${canon_main_id_file}\"

test \"\$canon_main_file\" = \"\$canon_main_id_file\" \\
  || echo \"main and build-id file not linked\"

# And check the same for the debug file.
debug_file=./usr/lib/debug/usr/local/bin/hello-*debug
test -f \${debug_file} || echo \"No debug file \${debug_file}\"

# Extract the build-id from the .debug file
id_debug=\$(file \$debug_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')

test \${id_main} = \${id_debug} || echo \"unequal main and debug id\"

id_debug_file=\"./usr/lib/debug/.build-id/\${id_debug:0:2}/\${id_debug:2}.debug\"
test -L \"\$id_debug_file\" || echo \"No build-id file \$id_debug_file\"

canon_debug_file=\$(readlink -f \${debug_file})

test -f \"\$canon_debug_file\" \\
  || echo \"Cannot resolve debug file \${debug_file} -> \${canon_debug_file}\"

canon_debug_id_file=\$(readlink -f \${id_debug_file})

test -f \"\$canon_debug_id_file\" \\
  || echo \"Cannot resolve debug build-id file \${id_debug_file} -> \${canon_debug_id_file}\"

test \"\$canon_debug_file\" = \"\$canon_debug_id_file\" \\
  || echo \"debug and build-id not linked\"

# The compat link should also point to the same (indirectly).
id_compat_file=\"./usr/lib/debug/.build-id/\${id_main:0:2}/\${id_main:2}\"
test -L \"\$id_compat_file\" || echo \"No build-id compat file \$id_compat_file\"

canon_compat_file=\$(readlink -f \${id_compat_file})

test -f \"\$canon_compat_file\" \\
  || echo \"Cannot resolve compat file \${id_compat_file} -> \${canon_compat_file}\"

test \"\$canon_compat_file\" = \"\$canon_main_file\" \\
  || echo \"compat and build-id not linked\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuildid.at:510"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


# Build, contains one ELF which should have a buildid.
rundebug rpmbuild \
  --define="_build_id_links compat" \
  --define="_unique_debug_names 1" \
  --quiet -ba "${abs_srcdir}"/data/SPECS/hello.spec

# There should be one build-id files in the main and debuginfo package.
# the debuginfo package has one extra main build-id compat symlink
# plus the .build-id/xx subdir, 2 in total in main, 3 in total in debug
echo -n "hello build-id files: "
runroot rpm -ql -p /build/RPMS/*/hello-1.0-1.*.rpm \
  | grep /.build-id/ | wc --lines

echo -n "hello debuginfo build-id files: "
runroot rpm -ql -p /build/RPMS/*/hello-debuginfo-1.0-1.*.rpm \
  | grep /.build-id/ | wc --lines

# Extract the both packages to check the build-id files link to the
# main and .debug files.
rpm2cpio ${RPMTEST}/build/RPMS/*/hello-1.0-1.*.rpm \
  | cpio -diu
rpm2cpio ${RPMTEST}/build/RPMS/*/hello-debuginfo-1.0-1.*.rpm \
  | cpio -diu

# Check there is a build-id symlink for the main file.
main_file=./usr/local/bin/hello
test -f "${main_file}" || echo "No main file ${main_file}"

# Extract the build-id from the main file
id_main=$(file $main_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')

id_main_file="./usr/lib/.build-id/${id_main:0:2}/${id_main:2}"
test -L "$id_main_file" || echo "No build-id file $id_main_file"

canon_main_file=$(readlink -f ${main_file})

test -f "$canon_main_file" \
  || echo "Cannot resolve main file ${main_file} -> ${canon_main_file}"

canon_main_id_file=$(readlink -f ${id_main_file})

test -f "$canon_main_id_file" \
  || echo "Cannot resolve main build-id file ${id_main_file} -> ${canon_main_id_file}"

test "$canon_main_file" = "$canon_main_id_file" \
  || echo "main and build-id file not linked"

# And check the same for the debug file.
debug_file=./usr/lib/debug/usr/local/bin/hello-*debug
test -f ${debug_file} || echo "No debug file ${debug_file}"

# Extract the build-id from the .debug file
id_debug=$(file $debug_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')

test ${id_main} = ${id_debug} || echo "unequal main and debug id"

id_debug_file="./usr/lib/debug/.build-id/${id_debug:0:2}/${id_debug:2}.debug"
test -L "$id_debug_file" || echo "No build-id file $id_debug_file"

canon_debug_file=$(readlink -f ${debug_file})

test -f "$canon_debug_file" \
  || echo "Cannot resolve debug file ${debug_file} -> ${canon_debug_file}"

canon_debug_id_file=$(readlink -f ${id_debug_file})

test -f "$canon_debug_id_file" \
  || echo "Cannot resolve debug build-id file ${id_debug_file} -> ${canon_debug_id_file}"

test "$canon_debug_file" = "$canon_debug_id_file" \
  || echo "debug and build-id not linked"

# The compat link should also point to the same (indirectly).
id_compat_file="./usr/lib/debug/.build-id/${id_main:0:2}/${id_main:2}"
test -L "$id_compat_file" || echo "No build-id compat file $id_compat_file"

canon_compat_file=$(readlink -f ${id_compat_file})

test -f "$canon_compat_file" \
  || echo "Cannot resolve compat file ${id_compat_file} -> ${canon_compat_file}"

test "$canon_compat_file" = "$canon_main_file" \
  || echo "compat and build-id not linked"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "hello build-id files: 2
hello debuginfo build-id files: 3
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuildid.at:510"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_387
#AT_START_388
at_fn_group_banner 388 'rpmbuildid.at:608' \
  "rpmbuild buildid duplicate alldebug" "            " 16
at_xfail=no
(
  $as_echo "388. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuildid.at:610" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuildid.at:610"
{ set +x
$as_echo "$at_srcdir/rpmbuildid.at:611:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

# Should create two warnings
rundebug rpmbuild --quiet \\
  --define=\"_build_id_links alldebug\" \\
  -ba \"\${abs_srcdir}\"/data/SPECS/hello2cp.spec 2>&1 | grep \"^warning: \" \\
  | cut -f1-3 -d' '

rpm2cpio \${RPMTEST}/build/RPMS/*/hello2-1.0-1.*.rpm \\
  | cpio -diu --quiet

hello_file=./usr/local/bin/hello

# Extract the build-id from the main file
id=\$(file \$hello_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')

# alldebug not here...
id_file=\"./usr/lib/debug/.build-id/\${id:0:2}/\${id:2}\"
test -L \"\$id_file\" && echo \"main id in main package\"
id_dup_file=\"./usr/lib/debug/.build-id/\${id:0:2}/\${id:2}.1\"
test -L \"\$id_dup_file\" && echo \"main dup id in main package\"

rpm2cpio \${RPMTEST}/build/RPMS/*/hello2-debuginfo-1.0-1.*.rpm \\
  | cpio -diu --quiet

# alldebug, so they are all here
test -L \"\$id_file\" && echo \"main id in debug package\"
test -L \"\$id_dup_file\" && echo \"main dup id in debug package\"

debug_id_file=\"./usr/lib/debug/.build-id/\${id:0:2}/\${id:2}.debug\"
test -L \"\$debug_id_file\" && echo \"debug id in debug package\"
debug_dup_file=\"./usr/lib/debug/.build-id/\${id:0:2}/\${id:2}.1.debug\"
test -L \"\$debug_dup_file\" && echo \"debug dup id in debug package\"

# We don't know which points to which, but we do know they point
# to different files.
canon_id_file=\$(readlink -f \${id_file})
canon_dup_file=\$(readlink -f \${id_dup_file})
test \"\$canon_id_file\" != \"\$canon_dup_file\" \\
  || echo \"id and dup same\"

canon_debug_id_file=\$(readlink -f \${debug_id_file})
canon_debug_dup_file=\$(readlink -f \${debug_dup_file})
test \"\$canon_debug_id_file\" != \"\$canon_debug_dup_file\" \\
  || echo \"debug id and dup same\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuildid.at:611"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

# Should create two warnings
rundebug rpmbuild --quiet \
  --define="_build_id_links alldebug" \
  -ba "${abs_srcdir}"/data/SPECS/hello2cp.spec 2>&1 | grep "^warning: " \
  | cut -f1-3 -d' '

rpm2cpio ${RPMTEST}/build/RPMS/*/hello2-1.0-1.*.rpm \
  | cpio -diu --quiet

hello_file=./usr/local/bin/hello

# Extract the build-id from the main file
id=$(file $hello_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')

# alldebug not here...
id_file="./usr/lib/debug/.build-id/${id:0:2}/${id:2}"
test -L "$id_file" && echo "main id in main package"
id_dup_file="./usr/lib/debug/.build-id/${id:0:2}/${id:2}.1"
test -L "$id_dup_file" && echo "main dup id in main package"

rpm2cpio ${RPMTEST}/build/RPMS/*/hello2-debuginfo-1.0-1.*.rpm \
  | cpio -diu --quiet

# alldebug, so they are all here
test -L "$id_file" && echo "main id in debug package"
test -L "$id_dup_file" && echo "main dup id in debug package"

debug_id_file="./usr/lib/debug/.build-id/${id:0:2}/${id:2}.debug"
test -L "$debug_id_file" && echo "debug id in debug package"
debug_dup_file="./usr/lib/debug/.build-id/${id:0:2}/${id:2}.1.debug"
test -L "$debug_dup_file" && echo "debug dup id in debug package"

# We don't know which points to which, but we do know they point
# to different files.
canon_id_file=$(readlink -f ${id_file})
canon_dup_file=$(readlink -f ${id_dup_file})
test "$canon_id_file" != "$canon_dup_file" \
  || echo "id and dup same"

canon_debug_id_file=$(readlink -f ${debug_id_file})
canon_debug_dup_file=$(readlink -f ${debug_dup_file})
test "$canon_debug_id_file" != "$canon_debug_dup_file" \
  || echo "debug id and dup same"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "warning: Duplicate build-ids
warning: Duplicate build-ids
main id in debug package
main dup id in debug package
debug id in debug package
debug dup id in debug package
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuildid.at:611"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_388
#AT_START_389
at_fn_group_banner 389 'rpmbuildid.at:673' \
  "rpmbuild buildid hardlink alldebug" "             " 16
at_xfail=no
(
  $as_echo "389. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuildid.at:675" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuildid.at:675"
{ set +x
$as_echo "$at_srcdir/rpmbuildid.at:676:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

# No warnings for hard links
rundebug rpmbuild --quiet \\
  --define=\"_build_id_links alldebug\" \\
  -ba \"\${abs_srcdir}\"/data/SPECS/hello2ln.spec 2>&1 | grep \"^warning: \" \\
  | cut -f1-3 -d' '

rpm2cpio \${RPMTEST}/build/RPMS/*/hello2-1.0-1.*.rpm \\
  | cpio -diu --quiet

hello_file=./usr/local/bin/hello

# Extract the build-id from the main file
id=\$(file \$hello_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')

# alldebug not here...
id_file=\"./usr/lib/debug/.build-id/\${id:0:2}/\${id:2}\"
test -L \"\$id_file\" && echo \"main id in main package\"
id_dup_file=\"./usr/lib/debug/.build-id/\${id:0:2}/\${id:2}.1\"
test -L \"\$id_dup_file\" && echo \"main dup id in main package\"

rpm2cpio \${RPMTEST}/build/RPMS/*/hello2-debuginfo-1.0-1.*.rpm \\
  | cpio -diu --quiet

# alldebug, so they are all here
test -L \"\$id_file\" && echo \"main id in debug package\"
test -L \"\$id_dup_file\" && echo \"main dup id in debug package\"

debug_id_file=\"./usr/lib/debug/.build-id/\${id:0:2}/\${id:2}.debug\"
test -L \"\$debug_id_file\" && echo \"debug id in debug package\"
debug_dup_file=\"./usr/lib/debug/.build-id/\${id:0:2}/\${id:2}.1.debug\"
test -L \"\$debug_dup_file\" && echo \"debug dup id in debug package\"

# We don't know which points to which, but we do know they point
# to different files.
canon_id_file=\$(readlink -f \${id_file})
canon_dup_file=\$(readlink -f \${id_dup_file})
test \"\$canon_id_file\" != \"\$canon_dup_file\" \\
  || echo \"id and dup same\"

canon_debug_id_file=\$(readlink -f \${debug_id_file})
canon_debug_dup_file=\$(readlink -f \${debug_dup_file})
test \"\$canon_debug_id_file\" != \"\$canon_debug_dup_file\" \\
  || echo \"debug id and dup same\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuildid.at:676"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

# No warnings for hard links
rundebug rpmbuild --quiet \
  --define="_build_id_links alldebug" \
  -ba "${abs_srcdir}"/data/SPECS/hello2ln.spec 2>&1 | grep "^warning: " \
  | cut -f1-3 -d' '

rpm2cpio ${RPMTEST}/build/RPMS/*/hello2-1.0-1.*.rpm \
  | cpio -diu --quiet

hello_file=./usr/local/bin/hello

# Extract the build-id from the main file
id=$(file $hello_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')

# alldebug not here...
id_file="./usr/lib/debug/.build-id/${id:0:2}/${id:2}"
test -L "$id_file" && echo "main id in main package"
id_dup_file="./usr/lib/debug/.build-id/${id:0:2}/${id:2}.1"
test -L "$id_dup_file" && echo "main dup id in main package"

rpm2cpio ${RPMTEST}/build/RPMS/*/hello2-debuginfo-1.0-1.*.rpm \
  | cpio -diu --quiet

# alldebug, so they are all here
test -L "$id_file" && echo "main id in debug package"
test -L "$id_dup_file" && echo "main dup id in debug package"

debug_id_file="./usr/lib/debug/.build-id/${id:0:2}/${id:2}.debug"
test -L "$debug_id_file" && echo "debug id in debug package"
debug_dup_file="./usr/lib/debug/.build-id/${id:0:2}/${id:2}.1.debug"
test -L "$debug_dup_file" && echo "debug dup id in debug package"

# We don't know which points to which, but we do know they point
# to different files.
canon_id_file=$(readlink -f ${id_file})
canon_dup_file=$(readlink -f ${id_dup_file})
test "$canon_id_file" != "$canon_dup_file" \
  || echo "id and dup same"

canon_debug_id_file=$(readlink -f ${debug_id_file})
canon_debug_dup_file=$(readlink -f ${debug_dup_file})
test "$canon_debug_id_file" != "$canon_debug_dup_file" \
  || echo "debug id and dup same"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "main id in debug package
main dup id in debug package
debug id in debug package
debug dup id in debug package
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuildid.at:676"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_389
#AT_START_390
at_fn_group_banner 390 'rpmbuildid.at:735' \
  "rpmbuild buildid duplicate separate" "            " 16
at_xfail=no
(
  $as_echo "390. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuildid.at:737" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuildid.at:737"
{ set +x
$as_echo "$at_srcdir/rpmbuildid.at:738:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

# Should create two warnings
rundebug rpmbuild --quiet \\
  --define=\"_build_id_links separate\" \\
  -ba \"\${abs_srcdir}\"/data/SPECS/hello2cp.spec 2>&1 | grep \"^warning: \" \\
  | cut -f1-3 -d' '

rpm2cpio \${RPMTEST}/build/RPMS/*/hello2-1.0-1.*.rpm \\
  | cpio -diu --quiet

hello_file=./usr/local/bin/hello

# Extract the build-id from the main file
id=\$(file \$hello_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')

# separate build-ids split...
id_file=\"./usr/lib/.build-id/\${id:0:2}/\${id:2}\"
test -L \"\$id_file\" && echo \"main id in main package\"
id_dup_file=\"./usr/lib/.build-id/\${id:0:2}/\${id:2}.1\"
test -L \"\$id_dup_file\" && echo \"main dup id in main package\"

rpm2cpio \${RPMTEST}/build/RPMS/*/hello2-debuginfo-1.0-1.*.rpm \\
  | cpio -diu --quiet

# separate, so debug ids are here
debug_id_file=\"./usr/lib/debug/.build-id/\${id:0:2}/\${id:2}.debug\"
test -L \"\$debug_id_file\" && echo \"debug id in debug package\"
debug_dup_file=\"./usr/lib/debug/.build-id/\${id:0:2}/\${id:2}.1.debug\"
test -L \"\$debug_dup_file\" && echo \"debug dup id in debug package\"

# We don't know which points to which, but we do know they point
# to different files.
canon_id_file=\$(readlink -f \${id_file})
canon_dup_file=\$(readlink -f \${id_dup_file})
test \"\$canon_id_file\" != \"\$canon_dup_file\" \\
  || echo \"id and dup same\"

canon_debug_id_file=\$(readlink -f \${debug_id_file})
canon_debug_dup_file=\$(readlink -f \${debug_dup_file})
test \"\$canon_debug_id_file\" != \"\$canon_debug_dup_file\" \\
  || echo \"debug id and dup same\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuildid.at:738"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

# Should create two warnings
rundebug rpmbuild --quiet \
  --define="_build_id_links separate" \
  -ba "${abs_srcdir}"/data/SPECS/hello2cp.spec 2>&1 | grep "^warning: " \
  | cut -f1-3 -d' '

rpm2cpio ${RPMTEST}/build/RPMS/*/hello2-1.0-1.*.rpm \
  | cpio -diu --quiet

hello_file=./usr/local/bin/hello

# Extract the build-id from the main file
id=$(file $hello_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')

# separate build-ids split...
id_file="./usr/lib/.build-id/${id:0:2}/${id:2}"
test -L "$id_file" && echo "main id in main package"
id_dup_file="./usr/lib/.build-id/${id:0:2}/${id:2}.1"
test -L "$id_dup_file" && echo "main dup id in main package"

rpm2cpio ${RPMTEST}/build/RPMS/*/hello2-debuginfo-1.0-1.*.rpm \
  | cpio -diu --quiet

# separate, so debug ids are here
debug_id_file="./usr/lib/debug/.build-id/${id:0:2}/${id:2}.debug"
test -L "$debug_id_file" && echo "debug id in debug package"
debug_dup_file="./usr/lib/debug/.build-id/${id:0:2}/${id:2}.1.debug"
test -L "$debug_dup_file" && echo "debug dup id in debug package"

# We don't know which points to which, but we do know they point
# to different files.
canon_id_file=$(readlink -f ${id_file})
canon_dup_file=$(readlink -f ${id_dup_file})
test "$canon_id_file" != "$canon_dup_file" \
  || echo "id and dup same"

canon_debug_id_file=$(readlink -f ${debug_id_file})
canon_debug_dup_file=$(readlink -f ${debug_dup_file})
test "$canon_debug_id_file" != "$canon_debug_dup_file" \
  || echo "debug id and dup same"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "warning: Duplicate build-ids
warning: Duplicate build-ids
main id in main package
main dup id in main package
debug id in debug package
debug dup id in debug package
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuildid.at:738"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_390
#AT_START_391
at_fn_group_banner 391 'rpmbuildid.at:797' \
  "rpmbuild buildid hardlink separate" "             " 16
at_xfail=no
(
  $as_echo "391. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuildid.at:799" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuildid.at:799"
{ set +x
$as_echo "$at_srcdir/rpmbuildid.at:800:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

# No warnings for hard links
rundebug rpmbuild --quiet \\
  --define=\"_build_id_links separate\" \\
  -ba \"\${abs_srcdir}\"/data/SPECS/hello2ln.spec 2>&1 | grep \"^warning: \" \\
  | cut -f1-3 -d' '

rpm2cpio \${RPMTEST}/build/RPMS/*/hello2-1.0-1.*.rpm \\
  | cpio -diu --quiet

hello_file=./usr/local/bin/hello

# Extract the build-id from the main file
id=\$(file \$hello_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')

# separate build-ids split...
id_file=\"./usr/lib/.build-id/\${id:0:2}/\${id:2}\"
test -L \"\$id_file\" && echo \"main id in main package\"
id_dup_file=\"./usr/lib/.build-id/\${id:0:2}/\${id:2}.1\"
test -L \"\$id_dup_file\" && echo \"main dup id in main package\"

rpm2cpio \${RPMTEST}/build/RPMS/*/hello2-debuginfo-1.0-1.*.rpm \\
  | cpio -diu --quiet

# separate, so debug ids are here
debug_id_file=\"./usr/lib/debug/.build-id/\${id:0:2}/\${id:2}.debug\"
test -L \"\$debug_id_file\" && echo \"debug id in debug package\"
debug_dup_file=\"./usr/lib/debug/.build-id/\${id:0:2}/\${id:2}.1.debug\"
test -L \"\$debug_dup_file\" && echo \"debug dup id in debug package\"

# We don't know which points to which, but we do know they point
# to different files.
canon_id_file=\$(readlink -f \${id_file})
canon_dup_file=\$(readlink -f \${id_dup_file})
test \"\$canon_id_file\" != \"\$canon_dup_file\" \\
  || echo \"id and dup same\"

canon_debug_id_file=\$(readlink -f \${debug_id_file})
canon_debug_dup_file=\$(readlink -f \${debug_dup_file})
test \"\$canon_debug_id_file\" != \"\$canon_debug_dup_file\" \\
  || echo \"debug id and dup same\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuildid.at:800"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

# No warnings for hard links
rundebug rpmbuild --quiet \
  --define="_build_id_links separate" \
  -ba "${abs_srcdir}"/data/SPECS/hello2ln.spec 2>&1 | grep "^warning: " \
  | cut -f1-3 -d' '

rpm2cpio ${RPMTEST}/build/RPMS/*/hello2-1.0-1.*.rpm \
  | cpio -diu --quiet

hello_file=./usr/local/bin/hello

# Extract the build-id from the main file
id=$(file $hello_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')

# separate build-ids split...
id_file="./usr/lib/.build-id/${id:0:2}/${id:2}"
test -L "$id_file" && echo "main id in main package"
id_dup_file="./usr/lib/.build-id/${id:0:2}/${id:2}.1"
test -L "$id_dup_file" && echo "main dup id in main package"

rpm2cpio ${RPMTEST}/build/RPMS/*/hello2-debuginfo-1.0-1.*.rpm \
  | cpio -diu --quiet

# separate, so debug ids are here
debug_id_file="./usr/lib/debug/.build-id/${id:0:2}/${id:2}.debug"
test -L "$debug_id_file" && echo "debug id in debug package"
debug_dup_file="./usr/lib/debug/.build-id/${id:0:2}/${id:2}.1.debug"
test -L "$debug_dup_file" && echo "debug dup id in debug package"

# We don't know which points to which, but we do know they point
# to different files.
canon_id_file=$(readlink -f ${id_file})
canon_dup_file=$(readlink -f ${id_dup_file})
test "$canon_id_file" != "$canon_dup_file" \
  || echo "id and dup same"

canon_debug_id_file=$(readlink -f ${debug_id_file})
canon_debug_dup_file=$(readlink -f ${debug_dup_file})
test "$canon_debug_id_file" != "$canon_debug_dup_file" \
  || echo "debug id and dup same"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "main id in main package
main dup id in main package
debug id in debug package
debug dup id in debug package
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuildid.at:800"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_391
#AT_START_392
at_fn_group_banner 392 'rpmbuildid.at:856' \
  "rpmbuild buildid duplicate compat" "              " 16
at_xfail=no
(
  $as_echo "392. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuildid.at:858" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuildid.at:858"
{ set +x
$as_echo "$at_srcdir/rpmbuildid.at:859:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

# Should create two warnings
rundebug rpmbuild --quiet \\
  --define=\"_build_id_links compat\" \\
  -ba \"\${abs_srcdir}\"/data/SPECS/hello2cp.spec 2>&1 | grep \"^warning: \" \\
  | cut -f1-3 -d' '

rpm2cpio \${RPMTEST}/build/RPMS/*/hello2-1.0-1.*.rpm \\
  | cpio -diu --quiet

hello_file=./usr/local/bin/hello

# Extract the build-id from the main file
id=\$(file \$hello_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')

# compat build-ids split...
id_file=\"./usr/lib/.build-id/\${id:0:2}/\${id:2}\"
test -L \"\$id_file\" && echo \"main id in main package\"
id_dup_file=\"./usr/lib/.build-id/\${id:0:2}/\${id:2}.1\"
test -L \"\$id_dup_file\" && echo \"main dup id in main package\"

rpm2cpio \${RPMTEST}/build/RPMS/*/hello2-debuginfo-1.0-1.*.rpm \\
  | cpio -diu --quiet

# compat, so main (and debug) ids are (also) here
compat_file=\"./usr/lib/debug/.build-id/\${id:0:2}/\${id:2}\"
test -L \"\$compat_file\" && echo \"compat id in debug package\"
compat_dup_file=\"./usr/lib/debug/.build-id/\${id:0:2}/\${id:2}.1\"
test -L \"\$compat_dup_file\" && echo \"compat dup id in debug package\"

debug_id_file=\"./usr/lib/debug/.build-id/\${id:0:2}/\${id:2}.debug\"
test -L \"\$debug_id_file\" && echo \"debug id in debug package\"
debug_dup_file=\"./usr/lib/debug/.build-id/\${id:0:2}/\${id:2}.1.debug\"
test -L \"\$debug_dup_file\" && echo \"debug dup id in debug package\"

# We don't know which points to which, but we do know they point
# to different files.
canon_id_file=\$(readlink -f \${id_file})
canon_dup_file=\$(readlink -f \${id_dup_file})
test \"\$canon_id_file\" != \"\$canon_dup_file\" \\
  || echo \"id and dup same\"

canon_debug_id_file=\$(readlink -f \${debug_id_file})
canon_debug_dup_file=\$(readlink -f \${debug_dup_file})
test \"\$canon_debug_id_file\" != \"\$canon_debug_dup_file\" \\
  || echo \"debug id and dup same\"

canon_compat_file=\$(readlink -f \${compat_file})
canon_compat_dup_file=\$(readlink -f \${compat_dup_file})
test \"\$canon_compat_file\" != \"\$canon_compat_dup_file\" \\
  || echo \"compat id and dup same\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuildid.at:859"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

# Should create two warnings
rundebug rpmbuild --quiet \
  --define="_build_id_links compat" \
  -ba "${abs_srcdir}"/data/SPECS/hello2cp.spec 2>&1 | grep "^warning: " \
  | cut -f1-3 -d' '

rpm2cpio ${RPMTEST}/build/RPMS/*/hello2-1.0-1.*.rpm \
  | cpio -diu --quiet

hello_file=./usr/local/bin/hello

# Extract the build-id from the main file
id=$(file $hello_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')

# compat build-ids split...
id_file="./usr/lib/.build-id/${id:0:2}/${id:2}"
test -L "$id_file" && echo "main id in main package"
id_dup_file="./usr/lib/.build-id/${id:0:2}/${id:2}.1"
test -L "$id_dup_file" && echo "main dup id in main package"

rpm2cpio ${RPMTEST}/build/RPMS/*/hello2-debuginfo-1.0-1.*.rpm \
  | cpio -diu --quiet

# compat, so main (and debug) ids are (also) here
compat_file="./usr/lib/debug/.build-id/${id:0:2}/${id:2}"
test -L "$compat_file" && echo "compat id in debug package"
compat_dup_file="./usr/lib/debug/.build-id/${id:0:2}/${id:2}.1"
test -L "$compat_dup_file" && echo "compat dup id in debug package"

debug_id_file="./usr/lib/debug/.build-id/${id:0:2}/${id:2}.debug"
test -L "$debug_id_file" && echo "debug id in debug package"
debug_dup_file="./usr/lib/debug/.build-id/${id:0:2}/${id:2}.1.debug"
test -L "$debug_dup_file" && echo "debug dup id in debug package"

# We don't know which points to which, but we do know they point
# to different files.
canon_id_file=$(readlink -f ${id_file})
canon_dup_file=$(readlink -f ${id_dup_file})
test "$canon_id_file" != "$canon_dup_file" \
  || echo "id and dup same"

canon_debug_id_file=$(readlink -f ${debug_id_file})
canon_debug_dup_file=$(readlink -f ${debug_dup_file})
test "$canon_debug_id_file" != "$canon_debug_dup_file" \
  || echo "debug id and dup same"

canon_compat_file=$(readlink -f ${compat_file})
canon_compat_dup_file=$(readlink -f ${compat_dup_file})
test "$canon_compat_file" != "$canon_compat_dup_file" \
  || echo "compat id and dup same"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "warning: Duplicate build-ids
warning: Duplicate build-ids
main id in main package
main dup id in main package
compat id in debug package
compat dup id in debug package
debug id in debug package
debug dup id in debug package
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuildid.at:859"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_392
#AT_START_393
at_fn_group_banner 393 'rpmbuildid.at:930' \
  "rpmbuild buildid hardlink compat" "               " 16
at_xfail=no
(
  $as_echo "393. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuildid.at:932" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuildid.at:932"
{ set +x
$as_echo "$at_srcdir/rpmbuildid.at:933:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

# No warnings for hard links
rundebug rpmbuild --quiet \\
  --define=\"_build_id_links compat\" \\
  -ba \"\${abs_srcdir}\"/data/SPECS/hello2ln.spec 2>&1 | grep \"^warning: \" \\
  | cut -f1-3 -d' '

rpm2cpio \${RPMTEST}/build/RPMS/*/hello2-1.0-1.*.rpm \\
  | cpio -diu --quiet

hello_file=./usr/local/bin/hello

# Extract the build-id from the main file
id=\$(file \$hello_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')

# compat build-ids split...
id_file=\"./usr/lib/.build-id/\${id:0:2}/\${id:2}\"
test -L \"\$id_file\" && echo \"main id in main package\"
id_dup_file=\"./usr/lib/.build-id/\${id:0:2}/\${id:2}.1\"
test -L \"\$id_dup_file\" && echo \"main dup id in main package\"

rpm2cpio \${RPMTEST}/build/RPMS/*/hello2-debuginfo-1.0-1.*.rpm \\
  | cpio -diu --quiet

# compat, so main (and debug) ids are (also) here
compat_file=\"./usr/lib/debug/.build-id/\${id:0:2}/\${id:2}\"
test -L \"\$compat_file\" && echo \"compat id in debug package\"
compat_dup_file=\"./usr/lib/debug/.build-id/\${id:0:2}/\${id:2}.1\"
test -L \"\$compat_dup_file\" && echo \"compat dup id in debug package\"

debug_id_file=\"./usr/lib/debug/.build-id/\${id:0:2}/\${id:2}.debug\"
test -L \"\$debug_id_file\" && echo \"debug id in debug package\"
debug_dup_file=\"./usr/lib/debug/.build-id/\${id:0:2}/\${id:2}.1.debug\"
test -L \"\$debug_dup_file\" && echo \"debug dup id in debug package\"

# We don't know which points to which, but we do know they point
# to different files.
canon_id_file=\$(readlink -f \${id_file})
canon_dup_file=\$(readlink -f \${id_dup_file})
test \"\$canon_id_file\" != \"\$canon_dup_file\" \\
  || echo \"id and dup same\"

canon_debug_id_file=\$(readlink -f \${debug_id_file})
canon_debug_dup_file=\$(readlink -f \${debug_dup_file})
test \"\$canon_debug_id_file\" != \"\$canon_debug_dup_file\" \\
  || echo \"debug id and dup same\"

canon_compat_file=\$(readlink -f \${compat_file})
canon_compat_dup_file=\$(readlink -f \${compat_dup_file})
test \"\$canon_compat_file\" != \"\$canon_compat_dup_file\" \\
  || echo \"compat id and dup same\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuildid.at:933"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

# No warnings for hard links
rundebug rpmbuild --quiet \
  --define="_build_id_links compat" \
  -ba "${abs_srcdir}"/data/SPECS/hello2ln.spec 2>&1 | grep "^warning: " \
  | cut -f1-3 -d' '

rpm2cpio ${RPMTEST}/build/RPMS/*/hello2-1.0-1.*.rpm \
  | cpio -diu --quiet

hello_file=./usr/local/bin/hello

# Extract the build-id from the main file
id=$(file $hello_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')

# compat build-ids split...
id_file="./usr/lib/.build-id/${id:0:2}/${id:2}"
test -L "$id_file" && echo "main id in main package"
id_dup_file="./usr/lib/.build-id/${id:0:2}/${id:2}.1"
test -L "$id_dup_file" && echo "main dup id in main package"

rpm2cpio ${RPMTEST}/build/RPMS/*/hello2-debuginfo-1.0-1.*.rpm \
  | cpio -diu --quiet

# compat, so main (and debug) ids are (also) here
compat_file="./usr/lib/debug/.build-id/${id:0:2}/${id:2}"
test -L "$compat_file" && echo "compat id in debug package"
compat_dup_file="./usr/lib/debug/.build-id/${id:0:2}/${id:2}.1"
test -L "$compat_dup_file" && echo "compat dup id in debug package"

debug_id_file="./usr/lib/debug/.build-id/${id:0:2}/${id:2}.debug"
test -L "$debug_id_file" && echo "debug id in debug package"
debug_dup_file="./usr/lib/debug/.build-id/${id:0:2}/${id:2}.1.debug"
test -L "$debug_dup_file" && echo "debug dup id in debug package"

# We don't know which points to which, but we do know they point
# to different files.
canon_id_file=$(readlink -f ${id_file})
canon_dup_file=$(readlink -f ${id_dup_file})
test "$canon_id_file" != "$canon_dup_file" \
  || echo "id and dup same"

canon_debug_id_file=$(readlink -f ${debug_id_file})
canon_debug_dup_file=$(readlink -f ${debug_dup_file})
test "$canon_debug_id_file" != "$canon_debug_dup_file" \
  || echo "debug id and dup same"

canon_compat_file=$(readlink -f ${compat_file})
canon_compat_dup_file=$(readlink -f ${compat_dup_file})
test "$canon_compat_file" != "$canon_compat_dup_file" \
  || echo "compat id and dup same"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "main id in main package
main dup id in main package
compat id in debug package
compat dup id in debug package
debug id in debug package
debug dup id in debug package
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuildid.at:933"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_393
#AT_START_394
at_fn_group_banner 394 'rpmbuildid.at:1000' \
  "rpmbuild buildid recompute" "                     " 16
at_xfail=no
(
  $as_echo "394. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuildid.at:1002" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuildid.at:1002"
{ set +x
$as_echo "$at_srcdir/rpmbuildid.at:1003:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

# Make sure we get debuginfo
export CFLAGS=\"-g\"

# Unique 1
rundebug rpmbuild --quiet \\
  --define=\"_unique_build_ids 1\" \\
  --undefine=\"_no_recompute_build_ids\" \\
  -ba \"\${abs_srcdir}\"/data/SPECS/hello.spec

rpm2cpio \${RPMTEST}/build/RPMS/*/hello-1.0-1.*.rpm \\
  | cpio -diu --quiet

hello_file=./usr/local/bin/hello

# Extract the build-id from the main file
test -f \$hello_file || echo \"No \$hello_file\"
id1=\$(file \$hello_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')

# Make sure we generate a new one
rm \$hello_file

# Unique 2
# Build the \"next\" release, which has no changes except for the release update.
rundebug rpmbuild --quiet \\
  --define=\"_unique_build_ids 1\" \\
  --undefine=\"_no_recompute_build_ids\" \\
  -ba \"\${abs_srcdir}\"/data/SPECS/hello-r2.spec

rpm2cpio \${RPMTEST}/build/RPMS/*/hello-1.0-2.*.rpm \\
  | cpio -diu --quiet

# Extract the build-id from the main file
test -f \$hello_file || echo \"No \$hello_file\"
id2=\$(file \$hello_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')

# Two unique builds should not be equal
if test \"\$id1\" == \"\$id2\"; then
  echo \"uniques equal\";
else
  echo \"uniques unequal\";
fi

# Make sure we generate a new one
rm \$hello_file

# no-recompute 1
rundebug rpmbuild --quiet \\
  --undefine=\"_unique_build_ids\" \\
  --undefine=\"_unique_debug_names\" \\
  --undefine=\"_unique_debug_srcs\" \\
  --define=\"_no_recompute_build_ids 1\" \\
  -ba \"\${abs_srcdir}\"/data/SPECS/hello.spec

rpm2cpio \${RPMTEST}/build/RPMS/*/hello-1.0-1.*.rpm \\
  | cpio -diu --quiet

hello_file=./usr/local/bin/hello

# Extract the build-id from the main file
test -f \$hello_file || echo \"No \$hello_file\"
id3=\$(file \$hello_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')

# An unique and no-recompute build should be unequal
if test \"\$id2\" == \"\$id3\"; then
  echo \"no-recompute unique equal\";
else
  echo \"no-recompute unique unequal\";
fi

# Make sure we generate a new one
rm \$hello_file

# no-recompute 2
# Build the \"next\" release, which has no changes except for the release update.
rundebug rpmbuild --quiet \\
  --undefine=\"_unique_build_ids\" \\
  --undefine=\"_unique_debug_names\" \\
  --undefine=\"_unique_debug_srcs\" \\
  --define=\"_no_recompute_build_ids 1\" \\
  -ba \"\${abs_srcdir}\"/data/SPECS/hello-r2.spec

rpm2cpio \${RPMTEST}/build/RPMS/*/hello-1.0-2.*.rpm \\
  | cpio -diu --quiet

# Extract the build-id from the main file
test -f \$hello_file || echo \"No \$hello_file\"
id4=\$(file \$hello_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')

# Two no-recompute builds should be equal. Even for different \"releases\".
if test \"\$id3\" == \"\$id4\"; then
  echo \"no-recomputes equal\";
else
  echo \"no-recomputes unequal\";
fi
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuildid.at:1003"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

# Make sure we get debuginfo
export CFLAGS="-g"

# Unique 1
rundebug rpmbuild --quiet \
  --define="_unique_build_ids 1" \
  --undefine="_no_recompute_build_ids" \
  -ba "${abs_srcdir}"/data/SPECS/hello.spec

rpm2cpio ${RPMTEST}/build/RPMS/*/hello-1.0-1.*.rpm \
  | cpio -diu --quiet

hello_file=./usr/local/bin/hello

# Extract the build-id from the main file
test -f $hello_file || echo "No $hello_file"
id1=$(file $hello_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')

# Make sure we generate a new one
rm $hello_file

# Unique 2
# Build the "next" release, which has no changes except for the release update.
rundebug rpmbuild --quiet \
  --define="_unique_build_ids 1" \
  --undefine="_no_recompute_build_ids" \
  -ba "${abs_srcdir}"/data/SPECS/hello-r2.spec

rpm2cpio ${RPMTEST}/build/RPMS/*/hello-1.0-2.*.rpm \
  | cpio -diu --quiet

# Extract the build-id from the main file
test -f $hello_file || echo "No $hello_file"
id2=$(file $hello_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')

# Two unique builds should not be equal
if test "$id1" == "$id2"; then
  echo "uniques equal";
else
  echo "uniques unequal";
fi

# Make sure we generate a new one
rm $hello_file

# no-recompute 1
rundebug rpmbuild --quiet \
  --undefine="_unique_build_ids" \
  --undefine="_unique_debug_names" \
  --undefine="_unique_debug_srcs" \
  --define="_no_recompute_build_ids 1" \
  -ba "${abs_srcdir}"/data/SPECS/hello.spec

rpm2cpio ${RPMTEST}/build/RPMS/*/hello-1.0-1.*.rpm \
  | cpio -diu --quiet

hello_file=./usr/local/bin/hello

# Extract the build-id from the main file
test -f $hello_file || echo "No $hello_file"
id3=$(file $hello_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')

# An unique and no-recompute build should be unequal
if test "$id2" == "$id3"; then
  echo "no-recompute unique equal";
else
  echo "no-recompute unique unequal";
fi

# Make sure we generate a new one
rm $hello_file

# no-recompute 2
# Build the "next" release, which has no changes except for the release update.
rundebug rpmbuild --quiet \
  --undefine="_unique_build_ids" \
  --undefine="_unique_debug_names" \
  --undefine="_unique_debug_srcs" \
  --define="_no_recompute_build_ids 1" \
  -ba "${abs_srcdir}"/data/SPECS/hello-r2.spec

rpm2cpio ${RPMTEST}/build/RPMS/*/hello-1.0-2.*.rpm \
  | cpio -diu --quiet

# Extract the build-id from the main file
test -f $hello_file || echo "No $hello_file"
id4=$(file $hello_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')

# Two no-recompute builds should be equal. Even for different "releases".
if test "$id3" == "$id4"; then
  echo "no-recomputes equal";
else
  echo "no-recomputes unequal";
fi

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "uniques unequal
no-recompute unique unequal
no-recomputes equal
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuildid.at:1003"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_394
#AT_START_395
at_fn_group_banner 395 'rpmbuildid.at:1111' \
  "rpmbuild buildid unique r1 r2" "                  " 16
at_xfail=no
(
  $as_echo "395. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuildid.at:1113" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuildid.at:1113"
{ set +x
$as_echo "$at_srcdir/rpmbuildid.at:1114:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

# No warnings for hard links
rundebug rpmbuild --quiet \\
  --define=\"_unique_build_ids 1\" \\
  -ba \"\${abs_srcdir}\"/data/SPECS/hello.spec

rpm2cpio \${RPMTEST}/build/RPMS/*/hello-1.0-1.*.rpm \\
  | cpio -diu --quiet

hello_file=./usr/local/bin/hello

# Extract the build-id from the main file
test -f \$hello_file || echo \"No \$hello_file\"
id1=\$(file \$hello_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')

# Make sure we generate a new one
rm \$hello_file

# Build the \"next\" release, which has no changes except for the release update.
rundebug rpmbuild --quiet \\
  --define=\"_unique_build_ids 1\" \\
  -ba \"\${abs_srcdir}\"/data/SPECS/hello-r2.spec

rpm2cpio \${RPMTEST}/build/RPMS/*/hello-1.0-2.*.rpm \\
  | cpio -diu --quiet

# Extract the build-id from the main file
test -f \$hello_file || echo \"No \$hello_file\"
id2=\$(file \$hello_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')

if test \"\$id1\" == \"\$id2\"; then echo \"equal \$id1\"; else echo \"unequal\"; fi
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuildid.at:1114"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

# No warnings for hard links
rundebug rpmbuild --quiet \
  --define="_unique_build_ids 1" \
  -ba "${abs_srcdir}"/data/SPECS/hello.spec

rpm2cpio ${RPMTEST}/build/RPMS/*/hello-1.0-1.*.rpm \
  | cpio -diu --quiet

hello_file=./usr/local/bin/hello

# Extract the build-id from the main file
test -f $hello_file || echo "No $hello_file"
id1=$(file $hello_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')

# Make sure we generate a new one
rm $hello_file

# Build the "next" release, which has no changes except for the release update.
rundebug rpmbuild --quiet \
  --define="_unique_build_ids 1" \
  -ba "${abs_srcdir}"/data/SPECS/hello-r2.spec

rpm2cpio ${RPMTEST}/build/RPMS/*/hello-1.0-2.*.rpm \
  | cpio -diu --quiet

# Extract the build-id from the main file
test -f $hello_file || echo "No $hello_file"
id2=$(file $hello_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')

if test "$id1" == "$id2"; then echo "equal $id1"; else echo "unequal"; fi

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "unequal
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuildid.at:1114"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_395
#AT_START_396
at_fn_group_banner 396 'rpmbuildid.at:1156' \
  "rpmbuild buildid non-unique r1 r2" "              " 16
at_xfail=no
(
  $as_echo "396. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuildid.at:1158" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuildid.at:1158"
{ set +x
$as_echo "$at_srcdir/rpmbuildid.at:1159:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

# No warnings for hard links
rundebug rpmbuild --quiet \\
  --undefine=\"_unique_build_ids\" \\
  --undefine=\"_unique_debug_names\" \\
  --undefine=\"_unique_debug_srcs\" \\
  -ba \"\${abs_srcdir}\"/data/SPECS/hello.spec

rpm2cpio \${RPMTEST}/build/RPMS/*/hello-1.0-1.*.rpm \\
  | cpio -diu --quiet

hello_file=./usr/local/bin/hello

# Extract the build-id from the main file
test -f \$hello_file || echo \"No \$hello_file\"
id1=\$(file \$hello_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')

# Make sure we generate a new one
rm \$hello_file

# Build the \"next\" release, which has no changes except for the release update.
rundebug rpmbuild --quiet \\
  --undefine=\"_unique_build_ids\" \\
  --undefine=\"_unique_debug_names\" \\
  --undefine=\"_unique_debug_srcs\" \\
  -ba \"\${abs_srcdir}\"/data/SPECS/hello-r2.spec

rpm2cpio \${RPMTEST}/build/RPMS/*/hello-1.0-2.*.rpm \\
  | cpio -diu --quiet

# Extract the build-id from the main file
test -f \$hello_file || echo \"No \$hello_file\"
id2=\$(file \$hello_file | sed 's/.*, BuildID\\[.*\\]=\\([0-9a-f]*\\),.*/\\1/')

if test \"\$id1\" == \"\$id2\"; then echo \"equal\"; else echo \"unequal \$id1 \$id2\"; fi
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuildid.at:1159"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

# No warnings for hard links
rundebug rpmbuild --quiet \
  --undefine="_unique_build_ids" \
  --undefine="_unique_debug_names" \
  --undefine="_unique_debug_srcs" \
  -ba "${abs_srcdir}"/data/SPECS/hello.spec

rpm2cpio ${RPMTEST}/build/RPMS/*/hello-1.0-1.*.rpm \
  | cpio -diu --quiet

hello_file=./usr/local/bin/hello

# Extract the build-id from the main file
test -f $hello_file || echo "No $hello_file"
id1=$(file $hello_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')

# Make sure we generate a new one
rm $hello_file

# Build the "next" release, which has no changes except for the release update.
rundebug rpmbuild --quiet \
  --undefine="_unique_build_ids" \
  --undefine="_unique_debug_names" \
  --undefine="_unique_debug_srcs" \
  -ba "${abs_srcdir}"/data/SPECS/hello-r2.spec

rpm2cpio ${RPMTEST}/build/RPMS/*/hello-1.0-2.*.rpm \
  | cpio -diu --quiet

# Extract the build-id from the main file
test -f $hello_file || echo "No $hello_file"
id2=$(file $hello_file | sed 's/.*, BuildID\[.*\]=\([0-9a-f]*\),.*/\1/')

if test "$id1" == "$id2"; then echo "equal"; else echo "unequal $id1 $id2"; fi

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "equal
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuildid.at:1159"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_396
#AT_START_397
at_fn_group_banner 397 'rpmbuildid.at:1205' \
  "rpmbuild buildid attrs" "                         " 16
at_xfail=no
(
  $as_echo "397. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuildid.at:1207" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuildid.at:1207"
{ set +x
$as_echo "$at_srcdir/rpmbuildid.at:1208:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


# Build, contains one ELF which should have a buildid.
rundebug rpmbuild \\
  --define=\"_build_id_links compat\" \\
  --define \"_unique_debug_names 1\" \\
  --define \"_unique_debug_srcs 1\" \\
  --quiet -ba \"\${abs_srcdir}\"/data/SPECS/hello-attr-buildid.spec

runroot rpm -qp --qf \"[%{filenames} %{filemodes:perms}\\n]\" \\
        /build/RPMS/*/test-1.0-1*rpm \\
	| grep \"build-id d\"

runroot rpm -qp --qf \"[%{filenames} %{filemodes:perms}\\n]\" \\
        /build/RPMS/*/test-debuginfo-1.0-1*rpm \\
	| grep \"build-id d\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuildid.at:1208"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


# Build, contains one ELF which should have a buildid.
rundebug rpmbuild \
  --define="_build_id_links compat" \
  --define "_unique_debug_names 1" \
  --define "_unique_debug_srcs 1" \
  --quiet -ba "${abs_srcdir}"/data/SPECS/hello-attr-buildid.spec

runroot rpm -qp --qf "[%{filenames} %{filemodes:perms}\n]" \
        /build/RPMS/*/test-1.0-1*rpm \
	| grep "build-id d"

runroot rpm -qp --qf "[%{filenames} %{filemodes:perms}\n]" \
        /build/RPMS/*/test-debuginfo-1.0-1*rpm \
	| grep "build-id d"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "/usr/lib/.build-id drwxr-xr-x
/usr/lib/debug/.build-id drwxr-xr-x
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuildid.at:1208"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_397
#AT_START_398
at_fn_group_banner 398 'rpmbuildid.at:1236' \
  "rpmbuild buildid config attrs" "                  " 16
at_xfail=no
(
  $as_echo "398. $at_setup_line: testing $at_desc ..."
  $at_traceon


$as_echo "rpmbuildid.at:1238" >"$at_check_line_file"
($DEBUGINFO_DISABLED) \
  && at_fn_check_skip 77 "$at_srcdir/rpmbuildid.at:1238"
{ set +x
$as_echo "$at_srcdir/rpmbuildid.at:1239:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


# Build, contains one ELF which should have a buildid.
rundebug rpmbuild \\
  --define=\"_build_id_links compat\" \\
  --define \"_unique_debug_names 1\" \\
  --define \"_unique_debug_srcs 1\" \\
  --quiet -ba \"\${abs_srcdir}\"/data/SPECS/hello-config-buildid.spec

# Should contain one config file.
runroot rpm -c -qp /build/RPMS/*/test-1.0-1*rpm
# Should not contain config files.
runroot rpm -c -qp /build/RPMS/*/test-debuginfo-1.0-1*rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmbuildid.at:1239"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


# Build, contains one ELF which should have a buildid.
rundebug rpmbuild \
  --define="_build_id_links compat" \
  --define "_unique_debug_names 1" \
  --define "_unique_debug_srcs 1" \
  --quiet -ba "${abs_srcdir}"/data/SPECS/hello-config-buildid.spec

# Should contain one config file.
runroot rpm -c -qp /build/RPMS/*/test-1.0-1*rpm
# Should not contain config files.
runroot rpm -c -qp /build/RPMS/*/test-debuginfo-1.0-1*rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo >>"$at_stdout"; $as_echo "/etc/config.file
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmbuildid.at:1239"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_398
#AT_START_399
at_fn_group_banner 399 'rpmscript.at:5' \
  "basic script failures 1" "                        " 17
at_xfail=no
(
  $as_echo "399. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmscript.at:7:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/fakeshell.spec
for v in 1.0 2.0; do
    runroot rpmbuild --quiet --define \"ver \${v}\" -bb /data/SPECS/scriptfail.spec
done

runroot rpm -U /build/RPMS/noarch/fakeshell-1.0-1.noarch.rpm

pkgname=\"scriptfail\"
pkg1=\"\${pkgname}-1.0-1\"
pkg2=\"\${pkgname}-2.0-1\"
pkgfile1=\"/build/RPMS/noarch/\${pkg1}.noarch.rpm\"
pkgfile2=\"/build/RPMS/noarch/\${pkg2}.noarch.rpm\"

echo PRETRANSFAIL
runroot rpm -U --define \"exitpretrans 1\" \${pkgfile1} 2>&1; echo \$?
runroot rpm -q \${pkgname} 2>&1
echo PRETRANS
runroot rpm -U --define \"exitpretrans 0\" \${pkgfile1} 2>&1; echo \$?
runroot rpm -q \${pkgname} 2>&1
runroot rpm -e \${pkgname} 2>&1
echo PREFAIL
runroot rpm -U --define \"exitpre 1\" \${pkgfile1} 2>&1; echo \$?
runroot rpm -q \${pkgname} 2>&1
echo PRE
runroot rpm -U --define \"exitpre 0\" \${pkgfile1} 2>&1; echo \$?
runroot rpm -q \${pkgname} 2>&1
echo PREUNFAIL
runroot rpm -e --define \"exitpreun 1\" \${pkgname} 2>&1; echo \$?
runroot rpm -q \${pkgname} 2>&1
echo PREUN
runroot rpm -e --define \"exitpreun 0\" \${pkgname} 2>&1; echo \$?
runroot rpm -q \${pkgname} 2>&1
echo POSTFAIL
runroot rpm -U \${pkgfile1} 2>&1
runroot rpm -U --define \"exitpost 1\" \${pkgfile2} 2>&1; echo \$?
runroot rpm -q \${pkgname} 2>&1
runroot rpm -e \${pkgname} 2>&1
echo POST
runroot rpm -U \${pkgfile1} 2>&1
runroot rpm -U --define \"exitpost 0\" \${pkgfile2} 2>&1; echo \$?
runroot rpm -q \${pkgname} 2>&1
runroot rpm -e \${pkgname} 2>&1
echo POSTTRANSFAIL
runroot rpm -U --define \"exitposttrans 1\" \${pkgfile1} 2>&1; echo \$?
runroot rpm -q \${pkgname} 2>&1
runroot rpm -e \${pkgname} 2>&1
echo POSTTRANS
runroot rpm -U --define \"exitposttrans 0\" \${pkgfile1} 2>&1; echo \$?
runroot rpm -q \${pkgname} 2>&1
runroot rpm -e \${pkgname} 2>&1
echo POSTUNFAIL
runroot rpm -U \${pkgfile1} 2>&1
runroot rpm -U --define \"exitpostun 1\" \${pkgfile2} 2>&1; echo \$?
runroot rpm -q \${pkgname} 2>&1
runroot rpm -e \${pkgname} 2>&1
echo POSTUN
runroot rpm -U \${pkgfile1} 2>&1
runroot rpm -U --define \"exitpostun 0\" \${pkgfile2} 2>&1; echo \$?
runroot rpm -q \${pkgname} 2>&1
runroot rpm -e \${pkgname} 2>&1

exit 0
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmscript.at:7"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/fakeshell.spec
for v in 1.0 2.0; do
    runroot rpmbuild --quiet --define "ver ${v}" -bb /data/SPECS/scriptfail.spec
done

runroot rpm -U /build/RPMS/noarch/fakeshell-1.0-1.noarch.rpm

pkgname="scriptfail"
pkg1="${pkgname}-1.0-1"
pkg2="${pkgname}-2.0-1"
pkgfile1="/build/RPMS/noarch/${pkg1}.noarch.rpm"
pkgfile2="/build/RPMS/noarch/${pkg2}.noarch.rpm"

echo PRETRANSFAIL
runroot rpm -U --define "exitpretrans 1" ${pkgfile1} 2>&1; echo $?
runroot rpm -q ${pkgname} 2>&1
echo PRETRANS
runroot rpm -U --define "exitpretrans 0" ${pkgfile1} 2>&1; echo $?
runroot rpm -q ${pkgname} 2>&1
runroot rpm -e ${pkgname} 2>&1
echo PREFAIL
runroot rpm -U --define "exitpre 1" ${pkgfile1} 2>&1; echo $?
runroot rpm -q ${pkgname} 2>&1
echo PRE
runroot rpm -U --define "exitpre 0" ${pkgfile1} 2>&1; echo $?
runroot rpm -q ${pkgname} 2>&1
echo PREUNFAIL
runroot rpm -e --define "exitpreun 1" ${pkgname} 2>&1; echo $?
runroot rpm -q ${pkgname} 2>&1
echo PREUN
runroot rpm -e --define "exitpreun 0" ${pkgname} 2>&1; echo $?
runroot rpm -q ${pkgname} 2>&1
echo POSTFAIL
runroot rpm -U ${pkgfile1} 2>&1
runroot rpm -U --define "exitpost 1" ${pkgfile2} 2>&1; echo $?
runroot rpm -q ${pkgname} 2>&1
runroot rpm -e ${pkgname} 2>&1
echo POST
runroot rpm -U ${pkgfile1} 2>&1
runroot rpm -U --define "exitpost 0" ${pkgfile2} 2>&1; echo $?
runroot rpm -q ${pkgname} 2>&1
runroot rpm -e ${pkgname} 2>&1
echo POSTTRANSFAIL
runroot rpm -U --define "exitposttrans 1" ${pkgfile1} 2>&1; echo $?
runroot rpm -q ${pkgname} 2>&1
runroot rpm -e ${pkgname} 2>&1
echo POSTTRANS
runroot rpm -U --define "exitposttrans 0" ${pkgfile1} 2>&1; echo $?
runroot rpm -q ${pkgname} 2>&1
runroot rpm -e ${pkgname} 2>&1
echo POSTUNFAIL
runroot rpm -U ${pkgfile1} 2>&1
runroot rpm -U --define "exitpostun 1" ${pkgfile2} 2>&1; echo $?
runroot rpm -q ${pkgname} 2>&1
runroot rpm -e ${pkgname} 2>&1
echo POSTUN
runroot rpm -U ${pkgfile1} 2>&1
runroot rpm -U --define "exitpostun 0" ${pkgfile2} 2>&1; echo $?
runroot rpm -q ${pkgname} 2>&1
runroot rpm -e ${pkgname} 2>&1

exit 0

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "PRETRANSFAIL
error: %pretrans(scriptfail-1.0-1.noarch) scriptlet failed, exit status 1
error: scriptfail-1.0-1.noarch: install skipped
1
package scriptfail is not installed
PRETRANS
0
scriptfail-1.0-1.noarch
PREFAIL
error: %prein(scriptfail-1.0-1.noarch) scriptlet failed, exit status 1
error: scriptfail-1.0-1.noarch: install failed
1
package scriptfail is not installed
PRE
0
scriptfail-1.0-1.noarch
PREUNFAIL
error: %preun(scriptfail-1.0-1.noarch) scriptlet failed, exit status 1
error: scriptfail-1.0-1.noarch: erase failed
1
scriptfail-1.0-1.noarch
PREUN
0
package scriptfail is not installed
POSTFAIL
warning: %post(scriptfail-2.0-1.noarch) scriptlet failed, exit status 1
0
scriptfail-2.0-1.noarch
POST
0
scriptfail-2.0-1.noarch
POSTTRANSFAIL
warning: %posttrans(scriptfail-1.0-1.noarch) scriptlet failed, exit status 1
0
scriptfail-1.0-1.noarch
POSTTRANS
0
scriptfail-1.0-1.noarch
POSTUNFAIL
warning: %postun(scriptfail-1.0-1.noarch) scriptlet failed, exit status 1
0
scriptfail-2.0-1.noarch
POSTUN
0
scriptfail-2.0-1.noarch
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmscript.at:7"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_399
#AT_START_400
at_fn_group_banner 400 'rpmscript.at:125' \
  "basic scripts and arguments" "                    " 17
at_xfail=no
(
  $as_echo "400. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmscript.at:127:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/fakeshell.spec
runroot rpmbuild --quiet -bb --define \"rel 1\" /data/SPECS/scripts.spec
runroot rpmbuild --quiet -bb --define \"rel 2\" /data/SPECS/scripts.spec

runroot rpm -U /build/RPMS/noarch/fakeshell-1.0-1.noarch.rpm
runroot rpm -Vvp /build/RPMS/noarch/scripts-1.0-1.noarch.rpm
runroot rpm -U /build/RPMS/noarch/scripts-1.0-1.noarch.rpm
runroot rpm -U /build/RPMS/noarch/scripts-1.0-2.noarch.rpm
runroot rpm -Vv scripts
runroot rpm -e scripts
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmscript.at:127"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/fakeshell.spec
runroot rpmbuild --quiet -bb --define "rel 1" /data/SPECS/scripts.spec
runroot rpmbuild --quiet -bb --define "rel 2" /data/SPECS/scripts.spec

runroot rpm -U /build/RPMS/noarch/fakeshell-1.0-1.noarch.rpm
runroot rpm -Vvp /build/RPMS/noarch/scripts-1.0-1.noarch.rpm
runroot rpm -U /build/RPMS/noarch/scripts-1.0-1.noarch.rpm
runroot rpm -U /build/RPMS/noarch/scripts-1.0-2.noarch.rpm
runroot rpm -Vv scripts
runroot rpm -e scripts

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "scripts-1.0-1 VERIFY 0
scripts-1.0-1 PRETRANS 1
scripts-1.0-1 PRE 1
scripts-1.0-1 POST 1
scripts-1.0-1 POSTTRANS 1
scripts-1.0-2 PRETRANS 2
scripts-1.0-2 PRE 2
scripts-1.0-2 POST 2
scripts-1.0-1 PREUN 1
scripts-1.0-1 POSTUN 1
scripts-1.0-2 POSTTRANS 1
scripts-1.0-2 VERIFY 1
scripts-1.0-2 PREUN 0
scripts-1.0-2 POSTUN 0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmscript.at:127"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_400
#AT_START_401
at_fn_group_banner 401 'rpmscript.at:160' \
  "basic trigger scripts and arguments" "            " 17
at_xfail=no
(
  $as_echo "401. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmscript.at:162:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/fakeshell.spec
runroot rpmbuild --quiet -bb --define \"rel 1\" /data/SPECS/scripts.spec
runroot rpmbuild --quiet -bb --define \"rel 2\" /data/SPECS/scripts.spec
runroot rpmbuild --quiet -bb --define \"rel 1\" --define \"trigpkg scripts\" /data/SPECS/triggers.spec
runroot rpmbuild --quiet -bb --define \"rel 2\" --define \"trigpkg scripts\" /data/SPECS/triggers.spec

runroot rpm -U /build/RPMS/noarch/fakeshell-1.0-1.noarch.rpm
echo TRIGGERS 1
runroot rpm -U /build/RPMS/noarch/triggers-1.0-1.noarch.rpm
echo SCRIPTS 1
runroot rpm -U /build/RPMS/noarch/scripts-1.0-1.noarch.rpm
echo SCRIPTS 2
runroot rpm -U /build/RPMS/noarch/scripts-1.0-2.noarch.rpm
echo TRIGGERS 2
runroot rpm -U /build/RPMS/noarch/triggers-1.0-2.noarch.rpm
echo ERASE
runroot rpm -e scripts
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmscript.at:162"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/fakeshell.spec
runroot rpmbuild --quiet -bb --define "rel 1" /data/SPECS/scripts.spec
runroot rpmbuild --quiet -bb --define "rel 2" /data/SPECS/scripts.spec
runroot rpmbuild --quiet -bb --define "rel 1" --define "trigpkg scripts" /data/SPECS/triggers.spec
runroot rpmbuild --quiet -bb --define "rel 2" --define "trigpkg scripts" /data/SPECS/triggers.spec

runroot rpm -U /build/RPMS/noarch/fakeshell-1.0-1.noarch.rpm
echo TRIGGERS 1
runroot rpm -U /build/RPMS/noarch/triggers-1.0-1.noarch.rpm
echo SCRIPTS 1
runroot rpm -U /build/RPMS/noarch/scripts-1.0-1.noarch.rpm
echo SCRIPTS 2
runroot rpm -U /build/RPMS/noarch/scripts-1.0-2.noarch.rpm
echo TRIGGERS 2
runroot rpm -U /build/RPMS/noarch/triggers-1.0-2.noarch.rpm
echo ERASE
runroot rpm -e scripts

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "TRIGGERS 1
SCRIPTS 1
scripts-1.0-1 PRETRANS 1
triggers-1.0-1 TRIGGERPREIN 1 0
scripts-1.0-1 PRE 1
scripts-1.0-1 POST 1
triggers-1.0-1 TRIGGERIN 1 1
scripts-1.0-1 POSTTRANS 1
SCRIPTS 2
scripts-1.0-2 PRETRANS 2
triggers-1.0-1 TRIGGERPREIN 1 1
scripts-1.0-2 PRE 2
scripts-1.0-2 POST 2
triggers-1.0-1 TRIGGERIN 1 2
triggers-1.0-1 TRIGGERUN 1 1
scripts-1.0-1 PREUN 1
scripts-1.0-1 POSTUN 1
triggers-1.0-1 TRIGGERPOSTUN 1 1
scripts-1.0-2 POSTTRANS 1
TRIGGERS 2
triggers-1.0-2 TRIGGERPREIN 1 1
triggers-1.0-2 TRIGGERIN 2 1
triggers-1.0-1 TRIGGERUN 1 1
ERASE
triggers-1.0-2 TRIGGERUN 1 0
scripts-1.0-2 PREUN 0
scripts-1.0-2 POSTUN 0
triggers-1.0-2 TRIGGERPOSTUN 1 0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmscript.at:162"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_401
#AT_START_402
at_fn_group_banner 402 'rpmscript.at:216' \
  "basic file trigger scripts" "                     " 17
at_xfail=no
(
  $as_echo "402. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmscript.at:218:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/fakeshell.spec
runroot rpmbuild --quiet -bb /data/SPECS/hello-script.spec
runroot rpmbuild --quiet -bb /data/SPECS/hlinktest.spec
runroot rpmbuild --quiet -bb /data/SPECS/filetriggers.spec

runroot rpm -U /build/RPMS/noarch/fakeshell-1.0-1.noarch.rpm
runroot rpm -U /build/RPMS/noarch/filetriggers-1.0-1.noarch.rpm
echo INSTALLATION
runroot rpm -U /build/RPMS/noarch/hello-script-1.0-1.noarch.rpm \\
/build/RPMS/noarch/hlinktest-1.0-1.noarch.rpm
echo ERASE
runroot rpm -e hello-script hlinktest
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmscript.at:218"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/fakeshell.spec
runroot rpmbuild --quiet -bb /data/SPECS/hello-script.spec
runroot rpmbuild --quiet -bb /data/SPECS/hlinktest.spec
runroot rpmbuild --quiet -bb /data/SPECS/filetriggers.spec

runroot rpm -U /build/RPMS/noarch/fakeshell-1.0-1.noarch.rpm
runroot rpm -U /build/RPMS/noarch/filetriggers-1.0-1.noarch.rpm
echo INSTALLATION
runroot rpm -U /build/RPMS/noarch/hello-script-1.0-1.noarch.rpm \
/build/RPMS/noarch/hlinktest-1.0-1.noarch.rpm
echo ERASE
runroot rpm -e hello-script hlinktest

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "INSTALLATION
filetriggerin(/foo*):
/foo/aaaa
/foo/copyllo
/foo/hello
/foo/hello-bar
/foo/hello-foo
/foo/hello-world
/foo/zzzz

filetriggerin(/foo*)<lua>:
/foo/aaaa
/foo/copyllo
/foo/hello
/foo/hello-bar
/foo/hello-foo
/foo/hello-world
/foo/zzzz

filetriggerin(/usr/bin*): 0
/usr/bin/hello

filetriggerin(/usr/bin*)<lua>: 0
/usr/bin/hello

transfiletriggerin(/usr/bin*): 0
/usr/bin/hello

transfiletriggerin(/foo*):
/foo/aaaa
/foo/copyllo
/foo/hello
/foo/hello-bar
/foo/hello-foo
/foo/hello-world
/foo/zzzz

ERASE
transfiletriggerun(/usr/bin*): 0
/usr/bin/hello

transfiletriggerun(/foo*):
/foo/aaaa
/foo/copyllo
/foo/hello
/foo/hello-bar
/foo/hello-foo
/foo/hello-world
/foo/zzzz

filetriggerun(/foo*):
/foo/aaaa
/foo/copyllo
/foo/hello
/foo/hello-bar
/foo/hello-foo
/foo/hello-world
/foo/zzzz

filetriggerpostun(/foo*):
/foo/aaaa
/foo/copyllo
/foo/hello
/foo/hello-bar
/foo/hello-foo
/foo/hello-world
/foo/zzzz

filetriggerun(/usr/bin*): 0
/usr/bin/hello

filetriggerpostun(/usr/bin*): 0
/usr/bin/hello

transfiletriggerpostun(/usr/bin*): 0

transfiletriggerpostun(/foo*):

" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmscript.at:218"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_402
#AT_START_403
at_fn_group_banner 403 'rpmscript.at:317' \
  "basic file triggers 2" "                          " 17
at_xfail=no
(
  $as_echo "403. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmscript.at:319:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/fakeshell.spec
for v in 1.0 2.0 3.0; do
    runroot rpmbuild --quiet -bb --define \"ver \${v}\" /data/SPECS/parallel.spec
done

runroot rpm -U /build/RPMS/noarch/fakeshell-1.0-1.noarch.rpm
runroot rpm -i \\
	/build/RPMS/noarch/parallel-1.0-1.noarch.rpm \\
	/build/RPMS/noarch/parallel-2.0-1.noarch.rpm \\
	/build/RPMS/noarch/parallel-3.0-1.noarch.rpm

echo INSTALL:
runroot rpm -U /build/RPMS/noarch/parallel-trigger-1.0-1.noarch.rpm
echo UPGRADE:
runroot rpm -U /build/RPMS/noarch/parallel-trigger-2.0-1.noarch.rpm
echo ERASE:
runroot rpm -e parallel-trigger

"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmscript.at:319"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/fakeshell.spec
for v in 1.0 2.0 3.0; do
    runroot rpmbuild --quiet -bb --define "ver ${v}" /data/SPECS/parallel.spec
done

runroot rpm -U /build/RPMS/noarch/fakeshell-1.0-1.noarch.rpm
runroot rpm -i \
	/build/RPMS/noarch/parallel-1.0-1.noarch.rpm \
	/build/RPMS/noarch/parallel-2.0-1.noarch.rpm \
	/build/RPMS/noarch/parallel-3.0-1.noarch.rpm

echo INSTALL:
runroot rpm -U /build/RPMS/noarch/parallel-trigger-1.0-1.noarch.rpm
echo UPGRADE:
runroot rpm -U /build/RPMS/noarch/parallel-trigger-2.0-1.noarch.rpm
echo ERASE:
runroot rpm -e parallel-trigger


) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "INSTALL:
%filetriggerin: 0
36
%transfiletriggerin: 0
36
UPGRADE:
%transfiletriggerun: 0
36
%filetriggerin: 0
36
%transfiletriggerin: 0
36
ERASE:
%transfiletriggerun: 0
36
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmscript.at:319"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_403
#AT_START_404
at_fn_group_banner 404 'rpmdeps.at:6' \
  "unversioned requires" "                           " 18
at_xfail=no
(
  $as_echo "404. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
	--define "pkg one" \
	--define "reqs deptest-two" \
	  /data/SPECS/deptest.spec

runroot rpmbuild --quiet -bb \
	--define "pkg two" \
	--define "reqs deptest-one" \
	  /data/SPECS/deptest.spec

# missing dependency
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:21:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:21"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Failed dependencies:
	deptest-two is needed by deptest-one-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmdeps.at:21"
$at_failed && at_fn_log_failure
$at_traceon; }


# cross-depending packages
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:33:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:33"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdeps.at:33"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_404
#AT_START_405
at_fn_group_banner 405 'rpmdeps.at:45' \
  "unsatisfied versioned require" "                  " 18
at_xfail=no
(
  $as_echo "405. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmdeps.at:47:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \\
	--define \"pkg one\" \\
	--define \"reqs deptest-two >= 2.0\" \\
	  /data/SPECS/deptest.spec

runroot rpmbuild --quiet -bb \\
	--define \"pkg two\" \\
	--define \"provs deptest-foo = 1.0\" \\
	  /data/SPECS/deptest.spec

runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm
echo \$?
runroot rpm -U --nodeps /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm
echo \$?
runroot rpm -e deptest-two
echo \$?
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:47"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
	--define "pkg one" \
	--define "reqs deptest-two >= 2.0" \
	  /data/SPECS/deptest.spec

runroot rpmbuild --quiet -bb \
	--define "pkg two" \
	--define "provs deptest-foo = 1.0" \
	  /data/SPECS/deptest.spec

runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm
echo $?
runroot rpm -U --nodeps /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm
echo $?
runroot rpm -e deptest-two
echo $?

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Failed dependencies:
	deptest-two >= 2.0 is needed by deptest-one-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "2
0
0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_skip $at_status "$at_srcdir/rpmdeps.at:47"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_405
#AT_START_406
at_fn_group_banner 406 'rpmdeps.at:79' \
  "satisfied versioned require" "                    " 18
at_xfail=no
(
  $as_echo "406. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmdeps.at:81:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \\
	--define \"pkg one\" \\
	--define \"reqs deptest-foo >= 2.0\" \\
	  /data/SPECS/deptest.spec

runroot rpmbuild --quiet -bb \\
	--define \"pkg two\" \\
	--define \"provs deptest-foo = 2.0\" \\
	  /data/SPECS/deptest.spec

runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:81"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
	--define "pkg one" \
	--define "reqs deptest-foo >= 2.0" \
	  /data/SPECS/deptest.spec

runroot rpmbuild --quiet -bb \
	--define "pkg two" \
	--define "provs deptest-foo = 2.0" \
	  /data/SPECS/deptest.spec

runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdeps.at:81"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_406
#AT_START_407
at_fn_group_banner 407 'rpmdeps.at:103' \
  "versioned conflicts" "                            " 18
at_xfail=no
(
  $as_echo "407. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
	--define "pkg one" \
	--define "cfls deptest-two < 2.0" \
	  /data/SPECS/deptest.spec

runroot rpmbuild --quiet -bb \
	--define "pkg two" \
	  /data/SPECS/deptest.spec

# versioned conflict in transaction
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:117:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:117"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Failed dependencies:
	deptest-two < 2.0 conflicts with deptest-one-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/rpmdeps.at:117"
$at_failed && at_fn_log_failure
$at_traceon; }


# versioned conflict in database
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:129:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm
runroot rpm -U /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:129"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm
runroot rpm -U /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Failed dependencies:
	deptest-two < 2.0 conflicts with (installed) deptest-one-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmdeps.at:129"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_407
#AT_START_408
at_fn_group_banner 408 'rpmdeps.at:142' \
  "install and verify self-conflicting package" "    " 18
at_xfail=no
(
  $as_echo "408. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmdeps.at:144:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \\
	--define \"pkg one\" \\
	--define \"provs something\" \\
	--define \"cfls something\" \\
	  /data/SPECS/deptest.spec

runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm
runroot rpm -V --nofiles deptest-one
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:144"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
	--define "pkg one" \
	--define "provs something" \
	--define "cfls something" \
	  /data/SPECS/deptest.spec

runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm
runroot rpm -V --nofiles deptest-one

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdeps.at:144"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_408
#AT_START_409
at_fn_group_banner 409 'rpmdeps.at:162' \
  "explicit file conflicts" "                        " 18
at_xfail=no
(
  $as_echo "409. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmdeps.at:164:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \\
	--define \"pkg one\" \\
	--define \"cfls /opt/bar\" \\
	  /data/SPECS/deptest.spec

runroot rpmbuild --quiet -bb \\
	--define \"pkg two\" \\
	  /data/SPECS/deptest.spec

runroot rpm -U --test \\
	/build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm \\
	/build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm
runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm
runroot rpm -U /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm
runroot rpm -e deptest-one
# XXX FIXME: rpm's problem message for this case is higly bogus.
runroot rpm -U /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm
runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm
runroot rpm -e deptest-two
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:164"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
	--define "pkg one" \
	--define "cfls /opt/bar" \
	  /data/SPECS/deptest.spec

runroot rpmbuild --quiet -bb \
	--define "pkg two" \
	  /data/SPECS/deptest.spec

runroot rpm -U --test \
	/build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm \
	/build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm
runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm
runroot rpm -U /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm
runroot rpm -e deptest-one
# XXX FIXME: rpm's problem message for this case is higly bogus.
runroot rpm -U /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm
runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm
runroot rpm -e deptest-two

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Failed dependencies:
	/opt/bar conflicts with deptest-one-1.0-1.noarch
error: Failed dependencies:
	/opt/bar conflicts with (installed) deptest-one-1.0-1.noarch
error: Failed dependencies:
	/opt/bar conflicts with deptest-one-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdeps.at:164"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_409
#AT_START_410
at_fn_group_banner 410 'rpmdeps.at:199' \
  "erase to break dependencies" "                    " 18
at_xfail=no
(
  $as_echo "410. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmdeps.at:201:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \\
	--define \"pkg one\" \\
	--define \"reqs deptest-foo >= 2.0\" \\
	  /data/SPECS/deptest.spec

runroot rpmbuild --quiet -bb \\
	--define \"pkg two\" \\
	--define \"provs deptest-foo = 2.0\" \\
	  /data/SPECS/deptest.spec

runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm
runroot rpm -e deptest-two
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:201"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
	--define "pkg one" \
	--define "reqs deptest-foo >= 2.0" \
	  /data/SPECS/deptest.spec

runroot rpmbuild --quiet -bb \
	--define "pkg two" \
	--define "provs deptest-foo = 2.0" \
	  /data/SPECS/deptest.spec

runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm
runroot rpm -e deptest-two

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Failed dependencies:
	deptest-foo >= 2.0 is needed by (installed) deptest-one-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmdeps.at:201"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_410
#AT_START_411
at_fn_group_banner 411 'rpmdeps.at:225' \
  "erase to break colored file dependency" "         " 18
at_xfail=no
(
  $as_echo "411. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmdeps.at:227:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \\
	--define \"pkg hello\" \\
	--define \"reqs /usr/bin/hello\" \\
	  /data/SPECS/deptest.spec

runroot rpm -U --ignoreos --ignorearch --nodeps \\
	--define \"_transaction_color 3\" \\
	--define \"_prefer_color 2\" \\
	/data/RPMS/hello-2.0-1.i686.rpm \\
	/data/RPMS/hello-2.0-1.x86_64.rpm \\
	/build/RPMS/noarch/deptest-hello-1.0-1.noarch.rpm

runroot rpm -e hello.x86_64
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:227"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
	--define "pkg hello" \
	--define "reqs /usr/bin/hello" \
	  /data/SPECS/deptest.spec

runroot rpm -U --ignoreos --ignorearch --nodeps \
	--define "_transaction_color 3" \
	--define "_prefer_color 2" \
	/data/RPMS/hello-2.0-1.i686.rpm \
	/data/RPMS/hello-2.0-1.x86_64.rpm \
	/build/RPMS/noarch/deptest-hello-1.0-1.noarch.rpm

runroot rpm -e hello.x86_64

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Failed dependencies:
	/usr/bin/hello is needed by (installed) deptest-hello-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmdeps.at:227"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_411
#AT_START_412
at_fn_group_banner 412 'rpmdeps.at:252' \
  "erase on wrong-colored file dependency" "         " 18
at_xfail=no
(
  $as_echo "412. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmdeps.at:254:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \\
	--define \"pkg hello\" \\
	--define \"reqs /usr/bin/hello\" \\
	  /data/SPECS/deptest.spec

runroot rpm -U --ignoreos --ignorearch --nodeps \\
	--define \"_transaction_color 3\" \\
	--define \"_prefer_color 2\" \\
	/data/RPMS/hello-2.0-1.i686.rpm \\
	/data/RPMS/hello-2.0-1.x86_64.rpm \\
	/build/RPMS/noarch/deptest-hello-1.0-1.noarch.rpm

runroot rpm -e hello.i686
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:254"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
	--define "pkg hello" \
	--define "reqs /usr/bin/hello" \
	  /data/SPECS/deptest.spec

runroot rpm -U --ignoreos --ignorearch --nodeps \
	--define "_transaction_color 3" \
	--define "_prefer_color 2" \
	/data/RPMS/hello-2.0-1.i686.rpm \
	/data/RPMS/hello-2.0-1.x86_64.rpm \
	/build/RPMS/noarch/deptest-hello-1.0-1.noarch.rpm

runroot rpm -e hello.i686

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdeps.at:254"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_412
#AT_START_413
at_fn_group_banner 413 'rpmdeps.at:278' \
  "unsatisfied WITH requires" "                      " 18
at_xfail=no
(
  $as_echo "413. $at_setup_line: testing $at_desc ..."
  $at_traceon





if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpmbuild --quiet -bb \
	--define "pkg one" \
	--define "reqs (deptest-two with flavor = dekstop)" \
	  /data/SPECS/deptest.spec

runroot rpmbuild --quiet -bb \
	--define "pkg two" \
	--define "provs flavor = server" \
	  /data/SPECS/deptest.spec

runroot rpmbuild --quiet -bb \
	--define "pkg three" \
	--define "provs flavor = desktop" \
	  /data/SPECS/deptest.spec

# unsatisfied WITH require in transaction
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:298:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:298"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Failed dependencies:
	(deptest-two with flavor = dekstop) is needed by deptest-one-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 3 $at_status "$at_srcdir/rpmdeps.at:298"
$at_failed && at_fn_log_failure
$at_traceon; }


# unsatisfied WITH require in rpmdb
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:310:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm

runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:310"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm

runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Failed dependencies:
	(deptest-two with flavor = dekstop) is needed by deptest-one-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmdeps.at:310"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_413
#AT_START_414
at_fn_group_banner 414 'rpmdeps.at:324' \
  "satisfied WITH requires" "                        " 18
at_xfail=no
(
  $as_echo "414. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
	--define "pkg one" \
	--define "reqs (deptest-two with flavor = desktop)" \
	  /data/SPECS/deptest.spec

runroot rpmbuild --quiet -bb \
	--define "pkg two" \
	--define "provs flavor = desktop" \
	  /data/SPECS/deptest.spec

# satisfied WITH require in transaction
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:339:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:339"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdeps.at:339"
$at_failed && at_fn_log_failure
$at_traceon; }


# satisfied WITH require in rpmdb
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:348:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \\
	--define \"pkg one\" \\
	--define \"reqs (deptest-two with flavor = desktop)\" \\
	  /data/SPECS/deptest.spec

runroot rpmbuild --quiet -bb \\
	--define \"pkg two\" \\
	--define \"provs flavor = desktop\" \\
	  /data/SPECS/deptest.spec

runroot rpm -U /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm

runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:348"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
	--define "pkg one" \
	--define "reqs (deptest-two with flavor = desktop)" \
	  /data/SPECS/deptest.spec

runroot rpmbuild --quiet -bb \
	--define "pkg two" \
	--define "provs flavor = desktop" \
	  /data/SPECS/deptest.spec

runroot rpm -U /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm

runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdeps.at:348"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_414
#AT_START_415
at_fn_group_banner 415 'rpmdeps.at:372' \
  "unsatisfied WITHOUT requires" "                   " 18
at_xfail=no
(
  $as_echo "415. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
	--define "pkg one" \
	--define "reqs (deptest-two without flavor)" \
	  /data/SPECS/deptest.spec

runroot rpmbuild --quiet -bb \
	--define "pkg two" \
	--define "provs flavor = server" \
	  /data/SPECS/deptest.spec

# unsatisfied WITHOUT require in transaction
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:387:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:387"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Failed dependencies:
	(deptest-two without flavor) is needed by deptest-one-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/rpmdeps.at:387"
$at_failed && at_fn_log_failure
$at_traceon; }


# unsatisfied WITHOUT require in rpmdb
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:399:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm

runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:399"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm

runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Failed dependencies:
	(deptest-two without flavor) is needed by deptest-one-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmdeps.at:399"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_415
#AT_START_416
at_fn_group_banner 416 'rpmdeps.at:413' \
  "satisfied WITHOUT requires" "                     " 18
at_xfail=no
(
  $as_echo "416. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
	--define "pkg one" \
	--define "reqs (deptest-two without flavor)" \
	  /data/SPECS/deptest.spec

runroot rpmbuild --quiet -bb \
	--define "pkg two" \
	  /data/SPECS/deptest.spec

# satisfied WITHOUT require in transaction
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:427:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:427"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdeps.at:427"
$at_failed && at_fn_log_failure
$at_traceon; }


# satisfied WITHOUT require in rpmdb
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:437:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm

runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:437"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm

runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdeps.at:437"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_416
#AT_START_417
at_fn_group_banner 417 'rpmdeps.at:451' \
  "AND requires" "                                   " 18
at_xfail=no
(
  $as_echo "417. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
	--define "pkg one" \
	--define "reqs (deptest-two and deptest-three)" \
	  /data/SPECS/deptest.spec

for pkg in two three; do
    runroot rpmbuild --quiet -bb \
	--define "pkg ${pkg}" \
	  /data/SPECS/deptest.spec
done

{ set +x
$as_echo "$at_srcdir/rpmdeps.at:466:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

# unsatisfied AND require - all missing
runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:466"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

# unsatisfied AND require - all missing
runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Failed dependencies:
	(deptest-two and deptest-three) is needed by deptest-one-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmdeps.at:466"
$at_failed && at_fn_log_failure
$at_traceon; }


# unsatisfied AND require - first is missing
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:478:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:478"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Failed dependencies:
	(deptest-two and deptest-three) is needed by deptest-one-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/rpmdeps.at:478"
$at_failed && at_fn_log_failure
$at_traceon; }


# unsatisfied AND require - second is missing
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:490:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:490"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Failed dependencies:
	(deptest-two and deptest-three) is needed by deptest-one-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/rpmdeps.at:490"
$at_failed && at_fn_log_failure
$at_traceon; }


# satisfied AND require
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:502:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:502"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdeps.at:502"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_417
#AT_START_418
at_fn_group_banner 418 'rpmdeps.at:514' \
  "OR requires" "                                    " 18
at_xfail=no
(
  $as_echo "418. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
	--define "pkg one" \
	--define "reqs (deptest-two or deptest-three)" \
	  /data/SPECS/deptest.spec

for pkg in two three; do
    runroot rpmbuild --quiet -bb \
	--define "pkg ${pkg}" \
	  /data/SPECS/deptest.spec
done

# unsatisfied OR require - all missing
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:530:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:530"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Failed dependencies:
	(deptest-two or deptest-three) is needed by deptest-one-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmdeps.at:530"
$at_failed && at_fn_log_failure
$at_traceon; }


# satisfied OR require - first is missing
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:541:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:541"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdeps.at:541"
$at_failed && at_fn_log_failure
$at_traceon; }


# satisfied OR require - second is missing
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:551:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:551"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdeps.at:551"
$at_failed && at_fn_log_failure
$at_traceon; }


# satisfied OR require - both present
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:561:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:561"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdeps.at:561"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_418
#AT_START_419
at_fn_group_banner 419 'rpmdeps.at:573' \
  "IF requires" "                                    " 18
at_xfail=no
(
  $as_echo "419. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
	--define "pkg one" \
	--define "reqs (deptest-two if deptest-three)" \
	  /data/SPECS/deptest.spec

for pkg in two three; do
    runroot rpmbuild --quiet -bb \
	--define "pkg ${pkg}" \
	  /data/SPECS/deptest.spec
done

# unsatisfied IF require
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:589:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:589"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Failed dependencies:
	(deptest-two if deptest-three) is needed by deptest-one-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/rpmdeps.at:589"
$at_failed && at_fn_log_failure
$at_traceon; }


# satisfied IF require
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:601:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:601"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdeps.at:601"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_419
#AT_START_420
at_fn_group_banner 420 'rpmdeps.at:611' \
  "IF-ELSE requires" "                               " 18
at_xfail=no
(
  $as_echo "420. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
	--define "pkg one" \
	--define "reqs (deptest-two if deptest-three else deptest-four)" \
	  /data/SPECS/deptest.spec

for pkg in two three four; do
    runroot rpmbuild --quiet -bb \
	--define "pkg ${pkg}" \
	  /data/SPECS/deptest.spec
done

# unsatisfied IF-ELSE require
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:627:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:627"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Failed dependencies:
	(deptest-two if deptest-three else deptest-four) is needed by deptest-one-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmdeps.at:627"
$at_failed && at_fn_log_failure
$at_traceon; }


# satisfied IF-ELSE require - right clause
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:639:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-four-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:639"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-four-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdeps.at:639"
$at_failed && at_fn_log_failure
$at_traceon; }


# satisfied IF-ELSE require - left clause
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:649:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:649"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdeps.at:649"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_420
#AT_START_421
at_fn_group_banner 421 'rpmdeps.at:661' \
  "nested AND-OR requires" "                         " 18
at_xfail=no
(
  $as_echo "421. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
	--define "pkg one" \
	--define "reqs (deptest-two and (deptest-three or deptest-four))" \
	  /data/SPECS/deptest.spec

for pkg in two three; do
    runroot rpmbuild --quiet -bb \
	--define "pkg ${pkg}" \
	  /data/SPECS/deptest.spec
done

{ set +x
$as_echo "$at_srcdir/rpmdeps.at:676:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

# unsatisfied nested AND-OR require
runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:676"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

# unsatisfied nested AND-OR require
runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Failed dependencies:
	(deptest-two and (deptest-three or deptest-four)) is needed by deptest-one-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/rpmdeps.at:676"
$at_failed && at_fn_log_failure
$at_traceon; }


# satisfied nested AND-OR require
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:688:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:688"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdeps.at:688"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_421
#AT_START_422
at_fn_group_banner 422 'rpmdeps.at:700' \
  "nested AND-IF requires" "                         " 18
at_xfail=no
(
  $as_echo "422. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
	--define "pkg one" \
	--define "reqs (deptest-two and (deptest-three if deptest-four))" \
	  /data/SPECS/deptest.spec

for pkg in two three four; do
    runroot rpmbuild --quiet -bb \
	--define "pkg ${pkg}" \
	  /data/SPECS/deptest.spec
done

# satisfied nested AND-IF require - without right clause
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:716:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:716"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdeps.at:716"
$at_failed && at_fn_log_failure
$at_traceon; }


# satisfied nested AND-IF require - with right clause
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:726:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-four-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:726"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-four-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmdeps.at:726"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_422
#AT_START_423
at_fn_group_banner 423 'rpmdeps.at:738' \
  "install to break installed rich dependency" "     " 18
at_xfail=no
(
  $as_echo "423. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
	--define "pkg one" \
	--define "cfls (deptest-three or deptest-five)" \
	  /data/SPECS/deptest.spec
runroot rpmbuild --quiet -bb \
	--define "pkg two" \
	--define "reqs (deptest-five if deptest-four)" \
	  /data/SPECS/deptest.spec
runroot rpmbuild --quiet -bb \
	--define "pkg three" \
	  /data/SPECS/deptest.spec
runroot rpmbuild --quiet -bb \
	--define "pkg four" \
	  /data/SPECS/deptest.spec

# installed conflict with "or" clause
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:758:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm
runroot rpm -U /build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:758"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm
runroot rpm -U /build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Failed dependencies:
	(deptest-three or deptest-five) conflicts with (installed) deptest-one-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmdeps.at:758"
$at_failed && at_fn_log_failure
$at_traceon; }


# installed requires with "if" clause
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:771:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm
runroot rpm -U /build/RPMS/noarch/deptest-four-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:771"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm
runroot rpm -U /build/RPMS/noarch/deptest-four-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Failed dependencies:
	(deptest-five if deptest-four) is needed by (installed) deptest-two-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmdeps.at:771"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_423
#AT_START_424
at_fn_group_banner 424 'rpmdeps.at:786' \
  "erase to break installed rich dependency" "       " 18
at_xfail=no
(
  $as_echo "424. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
	--define "pkg one" \
	--define "reqs (deptest-three or deptest-five)" \
	  /data/SPECS/deptest.spec
runroot rpmbuild --quiet -bb \
	--define "pkg two" \
	--define "cfls (deptest-five unless deptest-four)" \
	  /data/SPECS/deptest.spec
runroot rpmbuild --quiet -bb \
	--define "pkg three" \
	  /data/SPECS/deptest.spec
runroot rpmbuild --quiet -bb \
	--define "pkg four" \
	  /data/SPECS/deptest.spec
runroot rpmbuild --quiet -bb \
	--define "pkg five" \
	  /data/SPECS/deptest.spec

# installed requires with "or" clause
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:809:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm
runroot rpm -e deptest-three
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:809"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-one-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-three-1.0-1.noarch.rpm
runroot rpm -e deptest-three

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Failed dependencies:
	(deptest-three or deptest-five) is needed by (installed) deptest-one-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmdeps.at:809"
$at_failed && at_fn_log_failure
$at_traceon; }


# installed conflicts with "unless" clause
{ set +x
$as_echo "$at_srcdir/rpmdeps.at:822:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-four-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-five-1.0-1.noarch.rpm
runroot rpm -e deptest-four
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmdeps.at:822"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U /build/RPMS/noarch/deptest-two-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-four-1.0-1.noarch.rpm /build/RPMS/noarch/deptest-five-1.0-1.noarch.rpm
runroot rpm -e deptest-four

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "error: Failed dependencies:
	(deptest-five unless deptest-four) conflicts with (installed) deptest-two-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmdeps.at:822"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_424
#AT_START_425
at_fn_group_banner 425 'rpmconflict.at:6' \
  "packages with file conflicts" "                   " 19
at_xfail=no
(
  $as_echo "425. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


for p in "one" "two"; do
    runroot rpmbuild --quiet -bb \
        --define "pkg $p" \
	--define "filedata $p" \
          /data/SPECS/conflicttest.spec
done

{ set +x
$as_echo "$at_srcdir/rpmconflict.at:17:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

# (Build and) install conflicting package (should fail)
runroot rpm -U /build/RPMS/noarch/conflictone-1.0-1.noarch.rpm
runroot rpm -U /build/RPMS/noarch/conflicttwo-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconflict.at:17"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

# (Build and) install conflicting package (should fail)
runroot rpm -U /build/RPMS/noarch/conflictone-1.0-1.noarch.rpm
runroot rpm -U /build/RPMS/noarch/conflicttwo-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo stdout:; cat "$at_stdout"
at_fn_check_status 1 $at_status "$at_srcdir/rpmconflict.at:17"
$at_failed && at_fn_log_failure
$at_traceon; }


# Install conflicting packages in same transaction (should fail)
{ set +x
$as_echo "$at_srcdir/rpmconflict.at:28:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U \\
  /build/RPMS/noarch/conflictone-1.0-1.noarch.rpm \\
  /build/RPMS/noarch/conflicttwo-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconflict.at:28"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U \
  /build/RPMS/noarch/conflictone-1.0-1.noarch.rpm \
  /build/RPMS/noarch/conflicttwo-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo stdout:; cat "$at_stdout"
at_fn_check_status 2 $at_status "$at_srcdir/rpmconflict.at:28"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_425
#AT_START_426
at_fn_group_banner 426 'rpmconflict.at:41' \
  "shareable files" "                                " 19
at_xfail=no
(
  $as_echo "426. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


for p in "one" "two"; do
    runroot rpmbuild --quiet -bb \
        --define "pkg $p" \
	--define "filedata same_stuff" \
          /data/SPECS/conflicttest.spec
done

# (Build and) install package with shareable file
{ set +x
$as_echo "$at_srcdir/rpmconflict.at:53:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

runroot rpm -U /build/RPMS/noarch/conflictone-1.0-1.noarch.rpm
runroot rpm -U /build/RPMS/noarch/conflicttwo-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconflict.at:53"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

runroot rpm -U /build/RPMS/noarch/conflictone-1.0-1.noarch.rpm
runroot rpm -U /build/RPMS/noarch/conflicttwo-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo stdout:; cat "$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/rpmconflict.at:53"
$at_failed && at_fn_log_failure
$at_traceon; }


# Install packages with shareable file in same transaction
{ set +x
$as_echo "$at_srcdir/rpmconflict.at:63:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U \\
  /build/RPMS/noarch/conflictone-1.0-1.noarch.rpm \\
  /build/RPMS/noarch/conflicttwo-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconflict.at:63"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U \
  /build/RPMS/noarch/conflictone-1.0-1.noarch.rpm \
  /build/RPMS/noarch/conflicttwo-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo stderr:; cat "$at_stderr"
echo stdout:; cat "$at_stdout"
at_fn_check_status 0 $at_status "$at_srcdir/rpmconflict.at:63"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_426
#AT_START_427
at_fn_group_banner 427 'rpmconflict.at:77' \
  "non-conflicting identical basenames" "            " 19
at_xfail=no
(
  $as_echo "427. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmconflict.at:79:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/selfconflict.spec
rm -rf \"\${RPMTEST}\"/opt/mydir
runroot rpm -U /build/RPMS/noarch/selfconflict-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconflict.at:79"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/selfconflict.spec
rm -rf "${RPMTEST}"/opt/mydir
runroot rpm -U /build/RPMS/noarch/selfconflict-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconflict.at:79"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_427
#AT_START_428
at_fn_group_banner 428 'rpmconflict.at:93' \
  "conflicting identical basenames" "                " 19
at_xfail=no
(
  $as_echo "428. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmconflict.at:95:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/selfconflict.spec
rm -rf \"\${RPMTEST}\"/opt/mydir
mkdir -p \"\${RPMTEST}\"/opt/mydir/one
ln -s one \"\${RPMTEST}\"/opt/mydir/two
runroot rpm -U /build/RPMS/noarch/selfconflict-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconflict.at:95"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/selfconflict.spec
rm -rf "${RPMTEST}"/opt/mydir
mkdir -p "${RPMTEST}"/opt/mydir/one
ln -s one "${RPMTEST}"/opt/mydir/two
runroot rpm -U /build/RPMS/noarch/selfconflict-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "	file /opt/mydir/two/somefile conflicts between attempted installs of selfconflict-1.0-1.noarch and selfconflict-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmconflict.at:95"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_428
#AT_START_429
at_fn_group_banner 429 'rpmconflict.at:111' \
  "multilib elf conflict, prefer 64bit 1" "          " 19
at_xfail=no
(
  $as_echo "429. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmconflict.at:113:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U --ignoreos --ignorearch --nodeps \\
  --define \"_transaction_color 3\" \\
  --define \"_prefer_color 2\" \\
  /data/RPMS/hello-2.0-1.i686.rpm \\
  /data/RPMS/hello-2.0-1.x86_64.rpm
runroot rpm -q --qf \"[%{filestates:fstate},]\\n\" hello.i686 hello.x86_64
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconflict.at:113"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U --ignoreos --ignorearch --nodeps \
  --define "_transaction_color 3" \
  --define "_prefer_color 2" \
  /data/RPMS/hello-2.0-1.i686.rpm \
  /data/RPMS/hello-2.0-1.x86_64.rpm
runroot rpm -q --qf "[%{filestates:fstate},]\n" hello.i686 hello.x86_64

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "wrong color,normal,normal,normal,normal,
normal,normal,normal,normal,normal,
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconflict.at:113"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_429
#AT_START_430
at_fn_group_banner 430 'rpmconflict.at:132' \
  "multilib elf conflict, prefer 64bit 2" "          " 19
at_xfail=no
(
  $as_echo "430. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmconflict.at:134:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U --ignoreos --ignorearch --nodeps \\
  --define \"_transaction_color 3\" \\
  --define \"_prefer_color 2\" \\
  /data/RPMS/hello-2.0-1.i686.rpm
runroot rpm -q --qf \"[%{filestates:fstate},]\\n\" hello.i686
runroot rpm -U --ignoreos --ignorearch --nodeps \\
  --define \"_transaction_color 3\" \\
  --define \"_prefer_color 2\" \\
  /data/RPMS/hello-2.0-1.x86_64.rpm
runroot rpm -q --qf \"[%{filestates:fstate},]\\n\" hello.i686 hello.x86_64
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconflict.at:134"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U --ignoreos --ignorearch --nodeps \
  --define "_transaction_color 3" \
  --define "_prefer_color 2" \
  /data/RPMS/hello-2.0-1.i686.rpm
runroot rpm -q --qf "[%{filestates:fstate},]\n" hello.i686
runroot rpm -U --ignoreos --ignorearch --nodeps \
  --define "_transaction_color 3" \
  --define "_prefer_color 2" \
  /data/RPMS/hello-2.0-1.x86_64.rpm
runroot rpm -q --qf "[%{filestates:fstate},]\n" hello.i686 hello.x86_64

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "normal,normal,normal,normal,normal,
wrong color,normal,normal,normal,normal,
normal,normal,normal,normal,normal,
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconflict.at:134"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_430
#AT_START_431
at_fn_group_banner 431 'rpmconflict.at:158' \
  "multilib elf conflict, prefer 64bit 3" "          " 19
at_xfail=no
(
  $as_echo "431. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmconflict.at:160:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U --ignoreos --ignorearch --nodeps \\
  --define \"_transaction_color 3\" \\
  --define \"_prefer_color 2\" \\
  /data/RPMS/hello-2.0-1.x86_64.rpm
runroot rpm -q --qf \"[%{filestates:fstate},]\\n\" hello.x86_64
runroot rpm -U --ignoreos --ignorearch --nodeps \\
  --define \"_transaction_color 3\" \\
  --define \"_prefer_color 2\" \\
  /data/RPMS/hello-2.0-1.i686.rpm
runroot rpm -q --qf \"[%{filestates:fstate},]\\n\" hello.i686 hello.x86_64
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconflict.at:160"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U --ignoreos --ignorearch --nodeps \
  --define "_transaction_color 3" \
  --define "_prefer_color 2" \
  /data/RPMS/hello-2.0-1.x86_64.rpm
runroot rpm -q --qf "[%{filestates:fstate},]\n" hello.x86_64
runroot rpm -U --ignoreos --ignorearch --nodeps \
  --define "_transaction_color 3" \
  --define "_prefer_color 2" \
  /data/RPMS/hello-2.0-1.i686.rpm
runroot rpm -q --qf "[%{filestates:fstate},]\n" hello.i686 hello.x86_64

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "normal,normal,normal,normal,normal,
wrong color,normal,normal,normal,normal,
normal,normal,normal,normal,normal,
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconflict.at:160"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_431
#AT_START_432
at_fn_group_banner 432 'rpmconflict.at:184' \
  "multilib elf conflict, prefer 32bit 1" "          " 19
at_xfail=no
(
  $as_echo "432. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmconflict.at:186:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U --ignoreos --ignorearch --nodeps \\
  --define \"_transaction_color 3\" \\
  --define \"_prefer_color 1\" \\
  /data/RPMS/hello-2.0-1.i686.rpm \\
  /data/RPMS/hello-2.0-1.x86_64.rpm
runroot rpm -q --qf \"[%{filestates:fstate},]\\n\" hello.i686 hello.x86_64
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconflict.at:186"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U --ignoreos --ignorearch --nodeps \
  --define "_transaction_color 3" \
  --define "_prefer_color 1" \
  /data/RPMS/hello-2.0-1.i686.rpm \
  /data/RPMS/hello-2.0-1.x86_64.rpm
runroot rpm -q --qf "[%{filestates:fstate},]\n" hello.i686 hello.x86_64

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "normal,normal,normal,normal,normal,
wrong color,normal,normal,normal,normal,
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconflict.at:186"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_432
#AT_START_433
at_fn_group_banner 433 'rpmconflict.at:205' \
  "multilib elf conflict, prefer 32bit 2" "          " 19
at_xfail=no
(
  $as_echo "433. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmconflict.at:207:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U --ignoreos --ignorearch --nodeps \\
  --define \"_transaction_color 3\" \\
  --define \"_prefer_color 1\" \\
  /data/RPMS/hello-2.0-1.i686.rpm
runroot rpm -q --qf \"[%{filestates:fstate},]\\n\" hello.i686
runroot rpm -U --ignoreos --ignorearch --nodeps \\
  --define \"_transaction_color 3\" \\
  --define \"_prefer_color 1\" \\
  /data/RPMS/hello-2.0-1.x86_64.rpm
runroot rpm -q --qf \"[%{filestates:fstate},]\\n\" hello.i686 hello.x86_64
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconflict.at:207"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U --ignoreos --ignorearch --nodeps \
  --define "_transaction_color 3" \
  --define "_prefer_color 1" \
  /data/RPMS/hello-2.0-1.i686.rpm
runroot rpm -q --qf "[%{filestates:fstate},]\n" hello.i686
runroot rpm -U --ignoreos --ignorearch --nodeps \
  --define "_transaction_color 3" \
  --define "_prefer_color 1" \
  /data/RPMS/hello-2.0-1.x86_64.rpm
runroot rpm -q --qf "[%{filestates:fstate},]\n" hello.i686 hello.x86_64

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "normal,normal,normal,normal,normal,
normal,normal,normal,normal,normal,
wrong color,normal,normal,normal,normal,
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconflict.at:207"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_433
#AT_START_434
at_fn_group_banner 434 'rpmconflict.at:231' \
  "multilib elf conflict, prefer 32bit 3" "          " 19
at_xfail=no
(
  $as_echo "434. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmconflict.at:233:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpm -U --ignoreos --ignorearch --nodeps \\
  --define \"_transaction_color 3\" \\
  --define \"_prefer_color 1\" \\
  /data/RPMS/hello-2.0-1.x86_64.rpm
runroot rpm -q --qf \"[%{filestates:fstate},]\\n\" hello.x86_64
runroot rpm -U --ignoreos --ignorearch --nodeps \\
  --define \"_transaction_color 3\" \\
  --define \"_prefer_color 1\" \\
  /data/RPMS/hello-2.0-1.i686.rpm
runroot rpm -q --qf \"[%{filestates:fstate},]\\n\" hello.i686 hello.x86_64
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconflict.at:233"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpm -U --ignoreos --ignorearch --nodeps \
  --define "_transaction_color 3" \
  --define "_prefer_color 1" \
  /data/RPMS/hello-2.0-1.x86_64.rpm
runroot rpm -q --qf "[%{filestates:fstate},]\n" hello.x86_64
runroot rpm -U --ignoreos --ignorearch --nodeps \
  --define "_transaction_color 3" \
  --define "_prefer_color 1" \
  /data/RPMS/hello-2.0-1.i686.rpm
runroot rpm -q --qf "[%{filestates:fstate},]\n" hello.i686 hello.x86_64

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "normal,normal,normal,normal,normal,
normal,normal,normal,normal,normal,
wrong color,normal,normal,normal,normal,
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconflict.at:233"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_434
#AT_START_435
at_fn_group_banner 435 'rpmconflict.at:257' \
  "multilib elf vs non-elf file conflict 1" "        " 19
at_xfail=no
(
  $as_echo "435. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmconflict.at:259:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/hello-script.spec

runroot rpm -U --ignoreos --ignorearch --nodeps \\
  --define \"_transaction_color 3\" \\
  --define \"_prefer_color 2\" \\
  /data/RPMS/hello-2.0-1.x86_64.rpm \\
  /build/RPMS/noarch/hello-script-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconflict.at:259"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/hello-script.spec

runroot rpm -U --ignoreos --ignorearch --nodeps \
  --define "_transaction_color 3" \
  --define "_prefer_color 2" \
  /data/RPMS/hello-2.0-1.x86_64.rpm \
  /build/RPMS/noarch/hello-script-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "	file /usr/bin/hello conflicts between attempted installs of hello-2.0-1.x86_64 and hello-script-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/rpmconflict.at:259"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_435
#AT_START_436
at_fn_group_banner 436 'rpmconflict.at:277' \
  "multilib elf vs non-elf file conflict 2" "        " 19
at_xfail=no
(
  $as_echo "436. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmconflict.at:279:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/hello-script.spec

runroot rpm -U --ignoreos --ignorearch --nodeps \\
  --define \"_transaction_color 3\" \\
  --define \"_prefer_color 2\" \\
  /data/RPMS/hello-2.0-1.x86_64.rpm

runroot rpm -U --ignoreos --ignorearch --nodeps \\
  --define \"_transaction_color 3\" \\
  --define \"_prefer_color 2\" \\
  /build/RPMS/noarch/hello-script-1.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconflict.at:279"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/hello-script.spec

runroot rpm -U --ignoreos --ignorearch --nodeps \
  --define "_transaction_color 3" \
  --define "_prefer_color 2" \
  /data/RPMS/hello-2.0-1.x86_64.rpm

runroot rpm -U --ignoreos --ignorearch --nodeps \
  --define "_transaction_color 3" \
  --define "_prefer_color 2" \
  /build/RPMS/noarch/hello-script-1.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "	file /usr/bin/hello from install of hello-script-1.0-1.noarch conflicts with file from package hello-2.0-1.x86_64
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmconflict.at:279"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_436
#AT_START_437
at_fn_group_banner 437 'rpmconflict.at:301' \
  "multilib elf vs non-elf file conflict 3" "        " 19
at_xfail=no
(
  $as_echo "437. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmconflict.at:303:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/hello-script.spec

runroot rpm -U --ignoreos --ignorearch --nodeps \\
  --define \"_transaction_color 3\" \\
  --define \"_prefer_color 2\" \\
  /build/RPMS/noarch/hello-script-1.0-1.noarch.rpm

runroot rpm -U --ignoreos --ignorearch --nodeps \\
  --define \"_transaction_color 3\" \\
  --define \"_prefer_color 2\" \\
  /data/RPMS/hello-2.0-1.x86_64.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconflict.at:303"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb /data/SPECS/hello-script.spec

runroot rpm -U --ignoreos --ignorearch --nodeps \
  --define "_transaction_color 3" \
  --define "_prefer_color 2" \
  /build/RPMS/noarch/hello-script-1.0-1.noarch.rpm

runroot rpm -U --ignoreos --ignorearch --nodeps \
  --define "_transaction_color 3" \
  --define "_prefer_color 2" \
  /data/RPMS/hello-2.0-1.x86_64.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "	file /usr/bin/hello from install of hello-2.0-1.x86_64 conflicts with file from package hello-script-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 1 $at_status "$at_srcdir/rpmconflict.at:303"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_437
#AT_START_438
at_fn_group_banner 438 'rpmconflict.at:326' \
  "replacing directory with symlink" "               " 19
at_xfail=no
(
  $as_echo "438. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmconflict.at:328:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

rm -rf \"\${RPMTEST}\"/usr/{share,lib}/symlinktest*

runroot rpmbuild --quiet -bb \\
    --define \"rel 1\" --without symlink /data/SPECS/symlinktest.spec
runroot rpmbuild --quiet -bb \\
    --define \"rel 2\" --with symlink /data/SPECS/symlinktest.spec

runroot rpm -U /build/RPMS/noarch/symlinktest-1.0-1.noarch.rpm
runroot rpm -U /build/RPMS/noarch/symlinktest-1.0-2.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconflict.at:328"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

rm -rf "${RPMTEST}"/usr/{share,lib}/symlinktest*

runroot rpmbuild --quiet -bb \
    --define "rel 1" --without symlink /data/SPECS/symlinktest.spec
runroot rpmbuild --quiet -bb \
    --define "rel 2" --with symlink /data/SPECS/symlinktest.spec

runroot rpm -U /build/RPMS/noarch/symlinktest-1.0-1.noarch.rpm
runroot rpm -U /build/RPMS/noarch/symlinktest-1.0-2.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "	file /usr/share/symlinktest from install of symlinktest-1.0-2.noarch conflicts with file from package symlinktest-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/rpmconflict.at:328"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_438
#AT_START_439
at_fn_group_banner 439 'rpmconflict.at:348' \
  "replacing symlink with directory" "               " 19
at_xfail=no
(
  $as_echo "439. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmconflict.at:350:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

rm -rf \"\${RPMTEST}\"/usr/{share,lib}/symlinktest*

runroot rpmbuild --quiet -bb \\
    --define \"rel 1\" --with symlink /data/SPECS/symlinktest.spec
runroot rpmbuild --quiet -bb \\
    --define \"rel 2\" --without symlink /data/SPECS/symlinktest.spec

runroot rpm -U /build/RPMS/noarch/symlinktest-1.0-1.noarch.rpm
runroot rpm -U /build/RPMS/noarch/symlinktest-1.0-2.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconflict.at:350"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

rm -rf "${RPMTEST}"/usr/{share,lib}/symlinktest*

runroot rpmbuild --quiet -bb \
    --define "rel 1" --with symlink /data/SPECS/symlinktest.spec
runroot rpmbuild --quiet -bb \
    --define "rel 2" --without symlink /data/SPECS/symlinktest.spec

runroot rpm -U /build/RPMS/noarch/symlinktest-1.0-1.noarch.rpm
runroot rpm -U /build/RPMS/noarch/symlinktest-1.0-2.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "	file /usr/share/symlinktest from install of symlinktest-1.0-2.noarch conflicts with file from package symlinktest-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/rpmconflict.at:350"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_439
#AT_START_440
at_fn_group_banner 440 'rpmconflict.at:371' \
  "real file with shared ghost" "                    " 19
at_xfail=no
(
  $as_echo "440. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmconflict.at:373:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

fn=\"\${RPMTEST}\"/usr/share/my.version

runroot rpmbuild --quiet -bb \\
    --define \"pkg one\" --define \"filedata one\" \\
    /data/SPECS/conflicttest.spec
runroot rpmbuild --quiet -bb \\
    --define \"pkg two\" --define \"filedata two\" --define \"fileattr %ghost\"\\
    /data/SPECS/conflicttest.spec

test ! -f \"\${fn}\" && echo OK
runroot rpm -U \\
    /build/RPMS/noarch/conflictone-1.0-1.noarch.rpm \\
    /build/RPMS/noarch/conflicttwo-1.0-1.noarch.rpm
cat \"\${fn}\"
runroot rpm -e conflicttwo
cat \"\${fn}\"
runroot rpm -e conflictone
test ! -f \"\${fn}\" && echo OK
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconflict.at:373"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

fn="${RPMTEST}"/usr/share/my.version

runroot rpmbuild --quiet -bb \
    --define "pkg one" --define "filedata one" \
    /data/SPECS/conflicttest.spec
runroot rpmbuild --quiet -bb \
    --define "pkg two" --define "filedata two" --define "fileattr %ghost"\
    /data/SPECS/conflicttest.spec

test ! -f "${fn}" && echo OK
runroot rpm -U \
    /build/RPMS/noarch/conflictone-1.0-1.noarch.rpm \
    /build/RPMS/noarch/conflicttwo-1.0-1.noarch.rpm
cat "${fn}"
runroot rpm -e conflicttwo
cat "${fn}"
runroot rpm -e conflictone
test ! -f "${fn}" && echo OK

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "OK
one
one
OK
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconflict.at:373"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_440
#AT_START_441
at_fn_group_banner 441 'rpmreplace.at:4' \
  "upgrade to/from regular file" "                   " 20
at_xfail=no
(
  $as_echo "441. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmreplace.at:6:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

tf=\"\${RPMTEST}\"/opt/foo
rm -rf \"\${tf}\" \"\${tf}\".rpm*

runroot rpmbuild --quiet -bb \\
        --define \"ver 1.0\" \\
	--define \"filetype file\" \\
	--define \"filedata foo\" \\
          /data/SPECS/replacetest.spec

runroot rpmbuild --quiet -bb \\
        --define \"ver 2.0\" \\
	--define \"filetype file\" \\
	--define \"filedata bar\" \\
          /data/SPECS/replacetest.spec

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
cat \"\${tf}\"
runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
cat \"\${tf}\"
runroot rpm -U --oldpackage /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
cat \"\${tf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmreplace.at:6"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

tf="${RPMTEST}"/opt/foo
rm -rf "${tf}" "${tf}".rpm*

runroot rpmbuild --quiet -bb \
        --define "ver 1.0" \
	--define "filetype file" \
	--define "filedata foo" \
          /data/SPECS/replacetest.spec

runroot rpmbuild --quiet -bb \
        --define "ver 2.0" \
	--define "filetype file" \
	--define "filedata bar" \
          /data/SPECS/replacetest.spec

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
cat "${tf}"
runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
cat "${tf}"
runroot rpm -U --oldpackage /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
cat "${tf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
bar
foo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmreplace.at:6"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_441
#AT_START_442
at_fn_group_banner 442 'rpmreplace.at:38' \
  "upgrade regular file to/from link" "              " 20
at_xfail=no
(
  $as_echo "442. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
        --define "ver 1.0" \
	--define "filetype file" \
	--define "filedata foo" \
          /data/SPECS/replacetest.spec

runroot rpmbuild --quiet -bb \
        --define "ver 2.0" \
	--define "filetype link" \
	--define "filedata stuff" \
          /data/SPECS/replacetest.spec

# upgrade regular file to/from broken link
{ set +x
$as_echo "$at_srcdir/rpmreplace.at:55:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

tf=\"\${RPMTEST}\"/opt/foo
rm -rf \"\${RPMTEST}\"/opt/*

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
cat \"\${tf}\"
runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
readlink \"\${tf}\"
runroot rpm -U --oldpackage /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
cat \"\${tf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmreplace.at:55"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

tf="${RPMTEST}"/opt/foo
rm -rf "${RPMTEST}"/opt/*

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
cat "${tf}"
runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
readlink "${tf}"
runroot rpm -U --oldpackage /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
cat "${tf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
stuff
foo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmreplace.at:55"
$at_failed && at_fn_log_failure
$at_traceon; }


{ set +x
$as_echo "$at_srcdir/rpmreplace.at:74:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

tf=\"\${RPMTEST}\"/opt/foo
rm -rf \"\${RPMTEST}\"/opt/*

# upgrade regular file to/from file link
runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
cat \"\${tf}\"
runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
readlink \"\${tf}\"
runroot rpm -U --oldpackage /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
cat \"\${tf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmreplace.at:74"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

tf="${RPMTEST}"/opt/foo
rm -rf "${RPMTEST}"/opt/*

# upgrade regular file to/from file link
runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
cat "${tf}"
runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
readlink "${tf}"
runroot rpm -U --oldpackage /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
cat "${tf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
stuff
foo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmreplace.at:74"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_442
#AT_START_443
at_fn_group_banner 443 'rpmreplace.at:95' \
  "upgrade broken link to broken link" "             " 20
at_xfail=no
(
  $as_echo "443. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmreplace.at:97:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

tf=\"\${RPMTEST}\"/opt/foo
rm -rf \"\${RPMTEST}\"/opt/*

runroot rpmbuild --quiet -bb \\
        --define \"ver 1.0\" \\
	--define \"filetype link\" \\
	--define \"filedata stiff\" \\
          /data/SPECS/replacetest.spec

runroot rpmbuild --quiet -bb \\
        --define \"ver 2.0\" \\
	--define \"filetype link\" \\
	--define \"filedata stuff\" \\
          /data/SPECS/replacetest.spec

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
readlink \"\${tf}\"
runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
readlink \"\${tf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmreplace.at:97"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

tf="${RPMTEST}"/opt/foo
rm -rf "${RPMTEST}"/opt/*

runroot rpmbuild --quiet -bb \
        --define "ver 1.0" \
	--define "filetype link" \
	--define "filedata stiff" \
          /data/SPECS/replacetest.spec

runroot rpmbuild --quiet -bb \
        --define "ver 2.0" \
	--define "filetype link" \
	--define "filedata stuff" \
          /data/SPECS/replacetest.spec

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
readlink "${tf}"
runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
readlink "${tf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "stiff
stuff
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmreplace.at:97"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_443
#AT_START_444
at_fn_group_banner 444 'rpmreplace.at:126' \
  "upgrade file link to file link" "                 " 20
at_xfail=no
(
  $as_echo "444. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmreplace.at:128:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

tf=\"\${RPMTEST}\"/opt/foo
rm -rf \"\${RPMTEST}\"/opt/*

runroot rpmbuild --quiet -bb \\
        --define \"ver 1.0\" \\
	--define \"filetype link\" \\
	--define \"filedata goo\" \\
          /data/SPECS/replacetest.spec

runroot rpmbuild --quiet -bb \\
        --define \"ver 2.0\" \\
	--define \"filetype link\" \\
	--define \"filedata goo\" \\
          /data/SPECS/replacetest.spec

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
readlink \"\${tf}\"
runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
readlink \"\${tf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmreplace.at:128"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

tf="${RPMTEST}"/opt/foo
rm -rf "${RPMTEST}"/opt/*

runroot rpmbuild --quiet -bb \
        --define "ver 1.0" \
	--define "filetype link" \
	--define "filedata goo" \
          /data/SPECS/replacetest.spec

runroot rpmbuild --quiet -bb \
        --define "ver 2.0" \
	--define "filetype link" \
	--define "filedata goo" \
          /data/SPECS/replacetest.spec

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
readlink "${tf}"
runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
readlink "${tf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "goo
goo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmreplace.at:128"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_444
#AT_START_445
at_fn_group_banner 445 'rpmreplace.at:157' \
  "upgrade directory link to directory link" "       " 20
at_xfail=no
(
  $as_echo "445. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmreplace.at:159:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

tf=\"\${RPMTEST}\"/opt/foo
rm -rf \"\${RPMTEST}\"/opt/*

runroot rpmbuild --quiet -bb \\
        --define \"ver 1.0\" \\
	--define \"filetype link\" \\
	--define \"filedata zoo\" \\
          /data/SPECS/replacetest.spec

runroot rpmbuild --quiet -bb \\
        --define \"ver 2.0\" \\
	--define \"filetype link\" \\
	--define \"filedata zoo\" \\
          /data/SPECS/replacetest.spec

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
readlink \"\${tf}\"
runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
readlink \"\${tf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmreplace.at:159"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

tf="${RPMTEST}"/opt/foo
rm -rf "${RPMTEST}"/opt/*

runroot rpmbuild --quiet -bb \
        --define "ver 1.0" \
	--define "filetype link" \
	--define "filedata zoo" \
          /data/SPECS/replacetest.spec

runroot rpmbuild --quiet -bb \
        --define "ver 2.0" \
	--define "filetype link" \
	--define "filedata zoo" \
          /data/SPECS/replacetest.spec

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
readlink "${tf}"
runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
readlink "${tf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "zoo
zoo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmreplace.at:159"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_445
#AT_START_446
at_fn_group_banner 446 'rpmreplace.at:188' \
  "upgrade regular file to directory" "              " 20
at_xfail=no
(
  $as_echo "446. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmreplace.at:190:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

tf=\"\${RPMTEST}\"/opt/foo
rm -rf \"\${RPMTEST}\"/opt/*

runroot rpmbuild --quiet -bb \\
        --define \"ver 1.0\" \\
	--define \"filetype file\" \\
	--define \"filedata foo\" \\
          /data/SPECS/replacetest.spec

runroot rpmbuild --quiet -bb \\
        --define \"ver 2.0\" \\
	--define \"filetype dir\" \\
          /data/SPECS/replacetest.spec

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
cat \"\${tf}\"
runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
test -d \"\${tf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmreplace.at:190"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

tf="${RPMTEST}"/opt/foo
rm -rf "${RPMTEST}"/opt/*

runroot rpmbuild --quiet -bb \
        --define "ver 1.0" \
	--define "filetype file" \
	--define "filedata foo" \
          /data/SPECS/replacetest.spec

runroot rpmbuild --quiet -bb \
        --define "ver 2.0" \
	--define "filetype dir" \
          /data/SPECS/replacetest.spec

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
cat "${tf}"
runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
test -d "${tf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmreplace.at:190"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_446
#AT_START_447
at_fn_group_banner 447 'rpmreplace.at:217' \
  "upgrade broken link to directory" "               " 20
at_xfail=no
(
  $as_echo "447. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmreplace.at:219:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

tf=\"\${RPMTEST}\"/opt/foo
rm -rf \"\${RPMTEST}\"/opt/*

runroot rpmbuild --quiet -bb \\
        --define \"ver 1.0\" \\
	--define \"filetype link\" \\
	--define \"filedata other\" \\
          /data/SPECS/replacetest.spec

runroot rpmbuild --quiet -bb \\
        --define \"ver 2.0\" \\
	--define \"filetype dir\" \\
          /data/SPECS/replacetest.spec

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
readlink \"\${tf}\"
runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
test -d \"\${tf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmreplace.at:219"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

tf="${RPMTEST}"/opt/foo
rm -rf "${RPMTEST}"/opt/*

runroot rpmbuild --quiet -bb \
        --define "ver 1.0" \
	--define "filetype link" \
	--define "filedata other" \
          /data/SPECS/replacetest.spec

runroot rpmbuild --quiet -bb \
        --define "ver 2.0" \
	--define "filetype dir" \
          /data/SPECS/replacetest.spec

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
readlink "${tf}"
runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
test -d "${tf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "other
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmreplace.at:219"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_447
#AT_START_448
at_fn_group_banner 448 'rpmreplace.at:246' \
  "upgrade file link to directory" "                 " 20
at_xfail=no
(
  $as_echo "448. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmreplace.at:248:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

tf=\"\${RPMTEST}\"/opt/foo
rm -rf \"\${RPMTEST}\"/opt/*

runroot rpmbuild --quiet -bb \\
        --define \"ver 1.0\" \\
	--define \"filetype link\" \\
	--define \"filedata goo\" \\
          /data/SPECS/replacetest.spec

runroot rpmbuild --quiet -bb \\
        --define \"ver 2.0\" \\
	--define \"filetype dir\" \\
          /data/SPECS/replacetest.spec

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
readlink \"\${tf}\"
runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
test -d \"\${tf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmreplace.at:248"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

tf="${RPMTEST}"/opt/foo
rm -rf "${RPMTEST}"/opt/*

runroot rpmbuild --quiet -bb \
        --define "ver 1.0" \
	--define "filetype link" \
	--define "filedata goo" \
          /data/SPECS/replacetest.spec

runroot rpmbuild --quiet -bb \
        --define "ver 2.0" \
	--define "filetype dir" \
          /data/SPECS/replacetest.spec

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
readlink "${tf}"
runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
test -d "${tf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "goo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmreplace.at:248"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_448
#AT_START_449
at_fn_group_banner 449 'rpmreplace.at:275' \
  "upgrade directory link to directory" "            " 20
at_xfail=no
(
  $as_echo "449. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmreplace.at:277:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

tf=\"\${RPMTEST}\"/opt/foo
rm -rf \"\${RPMTEST}\"/opt/*

runroot rpmbuild --quiet -bb \\
        --define \"ver 1.0\" \\
	--define \"filetype link\" \\
	--define \"filedata zoo\" \\
          /data/SPECS/replacetest.spec

runroot rpmbuild --quiet -bb \\
        --define \"ver 2.0\" \\
	--define \"filetype dir\" \\
          /data/SPECS/replacetest.spec

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
readlink \"\${tf}\"
runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmreplace.at:277"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

tf="${RPMTEST}"/opt/foo
rm -rf "${RPMTEST}"/opt/*

runroot rpmbuild --quiet -bb \
        --define "ver 1.0" \
	--define "filetype link" \
	--define "filedata zoo" \
          /data/SPECS/replacetest.spec

runroot rpmbuild --quiet -bb \
        --define "ver 2.0" \
	--define "filetype dir" \
          /data/SPECS/replacetest.spec

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
readlink "${tf}"
runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "	file /opt/foo from install of replacetest-2.0-1.noarch conflicts with file from package replacetest-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "zoo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/rpmreplace.at:277"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_449
#AT_START_450
at_fn_group_banner 450 'rpmreplace.at:304' \
  "upgrade empty directory to empty directory" "     " 20
at_xfail=no
(
  $as_echo "450. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmreplace.at:306:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

tf=\"\${RPMTEST}\"/opt/foo
rm -rf \"\${RPMTEST}\"/opt/*

runroot rpmbuild --quiet -bb \\
        --define \"ver 1.0\" \\
	--define \"filetype dir\" \\
          /data/SPECS/replacetest.spec

runroot rpmbuild --quiet -bb \\
        --define \"ver 2.0\" \\
	--define \"filetype dir\" \\
          /data/SPECS/replacetest.spec

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
test -d \"\${tf}\" && runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
test -d \"\${tf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmreplace.at:306"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

tf="${RPMTEST}"/opt/foo
rm -rf "${RPMTEST}"/opt/*

runroot rpmbuild --quiet -bb \
        --define "ver 1.0" \
	--define "filetype dir" \
          /data/SPECS/replacetest.spec

runroot rpmbuild --quiet -bb \
        --define "ver 2.0" \
	--define "filetype dir" \
          /data/SPECS/replacetest.spec

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
test -d "${tf}" && runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
test -d "${tf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmreplace.at:306"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_450
#AT_START_451
at_fn_group_banner 451 'rpmreplace.at:330' \
  "upgrade empty directory to regular file" "        " 20
at_xfail=no
(
  $as_echo "451. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmreplace.at:332:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

tf=\"\${RPMTEST}\"/opt/foo
rm -rf \"\${RPMTEST}\"/opt/*

runroot rpmbuild --quiet -bb \\
        --define \"ver 1.0\" \\
	--define \"filetype dir\" \\
          /data/SPECS/replacetest.spec

runroot rpmbuild --quiet -bb \\
        --define \"ver 2.0\" \\
	--define \"filetype file\" \\
	--define \"filedata woot\" \\
          /data/SPECS/replacetest.spec

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
test -d \"\${tf}\" && runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmreplace.at:332"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

tf="${RPMTEST}"/opt/foo
rm -rf "${RPMTEST}"/opt/*

runroot rpmbuild --quiet -bb \
        --define "ver 1.0" \
	--define "filetype dir" \
          /data/SPECS/replacetest.spec

runroot rpmbuild --quiet -bb \
        --define "ver 2.0" \
	--define "filetype file" \
	--define "filedata woot" \
          /data/SPECS/replacetest.spec

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
test -d "${tf}" && runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "	file /opt/foo from install of replacetest-2.0-1.noarch conflicts with file from package replacetest-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/rpmreplace.at:332"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_451
#AT_START_452
at_fn_group_banner 452 'rpmreplace.at:357' \
  "upgrade locally symlinked directory" "            " 20
at_xfail=no
(
  $as_echo "452. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmreplace.at:359:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

tf=\"\${RPMTEST}\"/opt/foo
rm -rf \"\${RPMTEST}\"/opt/*

runroot rpmbuild --quiet -bb \\
        --define \"ver 1.0\" \\
	--define \"filetype datadir\" \\
	--define \"filedata README1\" \\
	--define \"user \$(id -u -n)\" \\
	--define \"grp \$(id -g -n)\" \\
          /data/SPECS/replacetest.spec

runroot rpmbuild --quiet -bb \\
        --define \"ver 2.0\" \\
	--define \"filetype datadir\" \\
	--define \"filedata README2\" \\
	--define \"user \$(id -u -n)\" \\
	--define \"grp \$(id -g -n)\" \\
          /data/SPECS/replacetest.spec

mkdir -p \"\${RPMTEST}\"/opt/f00f
ln -s f00f \"\${RPMTEST}\"/opt/foo
runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
test -L \"\${tf}\" && test -d \"\${tf}\" && runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
test -L \"\${tf}\" && test -d \"\${tf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmreplace.at:359"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

tf="${RPMTEST}"/opt/foo
rm -rf "${RPMTEST}"/opt/*

runroot rpmbuild --quiet -bb \
        --define "ver 1.0" \
	--define "filetype datadir" \
	--define "filedata README1" \
	--define "user $(id -u -n)" \
	--define "grp $(id -g -n)" \
          /data/SPECS/replacetest.spec

runroot rpmbuild --quiet -bb \
        --define "ver 2.0" \
	--define "filetype datadir" \
	--define "filedata README2" \
	--define "user $(id -u -n)" \
	--define "grp $(id -g -n)" \
          /data/SPECS/replacetest.spec

mkdir -p "${RPMTEST}"/opt/f00f
ln -s f00f "${RPMTEST}"/opt/foo
runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
test -L "${tf}" && test -d "${tf}" && runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
test -L "${tf}" && test -d "${tf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmreplace.at:359"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_452
#AT_START_453
at_fn_group_banner 453 'rpmreplace.at:391' \
  "upgrade invalid locally symlinked directory" "    " 20
at_xfail=no
(
  $as_echo "453. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmreplace.at:393:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

tf=\"\${RPMTEST}\"/opt/foo
rm -rf \"\${RPMTEST}\"/opt/*

runroot rpmbuild --quiet -bb \\
        --define \"ver 1.0\" \\
	--define \"filetype datadir\" \\
	--define \"filedata README1\" \\
          /data/SPECS/replacetest.spec

runroot rpmbuild --quiet -bb \\
        --define \"ver 2.0\" \\
	--define \"filetype datadir\" \\
	--define \"filedata README2\" \\
          /data/SPECS/replacetest.spec

mkdir -p \"\${RPMTEST}\"/opt/f00f
ln -s f00f \"\${RPMTEST}\"/opt/foo
runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
test -L \"\${tf}\" && test -d \"\${tf}\" && runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
test -d \"\${tf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmreplace.at:393"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

tf="${RPMTEST}"/opt/foo
rm -rf "${RPMTEST}"/opt/*

runroot rpmbuild --quiet -bb \
        --define "ver 1.0" \
	--define "filetype datadir" \
	--define "filedata README1" \
          /data/SPECS/replacetest.spec

runroot rpmbuild --quiet -bb \
        --define "ver 2.0" \
	--define "filetype datadir" \
	--define "filedata README2" \
          /data/SPECS/replacetest.spec

mkdir -p "${RPMTEST}"/opt/f00f
ln -s f00f "${RPMTEST}"/opt/foo
runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
test -L "${tf}" && test -d "${tf}" && runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
test -d "${tf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmreplace.at:393"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_453
#AT_START_454
at_fn_group_banner 454 'rpmreplace.at:421' \
  "upgrade empty directory to broken link" "         " 20
at_xfail=no
(
  $as_echo "454. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
        --define "ver 1.0" \
	--define "filetype dir" \
          /data/SPECS/replacetest.spec

runroot rpmbuild --quiet -bb \
        --define "ver 2.0" \
	--define "filetype link" \
	--define "filedata woot" \
          /data/SPECS/replacetest.spec

# upgrade empty directory to broken link
{ set +x
$as_echo "$at_srcdir/rpmreplace.at:437:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

tf=\"\${RPMTEST}\"/opt/foo
rm -rf \"\${RPMTEST}\"/opt/*

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
test -d \"\${tf}\" && runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmreplace.at:437"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

tf="${RPMTEST}"/opt/foo
rm -rf "${RPMTEST}"/opt/*

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
test -d "${tf}" && runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "	file /opt/foo from install of replacetest-2.0-1.noarch conflicts with file from package replacetest-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/rpmreplace.at:437"
$at_failed && at_fn_log_failure
$at_traceon; }


# upgrade empty directory to file link
{ set +x
$as_echo "$at_srcdir/rpmreplace.at:451:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

tf=\"\${RPMTEST}\"/opt/foo
rm -rf \"\${RPMTEST}\"/opt/*

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
test -d \"\${tf}\" && runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmreplace.at:451"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

tf="${RPMTEST}"/opt/foo
rm -rf "${RPMTEST}"/opt/*

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
test -d "${tf}" && runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "	file /opt/foo from install of replacetest-2.0-1.noarch conflicts with file from package replacetest-1.0-1.noarch
" | \
  $at_diff - "$at_stderr" || at_failed=:
at_fn_diff_devnull "$at_stdout" || at_failed=:
at_fn_check_status 2 $at_status "$at_srcdir/rpmreplace.at:451"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_454
#AT_START_455
at_fn_group_banner 455 'rpmreplace.at:465' \
  "upgrade empty directory to file link" "           " 20
at_xfail=no
(
  $as_echo "455. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
        --define "ver 1.0" \
	--define "filetype dir" \
          /data/SPECS/replacetest.spec

runroot rpmbuild --quiet -bb \
        --define "ver 2.0" \
	--define "filetype link" \
	--define "filedata goo" \
          /data/SPECS/replacetest.spec

# upgrade removed empty directory to file link
{ set +x
$as_echo "$at_srcdir/rpmreplace.at:481:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

tf=\"\${RPMTEST}\"/opt/foo
rm -rf \"\${RPMTEST}\"/opt/*

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
test -d \"\${tf}\" && rmdir \"\${tf}\" && runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
readlink \"\${tf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmreplace.at:481"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

tf="${RPMTEST}"/opt/foo
rm -rf "${RPMTEST}"/opt/*

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
test -d "${tf}" && rmdir "${tf}" && runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
readlink "${tf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "goo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmreplace.at:481"
$at_failed && at_fn_log_failure
$at_traceon; }


# upgrade replaced empty directory to file link
{ set +x
$as_echo "$at_srcdir/rpmreplace.at:496:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

tf=\"\${RPMTEST}\"/opt/foo
rm -rf \"\${RPMTEST}\"/opt/*

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
test -d \"\${tf}\" && rmdir \"\${tf}\" && ln -sf goo \"\${tf}\" && runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
readlink \"\${tf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmreplace.at:496"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

tf="${RPMTEST}"/opt/foo
rm -rf "${RPMTEST}"/opt/*

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
test -d "${tf}" && rmdir "${tf}" && ln -sf goo "${tf}" && runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
readlink "${tf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "goo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmreplace.at:496"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_455
#AT_START_456
at_fn_group_banner 456 'rpmreplace.at:511' \
  "upgrade empty directory to file link with pretrans" "" 20
at_xfail=no
(
  $as_echo "456. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmreplace.at:513:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

tf=\"\${RPMTEST}\"/opt/foo
rm -rf \"\${RPMTEST}\"/opt/*

runroot rpmbuild --quiet -bb \\
        --define \"ver 1.0\" \\
	--define \"filetype dir\" \\
          /data/SPECS/replacetest.spec

runroot rpmbuild --quiet -bb \\
        --define \"ver 2.0\" \\
	--define \"filetype link\" \\
	--define \"filedata goo\" \\
	--define \"fixit posix.rmdir('/opt/foo')\" \\
          /data/SPECS/replacetest.spec

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
test -d \"\${tf}\" && runroot rpm -U --test /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm && runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
readlink \"\${tf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmreplace.at:513"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

tf="${RPMTEST}"/opt/foo
rm -rf "${RPMTEST}"/opt/*

runroot rpmbuild --quiet -bb \
        --define "ver 1.0" \
	--define "filetype dir" \
          /data/SPECS/replacetest.spec

runroot rpmbuild --quiet -bb \
        --define "ver 2.0" \
	--define "filetype link" \
	--define "filedata goo" \
	--define "fixit posix.rmdir('/opt/foo')" \
          /data/SPECS/replacetest.spec

runroot rpm -U /build/RPMS/noarch/replacetest-1.0-1.noarch.rpm
test -d "${tf}" && runroot rpm -U --test /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm && runroot rpm -U /build/RPMS/noarch/replacetest-2.0-1.noarch.rpm
readlink "${tf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "goo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmreplace.at:513"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_456
#AT_START_457
at_fn_group_banner 457 'rpmconfig.at:5' \
  "config file install/upgrade/erase" "              " 21
at_xfail=no
(
  $as_echo "457. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

for v in "1.0" "2.0"; do
    runroot rpmbuild --quiet -bb \
        --define "ver $v" \
	--define "filedata foo" \
          /data/SPECS/configtest.spec
done

# Install over existing config file
{ set +x
$as_echo "$at_srcdir/rpmconfig.at:16:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

echo \"otherstuff\" > \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat \"\${cf}\"
runroot rpm -e configtest
cat \"\${cf}.rpmorig\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig.at:16"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

echo "otherstuff" > "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat "${cf}"
runroot rpm -e configtest
cat "${cf}.rpmorig"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "warning: /etc/my.conf saved as /etc/my.conf.rpmorig
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
otherstuff
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig.at:16"
$at_failed && at_fn_log_failure
$at_traceon; }


# Install over existing identical config file, no backup needed
{ set +x
$as_echo "$at_srcdir/rpmconfig.at:35:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

echo \"foo\" > \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat \"\${cf}\"
runroot rpm -e configtest
test ! -f \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig.at:35"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

echo "foo" > "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat "${cf}"
runroot rpm -e configtest
test ! -f "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig.at:35"
$at_failed && at_fn_log_failure
$at_traceon; }


# Erase unmodified config file, no backup here
{ set +x
$as_echo "$at_srcdir/rpmconfig.at:52:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat \"\${cf}\"
runroot rpm -e configtest
test ! -f \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig.at:52"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat "${cf}"
runroot rpm -e configtest
test ! -f "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig.at:52"
$at_failed && at_fn_log_failure
$at_traceon; }


# Erase modified config file
{ set +x
$as_echo "$at_srcdir/rpmconfig.at:68:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat \"\${cf}\"
echo \"otherstuff\" > \"\${cf}\"
runroot rpm -e configtest
cat \"\${cf}.rpmsave\"
test ! -f \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig.at:68"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat "${cf}"
echo "otherstuff" > "${cf}"
runroot rpm -e configtest
cat "${cf}.rpmsave"
test ! -f "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "warning: /etc/my.conf saved as /etc/my.conf.rpmsave
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
otherstuff
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig.at:68"
$at_failed && at_fn_log_failure
$at_traceon; }


# Upgrade package with config file, no backup here
{ set +x
$as_echo "$at_srcdir/rpmconfig.at:88:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
cat \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig.at:88"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
cat "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
foo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig.at:88"
$at_failed && at_fn_log_failure
$at_traceon; }


# Upgrade package with config file, no backup here
{ set +x
$as_echo "$at_srcdir/rpmconfig.at:105:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
runroot rpm -Uvv --fsmdebug /build/RPMS/noarch/configtest-2.0-1.noarch.rpm > output.txt 2>&1
grep -c  \"touch\" output.txt
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig.at:105"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
runroot rpm -Uvv --fsmdebug /build/RPMS/noarch/configtest-2.0-1.noarch.rpm > output.txt 2>&1
grep -c  "touch" output.txt

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig.at:105"
$at_failed && at_fn_log_failure
$at_traceon; }


# Upgrade package with locally modified config file, unchanged in pkg
{ set +x
$as_echo "$at_srcdir/rpmconfig.at:120:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat \"\${cf}\"
echo \"otherstuff\" > \"\${cf}\"
cat \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
cat \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig.at:120"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat "${cf}"
echo "otherstuff" > "${cf}"
cat "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
cat "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
otherstuff
otherstuff
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig.at:120"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_457
#AT_START_458
at_fn_group_banner 458 'rpmconfig.at:141' \
  "config(noreplace) file install/upgrade/erase" "   " 21
at_xfail=no
(
  $as_echo "458. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
        --define "ver 1.0" \
	--define "filedata foo" \
	--define "noreplace 1" \
          /data/SPECS/configtest.spec

# Install over existing config file
{ set +x
$as_echo "$at_srcdir/rpmconfig.at:152:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*
echo \"otherstuff\" > \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat \"\${cf}\"
cat \"\${cf}.rpmnew\"
runroot rpm -e configtest
cat \"\${cf}.rpmsave\"
cat \"\${cf}.rpmnew\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig.at:152"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*
echo "otherstuff" > "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat "${cf}"
cat "${cf}.rpmnew"
runroot rpm -e configtest
cat "${cf}.rpmsave"
cat "${cf}.rpmnew"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "warning: /etc/my.conf created as /etc/my.conf.rpmnew
warning: /etc/my.conf saved as /etc/my.conf.rpmsave
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "otherstuff
foo
otherstuff
foo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig.at:152"
$at_failed && at_fn_log_failure
$at_traceon; }


# Erase modified config(noreplace) file
{ set +x
$as_echo "$at_srcdir/rpmconfig.at:175:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat \"\${cf}\"
echo \"otherstuff\" > \"\${cf}\"
runroot rpm -e configtest
cat \"\${cf}.rpmsave\"
test ! -f \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig.at:175"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat "${cf}"
echo "otherstuff" > "${cf}"
runroot rpm -e configtest
cat "${cf}.rpmsave"
test ! -f "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "warning: /etc/my.conf saved as /etc/my.conf.rpmsave
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
otherstuff
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig.at:175"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_458
#AT_START_459
at_fn_group_banner 459 'rpmconfig.at:196' \
  "upgrade changing config" "                        " 21
at_xfail=no
(
  $as_echo "459. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


for v in "1.0" "2.0"; do
    runroot rpmbuild --quiet -bb \
        --define "ver $v" \
	--define "filedata foo-$v" \
          /data/SPECS/configtest.spec
done

# Upgrade package with unmodified config file, changed in pkg
{ set +x
$as_echo "$at_srcdir/rpmconfig.at:208:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
cat \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig.at:208"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
cat "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo-1.0
foo-2.0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig.at:208"
$at_failed && at_fn_log_failure
$at_traceon; }


# ------------------------------
# Upgrade package with locally modified config file, changed in pkg

{ set +x
$as_echo "$at_srcdir/rpmconfig.at:227:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat \"\${cf}\"
echo \"otherstuff\" > \"\${RPMTEST}\"/etc/my.conf
cat \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
cat \"\${cf}\"
cat \"\${cf}.rpmsave\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig.at:227"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat "${cf}"
echo "otherstuff" > "${RPMTEST}"/etc/my.conf
cat "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
cat "${cf}"
cat "${cf}.rpmsave"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "warning: /etc/my.conf saved as /etc/my.conf.rpmsave
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo-1.0
otherstuff
foo-2.0
otherstuff
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig.at:227"
$at_failed && at_fn_log_failure
$at_traceon; }


# ------------------------------
# Modified config file matches the content from new package.
{ set +x
$as_echo "$at_srcdir/rpmconfig.at:251:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat \"\${cf}\"
echo \"foo-2.0\" > \"\${RPMTEST}\"/etc/my.conf
cat \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
cat \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig.at:251"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat "${cf}"
echo "foo-2.0" > "${RPMTEST}"/etc/my.conf
cat "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
cat "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo-1.0
foo-2.0
foo-2.0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig.at:251"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_459
#AT_START_460
at_fn_group_banner 460 'rpmconfig.at:273' \
  "upgrade changing config(noreplace)" "             " 21
at_xfail=no
(
  $as_echo "460. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


for v in "1.0" "2.0"; do
    runroot rpmbuild --quiet -bb \
        --define "ver $v" \
	--define "filedata foo" \
	--define "noreplace 1" \
          /data/SPECS/configtest.spec
done
#
# Upgrade package with config file, no backup here
{ set +x
$as_echo "$at_srcdir/rpmconfig.at:286:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
cat \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig.at:286"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
cat "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
foo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig.at:286"
$at_failed && at_fn_log_failure
$at_traceon; }


# Upgrade package with locally modified config file, unchanged in pkg
{ set +x
$as_echo "$at_srcdir/rpmconfig.at:303:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat \"\${cf}\"
echo \"otherstuff\" > \"\${cf}\"
cat \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
cat \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig.at:303"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat "${cf}"
echo "otherstuff" > "${cf}"
cat "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
cat "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
otherstuff
otherstuff
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig.at:303"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_460
#AT_START_461
at_fn_group_banner 461 'rpmconfig.at:325' \
  "upgrade changing config(noreplace)" "             " 21
at_xfail=no
(
  $as_echo "461. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

for v in "1.0" "2.0"; do
    runroot rpmbuild --quiet -bb \
        --define "ver $v" \
	--define "filedata foo-$v" \
	--define "noreplace 1" \
          /data/SPECS/configtest.spec
done

# Upgrade package with unmodified config file, changed in pkg
{ set +x
$as_echo "$at_srcdir/rpmconfig.at:337:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
cat \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig.at:337"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
cat "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo-1.0
foo-2.0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig.at:337"
$at_failed && at_fn_log_failure
$at_traceon; }


# Upgrade package with locally modified config file, changed in pkg
{ set +x
$as_echo "$at_srcdir/rpmconfig.at:354:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat \"\${cf}\"
echo \"otherstuff\" > \"\${RPMTEST}\"/etc/my.conf
cat \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
cat \"\${cf}\"
cat \"\${cf}.rpmnew\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig.at:354"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat "${cf}"
echo "otherstuff" > "${RPMTEST}"/etc/my.conf
cat "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
cat "${cf}"
cat "${cf}.rpmnew"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "warning: /etc/my.conf created as /etc/my.conf.rpmnew
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo-1.0
otherstuff
otherstuff
foo-2.0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig.at:354"
$at_failed && at_fn_log_failure
$at_traceon; }


# Modified config file matches the content from new package.
{ set +x
$as_echo "$at_srcdir/rpmconfig.at:377:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat \"\${cf}\"
echo \"foo-2.0\" > \"\${RPMTEST}\"/etc/my.conf
cat \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
cat \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig.at:377"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat "${cf}"
echo "foo-2.0" > "${RPMTEST}"/etc/my.conf
cat "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
cat "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo-1.0
foo-2.0
foo-2.0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig.at:377"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_461
#AT_START_462
at_fn_group_banner 462 'rpmconfig.at:399' \
  "upgrade shared config" "                          " 21
at_xfail=no
(
  $as_echo "462. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

for s in "A" "B"; do
    for v in "1.0" "2.0"; do
        runroot rpmbuild --quiet -bb \
            --define "sub $s" \
            --define "ver $v" \
	    --define "filedata foo" \
              /data/SPECS/configtest.spec
    done
done

# Upgrade package with config file, no backup here
{ set +x
$as_echo "$at_srcdir/rpmconfig.at:413:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U \\
    /build/RPMS/noarch/configtest-A-1.0-1.noarch.rpm \\
    /build/RPMS/noarch/configtest-B-1.0-1.noarch.rpm
cat \"\${cf}\"
runroot rpm -U \\
    /build/RPMS/noarch/configtest-A-2.0-1.noarch.rpm \\
    /build/RPMS/noarch/configtest-B-2.0-1.noarch.rpm
cat \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig.at:413"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U \
    /build/RPMS/noarch/configtest-A-1.0-1.noarch.rpm \
    /build/RPMS/noarch/configtest-B-1.0-1.noarch.rpm
cat "${cf}"
runroot rpm -U \
    /build/RPMS/noarch/configtest-A-2.0-1.noarch.rpm \
    /build/RPMS/noarch/configtest-B-2.0-1.noarch.rpm
cat "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
foo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig.at:413"
$at_failed && at_fn_log_failure
$at_traceon; }


# Upgrade package with locally modified config file, unchanged in pkg
{ set +x
$as_echo "$at_srcdir/rpmconfig.at:434:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U \\
    /build/RPMS/noarch/configtest-A-1.0-1.noarch.rpm \\
    /build/RPMS/noarch/configtest-B-1.0-1.noarch.rpm
cat \"\${cf}\"
echo \"otherstuff\" > \"\${cf}\"
cat \"\${cf}\"
runroot rpm -U \\
    /build/RPMS/noarch/configtest-A-2.0-1.noarch.rpm \\
    /build/RPMS/noarch/configtest-B-2.0-1.noarch.rpm
cat \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig.at:434"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U \
    /build/RPMS/noarch/configtest-A-1.0-1.noarch.rpm \
    /build/RPMS/noarch/configtest-B-1.0-1.noarch.rpm
cat "${cf}"
echo "otherstuff" > "${cf}"
cat "${cf}"
runroot rpm -U \
    /build/RPMS/noarch/configtest-A-2.0-1.noarch.rpm \
    /build/RPMS/noarch/configtest-B-2.0-1.noarch.rpm
cat "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
otherstuff
otherstuff
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig.at:434"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_462
#AT_START_463
at_fn_group_banner 463 'rpmconfig.at:459' \
  "upgrade changing shared config" "                 " 21
at_xfail=no
(
  $as_echo "463. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

for s in "A" "B"; do
    for v in "1.0" "2.0"; do
        runroot rpmbuild --quiet -bb \
            --define "sub $s" \
            --define "ver $v" \
	    --define "filedata foo-$v" \
              /data/SPECS/configtest.spec
    done
done

# Upgrade package with unmodified config file, changed in pkg
{ set +x
$as_echo "$at_srcdir/rpmconfig.at:473:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U \\
    /build/RPMS/noarch/configtest-A-1.0-1.noarch.rpm \\
    /build/RPMS/noarch/configtest-B-1.0-1.noarch.rpm
cat \"\${cf}\"
runroot rpm -U \\
    /build/RPMS/noarch/configtest-A-2.0-1.noarch.rpm \\
    /build/RPMS/noarch/configtest-B-2.0-1.noarch.rpm
cat \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig.at:473"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U \
    /build/RPMS/noarch/configtest-A-1.0-1.noarch.rpm \
    /build/RPMS/noarch/configtest-B-1.0-1.noarch.rpm
cat "${cf}"
runroot rpm -U \
    /build/RPMS/noarch/configtest-A-2.0-1.noarch.rpm \
    /build/RPMS/noarch/configtest-B-2.0-1.noarch.rpm
cat "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo-1.0
foo-2.0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig.at:473"
$at_failed && at_fn_log_failure
$at_traceon; }


# Upgrade package with locally modified config file, changed in pkg
{ set +x
$as_echo "$at_srcdir/rpmconfig.at:494:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U \\
    /build/RPMS/noarch/configtest-A-1.0-1.noarch.rpm \\
    /build/RPMS/noarch/configtest-B-1.0-1.noarch.rpm
cat \"\${cf}\"
echo \"otherstuff\" > \"\${RPMTEST}\"/etc/my.conf
cat \"\${cf}\"
runroot rpm -U \\
    /build/RPMS/noarch/configtest-A-2.0-1.noarch.rpm \\
    /build/RPMS/noarch/configtest-B-2.0-1.noarch.rpm
cat \"\${cf}\"
cat \"\${cf}.rpmsave\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig.at:494"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U \
    /build/RPMS/noarch/configtest-A-1.0-1.noarch.rpm \
    /build/RPMS/noarch/configtest-B-1.0-1.noarch.rpm
cat "${cf}"
echo "otherstuff" > "${RPMTEST}"/etc/my.conf
cat "${cf}"
runroot rpm -U \
    /build/RPMS/noarch/configtest-A-2.0-1.noarch.rpm \
    /build/RPMS/noarch/configtest-B-2.0-1.noarch.rpm
cat "${cf}"
cat "${cf}.rpmsave"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "warning: /etc/my.conf saved as /etc/my.conf.rpmsave
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo-1.0
otherstuff
foo-2.0
otherstuff
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig.at:494"
$at_failed && at_fn_log_failure
$at_traceon; }


# Modified config file matches the content from new package.
{ set +x
$as_echo "$at_srcdir/rpmconfig.at:521:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U \\
    /build/RPMS/noarch/configtest-A-1.0-1.noarch.rpm \\
    /build/RPMS/noarch/configtest-B-1.0-1.noarch.rpm
cat \"\${cf}\"
echo \"foo-2.0\" > \"\${RPMTEST}\"/etc/my.conf
cat \"\${cf}\"
runroot rpm -U \\
    /build/RPMS/noarch/configtest-A-2.0-1.noarch.rpm \\
    /build/RPMS/noarch/configtest-B-2.0-1.noarch.rpm
cat \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig.at:521"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U \
    /build/RPMS/noarch/configtest-A-1.0-1.noarch.rpm \
    /build/RPMS/noarch/configtest-B-1.0-1.noarch.rpm
cat "${cf}"
echo "foo-2.0" > "${RPMTEST}"/etc/my.conf
cat "${cf}"
runroot rpm -U \
    /build/RPMS/noarch/configtest-A-2.0-1.noarch.rpm \
    /build/RPMS/noarch/configtest-B-2.0-1.noarch.rpm
cat "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo-1.0
foo-2.0
foo-2.0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig.at:521"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_463
#AT_START_464
at_fn_group_banner 464 'rpmconfig.at:548' \
  "upgrade shared config(noreplace)" "               " 21
at_xfail=no
(
  $as_echo "464. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


for s in "A" "B"; do
    for v in "1.0" "2.0"; do
        runroot rpmbuild --quiet -bb \
            --define "sub $s" \
            --define "ver $v" \
	    --define "filedata foo-$v" \
	    --define "noreplace 1" \
              /data/SPECS/configtest.spec
    done
done

{ set +x
$as_echo "$at_srcdir/rpmconfig.at:563:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U \\
    /build/RPMS/noarch/configtest-A-1.0-1.noarch.rpm \\
    /build/RPMS/noarch/configtest-B-1.0-1.noarch.rpm
cat \"\${cf}\"
echo \"otherstuff\" > \"\${RPMTEST}\"/etc/my.conf
cat \"\${cf}\"
runroot rpm -U \\
    /build/RPMS/noarch/configtest-A-2.0-1.noarch.rpm \\
    /build/RPMS/noarch/configtest-B-2.0-1.noarch.rpm
cat \"\${cf}\"
cat \"\${cf}.rpmnew\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig.at:563"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U \
    /build/RPMS/noarch/configtest-A-1.0-1.noarch.rpm \
    /build/RPMS/noarch/configtest-B-1.0-1.noarch.rpm
cat "${cf}"
echo "otherstuff" > "${RPMTEST}"/etc/my.conf
cat "${cf}"
runroot rpm -U \
    /build/RPMS/noarch/configtest-A-2.0-1.noarch.rpm \
    /build/RPMS/noarch/configtest-B-2.0-1.noarch.rpm
cat "${cf}"
cat "${cf}.rpmnew"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "warning: /etc/my.conf created as /etc/my.conf.rpmnew
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo-1.0
otherstuff
otherstuff
foo-2.0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig.at:563"
$at_failed && at_fn_log_failure
$at_traceon; }


# ------------------------------
# Modified config file matches the content from new package.
{ set +x
$as_echo "$at_srcdir/rpmconfig.at:591:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U \\
    /build/RPMS/noarch/configtest-A-1.0-1.noarch.rpm \\
    /build/RPMS/noarch/configtest-B-1.0-1.noarch.rpm
cat \"\${cf}\"
echo \"foo-2.0\" > \"\${RPMTEST}\"/etc/my.conf
cat \"\${cf}\"
runroot rpm -U \\
    /build/RPMS/noarch/configtest-A-2.0-1.noarch.rpm \\
    /build/RPMS/noarch/configtest-B-2.0-1.noarch.rpm
cat \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig.at:591"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U \
    /build/RPMS/noarch/configtest-A-1.0-1.noarch.rpm \
    /build/RPMS/noarch/configtest-B-1.0-1.noarch.rpm
cat "${cf}"
echo "foo-2.0" > "${RPMTEST}"/etc/my.conf
cat "${cf}"
runroot rpm -U \
    /build/RPMS/noarch/configtest-A-2.0-1.noarch.rpm \
    /build/RPMS/noarch/configtest-B-2.0-1.noarch.rpm
cat "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo-1.0
foo-2.0
foo-2.0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig.at:591"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_464
#AT_START_465
at_fn_group_banner 465 'rpmconfig.at:617' \
  "ghost config" "                                   " 21
at_xfail=no
(
  $as_echo "465. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmconfig.at:619:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

for v in 1.0 2.0; do
    runroot rpmbuild --quiet -bb \\
        --define \"ver \${v}\" \\
        --define \"filetype file\" \\
        --define \"filedata buster\" \\
        --define \"fileattr %ghost\" \\
          /data/SPECS/configtest.spec
done

# pre-existing config, install, erase
test ! -f \"\${cf}\" && echo OK1
echo \"keaton\" > \"\${cf}\"
cat \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat \"\${cf}\"
runroot rpm -e configtest
cat \"\${cf}\"
rm -f \"\${cf}\"

# post-install config, upgrade, erase
runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
test ! -f \"\${cf}\" && echo OK2
echo \"buster\" > \"\${cf}\"
cat \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
cat \"\${cf}\"
runroot rpm -e configtest
cat \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig.at:619"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

for v in 1.0 2.0; do
    runroot rpmbuild --quiet -bb \
        --define "ver ${v}" \
        --define "filetype file" \
        --define "filedata buster" \
        --define "fileattr %ghost" \
          /data/SPECS/configtest.spec
done

# pre-existing config, install, erase
test ! -f "${cf}" && echo OK1
echo "keaton" > "${cf}"
cat "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat "${cf}"
runroot rpm -e configtest
cat "${cf}"
rm -f "${cf}"

# post-install config, upgrade, erase
runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
test ! -f "${cf}" && echo OK2
echo "buster" > "${cf}"
cat "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
cat "${cf}"
runroot rpm -e configtest
cat "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "OK1
keaton
keaton
keaton
OK2
buster
buster
buster
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig.at:619"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_465
#AT_START_466
at_fn_group_banner 466 'rpmconfig2.at:5' \
  "config symlinks" "                                " 22
at_xfail=no
(
  $as_echo "466. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


for v in "1.0" "2.0"; do
    runroot rpmbuild --quiet -bb \
        --define "ver $v" \
	--define "filedata foo" \
	--define "filetype link" \
          /data/SPECS/configtest.spec
done

# Install over existing config file
{ set +x
$as_echo "$at_srcdir/rpmconfig2.at:18:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

ln -s \"otherstuff\" \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
readlink \"\${cf}\"
runroot rpm -e configtest
readlink \"\${cf}.rpmorig\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig2.at:18"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

ln -s "otherstuff" "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
readlink "${cf}"
runroot rpm -e configtest
readlink "${cf}.rpmorig"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "warning: /etc/my.conf saved as /etc/my.conf.rpmorig
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
otherstuff
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig2.at:18"
$at_failed && at_fn_log_failure
$at_traceon; }


# Install over existing identical config link, no backup needed
{ set +x
$as_echo "$at_srcdir/rpmconfig2.at:37:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

ln -s \"foo\" \"\${cf}\"
readlink \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
readlink \"\${cf}\"
runroot rpm -e configtest
test ! -L \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig2.at:37"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

ln -s "foo" "${cf}"
readlink "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
readlink "${cf}"
runroot rpm -e configtest
test ! -L "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
foo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig2.at:37"
$at_failed && at_fn_log_failure
$at_traceon; }


# Erase unmodified config link, no backup here
{ set +x
$as_echo "$at_srcdir/rpmconfig2.at:56:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
readlink \"\${cf}\"
runroot rpm -e configtest
test ! -L \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig2.at:56"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
readlink "${cf}"
runroot rpm -e configtest
test ! -L "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig2.at:56"
$at_failed && at_fn_log_failure
$at_traceon; }


# Erase modified config link
{ set +x
$as_echo "$at_srcdir/rpmconfig2.at:72:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
readlink \"\${cf}\"
ln -sf \"otherstuff\" \"\${cf}\"
runroot rpm -e configtest
readlink \"\${cf}.rpmsave\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig2.at:72"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
readlink "${cf}"
ln -sf "otherstuff" "${cf}"
runroot rpm -e configtest
readlink "${cf}.rpmsave"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "warning: /etc/my.conf saved as /etc/my.conf.rpmsave
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
otherstuff
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig2.at:72"
$at_failed && at_fn_log_failure
$at_traceon; }


# Upgrade package with config link, no backup here
{ set +x
$as_echo "$at_srcdir/rpmconfig2.at:91:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
readlink \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
readlink \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig2.at:91"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
readlink "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
readlink "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
foo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig2.at:91"
$at_failed && at_fn_log_failure
$at_traceon; }


#
# Upgrade package with config link, no backup here
{ set +x
$as_echo "$at_srcdir/rpmconfig2.at:109:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
runroot rpm -Uvv --fsmdebug /build/RPMS/noarch/configtest-2.0-1.noarch.rpm > output.txt 2>&1
grep -c  \"touch\" output.txt
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig2.at:109"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
runroot rpm -Uvv --fsmdebug /build/RPMS/noarch/configtest-2.0-1.noarch.rpm > output.txt 2>&1
grep -c  "touch" output.txt

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "1
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig2.at:109"
$at_failed && at_fn_log_failure
$at_traceon; }


# Upgrade package with modified config link, unchanged in pkg. No backup.
{ set +x
$as_echo "$at_srcdir/rpmconfig2.at:124:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
readlink \"\${cf}\"
ln -sf \"otherstuff\" \"\${cf}\"
readlink \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
readlink \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig2.at:124"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
readlink "${cf}"
ln -sf "otherstuff" "${cf}"
readlink "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
readlink "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
otherstuff
otherstuff
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig2.at:124"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_466
#AT_START_467
at_fn_group_banner 467 'rpmconfig2.at:145' \
  "changing config symlinks" "                       " 22
at_xfail=no
(
  $as_echo "467. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

for v in "1.0" "2.0"; do
    runroot rpmbuild --quiet -bb \
        --define "ver $v" \
	--define "filedata foo-$v" \
	--define "filetype link" \
          /data/SPECS/configtest.spec
done

# Upgrade package with unmodified config link, changed in pkg
{ set +x
$as_echo "$at_srcdir/rpmconfig2.at:157:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
readlink \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
readlink \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig2.at:157"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
readlink "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
readlink "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo-1.0
foo-2.0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig2.at:157"
$at_failed && at_fn_log_failure
$at_traceon; }


# Upgrade package with locally modified config link, changed in pkg
{ set +x
$as_echo "$at_srcdir/rpmconfig2.at:174:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
readlink \"\${cf}\"
ln -sf \"otherstuff\" \"\${cf}\"
readlink \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
readlink \"\${cf}\"
readlink \"\${cf}.rpmsave\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig2.at:174"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
readlink "${cf}"
ln -sf "otherstuff" "${cf}"
readlink "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
readlink "${cf}"
readlink "${cf}.rpmsave"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "warning: /etc/my.conf saved as /etc/my.conf.rpmsave
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo-1.0
otherstuff
foo-2.0
otherstuff
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig2.at:174"
$at_failed && at_fn_log_failure
$at_traceon; }


# Modified config link matches the content from new package.
{ set +x
$as_echo "$at_srcdir/rpmconfig2.at:197:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
readlink \"\${cf}\"
ln -sf \"foo-2.0\" \"\${cf}\"
readlink \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
readlink \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig2.at:197"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
readlink "${cf}"
ln -sf "foo-2.0" "${cf}"
readlink "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
readlink "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo-1.0
foo-2.0
foo-2.0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig2.at:197"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_467
#AT_START_468
at_fn_group_banner 468 'rpmconfig2.at:220' \
  "upgrade unchanged config(noreplace) links" "      " 22
at_xfail=no
(
  $as_echo "468. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

for v in "1.0" "2.0"; do
    runroot rpmbuild --quiet -bb \
        --define "ver $v" \
	--define "filedata foo" \
	--define "filetype link" \
	--define "noreplace 1" \
          /data/SPECS/configtest.spec
done

# Upgrade package with config file, no backup here
{ set +x
$as_echo "$at_srcdir/rpmconfig2.at:233:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
readlink \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
readlink \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig2.at:233"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
readlink "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
readlink "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
foo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig2.at:233"
$at_failed && at_fn_log_failure
$at_traceon; }


# Upgrade package with locally modified config file, unchanged in pkg
{ set +x
$as_echo "$at_srcdir/rpmconfig2.at:250:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
readlink \"\${cf}\"
ln -sf \"otherstuff\" \"\${cf}\"
readlink \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
readlink \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig2.at:250"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
readlink "${cf}"
ln -sf "otherstuff" "${cf}"
readlink "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
readlink "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
otherstuff
otherstuff
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig2.at:250"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_468
#AT_START_469
at_fn_group_banner 469 'rpmconfig2.at:271' \
  "upgrade changing config(noreplace) links" "       " 22
at_xfail=no
(
  $as_echo "469. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


for v in "1.0" "2.0"; do
    runroot rpmbuild --quiet -bb \
        --define "ver $v" \
	--define "filedata foo-$v" \
	--define "filetype link" \
	--define "noreplace 1" \
          /data/SPECS/configtest.spec
done

{ set +x
$as_echo "$at_srcdir/rpmconfig2.at:284:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

# Upgrade package with unmodified config file, changed in pkg
runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
readlink \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
readlink \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig2.at:284"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

# Upgrade package with unmodified config file, changed in pkg
runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
readlink "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
readlink "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo-1.0
foo-2.0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig2.at:284"
$at_failed && at_fn_log_failure
$at_traceon; }


# Upgrade package with locally modified config file, changed in pkg
{ set +x
$as_echo "$at_srcdir/rpmconfig2.at:302:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
readlink \"\${cf}\"
ln -sf \"otherstuff\" \"\${cf}\"
readlink \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
readlink \"\${cf}\"
readlink \"\${cf}.rpmnew\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig2.at:302"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
readlink "${cf}"
ln -sf "otherstuff" "${cf}"
readlink "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
readlink "${cf}"
readlink "${cf}.rpmnew"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "warning: /etc/my.conf created as /etc/my.conf.rpmnew
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo-1.0
otherstuff
otherstuff
foo-2.0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig2.at:302"
$at_failed && at_fn_log_failure
$at_traceon; }


# Modified config link matches the content from new package.
{ set +x
$as_echo "$at_srcdir/rpmconfig2.at:325:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
readlink \"\${cf}\"
ln -sf \"foo-2.0\" \"\${cf}\"
readlink \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
readlink \"\${cf}\"
test ! -L \"\${cf}.rpmnew\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig2.at:325"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
readlink "${cf}"
ln -sf "foo-2.0" "${cf}"
readlink "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
readlink "${cf}"
test ! -L "${cf}.rpmnew"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo-1.0
foo-2.0
foo-2.0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig2.at:325"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_469
#AT_START_470
at_fn_group_banner 470 'rpmconfig2.at:348' \
  "upgrade unchanged shared config links" "          " 22
at_xfail=no
(
  $as_echo "470. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


for s in "A" "B"; do
    for v in "1.0" "2.0"; do
        runroot rpmbuild --quiet -bb \
            --define "sub $s" \
            --define "ver $v" \
	    --define "filedata foo" \
	    --define "filetype link" \
              /data/SPECS/configtest.spec
    done
done

# Upgrade package with config file, no backup here
{ set +x
$as_echo "$at_srcdir/rpmconfig2.at:364:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U \\
    /build/RPMS/noarch/configtest-A-1.0-1.noarch.rpm \\
    /build/RPMS/noarch/configtest-B-1.0-1.noarch.rpm
readlink \"\${cf}\"
runroot rpm -U \\
    /build/RPMS/noarch/configtest-A-2.0-1.noarch.rpm \\
    /build/RPMS/noarch/configtest-B-2.0-1.noarch.rpm
readlink \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig2.at:364"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U \
    /build/RPMS/noarch/configtest-A-1.0-1.noarch.rpm \
    /build/RPMS/noarch/configtest-B-1.0-1.noarch.rpm
readlink "${cf}"
runroot rpm -U \
    /build/RPMS/noarch/configtest-A-2.0-1.noarch.rpm \
    /build/RPMS/noarch/configtest-B-2.0-1.noarch.rpm
readlink "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
foo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig2.at:364"
$at_failed && at_fn_log_failure
$at_traceon; }


# Upgrade package with locally modified config file, unchanged in pkg
{ set +x
$as_echo "$at_srcdir/rpmconfig2.at:385:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U \\
    /build/RPMS/noarch/configtest-A-1.0-1.noarch.rpm \\
    /build/RPMS/noarch/configtest-B-1.0-1.noarch.rpm
readlink \"\${cf}\"
ln -sf \"otherstuff\" \"\${cf}\"
readlink \"\${cf}\"
runroot rpm -U \\
    /build/RPMS/noarch/configtest-A-2.0-1.noarch.rpm \\
    /build/RPMS/noarch/configtest-B-2.0-1.noarch.rpm
readlink \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig2.at:385"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U \
    /build/RPMS/noarch/configtest-A-1.0-1.noarch.rpm \
    /build/RPMS/noarch/configtest-B-1.0-1.noarch.rpm
readlink "${cf}"
ln -sf "otherstuff" "${cf}"
readlink "${cf}"
runroot rpm -U \
    /build/RPMS/noarch/configtest-A-2.0-1.noarch.rpm \
    /build/RPMS/noarch/configtest-B-2.0-1.noarch.rpm
readlink "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
otherstuff
otherstuff
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig2.at:385"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_470
#AT_START_471
at_fn_group_banner 471 'rpmconfig2.at:410' \
  "upgrade changing shared config links" "           " 22
at_xfail=no
(
  $as_echo "471. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


for s in "A" "B"; do
    for v in "1.0" "2.0"; do
        runroot rpmbuild --quiet -bb \
            --define "sub $s" \
            --define "ver $v" \
	    --define "filedata foo-$v" \
	    --define "filetype link" \
              /data/SPECS/configtest.spec
    done
done

# Upgrade package with unmodified config file, changed in pkg
{ set +x
$as_echo "$at_srcdir/rpmconfig2.at:426:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U \\
    /build/RPMS/noarch/configtest-A-1.0-1.noarch.rpm \\
    /build/RPMS/noarch/configtest-B-1.0-1.noarch.rpm
readlink \"\${cf}\"
runroot rpm -U \\
    /build/RPMS/noarch/configtest-A-2.0-1.noarch.rpm \\
    /build/RPMS/noarch/configtest-B-2.0-1.noarch.rpm
readlink \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig2.at:426"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U \
    /build/RPMS/noarch/configtest-A-1.0-1.noarch.rpm \
    /build/RPMS/noarch/configtest-B-1.0-1.noarch.rpm
readlink "${cf}"
runroot rpm -U \
    /build/RPMS/noarch/configtest-A-2.0-1.noarch.rpm \
    /build/RPMS/noarch/configtest-B-2.0-1.noarch.rpm
readlink "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo-1.0
foo-2.0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig2.at:426"
$at_failed && at_fn_log_failure
$at_traceon; }


# Upgrade package with locally modified config file, changed in pkg
{ set +x
$as_echo "$at_srcdir/rpmconfig2.at:447:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U \\
    /build/RPMS/noarch/configtest-A-1.0-1.noarch.rpm \\
    /build/RPMS/noarch/configtest-B-1.0-1.noarch.rpm
readlink \"\${cf}\"
ln -sf \"otherstuff\" \"\${cf}\"
readlink \"\${cf}\"
runroot rpm -U \\
    /build/RPMS/noarch/configtest-A-2.0-1.noarch.rpm \\
    /build/RPMS/noarch/configtest-B-2.0-1.noarch.rpm
readlink \"\${cf}\"
readlink \"\${cf}.rpmsave\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig2.at:447"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U \
    /build/RPMS/noarch/configtest-A-1.0-1.noarch.rpm \
    /build/RPMS/noarch/configtest-B-1.0-1.noarch.rpm
readlink "${cf}"
ln -sf "otherstuff" "${cf}"
readlink "${cf}"
runroot rpm -U \
    /build/RPMS/noarch/configtest-A-2.0-1.noarch.rpm \
    /build/RPMS/noarch/configtest-B-2.0-1.noarch.rpm
readlink "${cf}"
readlink "${cf}.rpmsave"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "warning: /etc/my.conf saved as /etc/my.conf.rpmsave
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo-1.0
otherstuff
foo-2.0
otherstuff
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig2.at:447"
$at_failed && at_fn_log_failure
$at_traceon; }


# Modified config link matches the content from new package.
{ set +x
$as_echo "$at_srcdir/rpmconfig2.at:474:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U \\
    /build/RPMS/noarch/configtest-A-1.0-1.noarch.rpm \\
    /build/RPMS/noarch/configtest-B-1.0-1.noarch.rpm
readlink \"\${cf}\"
ln -sf \"foo-2.0\" \"\${cf}\"
readlink \"\${cf}\"
runroot rpm -U \\
    /build/RPMS/noarch/configtest-A-2.0-1.noarch.rpm \\
    /build/RPMS/noarch/configtest-B-2.0-1.noarch.rpm
readlink \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig2.at:474"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U \
    /build/RPMS/noarch/configtest-A-1.0-1.noarch.rpm \
    /build/RPMS/noarch/configtest-B-1.0-1.noarch.rpm
readlink "${cf}"
ln -sf "foo-2.0" "${cf}"
readlink "${cf}"
runroot rpm -U \
    /build/RPMS/noarch/configtest-A-2.0-1.noarch.rpm \
    /build/RPMS/noarch/configtest-B-2.0-1.noarch.rpm
readlink "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo-1.0
foo-2.0
foo-2.0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig2.at:474"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_471
#AT_START_472
at_fn_group_banner 472 'rpmconfig2.at:500' \
  "upgrade changing shared config(noreplace) links" "" 22
at_xfail=no
(
  $as_echo "472. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


for s in "A" "B"; do
    for v in "1.0" "2.0"; do
        runroot rpmbuild --quiet -bb \
            --define "sub $s" \
            --define "ver $v" \
	    --define "filedata foo-$v" \
	    --define "filetype link" \
	    --define "noreplace 1" \
              /data/SPECS/configtest.spec
    done
done

# Upgrade package with locally modified config file, changed in pkg.
{ set +x
$as_echo "$at_srcdir/rpmconfig2.at:517:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U \\
    /build/RPMS/noarch/configtest-A-1.0-1.noarch.rpm \\
    /build/RPMS/noarch/configtest-B-1.0-1.noarch.rpm
readlink \"\${cf}\"
ln -sf \"otherstuff\" \"\${cf}\"
readlink \"\${cf}\"
runroot rpm -U \\
    /build/RPMS/noarch/configtest-A-2.0-1.noarch.rpm \\
    /build/RPMS/noarch/configtest-B-2.0-1.noarch.rpm
readlink \"\${cf}\"
readlink \"\${cf}.rpmnew\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig2.at:517"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U \
    /build/RPMS/noarch/configtest-A-1.0-1.noarch.rpm \
    /build/RPMS/noarch/configtest-B-1.0-1.noarch.rpm
readlink "${cf}"
ln -sf "otherstuff" "${cf}"
readlink "${cf}"
runroot rpm -U \
    /build/RPMS/noarch/configtest-A-2.0-1.noarch.rpm \
    /build/RPMS/noarch/configtest-B-2.0-1.noarch.rpm
readlink "${cf}"
readlink "${cf}.rpmnew"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "warning: /etc/my.conf created as /etc/my.conf.rpmnew
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo-1.0
otherstuff
otherstuff
foo-2.0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig2.at:517"
$at_failed && at_fn_log_failure
$at_traceon; }


# Modified config link matches the content from new package.
{ set +x
$as_echo "$at_srcdir/rpmconfig2.at:544:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U \\
    /build/RPMS/noarch/configtest-A-1.0-1.noarch.rpm \\
    /build/RPMS/noarch/configtest-B-1.0-1.noarch.rpm
readlink \"\${cf}\"
ln -sf \"foo-2.0\" \"\${cf}\"
readlink \"\${cf}\"
runroot rpm -U \\
    /build/RPMS/noarch/configtest-A-2.0-1.noarch.rpm \\
    /build/RPMS/noarch/configtest-B-2.0-1.noarch.rpm
readlink \"\${cf}\"
test ! -L \"\${cf}.rpmnew\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig2.at:544"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U \
    /build/RPMS/noarch/configtest-A-1.0-1.noarch.rpm \
    /build/RPMS/noarch/configtest-B-1.0-1.noarch.rpm
readlink "${cf}"
ln -sf "foo-2.0" "${cf}"
readlink "${cf}"
runroot rpm -U \
    /build/RPMS/noarch/configtest-A-2.0-1.noarch.rpm \
    /build/RPMS/noarch/configtest-B-2.0-1.noarch.rpm
readlink "${cf}"
test ! -L "${cf}.rpmnew"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo-1.0
foo-2.0
foo-2.0
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig2.at:544"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_472
#AT_START_473
at_fn_group_banner 473 'rpmconfig3.at:5' \
  "upgrade config to/from non-config" "              " 23
at_xfail=no
(
  $as_echo "473. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
        --define "ver 1.0" \
	--define "filetype file" \
	--define "filedata foo" \
          /data/SPECS/configtest.spec

runroot rpmbuild --quiet -bb \
        --define "ver 2.0" \
	--define "filetype file" \
	--define "filedata bar" \
	--define "noconfig 1" \
          /data/SPECS/configtest.spec

# non-modified config changes to non-config and back, no backups
{ set +x
$as_echo "$at_srcdir/rpmconfig3.at:23:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\" \"\${cf}\".rpm*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
cat \"\${cf}\"
runroot rpm -U --oldpackage /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig3.at:23"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}" "${cf}".rpm*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
cat "${cf}"
runroot rpm -U --oldpackage /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
bar
foo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig3.at:23"
$at_failed && at_fn_log_failure
$at_traceon; }


# modified config changes to non-config and back, back up on first upgrade
{ set +x
$as_echo "$at_srcdir/rpmconfig3.at:43:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat \"\${cf}\"
echo \"otherstuff\" > \"\${cf}\"
cat \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
cat \"\${cf}\"
cat \"\${cf}.rpmsave\"
runroot rpm -U --oldpackage /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig3.at:43"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat "${cf}"
echo "otherstuff" > "${cf}"
cat "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
cat "${cf}"
cat "${cf}.rpmsave"
runroot rpm -U --oldpackage /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "warning: /etc/my.conf saved as /etc/my.conf.rpmsave
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
otherstuff
bar
otherstuff
foo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig3.at:43"
$at_failed && at_fn_log_failure
$at_traceon; }


# modified config changes to identical non-config and back, no backups
{ set +x
$as_echo "$at_srcdir/rpmconfig3.at:69:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat \"\${cf}\"
echo \"bar\" > \"\${cf}\"
cat \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
cat \"\${cf}\"
runroot rpm -U --oldpackage /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig3.at:69"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat "${cf}"
echo "bar" > "${cf}"
cat "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
cat "${cf}"
runroot rpm -U --oldpackage /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
bar
bar
foo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig3.at:69"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_473
#AT_START_474
at_fn_group_banner 474 'rpmconfig3.at:92' \
  "upgrade config to/from config link" "             " 23
at_xfail=no
(
  $as_echo "474. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
        --define "ver 1.0" \
	--define "filetype file" \
	--define "filedata foo" \
          /data/SPECS/configtest.spec

runroot rpmbuild --quiet -bb \
        --define "ver 2.0" \
	--define "filetype link" \
	--define "filedata bar" \
          /data/SPECS/configtest.spec

# non-modified config file changes to config symlink and back, no backups
{ set +x
$as_echo "$at_srcdir/rpmconfig3.at:109:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\" \"\${cf}\".rpm*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
readlink \"\${cf}\"
runroot rpm -U --oldpackage /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig3.at:109"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}" "${cf}".rpm*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
readlink "${cf}"
runroot rpm -U --oldpackage /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
bar
foo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig3.at:109"
$at_failed && at_fn_log_failure
$at_traceon; }


# Modified config changes to config symlink
{ set +x
$as_echo "$at_srcdir/rpmconfig3.at:129:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\" \"\${cf}\".rpm*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat \"\${cf}\"
echo \"otherstuff\" > \"\${cf}\"
cat \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
readlink \"\${cf}\"
cat \"\${cf}.rpmsave\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig3.at:129"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}" "${cf}".rpm*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat "${cf}"
echo "otherstuff" > "${cf}"
cat "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
readlink "${cf}"
cat "${cf}.rpmsave"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "warning: /etc/my.conf saved as /etc/my.conf.rpmsave
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
otherstuff
bar
otherstuff
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig3.at:129"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_474
#AT_START_475
at_fn_group_banner 475 'rpmconfig3.at:153' \
  "upgrade modified config link to config" "         " 23
at_xfail=no
(
  $as_echo "475. $at_setup_line: testing $at_desc ..."
  $at_traceon


{ set +x
$as_echo "$at_srcdir/rpmconfig3.at:155:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\" \"\${cf}\".rpm*

runroot rpmbuild --quiet -bb \\
        --define \"ver 1.0\" \\
	--define \"filetype link\" \\
	--define \"filedata foo\" \\
          /data/SPECS/configtest.spec

runroot rpmbuild --quiet -bb \\
        --define \"ver 2.0\" \\
	--define \"filetype file\" \\
	--define \"filedata bar\" \\
          /data/SPECS/configtest.spec

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
readlink \"\${cf}\"
ln -sf \"otherstuff\" \"\${cf}\"
readlink \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
cat \"\${cf}\"
readlink \"\${cf}.rpmsave\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig3.at:155"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}" "${cf}".rpm*

runroot rpmbuild --quiet -bb \
        --define "ver 1.0" \
	--define "filetype link" \
	--define "filedata foo" \
          /data/SPECS/configtest.spec

runroot rpmbuild --quiet -bb \
        --define "ver 2.0" \
	--define "filetype file" \
	--define "filedata bar" \
          /data/SPECS/configtest.spec

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
readlink "${cf}"
ln -sf "otherstuff" "${cf}"
readlink "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
cat "${cf}"
readlink "${cf}.rpmsave"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "warning: /etc/my.conf saved as /etc/my.conf.rpmsave
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
otherstuff
bar
otherstuff
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig3.at:155"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_475
#AT_START_476
at_fn_group_banner 476 'rpmconfig3.at:190' \
  "upgrade config to directory" "                    " 23
at_xfail=no
(
  $as_echo "476. $at_setup_line: testing $at_desc ..."
  $at_traceon




if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb


runroot rpmbuild --quiet -bb \
        --define "ver 1.0" \
	--define "filetype file" \
	--define "filedata foo" \
          /data/SPECS/configtest.spec

runroot rpmbuild --quiet -bb \
        --define "ver 2.0" \
	--define "filetype dir" \
          /data/SPECS/configtest.spec

# Non-modified config file changes to directory.
{ set +x
$as_echo "$at_srcdir/rpmconfig3.at:206:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
test -d \"\${cf}\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig3.at:206"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
test -d "${cf}"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
at_fn_diff_devnull "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig3.at:206"
$at_failed && at_fn_log_failure
$at_traceon; }


# Modified config changes to directory
{ set +x
$as_echo "$at_srcdir/rpmconfig3.at:222:


if ! [ -d testing/ ]; then
    cp -aP \"\${RPMTEST}\" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST=\"\${PWD}/testing\"
export TOPDIR=\"\${RPMTEST}/build\"
export HOME=\"\${RPMTEST}\"

rm -rf \"\${RPMTEST}\"\`rpm --eval '%_dbpath'\`/*
runroot rpm --initdb

cf=\"\${RPMTEST}\"/etc/my.conf
rm -rf \"\${cf}\"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat \"\${cf}\"
echo \"otherstuff\" > \"\${cf}\"
cat \"\${cf}\"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
test -d \"\${cf}\"
cat \"\${cf}.rpmsave\"
"
at_fn_check_prepare_notrace 'a `...` command substitution' "rpmconfig3.at:222"
( $at_check_trace;


if ! [ -d testing/ ]; then
    cp -aP "${RPMTEST}" .
    chmod -R u+w testing/
    mkdir -p testing/build
    ln -s ../data/SOURCES testing/build/
fi
export RPMTEST="${PWD}/testing"
export TOPDIR="${RPMTEST}/build"
export HOME="${RPMTEST}"

rm -rf "${RPMTEST}"`rpm --eval '%_dbpath'`/*
runroot rpm --initdb

cf="${RPMTEST}"/etc/my.conf
rm -rf "${cf}"*

runroot rpm -U /build/RPMS/noarch/configtest-1.0-1.noarch.rpm
cat "${cf}"
echo "otherstuff" > "${cf}"
cat "${cf}"
runroot rpm -U /build/RPMS/noarch/configtest-2.0-1.noarch.rpm
test -d "${cf}"
cat "${cf}.rpmsave"

) >>"$at_stdout" 2>>"$at_stderr" 5>&-
at_status=$? at_failed=false
$at_check_filter
echo >>"$at_stderr"; $as_echo "warning: /etc/my.conf saved as /etc/my.conf.rpmsave
" | \
  $at_diff - "$at_stderr" || at_failed=:
echo >>"$at_stdout"; $as_echo "foo
otherstuff
otherstuff
" | \
  $at_diff - "$at_stdout" || at_failed=:
at_fn_check_status 0 $at_status "$at_srcdir/rpmconfig3.at:222"
$at_failed && at_fn_log_failure
$at_traceon; }

  set +x
  $at_times_p && times >"$at_times_file"
) 5>&1 2>&1 7>&- | eval $at_tee_pipe
read at_status <"$at_status_file"
#AT_STOP_476
